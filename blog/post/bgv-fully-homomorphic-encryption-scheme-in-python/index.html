<!DOCTYPE html><html lang="en"><head><title data-react-helmet="true">The BGV fully homomorphic encryption scheme | Bitdefender Research</title><meta data-react-helmet="true" name="description" content="The BGV fully homomorphic encryption schemeThis is a sister blogpost to the previous one about a similar scheme (BFV) and it&#x27;s part of the series that covers fully homomorphic encryption techniques and applications.Introduction\gdef\can #1{\|#1\|^{\text{can}}}In this blogpost we will focus on the encryption, decryption, relinearization and the ..."/><meta data-react-helmet="true" name="keywords" content="blog"/><meta data-react-helmet="true" property="og:title" content="The BGV fully homomorphic encryption scheme | Bitdefender Research"/><meta data-react-helmet="true" property="og:description" content="The BGV fully homomorphic encryption schemeThis is a sister blogpost to the previous one about a similar scheme (BFV) and it&#x27;s part of the series that covers fully homomorphic encryption techniques and applications.Introduction\gdef\can #1{\|#1\|^{\text{can}}}In this blogpost we will focus on the encryption, decryption, relinearization and the ..."/><meta data-react-helmet="true" property="og:site_name" content="https://bit-ml.github.io"/><meta data-react-helmet="true" property="article:tag" content="blog"/><meta data-react-helmet="true" property="og:image" content="https://bit-ml.github.io/galleries/bgv_scheme2023/lock.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:site" content="@Bitdefender"/><meta data-react-helmet="true" name="twitter:title" content="The BGV fully homomorphic encryption scheme | Bitdefender Research"/><meta data-react-helmet="true" name="twitter:description" content="The BGV fully homomorphic encryption schemeThis is a sister blogpost to the previous one about a similar scheme (BFV) and it&#x27;s part of the series that covers fully homomorphic encryption techniques and applications.Introduction\gdef\can #1{\|#1\|^{\text{can}}}In this blogpost we will focus on the encryption, decryption, relinearization and the ..."/><meta data-react-helmet="true" name="twitter:image" content="https://bit-ml.github.io/galleries/bgv_scheme2023/lock.jpg"/><meta data-react-helmet="true" itemProp="description" content="The BGV fully homomorphic encryption schemeThis is a sister blogpost to the previous one about a similar scheme (BFV) and it&#x27;s part of the series that covers fully homomorphic encryption techniques and applications.Introduction\gdef\can #1{\|#1\|^{\text{can}}}In this blogpost we will focus on the encryption, decryption, relinearization and the ..."/><meta data-react-helmet="true" itemProp="keywords" content="blog"/><meta data-react-helmet="true" itemProp="image" content="https://bit-ml.github.io/galleries/bgv_scheme2023/lock.jpg"/><link rel="preload" as="script" href="https://bit-ml.github.io/bootstrap.627376fc.js"/><link rel="preload" as="script" href="https://bit-ml.github.io/templates/src/pages/Post.6f8f419e.js"/><link rel="preload" as="script" href="https://bit-ml.github.io/main.6dead43a.js"/><link rel="preload" as="style" href="https://bit-ml.github.io/styles.c960d3bf.css"/><link rel="stylesheet" href="https://bit-ml.github.io/styles.c960d3bf.css"/><meta charSet="UTF-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="apple-touch-icon" href="icon.png"/><style data-styled-components="iHRNpA XnyzJ dsJdO eglhTf kihGxn gDEKjd hnfUJl hWAXyU kuoEPx hKelgb gLoNrh bStMIm dYMJEb">
/* sc-component-id: sc-global-552716834 */
html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;-webkit-text-decoration:none;text-decoration:none;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} figure{margin:0;} img{border-style:none;max-width:100%;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} html{font-size:19px;box-sizing:border-box;} *,*::before,*::after{box-sizing:inherit;} body{font-family:"Roboto",Helvetica,Arial,sans-serif;line-height:1.78rem;padding:0;background:#FFF;} h1{display:block;margin:0.67em 0;} .math-display{overflow-x:auto;} @media (min-width:74.6875em){.math-display{overflow-x:initial;}} .remark-highlight{font-size:14px;} @media (min-width:74.6875em){.remark-highlight{font-size:16px;}} p.hint.tip,p.hint.error,p.hint.warn{-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;box-sizing:border-box;font-size:inherit;line-height:1.6rem;word-spacing:0.05rem;background-color:rgba(238,238,238,0.5);border-bottom-right-radius:2px;border-top-right-radius:2px;padding:8px 12px 8px 24px;margin-bottom:16px;position:relative;} p.hint.tip:before,p.hint.error:before,p.hint.warn:before{border-radius:100%;color:#fff;content:'!';font-size:14px;font-weight:700;left:-12px;line-height:20px;position:absolute;height:20px;width:20px;text-align:center;top:12px;} p.hint.tip{border-left:4px solid #27ab83;} p.hint.tip:before{display:none;} p.hint.warn{border-left:4px solid #f0b429;} p.hint.warn:before{background-color:#f0b429;} p.hint.error{border-left:4px solid #ef4e4e;} p.hint.error:before{background-color:#ef4e4e;content:'×';} .content table{border-collapse:collapse;border-spacing:0;empty-cells:show;border:1px solid #cbcbcb;font-size:12px;line-height:1.0rem;} @media (min-width:74.6875em){.content table{font-size:19px;line-height:1.78rem;}} .content caption{color:#000;font:italic 85%/1 arial,sans-serif;padding:1em 0;text-align:center;} .content td,.content th{border-left:1px solid #cbcbcb;border-width:0 0 0 1px;font-size:inherit;margin:0;overflow:visible;padding:0.5em 1em;} .content thead{background-color:#e0e0e0;color:#000;text-align:left;vertical-align:bottom;} .content td{background-color:#f2f2f2;} .content tr:nth-child(2n-1) td{background-color:transparent;} .content td{border-bottom:1px solid #cbcbcb;} .content tbody > tr:last-child > td{border-bottom-width:0;} .content td,.content th{border-width:0 0 1px 0;border-bottom:1px solid #cbcbcb;} .content tbody > tr:last-child > td{border-bottom-width:0;}
/* sc-component-id: Navigation__Nav-sc-qabwmo-0 */
.gDEKjd{width:100%;background:transparent;padding:0 1rem;font-family:"Roboto",Helvetica,Arial,sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;} .gDEKjd a{padding:0.5rem 0 0.25rem 0;font-style:normal;font-weight:500;line-height:23px;font-size:14px;text-align:right;text-transform:uppercase;color:#333;} .gDEKjd a:last-child{padding:0.5rem;padding-right:0;} @media (min-width:74.6875em){.gDEKjd{padding:0 5rem;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}.gDEKjd a{padding:0.5rem 1rem 0.25rem 1rem;}}
/* sc-component-id: Featured__StyledButtonBack-sc-xm4c49-5 */
.iHRNpA{position:absolute;top:50%;left:-5px;margin-left:10px;margin-top:-20px;width:40px;height:40px;padding:10px;background:none;border:none;outline:none;border-radius:40px;} @media (min-width:46.0625em){.iHRNpA{left:10px;width:70px;height:70px;padding:15px;}} @media (min-width:64.0625em){.iHRNpA{left:10px;width:70px;height:70px;padding:15px;}}
/* sc-component-id: Featured__StyledButtonNext-sc-xm4c49-6 */
.XnyzJ{position:absolute;top:50%;right:-5px;margin-right:10px;margin-top:-20px;width:40px;height:40px;padding:10px;background:none;border:none;outline:none;border-radius:40px;} @media (min-width:46.0625em){.XnyzJ{right:10px;width:70px;height:70px;padding:15px;}} @media (min-width:64.0625em){.XnyzJ{right:10px;width:70px;height:70px;padding:15px;}}
/* sc-component-id: Post__PageWithCoverImg-sc-oyq0rs-0 */
@media (min-width:74.6875em){.dsJdO{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}.dsJdO nav{padding:0;}} @media (min-width:46.0625em){.dsJdO{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}}
/* sc-component-id: Post-sc-oyq0rs-1 */
.kihGxn{margin:0 auto;padding:0 1rem;} @media (min-width:46.0625em){.kihGxn{max-width:62%;padding:0 2rem;}} @media (min-width:74.6875em){.kihGxn{max-width:62%;padding:0 5rem;}}
/* sc-component-id: Post__PostContent-sc-oyq0rs-2 */
.hnfUJl{margin:0 auto;max-width:720px;} .hnfUJl > h1{font-family:"Exo 2",sans-serif;font-size:2.074rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:2.074rem;} .hnfUJl > h1 > span{display:block;font-size:1.20rem;line-height:2.074rem;} @media (min-width:74.6875em){.hnfUJl > h1{font-size:2.488rem;line-height:3.57895rem;}.hnfUJl > h1 > span{font-size:1.44rem;}} .hnfUJl > h2{font-family:"Exo 2",sans-serif;font-size:1.728rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:2.074rem;} @media (min-width:74.6875em){.hnfUJl > h2{font-size:2.074rem;line-height:3.57895rem;}} .hnfUJl > h3{font-family:"Exo 2",sans-serif;font-size:1.44rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:1.78947rem;} @media (min-width:74.6875em){.hnfUJl > h3{font-size:1.728rem;}} .hnfUJl > h4{font-family:"Exo 2",sans-serif;font-size:1.20rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:1.78947rem;} @media (min-width:74.6875em){.hnfUJl > h4{font-size:1.44rem;}} .hnfUJl > h5{font-family:"Exo 2",sans-serif;font-size:1.20rem;font-weight:600;margin-top:1.78947rem;margin-bottom:0;padding:0;line-height:1.78947rem;} .hnfUJl p{font-family:"Roboto",Helvetica,Arial,sans-serif;font-size:1.00rem;font-weight:300;margin-top:0;margin-bottom:1.78947rem;padding:0;font-style:normal;-webkit-letter-spacing:0.03em;-moz-letter-spacing:0.03em;-ms-letter-spacing:0.03em;letter-spacing:0.03em;color:#333;} .hnfUJl p > strong{font-weight:500;} .hnfUJl >table{font-family:"Roboto",Helvetica,Arial,sans-serif;font-size:0.694rem;font-weight:300;margin-bottom:1.78947rem;} .hnfUJl >table > strong{font-weight:500;} @media (min-width:74.6875em){.hnfUJl div.wide-content+table{width:920px;margin-left:-100px;}} .hnfUJl a{-webkit-text-decoration:underline;text-decoration:underline;color:#333;} .hnfUJl a:hover{color:#e6212b;} .hnfUJl ul,.hnfUJl ol{margin-top:0;margin-bottom:1.78947rem;font-weight:300;line-height:1.78947rem;} .hnfUJl ul > li ul,.hnfUJl ol > li ul{margin-bottom:0;} .hnfUJl > img,.hnfUJl > p img{margin:0 auto;display:block;} .hnfUJl > blockquote{font-size:1.1rem;font-family:"Roboto",Helvetica,Arial,sans-serif;font-style:italic;font-weight:300;line-height:1.8rem;-webkit-letter-spacing:0.03em;-moz-letter-spacing:0.03em;-ms-letter-spacing:0.03em;letter-spacing:0.03em;text-align:right;margin-right:0;padding:24px;quotes:"\201E""\201C";} .hnfUJl > blockquote:before{display:inline-block;-webkit-transform:translate(-15px,-15px);-ms-transform:translate(-15px,-15px);transform:translate(-15px,-15px);content:open-quote;color:#edebeb;font-size:5rem;font-weight:400;} .hnfUJl > blockquote > footer{margin-top:10px;font-style:normal;font-weight:400;} .hnfUJl > details summary{cursor:pointer;}
/* sc-component-id: Post__PostHeader-sc-oyq0rs-5 */
.hWAXyU{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-family:"Roboto",Helvetica,Arial,sans-serif;font-style:normal;font-weight:400;line-height:1.8rem;-webkit-letter-spacing:0.03em;-moz-letter-spacing:0.03em;-ms-letter-spacing:0.03em;letter-spacing:0.03em;}
/* sc-component-id: Post__BackLink-sc-oyq0rs-6 */
.kuoEPx{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;color:#828282;} .kuoEPx:hover{color:#e6212b;}
/* sc-component-id: Post__Date-sc-oyq0rs-7 */
.hKelgb{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;font-size:1rem;text-align:right;color:#828282;}
/* sc-component-id: Post__PostFooter-sc-oyq0rs-8 */
.gLoNrh{display:inline-block;background:#edebeb;width:100%;}
/* sc-component-id: Post__PostFooterWraper-sc-oyq0rs-9 */
.bStMIm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:720px;padding:0 1rem;margin:0 auto;} .bStMIm > p{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;color:#828282;} @media (min-width:74.6875em){.bStMIm{padding-left:0 0 0 100px;}}
/* sc-component-id: Post__CoverImg-sc-oyq0rs-10 */
@media (min-width:46.0625em){.eglhTf{background:#fff url(/galleries/bgv_scheme2023/lock.jpg) no-repeat bottom;background-size:cover;position:-webkit-sticky;position:sticky;top:0;left:0;height:100vh;width:38%;}} @media (min-width:74.6875em){.eglhTf{background:#fff url(/galleries/bgv_scheme2023/lock.jpg) no-repeat bottom;background-size:cover;position:-webkit-sticky;position:sticky;top:0;left:0;height:100vh;width:38%;}}</style></head><body><div id="root"><div class="content" data-reactroot=""><div><div class="Post__PageWithCoverImg-sc-oyq0rs-0 dsJdO"><div class="Post__CoverImg-sc-oyq0rs-10 eglhTf"></div><div class="Post-sc-oyq0rs-1 kihGxn"><header><nav class="Navigation__Nav-sc-qabwmo-0 gDEKjd"><a href="https://bit-ml.github.io/">Home</a><a href="https://bit-ml.github.io/#research">Research</a><a href="https://bit-ml.github.io/#teams">Team</a><a href="https://bit-ml.github.io/teaching/lectures-and-courses">Teaching</a></nav></header><section class="Post__PostContent-sc-oyq0rs-2 hnfUJl"><div class="Post__PostHeader-sc-oyq0rs-5 hWAXyU"><a class="Post__BackLink-sc-oyq0rs-6 kuoEPx active" aria-current="page" href="https://bit-ml.github.io/">&lt;<!-- --> Back Home</a><small class="Post__Date-sc-oyq0rs-7 hKelgb">published on <!-- -->June 29, 2023</small></div><h1>The BGV fully homomorphic encryption scheme</h1>
<p>This is a sister blogpost to the <a href="https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/">previous one about a similar scheme (BFV)</a> and it&#x27;s part of the series that covers fully homomorphic encryption techniques and applications.</p>
<h2>Introduction</h2>
<p><span><span><span>\gdef\can #1{\|#1\|^{\text{can}}}</span><span aria-hidden="true"></span></span></span></p>
<p>In this blogpost we will focus on the encryption, decryption, relinearization and the noise analysis of the <a href="https://eprint.iacr.org/2011/277.pdf">Brakerski, Gentry, Vaikuntanathan (BGV)</a> fully homomorphic encryption scheme. A Python implementation of the aforementioned will be provided.</p>
<p>DISCLAIMER: This toy implementation is not meant to be secure or optimized
for efficiency. It&#x27;s for educational purposes only, and for us to better understand the inner workings.</p>
<p><strong>What to expect from this blogpost?</strong></p>
<ol>
<li>We briefly describe the motivations of fully homomorphic encryption.</li>
<li>We present the BGV scheme.</li>
<li>We offer a <a href="https://github.com/zademn/EverythingCrypto/blob/master/E3-Homomorphic-Encryption/BGV.ipynb">Python implementation</a> for the BGV scheme, for educational purposes.</li>
</ol>
<p>Now, let&#x27;s make a short, informal, tour before starting.
<a href="https://en.wikipedia.org/wiki/Homomorphic_encryption"><strong>Fully homomorphic encryption</strong></a> (FHE) allows us to perform computation on encrypted data. While there are a few cryptographic schemes to achieve this, in this blogpost we explore the <a href="https://eprint.iacr.org/2011/277.pdf"><strong>BGV scheme</strong></a>.</p>
<p>Firstly, this scheme allows us to encrypt messages into ciphertexts. Intuitively, a message is hidden in a ciphertext if there is no way to get to retrieve the original message from its encryption. To an attacker that sees a ciphertext, that ciphertext should look like &quot;random garbage&quot;. In order to achieve this we hide the message by &quot;masking&quot; it with some noise. We say it&#x27;s <em>hard</em> for an attacker to retrieve a message from its ciphertext if doing so is at least as hard as solving a computationally unfeasable problem. The problem the security of the BGV scheme is based on is called the <a href="https://en.wikipedia.org/wiki/Ring_learning_with_errors"><strong>Ring Learning with Errors problem</strong></a>.</p>
<p>Secondly, the scheme allows us to perform arithmetic operations (additions, multiplications) using noisy ciphertexts. However, we will encounter some problems along the way, such as the noise increasing after computations, or the size of the resulting ciphertext increasing. We&#x27;ll see how to handle these using <strong>modulus switching</strong> (for the former) and <strong>relinearization</strong> (for the latter).</p>
<p>This post will get a bit mathematical, so before starting we introduce some notation. Any other notation will be defined when introduced.</p>
<p>Notations:</p>
<ul>
<li><span><span><span>m,m′,m∗m, m&#x27;, m^*</span><span aria-hidden="true"><span><span></span><span>m</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> - messages.</li>
<li><span><span><span>c,c′,c∗c, c&#x27;, c^*</span><span aria-hidden="true"><span><span></span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> - ciphertexts. If ciphertexts have more components, we denote the components with indices: <span><span><span>c=(c0,c1)c = (c_0, c_1)</span><span aria-hidden="true"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></li>
<li><span><span><span>λ\lambda</span><span aria-hidden="true"><span><span></span><span>λ</span></span></span></span></span> - Security parameter.</li>
<li><span><span><span>Zq\mathbb Z_q</span><span aria-hidden="true"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - the set of integers from <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden="true"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span></li>
<li><span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span> - Ring.
<ul>
<li>Ex: <span><span><span>Z\mathbb Z</span><span aria-hidden="true"><span><span></span><span>Z</span></span></span></span></span> - the integers.</li>
<li>Ex: <span><span><span>Z[X]/(Xn+1)\mathbb Z[X] / (X^n + 1)</span><span aria-hidden="true"><span><span></span><span>Z</span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span> - the quotient polynomial ring with integer coefficients: .</li>
</ul>
</li>
<li><span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - Ring modulo the ideal generated by <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>.
<ul>
<li>Ex:  <span><span><span>Zq\mathbb Z_q</span><span aria-hidden="true"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - the integers mod <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>.</li>
<li>Ex: <span><span><span>Zq[X]/(Xn+1)\mathbb Z_q[X]/ (X^n + 1)</span><span aria-hidden="true"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span> - the quotient polynomial ring with coefficients being integers in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden="true"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>.</li>
</ul>
</li>
<li><span><span><span>[a]q[a]_q</span><span aria-hidden="true"><span><span></span><span>[</span><span>a</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - <span><span><span>a mod qa \bmod q</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span>, coefficients centered in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden="true"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>. When applying <span><span><span>[⋅]q[\cdot ]_q</span><span aria-hidden="true"><span><span></span><span>[</span><span>⋅</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to a polynomial we mean to apply it to all its coefficients individually. When applying <span><span><span>[⋅][\cdot]</span><span aria-hidden="true"><span><span></span><span>[</span><span>⋅</span><span>]</span></span></span></span></span> to a vector of elements, we mean to apply it to each element individually. So <span><span><span>[(a,b)]q=([a]q,[b]q)[(a, b)]_q = ([a]_q, [b]_q)</span><span aria-hidden="true"><span><span></span><span>[</span><span>(</span><span>a</span><span>,</span><span></span><span>b</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>a</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>[</span><span>b</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>. We give the similar treatment to reduction <span><span><span> mod q\bmod q</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> operation</li>
<li><span><span><span>χ=χ(λ)\chi = \chi(\lambda)</span><span aria-hidden="true"><span><span></span><span>χ</span><span></span><span>=</span><span></span></span><span><span></span><span>χ</span><span>(</span><span>λ</span><span>)</span></span></span></span></span> - Noise distribution, parametrized by <span><span><span>λ\lambda</span><span aria-hidden="true"><span><span></span><span>λ</span></span></span></span></span> (usually Gaussian).</li>
<li>For simplicity, when we say we sample a polynomial from some distribution (or a polynomial comes from some distribution) we mean that its coefficients are sampled independently from that distribution.</li>
<li><span><span><span>e←χe \leftarrow \chi</span><span aria-hidden="true"><span><span></span><span>e</span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span> - An element <span><span><span>ee</span><span aria-hidden="true"><span><span></span><span>e</span></span></span></span></span> sampled from the distribution <span><span><span>χ\chi</span><span aria-hidden="true"><span><span></span><span>χ</span></span></span></span></span></li>
<li><span><span><span>a←RSa \xleftarrow R S</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span>S</span></span></span></span></span> - An element sampled uniformly from a set <span><span><span>SS</span><span aria-hidden="true"><span><span></span><span>S</span></span></span></span></span>
<ul>
<li>Ex: <span><span><span>a←RRqa \xleftarrow R R_q</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> An element <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> sampled uniformly from the ring <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li><span><span><span>a⋅ba \cdot b</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>b</span></span></span></span></span>  denotes the multiplication of 2 elements from the ring <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
<li><span><span><span>tata</span><span aria-hidden="true"><span><span></span><span>t</span><span>a</span></span></span></span></span>  denotes the multiplication of coefficients of <span><span><span>a∈Rqa \in R_q</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> by some scalar <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span>.</li>
</ul>
<h2>Fully Homomorphic Encryption (FHE)</h2>
<p>Before defining fully homomorphic encryption, let&#x27;s look at some <strong>applications</strong> of it to get a better intuition:</p>
<p><strong>1. Outsourcing storage and computations</strong></p>
<ul>
<li>A company wants to use a cloud provider to store data and do computational heavy lifting.</li>
<li><em>Task</em>: The company wants to use the information (for example: to do machine learning, extract statistical properties) without locally retrieving it  (defeating the purpose of using the cloud company services). Furthermore, the company doesn&#x27;t want the cloud provider to see the sensitive data.</li>
<li><em>Solution</em>: Using homomorphic encryption, the company can encrypt and send the data to the cloud provider and then the cloud provider can process the information (as requested by the company) in the encrypted form, without learning anything about the data.</li>
<li>Ex: finance, medical apps, consumer privacy in ads.</li>
</ul>
<p><strong>2. Private queries</strong></p>
<ul>
<li>A client wants to retrieve a query against a large database held by a provider.</li>
<li><em>Task</em>: The client wants to retrieve a query <strong>without</strong> the database provider learning the query.</li>
<li><em>Solution</em>: Using homomorphic encryption the client can encrypt the index of the record and then the database can use this encrypted index to fetch (the comparison operation can be done using FHE) and return the encrypted result to the client. Finally, the client can decrypt the record.</li>
</ul>
<p><strong>3. Private set intersection</strong></p>
<ul>
<li>A client and a server each has a set of elements. The client wants to know which elements from its set are in the server&#x27;s set.</li>
<li><em>Task</em>: The client wants to find out the intersection of its elements and the server&#x27;s, without the server learning anything about the client&#x27;s elements and vice versa.</li>
<li><em>Solution (Very simplified)</em>: They translate the comparison operation into a subtraction (<span><span><span>x=y⇒x−y=0x = y \Rightarrow x - y = 0</span><span aria-hidden="true"><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span>y</span><span></span><span>⇒</span><span></span></span><span><span></span><span>x</span><span></span><span>−</span><span></span></span><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span></span>). The client encrypts its elements and sends them to the server. Then, the server evalutes these subtractions homomorphically. Because the result of the subtraction is an encrypted result, the server learns nothing. Then the server sends the comparison results back and the client decrypts the results. We have a longer, more in-depth blogpost about it <a href="https://bit-ml.github.io/blog/post/private-set-intersection-an-implementation-in-python/">here</a>. Happy reading!</li>
<li>Examples: Client: user contacts, Server: whatsapp contacts; Client: own passwords, Server: database with breached passwords.</li>
</ul>
<p><em>Intuition</em></p>
<ul>
<li>A user has an arithmetic function <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span> and some inputs <span><span><span>(m1,...mn)(m_1, ... m_n)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</li>
<li>He wants to compute <span><span><span>m∗=f(m1,...mn)m^* = f(m_1, ... m_n)</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> but instead of computing it directly, he wants to encrypt <span><span><span>(m1,...mn)→(c1,...cn)(m_1, ... m_n) \to (c_1, ... c_n)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>→</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>c</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> and do the computation on the ciphertext, obtaining a result which eventually decrypts to <span><span><span>m∗=f(m1,...mn)m^* =f(m_1, ... m_n)</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</li>
<li>It&#x27;s helpful to view the functions as tree of operations. For example (taken from the <a href="https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/">BFV blogpost</a>): <span><span><span>f(m1,m2,m3,m4)=(m1×m2+m3)×m4f(m_1,m_2,m_3,m_4)= (m_1 \times m_2 + m_3) \times m_4</span><span aria-hidden="true"><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>×</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>×</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
</ul>
<p><img src="https://i.imgur.com/ub2OyXu.png" alt=""/></p>
<p><strong>Homomorphic Encryption -- Definition</strong><br/>
Let  <span><span><span>(KeyGen,Enc,Dec,Eval)(\text{KeyGen}, \text{Enc}, \text{Dec}, \text{Eval})</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>KeyGen</span></span><span>,</span><span></span><span><span>Enc</span></span><span>,</span><span></span><span><span>Dec</span></span><span>,</span><span></span><span><span>Eval</span></span><span>)</span></span></span></span></span> be a tuple of procedures.<br/>
Let <span><span><span>f∈Ff \in \mathcal F</span><span aria-hidden="true"><span><span></span><span>f</span><span></span><span>∈</span><span></span></span><span><span></span><span>F</span></span></span></span></span> be a function in a family of functions. This function can also be written as a <em>circuit</em> from a family of circuits <span><span><span>C∈CC \in \mathcal C</span><span aria-hidden="true"><span><span></span><span>C</span><span></span><span>∈</span><span></span></span><span><span></span><span>C</span></span></span></span></span>.</p>
<ul>
<li><span><span><span>(sk,pk)←KeyGen(1λ,1d)(sk, pk) \gets \text{KeyGen}(1^\lambda, 1^d)</span><span aria-hidden="true"><span><span></span><span>(</span><span>s</span><span>k</span><span>,</span><span></span><span>p</span><span>k</span><span>)</span><span></span><span>←</span><span></span></span><span><span></span><span><span>KeyGen</span></span><span>(</span><span><span>1</span><span><span><span><span><span><span></span><span><span>λ</span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>1</span><span><span><span><span><span><span></span><span><span>d</span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> - key generation, <span><span><span>λ\lambda</span><span aria-hidden="true"><span><span></span><span>λ</span></span></span></span></span> is a security parameter, <span><span><span>dd</span><span aria-hidden="true"><span><span></span><span>d</span></span></span></span></span> is a functionality parameter (degree of the polynomial or depth of the circtuit).</li>
<li><span><span><span>ci←Enc(pk,mi)c_i \gets \text{Enc}(pk, m_i)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span><span>Enc</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> - Encryption of a message <span><span><span>mim_i</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> --  known as <strong>fresh ciphertexts</strong>.</li>
<li><span><span><span>c∗=Eval(pk,f,c1,...cn)c^* = \text{Eval}(pk, f, c_1, ... c_n)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Eval</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>f</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>c</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> - Evaluate the function <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span> on the ciphertexts  -- known as <strong>evaluated ciphertexts</strong>.</li>
</ul>
<p><strong>Correctness</strong><br/>
We require the (FHE) scheme to correctly decrypt both fresh and evaluated ciphertexts:
<span><span><span>Dec(sk,c∗)=m∗=f(m1,...,mn)\text{Dec}(sk, c^*) = m^* = f(m_1, ..., m_n)</span><span aria-hidden="true"><span><span></span><span><span>Dec</span></span><span>(</span><span>s</span><span>k</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></p>
<p><img src="https://bit-ml.github.io/galleries/bgv_scheme2023/fhe_simple_tiny.png" alt=""/></p>
<p>In the image above, the user with the laptop is interested  evaluating a certain circuit on its data <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span>. Therefore it sends its data, encrypted, to the cloud so that the cloud computes the circuit. By correctness, the user indeed gets the circuit applied on its data <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span>.</p>
<p><strong>Circuits?</strong><br/>
The two important operations we care about are addition and multiplication, because with them we can construct any arithmetic operation! Homomorphic encryption schemes started out by encrypting bits, so the equivalent operations for additon and multiplication on bits, <code>xor</code> and <code>and</code> are used.</p>
<div><span><span><span>⊕=+ mod 2⊗=× mod 2\oplus = + \bmod 2 \\
\otimes = \times \bmod 2 </span><span aria-hidden="true"><span><span></span><span>⊕</span><span></span><span>=</span><span></span></span><span><span></span><span>+</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span><span></span><span><span></span><span>⊗</span><span></span><span>=</span><span></span></span><span><span></span><span>×</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span></span></span></span></div>
<p>To convey the fact that a circuit supports both <code>xor</code> and <code>and</code> usually a <code>nand</code> gate is used, because <code>nand</code> gates are composed by 1 multiplication and 1 addition and they are logically complete (you can build any circuit with them).
<span><span><span>nand(a,b)=a×b+1 mod 2\text{nand}(a, b) = a \times b + 1 \bmod 2</span><span aria-hidden="true"><span><span></span><span><span>nand</span></span><span>(</span><span>a</span><span>,</span><span></span><span>b</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>a</span><span></span><span>×</span><span></span></span><span><span></span><span>b</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span></span></span></span></p>
<p>By extending to multiple bits, with the gates we discussed above you can represent any computation using boolean circuits.</p>
<p>HE can be classified based on the type of functions <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span> that it supports:</p>
<ul>
<li><strong>Partially homomorphic encryption</strong><br/>
Given <span><span><span>Enc(m1)\text{Enc}(m_1)</span><span aria-hidden="true"><span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, and <span><span><span>Enc(m2)\text{Enc}(m_2)</span><span aria-hidden="true"><span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> you can do limited operations (either additions or multiplications)</li>
<li><strong>Somewhat (leveled) homomorphic encryption</strong><br/>
Given <span><span><span>Enc(m1),...,Enc(mn)\text{Enc}(m_1), ..., \text{Enc}(m_n)</span><span aria-hidden="true"><span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> you can compute <span><span><span>Enc(f(m1,...mn))\text{Enc}(f(m_1, ... m_n))</span><span aria-hidden="true"><span><span></span><span><span>Enc</span></span><span>(</span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span></span></span></span> where <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span> is a polynomial of a limited degree.
One can do limited number of multiplications (Circuits of a maximum depth).</li>
<li><strong>Fully homomorphic encryption</strong><br/>
One can do unlimited multiplications and additions.</li>
</ul>
<p>The community put a lot of effort into the analysing FHE schemes: finding good parameters, finding software and hardware optimizations, coming up with possible attacks and adjusting the schemes against them. An interesting read is the <a href="https://homomorphicencryption.org/standard/">homomorphic encryption standard</a>, which compiles good practices and techniques for developing and using existing schemes.</p>
<h2>Ring Learning With Errors (RLWE)</h2>
<p>In this section we&#x27;ll focus on briefly introducing the Ring learning with errors (RLWE) problem. The problem is very complex and we&#x27;ll only attempt to cover the basic blocks for building an intuition. For the interested reader more details can be found in this <a href="https://eprint.iacr.org/2012/230.pdf">paper</a>.</p>
<h3>Quick recap on working with polynomials</h3>
<p>This section is taken from the <a href="https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/">BFV blogpost</a>, but we&#x27;ll repeat it here to save you a click. For this subsection we denote with <span><span><span>Z/qZ={0,...,q−1}\mathbb Z / q\mathbb Z = \{0, ... , q - 1\}</span><span aria-hidden="true"><span><span></span><span>Z</span><span>/</span><span>q</span><span>Z</span><span></span><span>=</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span>q</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>.</p>
<p>The HE scheme we are going to describe deals with <em>adding and multiplying
polynomials</em>. Here we present a quick example of how to work with
polynomials, so that we all have the same starting point. If you already know
how to do this, you can skip it.</p>
<p>First thing, let&#x27;s add and multiply polynomials <em>modulo some polynomial <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span></em>.
This &quot;modulo <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span>&quot; thing simply means that we add and multiply the polynomials
in the usual way, but we take the remainders of the results when divided by
<span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span>. When we do these additions and multiplications <span><span><span> mod f\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, we sometimes
say in a fancy way that we are working in the <em>ring</em> <span><span><span>Z[x]/(f)\mathbb{Z}[x]/(f)</span><span aria-hidden="true"><span><span></span><span><span>Z</span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span> of
reduced polynomials.</p>
<p>Let&#x27;s take <span><span><span>f=x4+1f = x^4 +1</span><span aria-hidden="true"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. If we look at <span><span><span>p(x)=x5p(x) =x^5</span><span aria-hidden="true"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span>,
then <span><span><span>p(x)=x⋅(x4+1)−xp(x) = x \cdot (x^4 + 1) - x</span><span aria-hidden="true"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>x</span><span></span><span>⋅</span><span></span></span><span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>−</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Therefore, when taking the reminder we get
<span><span><span>p(x)=−x mod fp(x) = -x \bmod f</span><span aria-hidden="true"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>−</span><span>x</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span></span></span></span></span>. For faster computations <span><span><span> mod f\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span> you can use this trick:
when making <span><span><span> mod f\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, simply replace <span><span><span>x4x^4</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>−1-1</span><span aria-hidden="true"><span><span></span><span>−</span><span>1</span></span></span></span></span>, <span><span><span>x5x^5</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>−x-x</span><span aria-hidden="true"><span><span></span><span>−</span><span>x</span></span></span></span></span> and so on.</p>
<p>Let&#x27;s consider two polynomials <span><span><span>a(x)=x3+x2+7a(x) = x^3 + x^2 + 7</span><span aria-hidden="true"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span> and <span><span><span>b(x)=x2+11xb(x) = x^2 + 11x</span><span aria-hidden="true"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span>.
Then:</p>
<div><span><span><span>a(x)+b(x) mod f=x3+2x2+11x+7 mod f.a(x)+b(x) \bmod f = x^3 + 2x^2 + 11x + 7 \text { mod }f.</span><span aria-hidden="true"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>7</span><span><span> mod </span></span><span>f</span><span>.</span></span></span></span></span></div>
<p>Here nothing special happened. Let&#x27;s multiply them:</p>
<div><span><span><span>a(x)⋅b(x) mod f=(x3+x2+7)⋅(x2+11x) mod f=x5+11x4+x4+11x3+7x2+77x mod f=−x−11−1+11x3+7x2+77x mod f=11x3+7x2+76x−12 mod f.\begin{aligned}
a(x) \cdot b(x) \bmod f
    &amp;= (x^3 + x^2 + 7)\cdot (x^2 +11x) \text { mod }f \\
    &amp;= x^5 + 11x^4 + x^4 + 11x^3 + 7x^2 + 77x \text { mod }f\\
    &amp;= -x - 11 - 1 + 11x^3 + 7x^2 + 77x \text { mod }f \\
    &amp;= 11x^3 + 7x^2 + 76x - 12 \text { mod }f.
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>⋅</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>f</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span>x</span><span>)</span><span><span> mod </span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span> mod </span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>x</span><span></span><span>−</span><span></span><span>1</span><span>1</span><span></span><span>−</span><span></span><span>1</span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span> mod </span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>6</span><span>x</span><span></span><span>−</span><span></span><span>1</span><span>2</span><span><span> mod </span></span><span>f</span><span>.</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Now let&#x27;s go one step further and see how we perform these operations of
polynomials not just modulo <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span>, <em>but also modulo some integer <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span></em>. As you
might expect, the coefficients of these polynomials are also reduced modulo
<span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>, so they always take integer values from <span><span><span>00</span><span aria-hidden="true"><span><span></span><span>0</span></span></span></span></span> to <span><span><span>q−1.q-1.</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>.</span></span></span></span></span> This time, we say
that we are working the ring of reduced polynomials <span><span><span>Z/qZ[x]/(f)\mathbb{Z} / q\mathbb Z[x]/(f)</span><span aria-hidden="true"><span><span></span><span><span>Z</span></span><span>/</span><span>q</span><span>Z</span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span>.</p>
<p>Let&#x27;s take the previous example, <span><span><span>f=x4+1f = x^4+1</span><span aria-hidden="true"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, <span><span><span>a(x)=x3+x2+7a(x)=x^3+x^2+7</span><span aria-hidden="true"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span>,
<span><span><span>b(x)=x2+11xb(x)=x^2+11x</span><span aria-hidden="true"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span> and consider <span><span><span>q=5q =5</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>5</span></span></span></span></span>. We can think of <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> and <span><span><span>bb</span><span aria-hidden="true"><span><span></span><span>b</span></span></span></span></span> as already
taken <span><span><span> mod f\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>. If we take them further modulo <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>, then <span><span><span>[a(x)]q=x3+x2+2[a(x)]_q = x^3 +
x^2 +2</span><span aria-hidden="true"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span> and <span><span><span>[b(x)]q=x2+x[b(x)]_q = x^2+x</span><span aria-hidden="true"><span><span></span><span>[</span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Moreover,</p>
<div><span><span><span>[a(x)+b(x)]q=x3+x2+2+x2+x=x3+2x2+x+2[a(x) + b(x)]_q = x^3 + x^2 +2+ x^2 + x = x^3 + 2x^2 + x+2</span><span aria-hidden="true"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span></div>
<p>and</p>
<div><span><span><span>[a(x)⋅b(x)]q=(x3+x2+2)⋅(x2+x)=x5+x4+x4+x3+2x2+2x=−x−1−1+x3+2x2+2x=x3+2x2+x+3\begin{aligned}
[a(x) \cdot b(x)]_q
    &amp;= (x^3 + x^2+2) \cdot (x^2 + x)\\
    &amp;= x^5 + x^4 + x^4 +x^3+2x^2 + 2x\\
    &amp;= -x -1 -1 + x^3 +2x^2+2x\\
    &amp;= x^3+2x^2+x+3
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>⋅</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>x</span><span></span><span>−</span><span></span><span>1</span><span></span><span>−</span><span></span><span>1</span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span></span><span>+</span><span></span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>To give a powerful visual intuition of polynomials in quotient rings, consider the following polynomial<span><span><span>1+4x+2x3∈Z/5Z[x]/(x4+1)1 + 4x + 2x^3 \in \mathbb Z/5\mathbb Z[x] / (x^4+1)</span><span aria-hidden="true"><span><span></span><span>1</span><span></span><span>+</span><span></span></span><span><span></span><span>4</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>∈</span><span></span></span><span><span></span><span>Z</span><span>/</span><span>5</span><span>Z</span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>
and its visual representation. For this grade 3 polynomial we have four pentagons, for each coefficient. Each pentagon represents <span><span><span>Z/5Z\mathbb Z/ 5\mathbb Z</span><span aria-hidden="true"><span><span></span><span>Z</span><span>/</span><span>5</span><span>Z</span></span></span></span></span>. The value of the coefficient is colored with green:</p>
<p><img src="https://bit-ml.github.io/galleries/bgv_scheme2023/poly_tiny.png" alt="poly"/></p>
<h3>The security of the BGV scheme</h3>
<p>Like we said in the introduction, our ciphertexts will be masked with some noise to look as random as possible in order to hide any information an attacker may extract about the message.</p>
<p>In fact it can be proven that the BGV scheme is secure as long as nobody can solve the Ring Learning With Errors (RLWE) problem described below. The parameters of the scheme must be chosen such that there are no known algorithms to solve the underlying RLWE problem in feasable time.</p>
<p>Formally, the idea of &quot;ciphertexts looking like garbage&quot; is called <a href="https://en.wikipedia.org/wiki/Ciphertext_indistinguishability"><strong>ciphertext indistinguishability</strong></a>. This concept can be formulated using a game between a challenger and an adversary:</p>
<ul>
<li>The challenger receives two messages <span><span><span>m0,m1m_0, m_1</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> from the adversary. Then, the challenger encrypts them into <span><span><span>c0,c1c_0, c_1</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</li>
<li>Then, the challenger secretly flips a bit <span><span><span>b∈{0,1}b\in \{0, 1\}</span><span aria-hidden="true"><span><span></span><span>b</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>}</span></span></span></span></span> and sends the ciphertext <span><span><span>cbc_b</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to the adversary.</li>
<li>The adversary must guess the bit <span><span><span>bb</span><span aria-hidden="true"><span><span></span><span>b</span></span></span></span></span>. After running an efficient algorithm, it outputs a bit <span><span><span>b′b&#x27;</span><span aria-hidden="true"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span>. It wins if <span><span><span>b′=bb&#x27; = b</span><span aria-hidden="true"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>b</span></span></span></span></span>.</li>
</ul>
<p><img src="https://bit-ml.github.io/galleries/bgv_scheme2023/sec_game_tiny.png" alt="sec_game"/></p>
<p>If there exists <strong>at least one</strong> adversary that can win the game with a probability significantly larger than 1/2 (a coinflip) using a computationally efficient algorithm (something that can run in our universe&#x27;s lifetime), the challenger&#x27;s algorithm is considered insecure. When we prove the security of a scheme, we actually show that if an adversary had such an algorithm that can win the security game, he can take that algorithm and use it to solve a problem that is considered <a href="https://en.wikipedia.org/wiki/Computational_hardness_assumption"><em>computationally hard</em></a>.</p>
<p>We will now describe the RLWE problem.</p>
<p>Consider the quotient polynomial ring <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \mathbb Z_q[X]/ (X^n + 1)</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>. This ring has polynomials with degree at most <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> and integer coefficients in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden="true"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>.</p>
<p><strong>The RLWE problem - decision</strong><br/>
The problem asks to distinguish between the following two distributions:</p>
<ul>
<li><span><span><span>(ai,bi)(a_i, b_i)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> with <span><span><span>ai←RRqa_i \xleftarrow R R_q</span><span aria-hidden="true"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, <span><span><span>bi←RRqb_i \xleftarrow R R_q</span><span aria-hidden="true"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</li>
<li><span><span><span>(ai,bi)(a_i, b_i)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> with <span><span><span>ai←RRqa_i \xleftarrow R R_q</span><span aria-hidden="true"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, <span><span><span>ei←χe_i \leftarrow \chi</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span>,  and <span><span><span>bi=ai⋅s+eib_i = a_i \cdot s + e_i</span><span aria-hidden="true"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> for some &quot;small&quot; secret <span><span><span>s∈Rqs \in R_q</span><span aria-hidden="true"><span><span></span><span>s</span><span></span><span>∈</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> sampled before.</li>
</ul>
<p>The RLWE problem also has a search version, where given pairs <span><span><span>(ai,bi)(a_i, b_i)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, <span><span><span>bi=ai⋅s+eib_i = a_i \cdot s + e_i</span><span aria-hidden="true"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> you need to find <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>. In practice, the decision version is more widely used when proving the security of different schemes.</p>
<p>More details about the RLWE problem can be found in this <a href="https://eprint.iacr.org/2012/230.pdf">paper</a>. In essence, by adding some small noise <span><span><span>eie_i</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, from a Gaussian distribution, we make our secret <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> unrecoverable even if we have access to many RLWE samples.</p>
<p>The <a href="https://eprint.iacr.org/2011/277.pdf">original BGV paper</a> presents the algorithms (encryption, decryption, etc) of a HE scheme based on a more general problem, the <em>General Learning with Errors (GLWE)</em>  problem. For simplicity, we work with the RLWE case in this blogpost.</p>
<h2>The BGV encryption scheme</h2>
<p>Generate the following parameters</p>
<ul>
<li><span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> - degree of <span><span><span>Xn+1X^n + 1</span><span aria-hidden="true"><span><span></span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> is chosen as a power of 2.</li>
<li><span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span> - ciphertext modulus.</li>
<li><span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> - plainext modulus, <span><span><span>t≪qt \ll q</span><span aria-hidden="true"><span><span></span><span>t</span><span></span><span>≪</span><span></span></span><span><span></span><span>q</span></span></span></span></span>.</li>
<li><span><span><span>χ\chi</span><span aria-hidden="true"><span><span></span><span>χ</span></span></span></span></span> - the noise distribution, a discrete Gaussian.</li>
</ul>
<p>We consider <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \mathbb Z_q[X] / (X^n + 1)</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>. This ring has polynomials with degree at most <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> and integer coefficients in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden="true"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>All polynomial operations are considered <span><span><span> mod q\bmod q</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> unless otherwise specified, to ease notation.</li>
<li>When we talk about &quot;small&quot; polynomials, we intuitively think about them having  small coefficients.</li>
<li>Polynomials that come from the noise distribution will be colored with green (ex: <span><span><span>e\textcolor{darkgreen}{e}</span><span aria-hidden="true"><span><span></span><span>e</span></span></span></span></span>) and the ones that will come from the secret key distribution will be colored with red (Ex: <span><span><span>s,u\red{s}, \red{u}</span><span aria-hidden="true"><span><span></span><span>s</span><span>,</span><span></span><span>u</span></span></span></span></span>).</li>
</ul>
<p>We will have one secret key <span><span><span>sksk</span><span aria-hidden="true"><span><span></span><span>s</span><span>k</span></span></span></span></span>, a public key with two components <span><span><span>pk=(pk0,pk1)pk = (pk_0, pk_1)</span><span aria-hidden="true"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, a ciphertext with 2 components <span><span><span>c=(c0,c1)c = (c_0, c_1)</span><span aria-hidden="true"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>
The messsage will come from the ring <span><span><span>RtR_t</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p><code>SecretKeyGen(params) -&gt; sk</code></p>
<ul>
<li>Draw <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> from a secret key distribution which outputs &quot;small&quot; elements with overwhelming probability. In practice <span><span><span>s∈{−1,0,1}n\red{s} \in \{-1, 0, 1\}^n</span><span aria-hidden="true"><span><span></span><span>s</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>−</span><span>1</span><span>,</span><span></span><span>0</span><span>,</span><span></span><span>1</span><span><span>}</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>, with the probability of sampling <span><span><span>00</span><span aria-hidden="true"><span><span></span><span>0</span></span></span></span></span> specified as a parameter and the probabilities of sampling <span><span><span>−1-1</span><span aria-hidden="true"><span><span></span><span>−</span><span>1</span></span></span></span></span> or <span><span><span>11</span><span aria-hidden="true"><span><span></span><span>1</span></span></span></span></span> being equal.</li>
<li>Return the secret key <span><span><span>sk=ssk = \red{s}</span><span aria-hidden="true"><span><span></span><span>s</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>s</span></span></span></span></span>.</li>
</ul>
<p><code>PubKeyGen(sk, params) -&gt; (pk0, pk1)</code></p>
<ul>
<li>Draw a random element <span><span><span>a←RRqa \xleftarrow R R_q</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and the noise <span><span><span>e←χ\textcolor{darkgreen}{e} \leftarrow \chi</span><span aria-hidden="true"><span><span></span><span>e</span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span>.</li>
<li>Return the public key: <span><span><span>pk=(pk0,pk1)=(a⋅s+te,−a)⏟RLWE instance-likepk = (pk_0, pk_1) = \underbrace{(a \cdot \red{s} + t\textcolor{darkgreen}{e}, -a)}_{\text{RLWE instance-like}}</span><span aria-hidden="true"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>RLWE instance-like</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span>,</span><span></span><span>−</span><span>a</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>.</li>
</ul>
<p>Notice that the public key  looks like a RLWE sample, but the error <span><span><span>ee</span><span aria-hidden="true"><span><span></span><span>e</span></span></span></span></span> is multiplied by the plaintext modulus <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span>.</p>
<p><code>Encrypt(m, pk, params) -&gt; (c0, c1)</code></p>
<ul>
<li>Draw the noise <span><span><span>e0,e1←χ\textcolor{darkgreen}{e_0}, \textcolor{darkgreen}{e_1} \leftarrow \chi</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span> and a &quot;small&quot; polynomial <span><span><span>u∈{−1,0,1}n\red{u} \in \{-1, 0, 1\}^n</span><span aria-hidden="true"><span><span></span><span>u</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>−</span><span>1</span><span>,</span><span></span><span>0</span><span>,</span><span></span><span>1</span><span><span>}</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span> in the same way as the secret.</li>
<li>Compute <span><span><span>c0=pk0⋅u+te0+mc_0 = pk_0 \cdot \red{u} + t\textcolor{darkgreen}{e_0} + m</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>m</span></span></span></span></span></li>
<li>Compute <span><span><span>c1=pk1⋅u+te1c_1 = pk_1 \cdot \red{u} + t\textcolor{darkgreen}{e_1}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
<li>Return <span><span><span>c=(c0,c1)c = (c_0, c_1)</span><span aria-hidden="true"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</li>
</ul>
<p>The ciphertext components <span><span><span>(c0,c1)(c_0, c_1)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> are elements in <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \mathbb Z_q[X]/(X^n + 1)</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>.</p>
<p><code>Decrypt(c, sk, params)</code></p>
<ul>
<li>Compute <span><span><span>m=c0+c1⋅s mod q mod tm = c_0 + c_1 \cdot \red{s} \bmod q \bmod t</span><span aria-hidden="true"><span><span></span><span>m</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span></li>
<li>Return <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span>.</li>
</ul>
<p>Let&#x27;s unroll the equations to check the correctness. All operation are <span><span><span> mod q\bmod q</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> to ease notation, unless we specify otherwise.</p>
<p>The public key is:</p>
<div><span><span><span>pk0=a⋅s+tepk1=−a\begin{aligned}
pk_0 &amp;= a \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e} \\
pk_1 &amp;= -a
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>The public key hides the secret <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> as a RLWE sample.</p>
<p>The encryption equations unrolled are:</p>
<div><span><span><span>c0=pk0⋅u+te0+m=(a⋅s+te)⋅u+te0+m=a⋅s⋅u+t(e⋅u)+te0+mc1=pk1⋅u+te1=−a⋅u+te1\begin{aligned}
c_0 = pk_0 \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e}_0 + m \\
&amp;= (a \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e}) \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_0} + m \\
&amp;= a \cdot \textcolor{red}{s} \cdot \textcolor{red}{u} + t(\textcolor{darkgreen}{e} \cdot \textcolor{red}{u}) + t\textcolor{darkgreen}{e_0} + m
\\
c_1 &amp;= pk_1 \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_1} \\
&amp;= -a \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_1} \\
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span>)</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>a</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>The decryption equation unrolled is:</p>
<div><span><span><span>c0+c1⋅s=a⋅s⋅u+t(e⋅u)+te0+m+(−a⋅u+te1)⋅s mod q=a⋅s⋅u+t(e⋅u)+te0+m−a⋅u⋅s+te1⋅s=te1⋅s+t(e⋅u)+te0+m=t(e⋅u+e0+e1⋅s)⏟error+m\begin{aligned}
c_0 + c_1 \cdot \textcolor{red}{s} &amp;= a \cdot \textcolor{red}{s} \cdot \textcolor{red}{u} + t(\textcolor{darkgreen}{e} \cdot \textcolor{red}{u}) + t\textcolor{darkgreen}{e_0} + m + (-a \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_1}) \cdot \textcolor{red}{s} \bmod q \\
&amp;= \cancel{a \cdot \textcolor{red}{s} \cdot \textcolor{red}{u}} + t(\textcolor{darkgreen}{e} \cdot \textcolor{red}{u}) + t\textcolor{darkgreen}{e_0} + m \cancel{-a \cdot \textcolor{red}{u} \cdot \textcolor{red}{s}} + t\textcolor{darkgreen}{e_1} \cdot \textcolor{red}{s} \\
&amp;= t\textcolor{darkgreen}{e_1} \cdot \textcolor{red}{s} + t(\textcolor{darkgreen}{e} \cdot \textcolor{red}{u}) + t\textcolor{darkgreen}{e_0} + m \\
&amp;= \underbrace{t(\textcolor{darkgreen}{e} \cdot \textcolor{red}{u} + \textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e_1} \cdot \textcolor{red}{s})}_{\text{error}} + m
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span>(</span><span>−</span><span>a</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>⋅</span><span></span><span>u</span></span></span><span><span></span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span><span><span><span><span><span></span><span><span>−</span><span>a</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span><span>error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>The decryption is correct as long as the error we add to <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span> does not wrap the coefficients of <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span> arond the modulus <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>. The noise analysis will be offered later, in its own section.</p>
<p>Now, we reduce the above <span><span><span> mod t\bmod t</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> and we get:</p>
<div><span><span><span>c0+c1⋅s=m mod q mod tc_0+c_1 \cdot \textcolor{red}{s} = m \bmod q \bmod t</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span></div>
<h2>FHE Operations</h2>
<p>Here we will explore the homomorphic properties of the scheme. We refer to the two input message and ciphertext pairs with <span><span><span>(m,c),(m′,c′)(m, c), (m&#x27;, c&#x27;)</span><span aria-hidden="true"><span><span></span><span>(</span><span>m</span><span>,</span><span></span><span>c</span><span>)</span><span>,</span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> and to the resulting message-ciphertext pair  with <span><span><span>(m∗,c∗)(m^*, c^*)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</p>
<p>The goal is to find two functions, <span><span><span>add,mul\text{add}, \text{mul}</span><span aria-hidden="true"><span><span></span><span><span>add</span></span><span>,</span><span></span><span><span>mul</span></span></span></span></span></span>, that work on ciphertexts, for addition and multiplication, such that:</p>
<ul>
<li>when <span><span><span>m∗=m+m′m^* = m + m&#x27;</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we have <span><span><span>c∗=add(c,c′)c^* = \text{add}(c, c&#x27;)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>add</span></span><span>(</span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>Dec(c∗)=m∗\text{Dec}(c^*) = m^*</span><span aria-hidden="true"><span><span></span><span><span>Dec</span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span></li>
<li>when <span><span><span>m∗=m⋅m′m^* = m \cdot m&#x27;</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we have <span><span><span>c∗=mul(c,c′)c^* = \text{mul}(c, c&#x27;)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>mul</span></span><span>(</span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>Dec(c∗)=m∗\text{Dec}(c^*) = m^*</span><span aria-hidden="true"><span><span></span><span><span>Dec</span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>Recall that <span><span><span>cc</span><span aria-hidden="true"><span><span></span><span>c</span></span></span></span></span> and <span><span><span>c′c&#x27;</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> encrypt <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span> and <span><span><span>m′m&#x27;</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> i.e.:</p>
<div><span><span><span>c0=pk0⋅u+te0+mc1=pk1⋅u+te1c0′=pk0⋅u′+te0′+mc1′=pk1⋅u′+te1′\begin{aligned}
c_0 &amp;= pk_0 \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_0} + m \\
c_1 &amp;= pk_1 \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_1} \\
\\
c&#x27;_0 &amp;= pk_0 \cdot \textcolor{red}{u&#x27;} + t\textcolor{darkgreen}{e&#x27;_0} + m \\
c&#x27;_1 &amp;= pk_1 \cdot \textcolor{red}{u&#x27;} + t\textcolor{darkgreen}{e&#x27;_1} \\
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<h3>FHE Addition</h3>
<p>The image on the left performs the addition before the encryption, with the messages in clear. This is not what we want. The image on the right is the desirable outcome, where we encrypt the messages, then perform addition on the encrypted messages.</p>
<p><img src="https://bit-ml.github.io/galleries/bgv_scheme2023/fhe_add_tiny.png" alt="fhe_add"/></p>
<p>We define <code>add</code>:
<code>add(c, c&#x27;) -&gt; c*</code></p>
<ul>
<li><span><span><span>c0∗=c0+c0′c^*_0 = c_0 + c&#x27;_0</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
<li><span><span><span>c1∗=c1+c1′c^*_1 = c_1 + c&#x27;_1</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
<li>return <span><span><span>c∗=(c0∗,c1∗)c^* = (c^*_0, c^*_1)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></li>
</ul>
<div><span><span><span>c0∗=c0+c0′=pk0⋅u+te0+m+pk0⋅u′+te0′+m′=pk0⋅(u+u′)+t(e0+e0′)+m+m′=(a⋅s+te)⋅(u+u′)+t(e0+e0′)+m+m′=(a⋅s)⋅(u+u′)+te⋅(u+u′)+t(e0+e0′)+m+m′c1∗=c1+c1′=pk1⋅u+te1+pk1⋅u′+te1′=pk1(u+u′)+t(e1+e1′)=−a(u+u′)+t(e1+e1′)\begin{aligned}
c^*_0 &amp;= c_0 + c&#x27;_0 \\
&amp;= pk_0 \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_0} + m + pk_0 \cdot \textcolor{red}{u&#x27;} + t\textcolor{darkgreen}{e&#x27;_0} + m&#x27; \\
&amp;= pk_0 \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e&#x27;_0}) + m + m&#x27; \\
&amp;= (a \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e}) \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e&#x27;_0}) + m + m&#x27; \\
&amp;= (a \cdot \textcolor{red}{s} ) \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t\textcolor{darkgreen}{e} \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e&#x27;_0}) + m + m&#x27;
\\
\\
c^*_1 &amp;= c_1 + c&#x27;_1 \\
&amp;= pk_1 \cdot \textcolor{red}{u} + t\textcolor{darkgreen}{e_1} + pk_1 \cdot \textcolor{red}{u&#x27;} + t\textcolor{darkgreen}{e&#x27;_1} \\ 
&amp;= pk_1(\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_1} + \textcolor{darkgreen}{e&#x27;_1}) \\
&amp;= -a(\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_1} + \textcolor{darkgreen}{e&#x27;_1})
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>a</span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>And by using <code>Decrypt(c*, sk, params)</code> we have</p>
<div><span><span><span>c0∗+c1∗⋅s=(a⋅s)⋅(u+u′)+te⋅(u+u′)+t(e0+e0′)+m+m′⏞c0∗++(−a(u+u′)+t(e1+e1′))⏞c1∗⋅s=(a⋅s)⋅(u+u′)+te⋅(u+u′)+t(e0+e0′)+m+m′−−(a⋅s)⋅(u+u′)+t(e1+e1′)⋅s=te⋅(u+u′)+t(e0+e0′)+t(e1+e1′)⋅s+m+m′=t(e⋅(u+u′)+e0+e0′+(e1+e1′)⋅s)⏟error+m+m′\begin{aligned}
c^*_0 + c^*_1 \cdot \textcolor{red}{s} &amp;= \overbrace{(a \cdot \textcolor{red}{s} ) \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + \textcolor{darkgreen}{te} \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e&#x27;_0}) + m + m&#x27;}^{c^*_0} + \\
&amp;+ \overbrace{(-a(\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_1} + \textcolor{darkgreen}{e&#x27;_1}))}^{c^*_1} \cdot \textcolor{red}{s} \\
&amp;= \cancel{(a \cdot \textcolor{red}{s} ) \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;})} + t\textcolor{darkgreen}{e} \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e&#x27;_0}) + m + m&#x27; - \\
&amp; \cancel{-(a \cdot \textcolor{red}{s}) \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;})} +  t(\textcolor{darkgreen}{e_1} + \textcolor{darkgreen}{e&#x27;_1}) \cdot \textcolor{red}{s} \\
&amp;= t\textcolor{darkgreen}{e} \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + t(\textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e&#x27;_0}) + t(\textcolor{darkgreen}{e_1} + \textcolor{darkgreen}{e&#x27;_1}) \cdot \textcolor{red}{s}  + m + m&#x27; \\
&amp;=  \underbrace{t(\textcolor{darkgreen}{e} \cdot (\textcolor{red}{u} + \textcolor{red}{u&#x27;}) + \textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e&#x27;_0} + (\textcolor{darkgreen}{e_1} + \textcolor{darkgreen}{e&#x27;_1}) \cdot \textcolor{red}{s} )}_{\text{error}} + m + m&#x27;
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span><span><span><span></span><span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span>+</span></span></span><span><span></span><span><span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span><span><span><span></span><span><span>(</span><span>−</span><span>a</span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>−</span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>−</span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span><span>error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Again, by reducing everything <span><span><span> mod t\bmod t</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> we have</p>
<div><span><span><span>c0∗+c1∗⋅s=m∗=m+m′ mod tc^*_0 + c^*_1 \cdot \red{s} = m^* = m + m&#x27; \bmod t</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span></div>
<p>with the same remark that for the decryption to be correct the error that we add to <span><span><span>m∗m^*</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> must not wrap <span><span><span>m∗m^*</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> around <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>.</p>
<p>The resulting ciphertext <span><span><span>c∗c^*</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> is not fresh anymore (just encrypted), and has a bigger noise than any of the previous ciphertexts that were inputs in the addition operation. In general, using non-fresh ciphertexts <span><span><span>c∗c^*</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> to perform future operations will carry over the noise from all the previous operations.</p>
<p>We&#x27;ll analyse how the noise grows in a dedicated section at the end.</p>
<h3>FHE Multiplication</h3>
<p>As in the addition case, we want the multiplication to be done on the encrypted messages.</p>
<p><img src="https://bit-ml.github.io/galleries/bgv_scheme2023/fhe_mul_tiny.png" alt="fhe_mul"/></p>
<p>Before describing how we multiply two ciphertexts we need to reinterpret the decryption equation:
<span><span><span>c0+c1⋅s≡m mod tc_0 + c_1 \cdot \red{s}  \equiv m \bmod t</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>≡</span><span></span></span><span><span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span>
as a linear equation:
<span><span><span>y=ax+by = ax + b</span><span aria-hidden="true"><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>a</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span></span></span></span></span>
in <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>.</p>
<p>If we look at adding two such linear equations in <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> we obtain another linear  equation in <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>:
<span><span><span>c0+c1⋅s+c0′+c1′⋅s=(c0+c0′)⏟c0∗+(c1+c1′)⏟c1∗⋅sc_0 + c_1 \cdot \red{s} + c&#x27;_0  + c&#x27;_1 \cdot \red{s} = \underbrace{(c_0 + c_0&#x27;)}_{c^*_0}  + \underbrace{(c_1 + c&#x27;_1)}_{c^*_1} \cdot \red{s}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span></p>
<p>However, when multiplying two linear equations in <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> we get a quadratic equation (<span><span><span>ax2+bx+cax^2 + bx + c</span><span aria-hidden="true"><span><span></span><span>a</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span></span></span></span></span>) in <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>:</p>
<div><span><span><span>(c0+c1⋅s)⏟=m mod t⋅(c0′+c1′⋅s)⏟=m′ mod t=c1⋅c1′⋅s2+(c0⋅c1′+c1⋅c0′)⋅s+c0⋅c0′\begin{aligned}
\underbrace{(c_0 + c_1 \cdot \textcolor{red}{s} )}_{= m \bmod t} \cdot \underbrace{(c&#x27;_0 + c&#x27;_1 \cdot \textcolor{red}{s} )}_{= m&#x27; \bmod t} &amp;= c_1 \cdot c&#x27;_1 \cdot \textcolor{red}{s}^2 + (c_0 \cdot c&#x27;_1 + c_1 \cdot c&#x27;_0) \cdot \textcolor{red}{s} +c_0 \cdot c&#x27;_0
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span></span><span><span><span>=</span><span>m</span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span><span><span></span><span><span><span>=</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>We can define <code>mul</code> in the following way:
<code>mul(c, c&#x27;) -&gt; c*</code></p>
<ul>
<li><span><span><span>c0∗=c0⋅c0′c^*_0 = c_0 \cdot c&#x27;_0</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
<li><span><span><span>c1∗=c0⋅c1′+c1⋅c0′c^*_1 = c_0 \cdot c&#x27;_1 + c_1 \cdot c&#x27;_0</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
<li><span><span><span>c2∗=c1⋅c1′c^*_2 = c_1 \cdot c&#x27;_1</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>
<li>return <span><span><span>c∗=(c0∗,c1∗,c2∗)c^* = (c^*_0, c^*_1, c^*_2)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></li>
</ul>
<p><strong>Remarks</strong></p>
<ul>
<li>Similarly, as in addition, the noise of the resulting ciphertext <span><span><span>c∗c^*</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> increases.</li>
<li>We increase the number of ciphertext components by 1. This is not sustainable.</li>
<li>Our decryption equation is linear, however after <code>mul</code> we have a quadratic decryption equation with 3 ciphertexts that doesn&#x27;t play well with our idea of linear decryption equation.</li>
</ul>
<p>To solve the remarks the concept of <strong>relinearization</strong> is introduced.</p>
<h2>Relinearization</h2>
<p>The concept was explained in the <a href="https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/">BFV blogpost</a> as well.</p>
<p><em>Intuition</em>: We want to transform the quadratic equation <span><span><span>c0∗+c1∗⋅s+c2∗⋅s2c^*_0 + c^*_1 \cdot \red{s} + c^*_2 \cdot \red{s}^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> in <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> into some other linear equation <span><span><span>c^0+c^1⋅s^\hat c_0 + \hat c_1 \cdot \red{\hat s}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span>s</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span> in some other secret key <span><span><span>s^\red{\hat s}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span></span><span>s</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>In order to do this we need to give some extra information (a &quot;hint&quot;) about the key <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> that will help us get <span><span><span>s^\red{\hat s}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span></span><span>s</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Consider the hint to be the pair:</p>
<div><span><span><span>(ek0,ek1)=((a⋅s+te)+s2,−a)(ek_0, ek_1) = ((a \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e}) + \textcolor{red}{s}^2, -a)</span><span aria-hidden="true"><span><span></span><span>(</span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>(</span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>e</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span><span></span><span>−</span><span>a</span><span>)</span></span></span></span></span></div>
<p>This is very similar to how the public key is generated and we can use the <code>PubKeyGen -&gt; (pk0, pk1)</code> to generate it:
<span><span><span>(pk0+s2,pk1)(pk_0 + \red{s}^2, pk_1)</span><span aria-hidden="true"><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>
Intuitively, we use a RLWE sample to hide <span><span><span>s2\red{s}^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Notice that:</p>
<div><span><span><span>ek0+ek1⋅s=a⋅s+e+s2−a⋅s=s2+eek_0 + ek_1 \cdot \textcolor{red}{s} = \cancel{\textcolor{red}{a} \cdot \textcolor{red}{s}} + \textcolor{darkgreen}{e} + \textcolor{red}{s}^2 - \cancel{\textcolor{red}{a} \cdot \textcolor{red}{s}} = \textcolor{red}{s}^2 + \textcolor{darkgreen}{e}</span><span aria-hidden="true"><span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>a</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>a</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span></span></span></span></span></div>
<p>The easiest way to get the term <span><span><span>c2∗s2c^*_2 \red{s}^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> from the above equation is to multiply it by <span><span><span>c2∗c^*_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. However, <span><span><span>c2∗c^*_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a random element in <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and it will yield some large noise <span><span><span>c2∗ec^*_2\textcolor{darkgreen}{e}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>e</span></span></span></span></span>. So we have to do something smarter.</p>
<h3>Key switching v1</h3>
<p>Key switching is a variant of relinearization. We start with a ciphertext <span><span><span>cc</span><span aria-hidden="true"><span><span></span><span>c</span></span></span></span></span>.</p>
<p><strong>Idea</strong>:<br/>
Split the ciphertext into multiple &quot;small&quot; ciphertexts (for now think of small as the ciphertext polynomials having small coefficents). We can do this by decomposing the ciphertext coefficients into a small base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span>.</p>
<p><em>Intuition</em>:<br/>
To build an intuition, we can take the most common bases used in representing numbers:</p>
<ul>
<li>Base 10: <span><span><span>12310=3⋅100+2⋅101+1⋅102123_{10} = 3 \cdot 10^0 + 2 \cdot 10 ^1 + 1 \cdot 10^2</span><span aria-hidden="true"><span><span></span><span>1</span><span>2</span><span><span>3</span><span><span><span><span><span><span></span><span><span><span>1</span><span>0</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>3</span><span></span><span>⋅</span><span></span></span><span><span></span><span>1</span><span><span>0</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span></span><span>⋅</span><span></span></span><span><span></span><span>1</span><span><span>0</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span>⋅</span><span></span></span><span><span></span><span>1</span><span><span>0</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span></li>
<li>Base 2: <span><span><span>1210=11002=1⋅23+1⋅22+0⋅21+0⋅2012_{10} = 1100_2 = 1 \cdot 2^3 + 1 \cdot 2^2 + 0 \cdot 2^1 + 0 \cdot 2^0</span><span aria-hidden="true"><span><span></span><span>1</span><span><span>2</span><span><span><span><span><span><span></span><span><span><span>1</span><span>0</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span>1</span><span>0</span><span><span>0</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>0</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>0</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>Programmatically, this can be done by dividing the integer by the base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> <em>repeatedly</em> and collecting the remainders.</p>
<p>In Python code:</p>
<div><pre><code><span>def</span><span> </span><span>int2base</span><span>(</span>x<span>:</span><span> </span><span>int</span><span>,</span><span> </span>base<span>:</span><span> </span><span>int</span><span>)</span><span> </span><span>-</span><span>&gt;</span><span> </span>List<span>[</span><span>int</span><span>]</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>digits<span> </span><span>=</span><span> </span><span>[</span><span>]</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>while</span><span> </span>x<span> </span><span>&gt;</span><span> </span><span>0</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q<span>,</span><span> </span>r<span> </span><span>=</span><span> </span><span>divmod</span><span>(</span>x<span>,</span><span> </span>base<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>digits<span>.</span>append<span>(</span>r<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>x<span> </span><span>=</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>digits<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span></span>
<span></span><span>print</span><span>(</span>int2base<span>(</span><span>123</span><span>,</span><span> </span><span>10</span><span>)</span><span>)</span><span></span>
<span></span><span>#<span> </span>[3,<span> </span>2,<span> </span>1]</span><span></span>
<span></span><span>print</span><span>(</span>int2base<span>(</span><span>12</span><span>,</span><span> </span><span>2</span><span>)</span><span>)</span><span></span>
<span></span><span>#<span> </span>[0,<span> </span>0,<span> </span>1,<span> </span>1]</span>
</code></pre></div>
<p>A ciphertext component <span><span><span>c∈Rqc \in R_q</span><span aria-hidden="true"><span><span></span><span>c</span><span></span><span>∈</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a polynomial of degree less than <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span>, with coefficients in <span><span><span>{0,1,..,q−1}\{0,1,..,q-1\}</span><span aria-hidden="true"><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>,</span><span></span><span>.</span><span>.</span><span>,</span><span></span><span>q</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>, which we denote as follows:
<span><span><span>c(x)=c[0]+c[1]x+...+c[n−1]xn−1c(x) = c[0] + c[1]x + ... + c[n-1]x^{n-1}</span><span aria-hidden="true"><span><span></span><span>c</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span>[</span><span>0</span><span>]</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>1</span><span>]</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>.</span><span>.</span><span>.</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>n</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>]</span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>We want to write the coefficients <span><span><span>(c[0],...,c[n−1])(c[0], ..., c[n-1])</span><span aria-hidden="true"><span><span></span><span>(</span><span>c</span><span>[</span><span>0</span><span>]</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span>c</span><span>[</span><span>n</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>]</span><span>)</span></span></span></span></span> in base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span>. Since any coefficient is less than <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>, this decomposition has at most <span><span><span>⌊log⁡Tq⌋+1\lfloor \log_T q \rfloor + 1</span><span aria-hidden="true"><span><span></span><span>⌊</span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> terms. For example <span><span><span>c[0]=∑i=0⌊log⁡Tq⌋Tic[0](i)c[0] = \sum_{i=0}^{\lfloor \log_T q \rfloor} T^i c[0]^{(i)}</span><span aria-hidden="true"><span><span></span><span>c</span><span>[</span><span>0</span><span>]</span><span></span><span>=</span><span></span></span><span><span></span><span><span>∑</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>c</span><span>[</span><span>0</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> where <span><span><span>c[0](i)c[0]^{(i)}</span><span aria-hidden="true"><span><span></span><span>c</span><span>[</span><span>0</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> is the corresponding digit <span><span><span>&lt;T&lt; T</span><span aria-hidden="true"><span><span></span><span>&lt;</span><span></span></span><span><span></span><span>T</span></span></span></span></span> in the decomposition. Using these digits we can construct the polynomials <span><span><span>c(i)c^{(i)}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span>:</p>
<div><span><span><span>c(i)(x)=c[0](i)+c[1](i)x+...+c[n−1](i)xn−1c^{(i)}(x) = c[0]^{(i)} + c[1]^{(i)}x + ... + c[n-1]^{(i)}x^{n-1}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span>[</span><span>0</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>1</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>.</span><span>.</span><span>.</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>n</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Then using these polynomials we can decompose the original polynomial <span><span><span>cc</span><span aria-hidden="true"><span><span></span><span>c</span></span></span></span></span>:</p>
<div><span><span><span>c=∑i=0⌊log⁡Tq⌋Ti⋅c(i) mod qc = \sum_{i=0}^{\lfloor \log_T q \rfloor} T^i  \cdot c^{(i)} \bmod q</span><span aria-hidden="true"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>
<p>The polynomials <span><span><span>c(i)c^{(i)}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> are elements of <span><span><span>RTR_T</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and for a reasonable small <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> they have small coefficients (<span><span><span>&lt;T&lt; T</span><span aria-hidden="true"><span><span></span><span>&lt;</span><span></span></span><span><span></span><span>T</span></span></span></span></span>). For each one of them we generate the hints:</p>
<div><span><span><span>(ek0(i),ek1(i))=(ai⋅s+tei+Tis2,−ai)(ek_0^{(i)}, ek_1^{(i)}) = (a_i \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e_i} + T^i\textcolor{red}{s}^2, -a_i)</span><span aria-hidden="true"><span><span></span><span>(</span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span><span></span><span>−</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></div>
<p>with <span><span><span>ai←RRqa_i \xleftarrow{R} R_q</span><span aria-hidden="true"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span><span>R</span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>ei←χ\textcolor{darkgreen}{e_i} \leftarrow \chi</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span>.</p>
<p>Now we go back to our ciphertext <span><span><span>c∗=(c0∗,c1∗,c2∗)c^* = (c_0^*, c_1^*, c_2^*)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, the result of <code>EvalMul</code>. We decompose <span><span><span>c2∗c^*_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> in the base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> and we get:</p>
<div><span><span><span>c2∗=∑i=0⌊log⁡Tq⌋Ti⋅c2∗(i) mod qc^*_2 = \sum_{i=0}^{\lfloor \log_T q \rfloor} T^i  \cdot {c^*_2}^{(i)} \bmod q</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>
<p>Then we construct the new ciphertext <span><span><span>c^\hat c</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span> with the <strong>two</strong> components:</p>
<div><span><span><span>c^0=c0∗+∑i=0⌊log⁡Tq⌋ek0(i)⋅c2∗(i)=c0∗+∑i=0⌊log⁡Tq⌋((ai⋅s+tei)+Tis2)⋅c2∗(i)c^1=c1∗+∑i=0⌊log⁡Tq⌋ek1(i)⋅c2∗(i)=c1∗+∑i=0⌊log⁡Tq⌋−ai⋅c2∗(i)\begin{aligned}
\hat c_0 &amp;= c^*_0 + \sum_{i=0}^{\lfloor \log_T q \rfloor} ek_0^{(i)} \cdot {c^*_2}^{(i)} = c^*_0 + \sum_{i=0}^{\lfloor \log_T q \rfloor} ((a_i \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e_i}) + T^i\textcolor{red}{s}^2 )\cdot {c^*_2}^{(i)}\\
\hat c_1 &amp;= c^*_1 + \sum_{i=0}^{\lfloor \log_T q \rfloor} ek_1^{(i)} \cdot {c^*_2}^{(i)} = c^*_1 + \sum_{i=0}^{\lfloor \log_T q \rfloor} -a_i \cdot {c^*_2}^{(i)} 
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span>(</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>−</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Using the above relations, we obtain the following linear equation:</p>
<div><span><span><span>c^0+c^1⋅s=c0∗+c1∗⋅s+c2∗⋅s2⏟m⋅m′+∑i=0⌊log⁡Tq⌋tei⋅c2∗(i)⏟relinearization error\hat c_0 + \hat c_1 \cdot \textcolor{red}{s} = \underbrace{c^*_0 + c^*_1 \cdot \textcolor{red}{s} + c^*_2 \cdot \textcolor{red}{s}^2}_{m \cdot m&#x27;} + \underbrace{ \sum_{i=0}^{\lfloor \log_T q \rfloor} t\textcolor{darkgreen}{e_i} \cdot {c^*_2}^{(i)}}_{\text{relinearization error}}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>m</span><span>⋅</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>relinearization error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></div>
<p>(the terms containing <span><span><span>ai⋅sa_i \cdot \red{s}</span><span aria-hidden="true"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span> from <span><span><span>c^0\hat c_0</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>−ai⋅s-a_i \cdot \red{s}</span><span aria-hidden="true"><span><span></span><span>−</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span> from <span><span><span>c^1⋅s\hat c_1 \cdot \red{s}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span>  cancel out, <span><span><span>c2∗c^*_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is reconstructed and we are left with an error term).</p>
<p>Because the relinearization error is a multiple of <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span>, it goes away when we decrypt and reduce <span><span><span> mod t\bmod t</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> as long as the relinearization error does not wrap <span><span><span>m∗=m⋅m′m^* = m\cdot m&#x27;</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> around <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>.</p>
<p><strong>Remarks</strong></p>
<ul>
<li>We need to relinearize after a multiplication.</li>
<li>A smaller <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> means we have a smaller noise, but more relinearization keys are needed.</li>
<li><span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> is chosen based on what we want to optimize. We usually want to choose <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> to introduce a noise around the size of the noise in the ciphertexts. Once the noise grows we can use <span><span><span>T2T^2</span><span aria-hidden="true"><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> or something else. We can also choose a big <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> at the start (which introduces lots of starting noise) and we don&#x27;t need to change it later.</li>
</ul>
<h3>Modulus switching</h3>
<p><strong>Task</strong>:
You want to reduce the noise that accumulates in the ciphertext, after performing homomorphic operations. The modulus switching technique allows us to decrease the noise, to ensure the decryption is still correct after performing homomorphic operations. More analysis is provided in a dedicated section below.</p>
<p><strong>Idea</strong>: The technique uses two moduli <span><span><span>Q,qQ, q</span><span aria-hidden="true"><span><span></span><span>Q</span><span>,</span><span></span><span>q</span></span></span></span></span> with <span><span><span>q&lt;Qq &lt; Q</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>Q</span></span></span></span></span> and <span><span><span>q∣Qq | Q</span><span aria-hidden="true"><span><span></span><span>q</span><span>∣</span><span>Q</span></span></span></span></span>. This  involves changing the ring where the ciphertexts live, <span><span><span>RQR_Q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, with a ring <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, that is parametrized by the smaller modulus. When you perform this change, the coefficient ring  <span><span><span>ZQ\mathbb Z_Q</span><span aria-hidden="true"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is &quot;approximated&quot; by some ring <span><span><span>Zq\mathbb Z_q</span><span aria-hidden="true"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, in the intuitive sense that the numbers become smaller (the numbers are scaled down by some factor). As we will see this means that the noise will be smaller in absolute value. Although, the noise will relatively  stay the same, since <span><span><span>q&lt;Qq &lt; Q</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>Q</span></span></span></span></span>, we mostly care about the magnitude of the noise, especially in multiplications.</p>
<p>You can perform this repeatedly with many moduli <span><span><span>{q0,q1,...,qL}\{q_0, q_1, ..., q_L\}</span><span aria-hidden="true"><span><span></span><span>{</span><span><span>q</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>L</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>}</span></span></span></span></span> with decreasing values to lower the noise after each multiplication.</p>
<p>The easiest way to do this is to scale down the ciphertext&#x27;s components by <span><span><span>q/Qq / Q</span><span aria-hidden="true"><span><span></span><span>q</span><span>/</span><span>Q</span></span></span></span></span> and <strong>smartly round</strong> in a way to keep the decryption equation correct. To ensure this, we want the scaling to keep the following propriety: <span><span><span>c~i=ci mod t\tilde c_i = c_i \bmod t</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span> , where <span><span><span>c~i≈(q/Q)ci\tilde c_i \approx (q / Q) c_i</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≈</span><span></span></span><span><span></span><span>(</span><span>q</span><span>/</span><span>Q</span><span>)</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> where <span><span><span>i∈{0,1}i \in \{0, 1\}</span><span aria-hidden="true"><span><span></span><span>i</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>}</span></span></span></span></span>.</p>
<p>The two requirements that we want to have are</p>
<ol>
<li>The decryption should be correct (decryption mod <span><span><span>QQ</span><span aria-hidden="true"><span><span></span><span>Q</span></span></span></span></span> should be the same as decryption mod <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>): <span><span><span>[c0+c1⋅s]Q=[c~0+c~1⋅s]q mod t[c_0 + c_1 \cdot \red{s}]_Q = [\tilde c_0 + \tilde c_1 \cdot \red{s}]_q \bmod t</span><span aria-hidden="true"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span>.</li>
<li>The noise scales down.</li>
</ol>
<p><strong>Rounding</strong><br/>
In order for the decryption to be correct we must adjust <span><span><span>cic_i</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> before scaling by  <span><span><span>q/Qq / Q</span><span aria-hidden="true"><span><span></span><span>q</span><span>/</span><span>Q</span></span></span></span></span>. To do this we add a <strong>small correction term</strong> <span><span><span>δi\delta_i</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> per component. We require <span><span><span>δi\delta_i</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to:</p>
<ol>
<li>Only influence the error, hence <span><span><span>δi≡0 mod t\delta_i \equiv 0 \bmod t</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≡</span><span></span></span><span><span></span><span>0</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span> (it will disappear when decrypting)</li>
<li>Make the ciphertext to be divisible by <span><span><span>Q/q Q / q</span><span aria-hidden="true"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>:
<div><span><span><span>ci+δi≡0 mod Qq⇒δi≡−ci mod Qqc_i + \delta_i \equiv 0 \bmod \dfrac Q q  \Rightarrow \delta_i \equiv -c_i \bmod \dfrac Q q</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≡</span><span></span></span><span><span></span><span>0</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>⇒</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≡</span><span></span></span><span><span></span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span></div>
</li>
</ol>
<p>One easy choice to set the correction terms such that both properties hold is <span><span><span>δi=t[−cit−1]Q/q\delta_i = t [-c_i t^{-1}]_{Q/q}</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> where <span><span><span>t−1t^{-1}</span><span aria-hidden="true"><span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span> is the inverse of <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> modulo <span><span><span>Q/qQ / q</span><span aria-hidden="true"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>.</p>
<p>In the end, we define the components <span><span><span>c~i\tilde c_i</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> of the  modulus switched ciphertext:
<span><span><span>c~i=qQ(ci+δi)\tilde c_i = \dfrac q Q(c_i + \delta_i)</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></p>
<p>Now, let&#x27;s check the decryption equation is actually correct. For a <span><span><span>k∈Rk \in R</span><span aria-hidden="true"><span><span></span><span>k</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span>:</p>
<div><span><span><span>[c~0+c~1⋅s]q=c~0+c~1⋅s−kq=qQ(c0+δ0)+qQ(c1+δ1)⋅s−kq=qQ(c0+c1⋅s+δ0+δ1⋅s)−kq=qQ([c0+c1⋅s]Q+kQ+δ0+δ1⋅s)−kq=qQ[c0+c1⋅s]Q⏟≡m mod t+qQ(δ0+δ1⋅s)⏟≡0 mod t+kq−kq≡qQm mod t\begin{aligned}
[\tilde c_0 + \tilde c_1 \cdot \textcolor{red}{s}]_q 
&amp;= \tilde c_0 + \tilde c_1 \cdot \textcolor{red}{s} - kq \\
&amp;= \dfrac q Q(c_0 + \delta_0) + \dfrac q Q (c_1 + \delta_1) \cdot \textcolor{red}{s} - kq \\
&amp;= \dfrac q Q(c_0 + c_1 \cdot \textcolor{red}{s} + \delta_0 + \delta_1 \cdot \textcolor{red}{s}) - kq \\
&amp;= \dfrac q Q([{c_0 + c_1 \cdot \textcolor{red}{s}}]_Q + kQ + \delta_0 + \delta_1 \cdot \textcolor{red}{s}) - kq \\ 
&amp;= \dfrac q Q \underbrace{[{c_0 + c_1 \cdot \textcolor{red}{s}}]_Q}_{\equiv m \bmod t}  + \underbrace{\dfrac q Q (\delta_0 + \delta_1 \cdot \textcolor{red}{s})}_{\equiv 0 \bmod t} + kq - kq \\
&amp;\equiv \dfrac q Q m \bmod t
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>[</span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>k</span><span>Q</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span><span><span><span><span></span><span><span><span>≡</span><span>m</span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>[</span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>≡</span><span>0</span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>k</span><span>q</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>≡</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>When doing <span><span><span>c0+c1⋅s=[c0+c1⋅s]Q+kQc_0 + c_1 \cdot \red{s} = [c_0 + c_1 \cdot \red{s}]_Q + kQ</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>k</span><span>Q</span></span></span></span></span>
we mention that <span><span><span>kk</span><span aria-hidden="true"><span><span></span><span>k</span></span></span></span></span> is the same as in <span><span><span>[c~0+c~1⋅s]q=c~0+c~1⋅s−kq[\tilde c_0 + \tilde c_1 \cdot \red{s}]_q = \tilde c_0 + \tilde c_1 \cdot \red{s} - kq</span><span aria-hidden="true"><span><span></span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>−</span><span></span></span><span><span></span><span>k</span><span>q</span></span></span></span></span> under some conditions (see lemma 1 from <a href="https://eprint.iacr.org/2011/277.pdf">here</a>).</p>
<p>In the end we decrypt <span><span><span>qQm\dfrac q Q m</span><span aria-hidden="true"><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>m</span></span></span></span></span> instead of <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span>. In practice this can be solved by multiplying by <span><span><span>Q/qQ/q</span><span aria-hidden="true"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span> before encryption or after decryption, or to take <span><span><span>Q/q≡1 mod tQ/q \equiv 1 \bmod t</span><span aria-hidden="true"><span><span></span><span>Q</span><span>/</span><span>q</span><span></span><span>≡</span><span></span></span><span><span></span><span>1</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span> (however such a <span><span><span>Q/qQ/q</span><span aria-hidden="true"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span> can be harder to find).</p>
<h3>Key switching v2</h3>
<p>Now that we know about modulus switching we introduce a second version to do key switching in BGV. Recall that the key switching technique is used in relinearization, for decreasing the size of the ciphertext obtained in multiplication.</p>
<p><strong>Idea</strong>: Given two moduli <span><span><span>q,Qq, Q</span><span aria-hidden="true"><span><span></span><span>q</span><span>,</span><span></span><span>Q</span></span></span></span></span>  with <span><span><span>q&lt;Qq &lt; Q</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>Q</span></span></span></span></span> and <span><span><span>q∣Qq | Q</span><span aria-hidden="true"><span><span></span><span>q</span><span>∣</span><span>Q</span></span></span></span></span>, we start with elements in <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and we make a detour in a ring <span><span><span>RQR_Q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> with a bigger modulus <span><span><span>QQ</span><span aria-hidden="true"><span><span></span><span>Q</span></span></span></span></span> where we perform our relinearization. Then we perform modulus switching to go back to our small ring <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>We generate the <em>hint</em>:</p>
<div><span><span><span>(ek0,ek1)=((a⋅s+te+Qqs2),−a) mod Q(ek_0, ek_1) = ((a \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e} + \frac{Q}{q} \textcolor{red}{s}^2), -a) \bmod Q</span><span aria-hidden="true"><span><span></span><span>(</span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>(</span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>−</span><span>a</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>Q</span></span></span></span></span></div>
<p>Recall that <span><span><span>c∗=(c0∗,c1∗,c2∗)c^* = (c^*_0, c^*_1, c^*_2)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> is the result of the <code>mul</code>. Then we compute the components of the new ciphertext <span><span><span>c^\hat c</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span>:</p>
<div><span><span><span>c^0=Qqc0∗+c2∗⋅ek0 mod Qc^1=Qqc1∗+c2∗⋅ek1 mod Q\begin{aligned}
\hat c_0 &amp;= \frac Q q c_0^* + c_2^* \cdot ek_0 \bmod Q\\
\hat c_1 &amp;= \frac Q q c_1^* + c_2^* \cdot ek_1 \bmod Q
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>Q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Lastly, we scale them both using modulus switching: <span><span><span>c^i=qQ(c^i+δi)\hat c_i = \dfrac q Q (\hat c_i + \delta_i)</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> with <span><span><span>δi=t[−cit−1]Q/q\delta_i = t[-c_i t^{-1}]_{Q/q}</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, like before.</p>
<p>The relinearization equation looks like this:</p>
<div><span><span><span>c^0+c^1⋅s=c0∗+c1∗⋅s+c2∗⋅s2⏟m⋅m′+qQ(tc2∗⋅e+δ0+δ1⋅s)⏟relinearization error\hat c_0 + \hat c_1 \cdot \textcolor{red}{s} = \underbrace{c_0^* + c_1^* \cdot \textcolor{red}{s} + c_2^* \cdot \textcolor{red}{s}^2}_{m\cdot m&#x27;} + \underbrace{\dfrac q Q (t c_2^* \cdot \textcolor{darkgreen}{e} + \delta_0 + \delta_1 \cdot \textcolor{red}{s})}_{\text{relinearization error}}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>m</span><span>⋅</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>relinearization error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></div>
<p>Because the relinearization error is a multiple of <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> (remember that we chose <span><span><span>δi\delta_i</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to be multiples of <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> too, to not influence the error), it will go away when we decrypt and reduce <span><span><span> mod t\bmod t</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> as long as the relinearization error does not wrap <span><span><span>m∗=m⋅m′m^* = m\cdot m&#x27;</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> around <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>.</p>
<div><span><span><span>c^0+c^1⋅s=qQ(Qqc0∗+c2∗⋅ek0+δ0)+(qQ(Qqc1∗+c2∗⋅ek1)+δ1)⋅s=qQ(Qqc0∗+c2∗⋅(a⋅s+te+Qqs2)+δ0)++(qQ(Qqc1∗+c2∗⋅(−a))+δ1)⋅s=c0∗+c1∗⋅s+c2∗⋅s2+qQ(tc2∗⋅e+δ0+δ1⋅s)=mm′ mod t\begin{aligned}
\hat c_0 + \hat c_1 \cdot \textcolor{red}{s} 
&amp;= \frac{q}{Q} \left( \frac{Q}{q} c_0^* + c_2^* \cdot ek_0 + \delta_0 \right) + \left(\frac{q}{Q} \left ( \frac{Q}{q} c_1^*  + c_2^* \cdot ek_1 \right) + \delta_1 \right) \cdot \textcolor{red}{s} \\
&amp;= \frac{q}{Q} \left( \frac{Q}{q} c_0^* + c_2^* \cdot \left( a \cdot \textcolor{red}{s} + t\textcolor{darkgreen}{e} + \frac{Q}{q} \textcolor{red}{s}^2 \right) + \delta_0 \right) + \\
&amp;+ \left(\frac{q}{Q} \left ( \frac{Q}{q} c_1^*  + c_2^* \cdot (-a)\right)  + \delta_1 \right) \cdot \textcolor{red}{s} \\
&amp;= c_0^* + c_1^* \cdot \textcolor{red}{s} + c_2^* \cdot s^2 + \frac{q}{Q} (tc_2^* \cdot \textcolor{darkgreen}{e} + \delta_0 + \delta_1 \cdot \textcolor{red}{s}) \\
&amp;= mm&#x27; \bmod t
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span>(</span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span></span></span><span><span></span><span><span></span><span></span><span>+</span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>(</span><span>−</span><span>a</span><span>)</span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<h2>Noise analysis</h2>
<p>The main motivation of analysing the noise growth is because we want to set the parameters of the scheme based on it.</p>
<p>Relevant papers:</p>
<ul>
<li><a href="https://www.esat.kuleuven.be/cosic/publications/thesis-316.pdf">Ilia Iliashenko thesis</a></li>
<li><a href="https://eprint.iacr.org/2015/889.pdf">CS15</a></li>
<li><a href="https://eprint.iacr.org/2019/493.pdf">Evaluating the effectiveness of heuristic worst-case noise analysis in FHE</a></li>
<li><a href="https://eprint.iacr.org/2012/099.pdf">GHS</a></li>
<li><a href="https://eprint.iacr.org/2022/706.pdf">Finding and Evaluating Parameters for BGV</a></li>
</ul>
<h3>Measuring Noise</h3>
<p>When doing operations (such as addition, multiplication) with noisy ciphertexts, the total noise accumulates. In the end we want our decryption to be correct. However, this can only happen if the accumulated noise does not exceed some <strong>bound</strong>.</p>
<p><img src="https://bit-ml.github.io/galleries/bgv_scheme2023/fhe_noise_tiny.png" alt="fhe_noise"/></p>
<p><em>Intuition</em>: We want to &quot;measure&quot; this accumulated noise by looking at &quot;how much&quot; a polynomial can impact an operation it&#x27;s involved in. For example, we can analyze the impact of the polynomials <span><span><span>eie_i</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> which represent the RLWE noise or of the secret <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>. We can represent the polynomial&#x27;s impact with a number.</p>
<p>We can &quot;measure&quot; the impact of the polynomials using the:</p>
<ol>
<li><strong>Infinity norm</strong>: <span><span><span>∥a∥∞=max⁡∣ai∣\|a\|_\infty = \max{|a_i|}</span><span aria-hidden="true"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>max</span><span></span><span><span>∣</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>∣</span></span></span></span></span></span>, which is the value of the biggest coefficient in absolute value.</li>
<li><strong>Canonical norm</strong>: <span><span><span>∥a∥can\can a</span><span aria-hidden="true"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span>. In order to define it we use the so called <strong>canonical embedding</strong> of the polynomial.</li>
</ol>
<p>While the infinity norm is easy to understand, the canonical embedding is a bit more mathematically involved. Instead of searching for a way to measure the impact of a polynomial <span><span><span>a∈Ra \in R</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span>, we transfer the polynomial in another space, such as <span><span><span>Cn\mathbb C^n</span><span aria-hidden="true"><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>, and we search for a better measure there.</p>
<p>Recall that we work with polynomials from the ring <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \mathbb Z_q[X]/(X^n + 1)</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span> with <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> a power of <span><span><span>22</span><span aria-hidden="true"><span><span></span><span>2</span></span></span></span></span>.</p>
<p><strong>Canonical embedding</strong><br/>
We have the quotient polynomial <span><span><span>Xn+1X^n + 1</span><span aria-hidden="true"><span><span></span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> of <span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span> which has the complex roots <span><span><span>{ζ0,…,ζn−1}\{\zeta_0, \dots, \zeta_{n-1}\}</span><span aria-hidden="true"><span><span></span><span>{</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>…</span><span></span><span>,</span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>}</span></span></span></span></span> with <span><span><span>ζin=−1⇒ζi2n=1\zeta_i^n = -1 \Rightarrow \zeta_i^{2n} = 1</span><span aria-hidden="true"><span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>i</span></span></span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>−</span><span>1</span><span></span><span>⇒</span><span></span></span><span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>i</span></span></span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span></span>.<br/>
Then we take a polynomial <span><span><span>a∈Ra \in R</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span>:<br/>
<span><span><span>a(X)=a0+a1X+...an−1Xn−1a(X) = a_0 + a_1X + ... a_{n-1}X^{n-1}</span><span aria-hidden="true"><span><span></span><span>a</span><span>(</span><span>X</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>X</span><span></span><span>+</span><span></span></span><span><span></span><span>.</span><span>.</span><span>.</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>X</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span>
and we evaluate <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> in every root <span><span><span>ζi\zeta_i</span><span aria-hidden="true"><span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. This leads to a vector <span><span><span>(a(ζ0),...a(ζn−1))∈Cn\left(a(\zeta_0), ... a(\zeta_{n-1})\right) \in \mathbb C^n</span><span aria-hidden="true"><span><span></span><span><span>(</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span><span></span><span>∈</span><span></span></span><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>. We call this vector the <strong>canonical embedding</strong> of <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span>.<br/>
The <a href="https://eprint.iacr.org/2012/230.pdf">canonical embedding</a> is defined as</p>
<div><span><span><span>σ:R→Cn,σ(a)=(a(ζ0),...a(ζn−1))\sigma: R \to \mathbb C^n,
\quad \sigma(a) = \left(a(\zeta_0), ... a(\zeta_{n-1})\right)</span><span aria-hidden="true"><span><span></span><span>σ</span><span></span><span>:</span><span></span></span><span><span></span><span>R</span><span></span><span>→</span><span></span></span><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span>,</span><span></span><span></span><span>σ</span><span>(</span><span>a</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>(</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span></span></span></span></span></div>
<p><strong>Canonical norm</strong><br/>
Since now we have obtained a new vector in <span><span><span>Cn\mathbb C^n</span><span aria-hidden="true"><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span> we can look at its infinity norm and define the <strong>canonical norm</strong> <span><span><span>∥a∥can=∥σ(a)∥∞\can a = \|\sigma(a)\|_\infty</span><span aria-hidden="true"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>∥</span><span>σ</span><span>(</span><span>a</span><span>)</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>In practice, the canonical norm is used to compute the noise bounds, because it provides a better decryption noise bound.</p>
<ol>
<li>There is a relationship between these norms: <span><span><span>∥a∥∞≤c2n⋅∥a∥can\|a\|_{\infty} \leq c_{2n}\cdot \can a</span><span aria-hidden="true"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span> for some constant <span><span><span>c2nc_{2n}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, which is <span><span><span>11</span><span aria-hidden="true"><span><span></span><span>1</span></span></span></span></span> when <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> is a power of <span><span><span>22</span><span aria-hidden="true"><span><span></span><span>2</span></span></span></span></span> (see <a href="https://eprint.iacr.org/2011/535.pdf">this</a>). With this inequality in mind, it suffices to assure correct decryption by setting the canonical norm of the noise to be less than <span><span><span>q/2q/2</span><span aria-hidden="true"><span><span></span><span>q</span><span>/</span><span>2</span></span></span></span></span>.</li>
<li>When doing multiplications, the noise bound offered by the canonical norm increases slower than the bound offered by the infinity norm. We have these two inequalities:</li>
</ol>
<div><span><span><span>∥ab∥∞≤γ∥a∥∞∥b∥∞∥ab∥can≤∥a∥can∥b∥can\begin{aligned}
\|ab\|_\infty &amp;\leq \gamma\|a\|_\infty \|b\|_\infty  \\ 
\can {ab} &amp;\leq \can a \can b
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>∥</span><span>a</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span>∥</span><span>a</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>γ</span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>∥</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span>∥</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>where <span><span><span>γ&gt;1\gamma &gt; 1</span><span aria-hidden="true"><span><span></span><span>γ</span><span></span><span>&gt;</span><span></span></span><span><span></span><span>1</span></span></span></span></span> is the so-called <em>expansion factor</em> of the ring <span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span>. For more details, see <a href="https://escholarship.org/content/qt0141w93p/qt0141w93p.pdf">this</a>.</p>
<p><strong>Noise bounds</strong><br/>
Suppose we choose <span><span><span>a∈Ra \in R</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span> with coefficients sampled independently from one of the distributions (discrete Gaussian, random, ternary). Let <span><span><span>VaV_a</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> be the variance of each coefficient <span><span><span>(a0,...an)(a_0, ... a_n)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>a</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> in <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span>. In <a href="https://www.esat.kuleuven.be/cosic/publications/thesis-316.pdf">Ilia Iliashenko&#x27;s thesis</a> and in the <a href="https://eprint.iacr.org/2022/706.pdf">Finding and Evaluating Parameters for BGV</a> paper it&#x27;s shown that we can choose a number <span><span><span>DD</span><span aria-hidden="true"><span><span></span><span>D</span></span></span></span></span> such that
<span><span><span>∥a∥can≤DnVa \can a \leq D \sqrt{n V_a}</span><span aria-hidden="true"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>
holds with overwhelming probability. In practice, we set <span><span><span>D=6D = 6</span><span aria-hidden="true"><span><span></span><span>D</span><span></span><span>=</span><span></span></span><span><span></span><span>6</span></span></span></span></span>.</p>
<p>When analysing the noise growth we&#x27;ll make use of the following proprieties. For two polynomials <span><span><span>a,b∈Ra, b \in R</span><span aria-hidden="true"><span><span></span><span>a</span><span>,</span><span></span><span>b</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span> with variances <span><span><span>Va,VbV_a, V_b</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and some constant <span><span><span>kk</span><span aria-hidden="true"><span><span></span><span>k</span></span></span></span></span> we have:</p>
<ul>
<li><span><span><span>Va+b=Va+VbV_{a+b} = V_a + V_b</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>a</span><span>+</span><span>b</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> ,</li>
<li><span><span><span>Vka=k2VaV_{ka} = k^2V_a</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>k</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>k</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>,</li>
<li><span><span><span>Va⋅b=nVaVbV_{a \cdot b} = nV_aV_b</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>a</span><span>⋅</span><span>b</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</li>
</ul>
<p>For the distributions that we work with we have the <strong>coefficient</strong> variances:</p>
<ul>
<li>Discrete Gaussian distribution with standard deviation <span><span><span>σ: VDG=σ2\sigma: \ V_{\mathcal {DG}} = \sigma^2</span><span aria-hidden="true"><span><span></span><span>σ</span><span></span><span>:</span><span> </span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>D</span><span>G</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>
<li>Ternary distribution: <span><span><span>V3=2/3V_3 = 2/3</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>2</span><span>/</span><span>3</span></span></span></span></span>.</li>
<li>Uniform distribution with integer coefficients in <span><span><span>(−q/2,q/2]: Vq≈q2/12(-q/2, q/2]: \ V_q \approx q^2 / 12</span><span aria-hidden="true"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span><span></span><span>:</span><span> </span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≈</span><span></span></span><span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>
</ul>
<h3>Noise for operations</h3>
<p>We now have the building blocks (starting values and operations) to analyse the noise for each operation. The goal of analysing the noise buildup is to choose the scheme parameters such that the scheme properties (fhe, decryption) hold and the scheme remains secure. Following the paper <a href="https://eprint.iacr.org/2022/706.pdf">Finding and Evaluating Parameters for BGV</a> we have:</p>
<p><strong>Fresh ciphertext noise</strong><br/>
In order to make sure the decryption is correct we must make sure the error</p>
<div><span><span><span>v=c0+c1⋅s=t(e⋅u+e0+e1⋅s)⏟r+m=r+m mod qv = c_0 + c_1 \cdot \textcolor{red}{s} = \underbrace{t(\textcolor{darkgreen}{e} \cdot \textcolor{red}{u} + \textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e_1} \cdot \textcolor{red}{s})}_{r} + m = r + m \bmod q</span><span aria-hidden="true"><span><span></span><span>v</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>r</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>m</span><span></span><span>=</span><span></span></span><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>
<p>does not wrap around the modulus (i.e <span><span><span>∥v∥∞≤c2n∥v∥can≤q/2\|v\|_{\infty} \leq c_{2n}\can v \leq q/2</span><span aria-hidden="true"><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>q</span><span>/</span><span>2</span></span></span></span></span> ). The message <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span> is thought to come uniformly from <span><span><span>RtR_t</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Recall that</p>
<ul>
<li>The errors <span><span><span>e,e0,e1\textcolor{darkgreen}{e}, \textcolor{darkgreen}{e_0}, \textcolor{darkgreen}{e_1}</span><span aria-hidden="true"><span><span></span><span>e</span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> come from a discrete Gaussian =&gt; <span><span><span>Ve=Ve0=Ve1=σ2V_{\textcolor{darkgreen}{e}} = V_{\textcolor{darkgreen}{e_0}} = V_{\textcolor{darkgreen}{e_1}} = \sigma^2</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>
<li>The secret <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> and <span><span><span>u\red{u}</span><span aria-hidden="true"><span><span></span><span>u</span></span></span></span></span> come from a ternary distribution =&gt; <span><span><span>Vs=Vu=2/3V_{\red{s}} = V_{\red{u}} = 2/3</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>u</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>2</span><span>/</span><span>3</span></span></span></span></span>.</li>
<li>The message <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span> comes from <span><span><span>RtR_t</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and we assume that the coefficients are uniformly distributed in <span><span><span>Zt\mathbb Z_t</span><span aria-hidden="true"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> =&gt; <span><span><span>Vm=t2/12V_m = t^2 / 12</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>
</ul>
<div><span><span><span>Vv=Vm+t(e⋅u+e0+e1⋅s)=Vm+t2Ve⋅u+e0+e1⋅s=t212+t2(nσ223+σ2+nσ223)=t2(112+σ2(43n+1))\begin{aligned}
V_v &amp;= V_{m + t(\textcolor{darkgreen}{e}\cdot \textcolor{red}{u} + \textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e_1} \cdot \textcolor{red}{s})} \\
&amp;= V_m + t^2V_{\textcolor{darkgreen}{e} \cdot \textcolor{red}{u} + \textcolor{darkgreen}{e_0} + \textcolor{darkgreen}{e_1} \cdot \textcolor{red}{s}}  \\
&amp;= \frac{t^2}{12} + t^2 \left(n\sigma^2 \frac{2}{3} + \sigma^2 + n\sigma^2 \frac{2}{3}\right)  \\
&amp;= t^2 \left(\frac{1}{12} + \sigma^2 \left(\frac{4}{3}n + 1\right)\right)
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>V</span><span><span><span><span><span><span></span><span><span>v</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>m</span><span>+</span><span>t</span><span>(</span><span>e</span><span>⋅</span><span>u</span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>s</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span><span>⋅</span><span>u</span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span>n</span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>3</span></span></span><span><span></span><span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>n</span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>3</span></span></span><span><span></span><span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>3</span></span></span><span><span></span><span></span></span><span><span></span><span><span>4</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span></span><span>+</span><span></span><span>1</span><span><span>)</span></span></span><span><span>)</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Hence:
<span><span><span>∥v∥can≤DnVv\can v \leq D\sqrt {nV_v}</span><span aria-hidden="true"><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span>v</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></p>
<p>The parameters for the scheme and distributions, <span><span><span>q,t,σ,nq, t, \sigma, n</span><span aria-hidden="true"><span><span></span><span>q</span><span>,</span><span></span><span>t</span><span>,</span><span></span><span>σ</span><span>,</span><span></span><span>n</span></span></span></span></span>,  are chosen such that the decryption is correct.</p>
<p><strong>Addition</strong><br/>
For two ciphertexts <span><span><span>(c,c′)(c, c&#x27;)</span><span aria-hidden="true"><span><span></span><span>(</span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> encrypting <span><span><span>(m,m′)(m, m&#x27;)</span><span aria-hidden="true"><span><span></span><span>(</span><span>m</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> we have the corresponding errors <span><span><span>(v,v′)(v, v&#x27;)</span><span aria-hidden="true"><span><span></span><span>(</span><span>v</span><span>,</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span>. The error after ciphertext addition is <span><span><span>vaddv_{\text{add}}</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>add</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>If we use the decryption equation we have</p>
<div><span><span><span>vadd=v+v′=(c0+c1⋅s)+(c0′+c1′⋅s)=r+m+r′+m′ mod qv_{\text{add}} = v + v&#x27; = (c_0 + c_1 \cdot \red{s}) + (c_0&#x27; + c_1&#x27; \cdot \red{s}) = r + m + r&#x27; + m&#x27; \bmod q</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>add</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>
<p>We have <span><span><span>m+m′=[m+m′]t+gtm + m&#x27; = [m + m&#x27;]_t + gt</span><span aria-hidden="true"><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>g</span><span>t</span></span></span></span></span> with <span><span><span>g∈Rg \in R</span><span aria-hidden="true"><span><span></span><span>g</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span> and <span><span><span>∥g∥∞=1\|g\|_{\infty} = 1</span><span aria-hidden="true"><span><span></span><span>∥</span><span>g</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span></span> (because both <span><span><span>∥m∥∞,∥m′∥∞&lt;t/2\|m\|_{\infty}, \|m&#x27;\|_{\infty} &lt; t / 2</span><span aria-hidden="true"><span><span></span><span>∥</span><span>m</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>∥</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>&lt;</span><span></span></span><span><span></span><span>t</span><span>/</span><span>2</span></span></span></span></span>). By replacing in the equation above we obtain:
<span><span><span>v+v′=[m+m′]t+r+r′+gt mod qv + v&#x27; = [m + m&#x27;]_t + r + r&#x27; + gt \bmod q</span><span aria-hidden="true"><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>g</span><span>t</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></p>
<p>We see that the noise <span><span><span>r+r′+gtr + r&#x27; + gt</span><span aria-hidden="true"><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>g</span><span>t</span></span></span></span></span> grows linearly.</p>
<p>Finally, using the canonical norm we have the following:</p>
<div><span><span><span>∥vadd∥can≤∥v∥can+∥v′∥can\can {v_{\text{add}}} \leq \can v + \can {v&#x27;}</span><span aria-hidden="true"><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>add</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p><strong>Multiplication</strong><br/>
Similarly for multiplication, if we use the decryption equation we have:</p>
<div><span><span><span>vmul=v⋅v′=(c0+c1⋅s)⋅(c0′+c1′⋅s)=(r+m)+(r′+m′)=mm′+mr′+m′r+rr′ mod q\begin{aligned}
v_{\text{mul}} 
&amp;= v \cdot v&#x27; = (c_0 + c_1 \cdot \red{s}) \cdot (c_0&#x27; + c_1&#x27; \cdot \red{s}) \\
&amp;= (r + m) + (r&#x27; + m&#x27;) = mm&#x27; + mr&#x27; + m&#x27;r + rr&#x27; \bmod q
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>v</span><span></span><span>⋅</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>r</span><span></span><span>+</span><span></span><span>m</span><span>)</span><span></span><span>+</span><span></span><span>(</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>r</span><span></span><span>+</span><span></span><span>r</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>If we look at the error term <span><span><span>mr′+m′r+rr′mr&#x27; + m&#x27;r + rr&#x27;</span><span aria-hidden="true"><span><span></span><span>m</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we see that in the leading term <span><span><span>rr′rr&#x27;</span><span aria-hidden="true"><span><span></span><span>r</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we multiply the noises, therefore the noise grows quadratically.</p>
<p>Using the canonical norm, we have:</p>
<div><span><span><span>∥vmul∥can≤∥v∥can∥v′∥can\can {v_{\text{mul}}} \leq \can v\can {v&#x27;}</span><span aria-hidden="true"><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p><strong>Modulus switching</strong><br/>
For modulus switch we scale the noise down and then we add the small error that comes with the correction terms <span><span><span>δ0,δ1\delta_0, \delta_1</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.
Recall that</p>
<ul>
<li>We set <span><span><span>δi=t[−cit−1]Q/q\delta_i = t[-c_it^{-1}]_{Q/q}</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. We assume the terms <span><span><span>[−cit−1]Q/q[-c_it^{-1}]_{Q/q}</span><span aria-hidden="true"><span><span></span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> are uniformly distributed mod <span><span><span>Q/qQ / q</span><span aria-hidden="true"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>, then multiplied by <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> =&gt; <span><span><span>Vδ0=Vδ1=t2Q212q2V_{\delta_0} = V_{\delta_1} = \dfrac {t^2Q^2} {12q^2}</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span>.</li>
</ul>
<div><span><span><span>vswitch=[c~0+c~1⋅s]q=qQ[c0+c1⋅s]Q+qQ(δ0+δ1⋅s)=qQv+qQ(δ0+δ1⋅s)v_{\text{switch}} = [\tilde c_0 + \tilde c_1 \cdot \red{s}]_q = \dfrac q Q [c_0 + c_1 \cdot \red{s}]_Q  + \dfrac q Q (\delta_0 + \delta_1 \cdot \red{s}) = \dfrac q Q v  + \dfrac q Q (\delta_0 + \delta_1 \cdot \red{s})</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>switch</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span></span></span></span></span></div>
<p>Using the canonical norm we get:</p>
<div><span><span><span>∥vswitch∥can≤qQ∥v∥can+qQ∥δ0+δ1⋅s∥can≤qQ∥v∥can+Dtn12(1+23n)\can {v_{\text{switch}}} \leq \dfrac q Q \can v + \dfrac q Q \can {\delta_0 + \delta_1 \cdot \red{s}} \leq \dfrac q Q \can v + Dt\sqrt{\dfrac n {12} \left (1 + \dfrac 2 3 n \right)}</span><span aria-hidden="true"><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>switch</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>∥</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>D</span><span>t</span><span><span><span><span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span>n</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></div>
<p>We can see that the noise is scaled down by almost <span><span><span>q/Qq / Q</span><span aria-hidden="true"><span><span></span><span>q</span><span>/</span><span>Q</span></span></span></span></span>.</p>
<p><strong>Key switching - Base decomposition</strong><br/>
In relinearization we deal with <span><span><span>c0+c1⋅s+c2⋅s2c_0 + c_1 \cdot \red{s} + c_2 \cdot \red{s}^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. Here we decompose <span><span><span>c2⋅s2c_2 \cdot \red{s}^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> in base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> and hide the <em>hints</em> about <span><span><span>s2\red{s}^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> using  RingLWE-like samples involving errors  <span><span><span>ei\textcolor{darkgreen}{e_i}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. Remember from  key switching technique using base decomposition that we have a relinearization error: <span><span><span>∑i=0⌊log⁡Tq⌋tei⋅c2∗(i)\sum_{i=0}^{\lfloor \log_T q \rfloor} t\textcolor{darkgreen}{e_i} \cdot {c^*_2}^{(i)}</span><span aria-hidden="true"><span><span></span><span><span>∑</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span>. The variance of any term <span><span><span>tei⋅c2∗(i)t\textcolor{darkgreen}{e_i} \cdot {c^*_2}^{(i)}</span><span aria-hidden="true"><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> from the sum is <span><span><span>Vtei⋅c2∗(i)V_{t \textcolor{darkgreen}{e_i} \cdot {c^*_2}^{(i)}}</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Recall that</p>
<ul>
<li>The errors <span><span><span>ei\textcolor{darkgreen}{e_i}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> come from a discrete Gaussian distribution =&gt; <span><span><span>Vei=σ2V_{\textcolor{darkgreen}{e_i}}= \sigma^2</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>
<li>We can assume that the polynomials in base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> behave like random polynomials extracted from <span><span><span>RTR_T</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> =&gt; <span><span><span>Vc2∗=T2/12V_{{c^*_2}} = T^2 / 12</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>
</ul>
<div><span><span><span>vks=c0∗+c1∗⋅s+c2∗⋅s2⏟vmul+∑i=0⌊log⁡Tq⌋tei⋅c2∗(i)v_{\text{ks}} = \underbrace{c^*_0 + c^*_1 \cdot \red{s} + c^*_2 \cdot \red{s}^2}_{v_{\text{mul}}} +  \sum_{i=0}^{\lfloor \log_T q \rfloor} t\textcolor{darkgreen}{e_i} \cdot {c^*_2}^{(i)}</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>If we use the canonical norm:</p>
<div><span><span><span>∥vks∥can≤∥vmul∥can+Dnlog⁡T(q)Vt⋅ei⋅c2∗(i)=∥vmul∥can+Dtn2log⁡T(q)VeiVc2∗(i)=∥vmul∥can+DtnTlog⁡T(q)σ212\begin{aligned}
\can {v_{\text{ks}}} &amp; \leq \can {v_{\text{mul}}} + D\sqrt{n \log_T (q)V_{t \cdot \textcolor{darkgreen}{e_i} \cdot {c^*_2}^{(i)}}} \\
&amp;= \can {v_{\text{mul}}} + Dt\sqrt{n^2 \log_T (q)V_{\textcolor{darkgreen}{e_i}} V_{{c^*_2}^{(i)}}}  \\ 
&amp;= \can {v_{\text{mul}}} + DtnT\sqrt{ \log_T (q)\dfrac {\sigma^2} {12}}
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span></span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>t</span><span>⋅</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span>t</span><span><span><span><span><span><span></span><span><span><span>n</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span>t</span><span>n</span><span>T</span><span><span><span><span><span><span></span><span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p><strong>Key switching - Modulus switch</strong><br/>
In the relinearisation version that employs modulus switching, we have the following error term: <span><span><span>qQ(tc2∗⋅e+δ0+δ1⋅s)\dfrac q Q (tc_2^* \cdot \textcolor{darkgreen}{e} + \delta_0 + \delta_1 \cdot \red{s})</span><span aria-hidden="true"><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span></span></span></span></span>.
Recall that:</p>
<ul>
<li>The ciphertext component <span><span><span>c2∗c_2^*</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> comes from <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> =&gt; <span><span><span>Vc2∗=q2/12V_{c_2^*} = q^2 / 12</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>
<li>The errors <span><span><span>e\textcolor{darkgreen}{e}</span><span aria-hidden="true"><span><span></span><span>e</span></span></span></span></span> comes from a discrete Gaussian =&gt; <span><span><span>Ve=σ2V_{\textcolor{darkgreen}{e}}= \sigma^2</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>
<li>The secret <span><span><span>s\red{s}</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> comes from a ternary distribution =&gt; <span><span><span>Vs=2/3V_{\red{s}}= 2/3</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>2</span><span>/</span><span>3</span></span></span></span></span>.</li>
<li>We set <span><span><span>δi=t[−cit−1]Q/q\delta_i = t[-c_it^{-1}]_{Q/q}</span><span aria-hidden="true"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. We assume the terms <span><span><span>[−cit−1]Q/q[-c_it^{-1}]_{Q/q}</span><span aria-hidden="true"><span><span></span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> are uniformly distributed mod <span><span><span>Q/qQ / q</span><span aria-hidden="true"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>, then multiplied by <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> =&gt; <span><span><span>Vδ0=Vδ1=t2Q212q2V_{\delta_0} = V_{\delta_1} = \dfrac {t^2Q^2} {12q^2}</span><span aria-hidden="true"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span>.</li>
</ul>
<div><span><span><span>vks=c0∗+c1∗⋅s+c2∗⋅s2⏟vmul+qQ(tc2∗⋅e+δ0+δ1⋅s)v_{\text{ks}} = \underbrace{c_0^* + c_1^* \cdot \red{s} + c_2^* \cdot \red{s}^2}_{v_{\text{mul}}} + \dfrac q Q (tc_2^* \cdot \textcolor{darkgreen}{e} + \delta_0 + \delta_1 \cdot \red{s})</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span></span></span></span></span></div>
<p>The variance of this error term is:</p>
<div><span><span><span>VqQ(tc2∗i⋅e+δ0+δ1⋅s)=(qQ)2(t2nVc2∗Ve+Vδ0+nVδ1Vs)=(qQ)2(t2nq212σ2+t2Q212q2+nt2Q212q223)=(qQ)2(t2nq212σ2)+t212+nt21223=(qQ)2(t2nq212σ2)+t212(1+23n)\begin{aligned}
V_{\frac q Q (t{c_2^*}_i \cdot \textcolor{darkgreen}{e} + \delta_0 + \delta_1 \cdot \textcolor{red}{s})} 
&amp;= \left(\frac q Q \right)^2 (t^2 nV_{c_2^*}V_{\textcolor{darkgreen}{e}} + V_{\delta_0} + nV_{\delta_1}V_{\textcolor{red}{s}}) \\
&amp;= \left(\frac q Q \right)^2 \left(t^2  n \frac {q^2} {12} \sigma^2 +  \dfrac {t^2Q^2} {12q^2} + n  \dfrac {t^2Q^2} {12q^2} \dfrac 2 3\right) \\
&amp;= \left(\frac q Q \right)^2 \left(t^2  n \frac {q^2} {12} \sigma^2 \right)  +\dfrac {t^2} {12} + n  \dfrac {t^2} {12} \dfrac 2 3 \\
&amp;= \left(\frac q Q \right)^2 \left(t^2  n \frac {q^2} {12} \sigma^2 \right)  +\dfrac {t^2} {12} \left(1+ \dfrac 2 3 n \right)
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>e</span><span>+</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>s</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>(</span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Now we can bound:</p>
<div><span><span><span>∥vks∥can≤∥vmul∥can+Dn(qQ)2(t2nq212σ2+t212(1+23n))≤∥vmul∥can+DqQtn(nq212σ2+112(1+23n))\begin{aligned}
\can {v_{\text{ks}}} 
&amp; \leq \can {v_{\text{mul}}} + D\sqrt{n \left(\frac q Q \right)^2 \left(t^2  n \frac {q^2} {12} \sigma^2 + \frac {t^2} {12} \left(1+ \dfrac 2 3 n\right) \right)} \\
&amp; \leq \can {v_{\text{mul}}} + D \frac q Q t\sqrt{n \left(n \frac{q^2} {12} \sigma^2 + \frac {1} {12} \left(1+ \dfrac 2 3 n\right) \right)}
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span><span><span>)</span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>t</span><span><span><span><span><span><span></span><span><span>n</span><span></span><span><span><span>(</span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span><span><span>)</span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<h1>Code</h1>
<p>And now that we have discussed all the ingredients and spices of the BGV encryption scheme, it&#x27;s time to bake it, sorry, implement it.</p>
<p>We provide a <a href="https://github.com/zademn/EverythingCrypto/blob/master/E3-Homomorphic-Encryption/BGV.ipynb">proof of concept implementation</a>, in Python. The aim of the code is to mirror the equations easily. This means that if we see <span><span><span>a⋅s+ea \cdot s + e</span><span aria-hidden="true"><span><span></span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>e</span></span></span></span></span> in the theory part we prefer to see <code>a * s + e</code> in code instead of <code>polyadd(polymul(a, s), e)</code>.</p>
<p>DISCLAIMER: The code should be used for educational purposes only, and never in production.</p>
<p>We represent polynomials using a class: <code>QuotientRingPoly</code>. Every polynomial is defined by three attributes:</p>
<ul>
<li><code>coef: np.ndarray</code> - Vector of the polynomial&#x27;s coefficients. <code>coef[-1]</code> is the free coefficient, <code>coef[0]</code> is the leading coefficient. It&#x27;s always padded to have <code>n</code> elements.</li>
<li><code>coef_modulus: int</code> - Modulus of the ring where its coefficients live in.</li>
<li><code>poly_modulus: int | np.ndarray</code> - Modulus of the polynomial ring where it belongs: <code>X^n + 1</code></li>
</ul>
<p><code>QuotientRingPoly</code> has the <code>._reduce(self)</code> method which reduces any polynomial to an element in the ring.</p>
<p>We overloaded the operators <code>+, -, *, //, %</code>:</p>
<ul>
<li>Operators work between two <code>QuotientRingPoly</code> using the default polynomial operation rules.</li>
<li>Operators work between a <code>QuotientRingPoly</code> and an <code>int | float</code> coefficient-wise.</li>
</ul>
<p>The attributes <code>coef</code> and <code>coef_modulus</code> can be assigned too. After assigning, the <code>_reduce()</code> method will be called. This is helpful to easily change the ring of the polynomial.</p>
<p><strong>Remarks</strong></p>
<ul>
<li>To work with big integers, we use the python built in <code>int</code> class. To use this with numpy we set <code>dtype = object</code> for every array creation.</li>
<li>We have helper functions <code>roundv</code> and <code>intv</code> (round vector, int vector) that vectorize the <code>round</code> and <code>int</code> operations, allowing us to help with rounding and converting vector elements to python&#x27;s builtin <code>int</code> class.</li>
</ul>
<h1>Resources</h1>
<ul>
<li><a href="https://eprint.iacr.org/2011/277.pdf">BGV paper</a> - Original paper</li>
<li><a href="https://eprint.iacr.org/2011/344.pdf">BV paper</a></li>
<li><a href="https://homomorphicencryption.org/standard/">FHE standard</a></li>
<li><a href="https://eprint.iacr.org/2015/889.pdf">CS15</a> - for comparisons between FHE schemes</li>
<li><a href="https://www.esat.kuleuven.be/cosic/publications/thesis-316.pdf">Ilia Iliashenko thesis</a> - for noise analysis</li>
<li><a href="https://eprint.iacr.org/2019/493.pdf">Evaluating the effectiveness of heuristic worst-case noise analysis in FHE</a></li>
<li><a href="https://eprint.iacr.org/2012/099.pdf">GHS</a></li>
<li><a href="https://eprint.iacr.org/2022/706.pdf">Finding and Evaluating Parameters for BGV</a></li>
<li><a href="https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/">Bitdefender BFV blogpost</a></li>
<li><a href="https://www.inferati.com/blog/fhe-schemes-bgv">Inferati blogpost</a></li>
</ul></section><div class="Post__PostFooter-sc-oyq0rs-8 gLoNrh"><div class="Post__PostFooterWraper-sc-oyq0rs-9 bStMIm"><p class="Post__Author-sc-oyq0rs-4 dYMJEb">written by <!-- -->Dacian Stroia</p></div></div></div></div></div></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"https://bit-ml.github.io/styles.c960d3bf.css"}</script><script type="text/javascript">
    window.__routeInfo = {"path":"blog/post/bgv-fully-homomorphic-encryption-scheme-in-python","templateID":2,"sharedPropsHashes":{"galleries":"ZHT1Kz"},"localProps":null,"allProps":{"post":{"data":{"slug":"bgv-fully-homomorphic-encryption-scheme-in-python","authors":"Dacian Stroia","categories":"blog","featured_img":"/galleries/bgv_scheme2023/lock.jpg","date":"June-29-2023","title":"The BGV fully homomorphic encryption scheme","id":2},"messages":[],"history":["./content/collections/posts/bgv_scheme2023.md","content/collections/posts/bgv_scheme2023.html"],"cwd":"/Users/fbrad/bit/bit-ml","contents":"<h1>The BGV fully homomorphic encryption scheme</h1>\n<p>This is a sister blogpost to the <a href=\"https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/\">previous one about a similar scheme (BFV)</a> and it's part of the series that covers fully homomorphic encryption techniques and applications.</p>\n<h2>Introduction</h2>\n<p><span><span><span>\\gdef\\can #1{\\|#1\\|^{\\text{can}}}</span><span aria-hidden=\"true\"></span></span></span></p>\n<p>In this blogpost we will focus on the encryption, decryption, relinearization and the noise analysis of the <a href=\"https://eprint.iacr.org/2011/277.pdf\">Brakerski, Gentry, Vaikuntanathan (BGV)</a> fully homomorphic encryption scheme. A Python implementation of the aforementioned will be provided.</p>\n<p>DISCLAIMER: This toy implementation is not meant to be secure or optimized\nfor efficiency. It's for educational purposes only, and for us to better understand the inner workings.</p>\n<p><strong>What to expect from this blogpost?</strong></p>\n<ol>\n<li>We briefly describe the motivations of fully homomorphic encryption.</li>\n<li>We present the BGV scheme.</li>\n<li>We offer a <a href=\"https://github.com/zademn/EverythingCrypto/blob/master/E3-Homomorphic-Encryption/BGV.ipynb\">Python implementation</a> for the BGV scheme, for educational purposes.</li>\n</ol>\n<p>Now, let's make a short, informal, tour before starting.\n<a href=\"https://en.wikipedia.org/wiki/Homomorphic_encryption\"><strong>Fully homomorphic encryption</strong></a> (FHE) allows us to perform computation on encrypted data. While there are a few cryptographic schemes to achieve this, in this blogpost we explore the <a href=\"https://eprint.iacr.org/2011/277.pdf\"><strong>BGV scheme</strong></a>.</p>\n<p>Firstly, this scheme allows us to encrypt messages into ciphertexts. Intuitively, a message is hidden in a ciphertext if there is no way to get to retrieve the original message from its encryption. To an attacker that sees a ciphertext, that ciphertext should look like \"random garbage\". In order to achieve this we hide the message by \"masking\" it with some noise. We say it's <em>hard</em> for an attacker to retrieve a message from its ciphertext if doing so is at least as hard as solving a computationally unfeasable problem. The problem the security of the BGV scheme is based on is called the <a href=\"https://en.wikipedia.org/wiki/Ring_learning_with_errors\"><strong>Ring Learning with Errors problem</strong></a>.</p>\n<p>Secondly, the scheme allows us to perform arithmetic operations (additions, multiplications) using noisy ciphertexts. However, we will encounter some problems along the way, such as the noise increasing after computations, or the size of the resulting ciphertext increasing. We'll see how to handle these using <strong>modulus switching</strong> (for the former) and <strong>relinearization</strong> (for the latter).</p>\n<p>This post will get a bit mathematical, so before starting we introduce some notation. Any other notation will be defined when introduced.</p>\n<p>Notations:</p>\n<ul>\n<li><span><span><span>m,m′,m∗m, m', m^*</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> - messages.</li>\n<li><span><span><span>c,c′,c∗c, c', c^*</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> - ciphertexts. If ciphertexts have more components, we denote the components with indices: <span><span><span>c=(c0,c1)c = (c_0, c_1)</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></li>\n<li><span><span><span>λ\\lambda</span><span aria-hidden=\"true\"><span><span></span><span>λ</span></span></span></span></span> - Security parameter.</li>\n<li><span><span><span>Zq\\mathbb Z_q</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - the set of integers from <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span></li>\n<li><span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span> - Ring.\n<ul>\n<li>Ex: <span><span><span>Z\\mathbb Z</span><span aria-hidden=\"true\"><span><span></span><span>Z</span></span></span></span></span> - the integers.</li>\n<li>Ex: <span><span><span>Z[X]/(Xn+1)\\mathbb Z[X] / (X^n + 1)</span><span aria-hidden=\"true\"><span><span></span><span>Z</span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span> - the quotient polynomial ring with integer coefficients: .</li>\n</ul>\n</li>\n<li><span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - Ring modulo the ideal generated by <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>.\n<ul>\n<li>Ex:  <span><span><span>Zq\\mathbb Z_q</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - the integers mod <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>.</li>\n<li>Ex: <span><span><span>Zq[X]/(Xn+1)\\mathbb Z_q[X]/ (X^n + 1)</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span> - the quotient polynomial ring with coefficients being integers in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>.</li>\n</ul>\n</li>\n<li><span><span><span>[a]q[a]_q</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>a</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> - <span><span><span>a mod qa \\bmod q</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span>, coefficients centered in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>. When applying <span><span><span>[⋅]q[\\cdot ]_q</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>⋅</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to a polynomial we mean to apply it to all its coefficients individually. When applying <span><span><span>[⋅][\\cdot]</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>⋅</span><span>]</span></span></span></span></span> to a vector of elements, we mean to apply it to each element individually. So <span><span><span>[(a,b)]q=([a]q,[b]q)[(a, b)]_q = ([a]_q, [b]_q)</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>(</span><span>a</span><span>,</span><span></span><span>b</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>a</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>[</span><span>b</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>. We give the similar treatment to reduction <span><span><span> mod q\\bmod q</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> operation</li>\n<li><span><span><span>χ=χ(λ)\\chi = \\chi(\\lambda)</span><span aria-hidden=\"true\"><span><span></span><span>χ</span><span></span><span>=</span><span></span></span><span><span></span><span>χ</span><span>(</span><span>λ</span><span>)</span></span></span></span></span> - Noise distribution, parametrized by <span><span><span>λ\\lambda</span><span aria-hidden=\"true\"><span><span></span><span>λ</span></span></span></span></span> (usually Gaussian).</li>\n<li>For simplicity, when we say we sample a polynomial from some distribution (or a polynomial comes from some distribution) we mean that its coefficients are sampled independently from that distribution.</li>\n<li><span><span><span>e←χe \\leftarrow \\chi</span><span aria-hidden=\"true\"><span><span></span><span>e</span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span> - An element <span><span><span>ee</span><span aria-hidden=\"true\"><span><span></span><span>e</span></span></span></span></span> sampled from the distribution <span><span><span>χ\\chi</span><span aria-hidden=\"true\"><span><span></span><span>χ</span></span></span></span></span></li>\n<li><span><span><span>a←RSa \\xleftarrow R S</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span>S</span></span></span></span></span> - An element sampled uniformly from a set <span><span><span>SS</span><span aria-hidden=\"true\"><span><span></span><span>S</span></span></span></span></span>\n<ul>\n<li>Ex: <span><span><span>a←RRqa \\xleftarrow R R_q</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> An element <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> sampled uniformly from the ring <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n</ul>\n</li>\n<li><span><span><span>a⋅ba \\cdot b</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>b</span></span></span></span></span>  denotes the multiplication of 2 elements from the ring <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n<li><span><span><span>tata</span><span aria-hidden=\"true\"><span><span></span><span>t</span><span>a</span></span></span></span></span>  denotes the multiplication of coefficients of <span><span><span>a∈Rqa \\in R_q</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> by some scalar <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span>.</li>\n</ul>\n<h2>Fully Homomorphic Encryption (FHE)</h2>\n<p>Before defining fully homomorphic encryption, let's look at some <strong>applications</strong> of it to get a better intuition:</p>\n<p><strong>1. Outsourcing storage and computations</strong></p>\n<ul>\n<li>A company wants to use a cloud provider to store data and do computational heavy lifting.</li>\n<li><em>Task</em>: The company wants to use the information (for example: to do machine learning, extract statistical properties) without locally retrieving it  (defeating the purpose of using the cloud company services). Furthermore, the company doesn't want the cloud provider to see the sensitive data.</li>\n<li><em>Solution</em>: Using homomorphic encryption, the company can encrypt and send the data to the cloud provider and then the cloud provider can process the information (as requested by the company) in the encrypted form, without learning anything about the data.</li>\n<li>Ex: finance, medical apps, consumer privacy in ads.</li>\n</ul>\n<p><strong>2. Private queries</strong></p>\n<ul>\n<li>A client wants to retrieve a query against a large database held by a provider.</li>\n<li><em>Task</em>: The client wants to retrieve a query <strong>without</strong> the database provider learning the query.</li>\n<li><em>Solution</em>: Using homomorphic encryption the client can encrypt the index of the record and then the database can use this encrypted index to fetch (the comparison operation can be done using FHE) and return the encrypted result to the client. Finally, the client can decrypt the record.</li>\n</ul>\n<p><strong>3. Private set intersection</strong></p>\n<ul>\n<li>A client and a server each has a set of elements. The client wants to know which elements from its set are in the server's set.</li>\n<li><em>Task</em>: The client wants to find out the intersection of its elements and the server's, without the server learning anything about the client's elements and vice versa.</li>\n<li><em>Solution (Very simplified)</em>: They translate the comparison operation into a subtraction (<span><span><span>x=y⇒x−y=0x = y \\Rightarrow x - y = 0</span><span aria-hidden=\"true\"><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span>y</span><span></span><span>⇒</span><span></span></span><span><span></span><span>x</span><span></span><span>−</span><span></span></span><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span></span>). The client encrypts its elements and sends them to the server. Then, the server evalutes these subtractions homomorphically. Because the result of the subtraction is an encrypted result, the server learns nothing. Then the server sends the comparison results back and the client decrypts the results. We have a longer, more in-depth blogpost about it <a href=\"https://bit-ml.github.io/blog/post/private-set-intersection-an-implementation-in-python/\">here</a>. Happy reading!</li>\n<li>Examples: Client: user contacts, Server: whatsapp contacts; Client: own passwords, Server: database with breached passwords.</li>\n</ul>\n<p><em>Intuition</em></p>\n<ul>\n<li>A user has an arithmetic function <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span> and some inputs <span><span><span>(m1,...mn)(m_1, ... m_n)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</li>\n<li>He wants to compute <span><span><span>m∗=f(m1,...mn)m^* = f(m_1, ... m_n)</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> but instead of computing it directly, he wants to encrypt <span><span><span>(m1,...mn)→(c1,...cn)(m_1, ... m_n) \\to (c_1, ... c_n)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>→</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>c</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> and do the computation on the ciphertext, obtaining a result which eventually decrypts to <span><span><span>m∗=f(m1,...mn)m^* =f(m_1, ... m_n)</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</li>\n<li>It's helpful to view the functions as tree of operations. For example (taken from the <a href=\"https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/\">BFV blogpost</a>): <span><span><span>f(m1,m2,m3,m4)=(m1×m2+m3)×m4f(m_1,m_2,m_3,m_4)= (m_1 \\times m_2 + m_3) \\times m_4</span><span aria-hidden=\"true\"><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>×</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>×</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n</ul>\n<p><img src=\"https://i.imgur.com/ub2OyXu.png\" alt=\"\"></p>\n<p><strong>Homomorphic Encryption -- Definition</strong><br>\nLet  <span><span><span>(KeyGen,Enc,Dec,Eval)(\\text{KeyGen}, \\text{Enc}, \\text{Dec}, \\text{Eval})</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>KeyGen</span></span><span>,</span><span></span><span><span>Enc</span></span><span>,</span><span></span><span><span>Dec</span></span><span>,</span><span></span><span><span>Eval</span></span><span>)</span></span></span></span></span> be a tuple of procedures.<br>\nLet <span><span><span>f∈Ff \\in \\mathcal F</span><span aria-hidden=\"true\"><span><span></span><span>f</span><span></span><span>∈</span><span></span></span><span><span></span><span>F</span></span></span></span></span> be a function in a family of functions. This function can also be written as a <em>circuit</em> from a family of circuits <span><span><span>C∈CC \\in \\mathcal C</span><span aria-hidden=\"true\"><span><span></span><span>C</span><span></span><span>∈</span><span></span></span><span><span></span><span>C</span></span></span></span></span>.</p>\n<ul>\n<li><span><span><span>(sk,pk)←KeyGen(1λ,1d)(sk, pk) \\gets \\text{KeyGen}(1^\\lambda, 1^d)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>s</span><span>k</span><span>,</span><span></span><span>p</span><span>k</span><span>)</span><span></span><span>←</span><span></span></span><span><span></span><span><span>KeyGen</span></span><span>(</span><span><span>1</span><span><span><span><span><span><span></span><span><span>λ</span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>1</span><span><span><span><span><span><span></span><span><span>d</span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> - key generation, <span><span><span>λ\\lambda</span><span aria-hidden=\"true\"><span><span></span><span>λ</span></span></span></span></span> is a security parameter, <span><span><span>dd</span><span aria-hidden=\"true\"><span><span></span><span>d</span></span></span></span></span> is a functionality parameter (degree of the polynomial or depth of the circtuit).</li>\n<li><span><span><span>ci←Enc(pk,mi)c_i \\gets \\text{Enc}(pk, m_i)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span><span>Enc</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> - Encryption of a message <span><span><span>mim_i</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> --  known as <strong>fresh ciphertexts</strong>.</li>\n<li><span><span><span>c∗=Eval(pk,f,c1,...cn)c^* = \\text{Eval}(pk, f, c_1, ... c_n)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Eval</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>f</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>c</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> - Evaluate the function <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span> on the ciphertexts  -- known as <strong>evaluated ciphertexts</strong>.</li>\n</ul>\n<p><strong>Correctness</strong><br>\nWe require the (FHE) scheme to correctly decrypt both fresh and evaluated ciphertexts:\n<span><span><span>Dec(sk,c∗)=m∗=f(m1,...,mn)\\text{Dec}(sk, c^*) = m^* = f(m_1, ..., m_n)</span><span aria-hidden=\"true\"><span><span></span><span><span>Dec</span></span><span>(</span><span>s</span><span>k</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></p>\n<p><img src=\"/galleries/bgv_scheme2023/fhe_simple_tiny.png\" alt=\"\"></p>\n<p>In the image above, the user with the laptop is interested  evaluating a certain circuit on its data <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span>. Therefore it sends its data, encrypted, to the cloud so that the cloud computes the circuit. By correctness, the user indeed gets the circuit applied on its data <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span>.</p>\n<p><strong>Circuits?</strong><br>\nThe two important operations we care about are addition and multiplication, because with them we can construct any arithmetic operation! Homomorphic encryption schemes started out by encrypting bits, so the equivalent operations for additon and multiplication on bits, <code>xor</code> and <code>and</code> are used.</p>\n<div><span><span><span>⊕=+ mod 2⊗=× mod 2\\oplus = + \\bmod 2 \\\\\n\\otimes = \\times \\bmod 2 </span><span aria-hidden=\"true\"><span><span></span><span>⊕</span><span></span><span>=</span><span></span></span><span><span></span><span>+</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span><span></span><span><span></span><span>⊗</span><span></span><span>=</span><span></span></span><span><span></span><span>×</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span></span></span></span></div>\n<p>To convey the fact that a circuit supports both <code>xor</code> and <code>and</code> usually a <code>nand</code> gate is used, because <code>nand</code> gates are composed by 1 multiplication and 1 addition and they are logically complete (you can build any circuit with them).\n<span><span><span>nand(a,b)=a×b+1 mod 2\\text{nand}(a, b) = a \\times b + 1 \\bmod 2</span><span aria-hidden=\"true\"><span><span></span><span><span>nand</span></span><span>(</span><span>a</span><span>,</span><span></span><span>b</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>a</span><span></span><span>×</span><span></span></span><span><span></span><span>b</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span></span></span></span></p>\n<p>By extending to multiple bits, with the gates we discussed above you can represent any computation using boolean circuits.</p>\n<p>HE can be classified based on the type of functions <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span> that it supports:</p>\n<ul>\n<li><strong>Partially homomorphic encryption</strong><br>\nGiven <span><span><span>Enc(m1)\\text{Enc}(m_1)</span><span aria-hidden=\"true\"><span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, and <span><span><span>Enc(m2)\\text{Enc}(m_2)</span><span aria-hidden=\"true\"><span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> you can do limited operations (either additions or multiplications)</li>\n<li><strong>Somewhat (leveled) homomorphic encryption</strong><br>\nGiven <span><span><span>Enc(m1),...,Enc(mn)\\text{Enc}(m_1), ..., \\text{Enc}(m_n)</span><span aria-hidden=\"true\"><span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span><span>Enc</span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> you can compute <span><span><span>Enc(f(m1,...mn))\\text{Enc}(f(m_1, ... m_n))</span><span aria-hidden=\"true\"><span><span></span><span><span>Enc</span></span><span>(</span><span>f</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>m</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span></span></span></span> where <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span> is a polynomial of a limited degree.\nOne can do limited number of multiplications (Circuits of a maximum depth).</li>\n<li><strong>Fully homomorphic encryption</strong><br>\nOne can do unlimited multiplications and additions.</li>\n</ul>\n<p>The community put a lot of effort into the analysing FHE schemes: finding good parameters, finding software and hardware optimizations, coming up with possible attacks and adjusting the schemes against them. An interesting read is the <a href=\"https://homomorphicencryption.org/standard/\">homomorphic encryption standard</a>, which compiles good practices and techniques for developing and using existing schemes.</p>\n<h2>Ring Learning With Errors (RLWE)</h2>\n<p>In this section we'll focus on briefly introducing the Ring learning with errors (RLWE) problem. The problem is very complex and we'll only attempt to cover the basic blocks for building an intuition. For the interested reader more details can be found in this <a href=\"https://eprint.iacr.org/2012/230.pdf\">paper</a>.</p>\n<h3>Quick recap on working with polynomials</h3>\n<p>This section is taken from the <a href=\"https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/\">BFV blogpost</a>, but we'll repeat it here to save you a click. For this subsection we denote with <span><span><span>Z/qZ={0,...,q−1}\\mathbb Z / q\\mathbb Z = \\{0, ... , q - 1\\}</span><span aria-hidden=\"true\"><span><span></span><span>Z</span><span>/</span><span>q</span><span>Z</span><span></span><span>=</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span>q</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>.</p>\n<p>The HE scheme we are going to describe deals with <em>adding and multiplying\npolynomials</em>. Here we present a quick example of how to work with\npolynomials, so that we all have the same starting point. If you already know\nhow to do this, you can skip it.</p>\n<p>First thing, let's add and multiply polynomials <em>modulo some polynomial <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span></em>.\nThis \"modulo <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span>\" thing simply means that we add and multiply the polynomials\nin the usual way, but we take the remainders of the results when divided by\n<span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span>. When we do these additions and multiplications <span><span><span> mod f\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, we sometimes\nsay in a fancy way that we are working in the <em>ring</em> <span><span><span>Z[x]/(f)\\mathbb{Z}[x]/(f)</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span> of\nreduced polynomials.</p>\n<p>Let's take <span><span><span>f=x4+1f = x^4 +1</span><span aria-hidden=\"true\"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. If we look at <span><span><span>p(x)=x5p(x) =x^5</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span>,\nthen <span><span><span>p(x)=x⋅(x4+1)−xp(x) = x \\cdot (x^4 + 1) - x</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>x</span><span></span><span>⋅</span><span></span></span><span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>−</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Therefore, when taking the reminder we get\n<span><span><span>p(x)=−x mod fp(x) = -x \\bmod f</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>−</span><span>x</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span></span></span></span></span>. For faster computations <span><span><span> mod f\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span> you can use this trick:\nwhen making <span><span><span> mod f\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, simply replace <span><span><span>x4x^4</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>−1-1</span><span aria-hidden=\"true\"><span><span></span><span>−</span><span>1</span></span></span></span></span>, <span><span><span>x5x^5</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>−x-x</span><span aria-hidden=\"true\"><span><span></span><span>−</span><span>x</span></span></span></span></span> and so on.</p>\n<p>Let's consider two polynomials <span><span><span>a(x)=x3+x2+7a(x) = x^3 + x^2 + 7</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span> and <span><span><span>b(x)=x2+11xb(x) = x^2 + 11x</span><span aria-hidden=\"true\"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span>.\nThen:</p>\n<div><span><span><span>a(x)+b(x) mod f=x3+2x2+11x+7 mod f.a(x)+b(x) \\bmod f = x^3 + 2x^2 + 11x + 7 \\text { mod }f.</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>7</span><span><span> mod </span></span><span>f</span><span>.</span></span></span></span></span></div>\n<p>Here nothing special happened. Let's multiply them:</p>\n<div><span><span><span>a(x)⋅b(x) mod f=(x3+x2+7)⋅(x2+11x) mod f=x5+11x4+x4+11x3+7x2+77x mod f=−x−11−1+11x3+7x2+77x mod f=11x3+7x2+76x−12 mod f.\\begin{aligned}\na(x) \\cdot b(x) \\bmod f\n    &#x26;= (x^3 + x^2 + 7)\\cdot (x^2 +11x) \\text { mod }f \\\\\n    &#x26;= x^5 + 11x^4 + x^4 + 11x^3 + 7x^2 + 77x \\text { mod }f\\\\\n    &#x26;= -x - 11 - 1 + 11x^3 + 7x^2 + 77x \\text { mod }f \\\\\n    &#x26;= 11x^3 + 7x^2 + 76x - 12 \\text { mod }f.\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>⋅</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>f</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span>x</span><span>)</span><span><span> mod </span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span> mod </span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>x</span><span></span><span>−</span><span></span><span>1</span><span>1</span><span></span><span>−</span><span></span><span>1</span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span> mod </span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>6</span><span>x</span><span></span><span>−</span><span></span><span>1</span><span>2</span><span><span> mod </span></span><span>f</span><span>.</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Now let's go one step further and see how we perform these operations of\npolynomials not just modulo <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span>, <em>but also modulo some integer <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span></em>. As you\nmight expect, the coefficients of these polynomials are also reduced modulo\n<span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>, so they always take integer values from <span><span><span>00</span><span aria-hidden=\"true\"><span><span></span><span>0</span></span></span></span></span> to <span><span><span>q−1.q-1.</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>.</span></span></span></span></span> This time, we say\nthat we are working the ring of reduced polynomials <span><span><span>Z/qZ[x]/(f)\\mathbb{Z} / q\\mathbb Z[x]/(f)</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span></span><span>/</span><span>q</span><span>Z</span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span>.</p>\n<p>Let's take the previous example, <span><span><span>f=x4+1f = x^4+1</span><span aria-hidden=\"true\"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, <span><span><span>a(x)=x3+x2+7a(x)=x^3+x^2+7</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span>,\n<span><span><span>b(x)=x2+11xb(x)=x^2+11x</span><span aria-hidden=\"true\"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span> and consider <span><span><span>q=5q =5</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>5</span></span></span></span></span>. We can think of <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> and <span><span><span>bb</span><span aria-hidden=\"true\"><span><span></span><span>b</span></span></span></span></span> as already\ntaken <span><span><span> mod f\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>. If we take them further modulo <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>, then <span><span><span>[a(x)]q=x3+x2+2[a(x)]_q = x^3 +\nx^2 +2</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span> and <span><span><span>[b(x)]q=x2+x[b(x)]_q = x^2+x</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Moreover,</p>\n<div><span><span><span>[a(x)+b(x)]q=x3+x2+2+x2+x=x3+2x2+x+2[a(x) + b(x)]_q = x^3 + x^2 +2+ x^2 + x = x^3 + 2x^2 + x+2</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span></div>\n<p>and</p>\n<div><span><span><span>[a(x)⋅b(x)]q=(x3+x2+2)⋅(x2+x)=x5+x4+x4+x3+2x2+2x=−x−1−1+x3+2x2+2x=x3+2x2+x+3\\begin{aligned}\n[a(x) \\cdot b(x)]_q\n    &#x26;= (x^3 + x^2+2) \\cdot (x^2 + x)\\\\\n    &#x26;= x^5 + x^4 + x^4 +x^3+2x^2 + 2x\\\\\n    &#x26;= -x -1 -1 + x^3 +2x^2+2x\\\\\n    &#x26;= x^3+2x^2+x+3\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>⋅</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>x</span><span></span><span>−</span><span></span><span>1</span><span></span><span>−</span><span></span><span>1</span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span></span><span>+</span><span></span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>To give a powerful visual intuition of polynomials in quotient rings, consider the following polynomial<span><span><span>1+4x+2x3∈Z/5Z[x]/(x4+1)1 + 4x + 2x^3 \\in \\mathbb Z/5\\mathbb Z[x] / (x^4+1)</span><span aria-hidden=\"true\"><span><span></span><span>1</span><span></span><span>+</span><span></span></span><span><span></span><span>4</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>∈</span><span></span></span><span><span></span><span>Z</span><span>/</span><span>5</span><span>Z</span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>\nand its visual representation. For this grade 3 polynomial we have four pentagons, for each coefficient. Each pentagon represents <span><span><span>Z/5Z\\mathbb Z/ 5\\mathbb Z</span><span aria-hidden=\"true\"><span><span></span><span>Z</span><span>/</span><span>5</span><span>Z</span></span></span></span></span>. The value of the coefficient is colored with green:</p>\n<p><img src=\"/galleries/bgv_scheme2023/poly_tiny.png\" alt=\"poly\"></p>\n<h3>The security of the BGV scheme</h3>\n<p>Like we said in the introduction, our ciphertexts will be masked with some noise to look as random as possible in order to hide any information an attacker may extract about the message.</p>\n<p>In fact it can be proven that the BGV scheme is secure as long as nobody can solve the Ring Learning With Errors (RLWE) problem described below. The parameters of the scheme must be chosen such that there are no known algorithms to solve the underlying RLWE problem in feasable time.</p>\n<p>Formally, the idea of \"ciphertexts looking like garbage\" is called <a href=\"https://en.wikipedia.org/wiki/Ciphertext_indistinguishability\"><strong>ciphertext indistinguishability</strong></a>. This concept can be formulated using a game between a challenger and an adversary:</p>\n<ul>\n<li>The challenger receives two messages <span><span><span>m0,m1m_0, m_1</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> from the adversary. Then, the challenger encrypts them into <span><span><span>c0,c1c_0, c_1</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</li>\n<li>Then, the challenger secretly flips a bit <span><span><span>b∈{0,1}b\\in \\{0, 1\\}</span><span aria-hidden=\"true\"><span><span></span><span>b</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>}</span></span></span></span></span> and sends the ciphertext <span><span><span>cbc_b</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to the adversary.</li>\n<li>The adversary must guess the bit <span><span><span>bb</span><span aria-hidden=\"true\"><span><span></span><span>b</span></span></span></span></span>. After running an efficient algorithm, it outputs a bit <span><span><span>b′b'</span><span aria-hidden=\"true\"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span>. It wins if <span><span><span>b′=bb' = b</span><span aria-hidden=\"true\"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>b</span></span></span></span></span>.</li>\n</ul>\n<p><img src=\"/galleries/bgv_scheme2023/sec_game_tiny.png\" alt=\"sec_game\"></p>\n<p>If there exists <strong>at least one</strong> adversary that can win the game with a probability significantly larger than 1/2 (a coinflip) using a computationally efficient algorithm (something that can run in our universe's lifetime), the challenger's algorithm is considered insecure. When we prove the security of a scheme, we actually show that if an adversary had such an algorithm that can win the security game, he can take that algorithm and use it to solve a problem that is considered <a href=\"https://en.wikipedia.org/wiki/Computational_hardness_assumption\"><em>computationally hard</em></a>.</p>\n<p>We will now describe the RLWE problem.</p>\n<p>Consider the quotient polynomial ring <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \\mathbb Z_q[X]/ (X^n + 1)</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>. This ring has polynomials with degree at most <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> and integer coefficients in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>.</p>\n<p><strong>The RLWE problem - decision</strong><br>\nThe problem asks to distinguish between the following two distributions:</p>\n<ul>\n<li><span><span><span>(ai,bi)(a_i, b_i)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> with <span><span><span>ai←RRqa_i \\xleftarrow R R_q</span><span aria-hidden=\"true\"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, <span><span><span>bi←RRqb_i \\xleftarrow R R_q</span><span aria-hidden=\"true\"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</li>\n<li><span><span><span>(ai,bi)(a_i, b_i)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> with <span><span><span>ai←RRqa_i \\xleftarrow R R_q</span><span aria-hidden=\"true\"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, <span><span><span>ei←χe_i \\leftarrow \\chi</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span>,  and <span><span><span>bi=ai⋅s+eib_i = a_i \\cdot s + e_i</span><span aria-hidden=\"true\"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> for some \"small\" secret <span><span><span>s∈Rqs \\in R_q</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span></span><span>∈</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> sampled before.</li>\n</ul>\n<p>The RLWE problem also has a search version, where given pairs <span><span><span>(ai,bi)(a_i, b_i)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, <span><span><span>bi=ai⋅s+eib_i = a_i \\cdot s + e_i</span><span aria-hidden=\"true\"><span><span></span><span><span>b</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> you need to find <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>. In practice, the decision version is more widely used when proving the security of different schemes.</p>\n<p>More details about the RLWE problem can be found in this <a href=\"https://eprint.iacr.org/2012/230.pdf\">paper</a>. In essence, by adding some small noise <span><span><span>eie_i</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, from a Gaussian distribution, we make our secret <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> unrecoverable even if we have access to many RLWE samples.</p>\n<p>The <a href=\"https://eprint.iacr.org/2011/277.pdf\">original BGV paper</a> presents the algorithms (encryption, decryption, etc) of a HE scheme based on a more general problem, the <em>General Learning with Errors (GLWE)</em>  problem. For simplicity, we work with the RLWE case in this blogpost.</p>\n<h2>The BGV encryption scheme</h2>\n<p>Generate the following parameters</p>\n<ul>\n<li><span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> - degree of <span><span><span>Xn+1X^n + 1</span><span aria-hidden=\"true\"><span><span></span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> is chosen as a power of 2.</li>\n<li><span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span> - ciphertext modulus.</li>\n<li><span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> - plainext modulus, <span><span><span>t≪qt \\ll q</span><span aria-hidden=\"true\"><span><span></span><span>t</span><span></span><span>≪</span><span></span></span><span><span></span><span>q</span></span></span></span></span>.</li>\n<li><span><span><span>χ\\chi</span><span aria-hidden=\"true\"><span><span></span><span>χ</span></span></span></span></span> - the noise distribution, a discrete Gaussian.</li>\n</ul>\n<p>We consider <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \\mathbb Z_q[X] / (X^n + 1)</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>. This ring has polynomials with degree at most <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> and integer coefficients in <span><span><span>(−q/2,q/2](-q / 2, q / 2]</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span></span></span></span></span>.</p>\n<p><strong>Note</strong>:</p>\n<ul>\n<li>All polynomial operations are considered <span><span><span> mod q\\bmod q</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> unless otherwise specified, to ease notation.</li>\n<li>When we talk about \"small\" polynomials, we intuitively think about them having  small coefficients.</li>\n<li>Polynomials that come from the noise distribution will be colored with green (ex: <span><span><span>e\\textcolor{darkgreen}{e}</span><span aria-hidden=\"true\"><span><span></span><span>e</span></span></span></span></span>) and the ones that will come from the secret key distribution will be colored with red (Ex: <span><span><span>s,u\\red{s}, \\red{u}</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span>,</span><span></span><span>u</span></span></span></span></span>).</li>\n</ul>\n<p>We will have one secret key <span><span><span>sksk</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span>k</span></span></span></span></span>, a public key with two components <span><span><span>pk=(pk0,pk1)pk = (pk_0, pk_1)</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, a ciphertext with 2 components <span><span><span>c=(c0,c1)c = (c_0, c_1)</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>\nThe messsage will come from the ring <span><span><span>RtR_t</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p><code>SecretKeyGen(params) -> sk</code></p>\n<ul>\n<li>Draw <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> from a secret key distribution which outputs \"small\" elements with overwhelming probability. In practice <span><span><span>s∈{−1,0,1}n\\red{s} \\in \\{-1, 0, 1\\}^n</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>−</span><span>1</span><span>,</span><span></span><span>0</span><span>,</span><span></span><span>1</span><span><span>}</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>, with the probability of sampling <span><span><span>00</span><span aria-hidden=\"true\"><span><span></span><span>0</span></span></span></span></span> specified as a parameter and the probabilities of sampling <span><span><span>−1-1</span><span aria-hidden=\"true\"><span><span></span><span>−</span><span>1</span></span></span></span></span> or <span><span><span>11</span><span aria-hidden=\"true\"><span><span></span><span>1</span></span></span></span></span> being equal.</li>\n<li>Return the secret key <span><span><span>sk=ssk = \\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>s</span></span></span></span></span>.</li>\n</ul>\n<p><code>PubKeyGen(sk, params) -> (pk0, pk1)</code></p>\n<ul>\n<li>Draw a random element <span><span><span>a←RRqa \\xleftarrow R R_q</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span><span><span><span><span><span></span><span><span>R</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and the noise <span><span><span>e←χ\\textcolor{darkgreen}{e} \\leftarrow \\chi</span><span aria-hidden=\"true\"><span><span></span><span>e</span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span>.</li>\n<li>Return the public key: <span><span><span>pk=(pk0,pk1)=(a⋅s+te,−a)⏟RLWE instance-likepk = (pk_0, pk_1) = \\underbrace{(a \\cdot \\red{s} + t\\textcolor{darkgreen}{e}, -a)}_{\\text{RLWE instance-like}}</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>RLWE instance-like</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span>,</span><span></span><span>−</span><span>a</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>.</li>\n</ul>\n<p>Notice that the public key  looks like a RLWE sample, but the error <span><span><span>ee</span><span aria-hidden=\"true\"><span><span></span><span>e</span></span></span></span></span> is multiplied by the plaintext modulus <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span>.</p>\n<p><code>Encrypt(m, pk, params) -> (c0, c1)</code></p>\n<ul>\n<li>Draw the noise <span><span><span>e0,e1←χ\\textcolor{darkgreen}{e_0}, \\textcolor{darkgreen}{e_1} \\leftarrow \\chi</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span> and a \"small\" polynomial <span><span><span>u∈{−1,0,1}n\\red{u} \\in \\{-1, 0, 1\\}^n</span><span aria-hidden=\"true\"><span><span></span><span>u</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>−</span><span>1</span><span>,</span><span></span><span>0</span><span>,</span><span></span><span>1</span><span><span>}</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span> in the same way as the secret.</li>\n<li>Compute <span><span><span>c0=pk0⋅u+te0+mc_0 = pk_0 \\cdot \\red{u} + t\\textcolor{darkgreen}{e_0} + m</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>m</span></span></span></span></span></li>\n<li>Compute <span><span><span>c1=pk1⋅u+te1c_1 = pk_1 \\cdot \\red{u} + t\\textcolor{darkgreen}{e_1}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n<li>Return <span><span><span>c=(c0,c1)c = (c_0, c_1)</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</li>\n</ul>\n<p>The ciphertext components <span><span><span>(c0,c1)(c_0, c_1)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> are elements in <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \\mathbb Z_q[X]/(X^n + 1)</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>.</p>\n<p><code>Decrypt(c, sk, params)</code></p>\n<ul>\n<li>Compute <span><span><span>m=c0+c1⋅s mod q mod tm = c_0 + c_1 \\cdot \\red{s} \\bmod q \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span></li>\n<li>Return <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span>.</li>\n</ul>\n<p>Let's unroll the equations to check the correctness. All operation are <span><span><span> mod q\\bmod q</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> to ease notation, unless we specify otherwise.</p>\n<p>The public key is:</p>\n<div><span><span><span>pk0=a⋅s+tepk1=−a\\begin{aligned}\npk_0 &#x26;= a \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e} \\\\\npk_1 &#x26;= -a\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>The public key hides the secret <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> as a RLWE sample.</p>\n<p>The encryption equations unrolled are:</p>\n<div><span><span><span>c0=pk0⋅u+te0+m=(a⋅s+te)⋅u+te0+m=a⋅s⋅u+t(e⋅u)+te0+mc1=pk1⋅u+te1=−a⋅u+te1\\begin{aligned}\nc_0 = pk_0 \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e}_0 + m \\\\\n&#x26;= (a \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e}) \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_0} + m \\\\\n&#x26;= a \\cdot \\textcolor{red}{s} \\cdot \\textcolor{red}{u} + t(\\textcolor{darkgreen}{e} \\cdot \\textcolor{red}{u}) + t\\textcolor{darkgreen}{e_0} + m\n\\\\\nc_1 &#x26;= pk_1 \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_1} \\\\\n&#x26;= -a \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_1} \\\\\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span>)</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>a</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>The decryption equation unrolled is:</p>\n<div><span><span><span>c0+c1⋅s=a⋅s⋅u+t(e⋅u)+te0+m+(−a⋅u+te1)⋅s mod q=a⋅s⋅u+t(e⋅u)+te0+m−a⋅u⋅s+te1⋅s=te1⋅s+t(e⋅u)+te0+m=t(e⋅u+e0+e1⋅s)⏟error+m\\begin{aligned}\nc_0 + c_1 \\cdot \\textcolor{red}{s} &#x26;= a \\cdot \\textcolor{red}{s} \\cdot \\textcolor{red}{u} + t(\\textcolor{darkgreen}{e} \\cdot \\textcolor{red}{u}) + t\\textcolor{darkgreen}{e_0} + m + (-a \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_1}) \\cdot \\textcolor{red}{s} \\bmod q \\\\\n&#x26;= \\cancel{a \\cdot \\textcolor{red}{s} \\cdot \\textcolor{red}{u}} + t(\\textcolor{darkgreen}{e} \\cdot \\textcolor{red}{u}) + t\\textcolor{darkgreen}{e_0} + m \\cancel{-a \\cdot \\textcolor{red}{u} \\cdot \\textcolor{red}{s}} + t\\textcolor{darkgreen}{e_1} \\cdot \\textcolor{red}{s} \\\\\n&#x26;= t\\textcolor{darkgreen}{e_1} \\cdot \\textcolor{red}{s} + t(\\textcolor{darkgreen}{e} \\cdot \\textcolor{red}{u}) + t\\textcolor{darkgreen}{e_0} + m \\\\\n&#x26;= \\underbrace{t(\\textcolor{darkgreen}{e} \\cdot \\textcolor{red}{u} + \\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e_1} \\cdot \\textcolor{red}{s})}_{\\text{error}} + m\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span>(</span><span>−</span><span>a</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>⋅</span><span></span><span>u</span></span></span><span><span></span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span><span><span><span><span><span></span><span><span>−</span><span>a</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span>)</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span><span>error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>The decryption is correct as long as the error we add to <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span> does not wrap the coefficients of <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span> arond the modulus <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>. The noise analysis will be offered later, in its own section.</p>\n<p>Now, we reduce the above <span><span><span> mod t\\bmod t</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> and we get:</p>\n<div><span><span><span>c0+c1⋅s=m mod q mod tc_0+c_1 \\cdot \\textcolor{red}{s} = m \\bmod q \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span></div>\n<h2>FHE Operations</h2>\n<p>Here we will explore the homomorphic properties of the scheme. We refer to the two input message and ciphertext pairs with <span><span><span>(m,c),(m′,c′)(m, c), (m', c')</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>m</span><span>,</span><span></span><span>c</span><span>)</span><span>,</span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> and to the resulting message-ciphertext pair  with <span><span><span>(m∗,c∗)(m^*, c^*)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span></span></span></span></span>.</p>\n<p>The goal is to find two functions, <span><span><span>add,mul\\text{add}, \\text{mul}</span><span aria-hidden=\"true\"><span><span></span><span><span>add</span></span><span>,</span><span></span><span><span>mul</span></span></span></span></span></span>, that work on ciphertexts, for addition and multiplication, such that:</p>\n<ul>\n<li>when <span><span><span>m∗=m+m′m^* = m + m'</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we have <span><span><span>c∗=add(c,c′)c^* = \\text{add}(c, c')</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>add</span></span><span>(</span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>Dec(c∗)=m∗\\text{Dec}(c^*) = m^*</span><span aria-hidden=\"true\"><span><span></span><span><span>Dec</span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span></li>\n<li>when <span><span><span>m∗=m⋅m′m^* = m \\cdot m'</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we have <span><span><span>c∗=mul(c,c′)c^* = \\text{mul}(c, c')</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>mul</span></span><span>(</span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>Dec(c∗)=m∗\\text{Dec}(c^*) = m^*</span><span aria-hidden=\"true\"><span><span></span><span><span>Dec</span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span></li>\n</ul>\n<p>Recall that <span><span><span>cc</span><span aria-hidden=\"true\"><span><span></span><span>c</span></span></span></span></span> and <span><span><span>c′c'</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> encrypt <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span> and <span><span><span>m′m'</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> i.e.:</p>\n<div><span><span><span>c0=pk0⋅u+te0+mc1=pk1⋅u+te1c0′=pk0⋅u′+te0′+mc1′=pk1⋅u′+te1′\\begin{aligned}\nc_0 &#x26;= pk_0 \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_0} + m \\\\\nc_1 &#x26;= pk_1 \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_1} \\\\\n\\\\\nc'_0 &#x26;= pk_0 \\cdot \\textcolor{red}{u'} + t\\textcolor{darkgreen}{e'_0} + m \\\\\nc'_1 &#x26;= pk_1 \\cdot \\textcolor{red}{u'} + t\\textcolor{darkgreen}{e'_1} \\\\\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<h3>FHE Addition</h3>\n<p>The image on the left performs the addition before the encryption, with the messages in clear. This is not what we want. The image on the right is the desirable outcome, where we encrypt the messages, then perform addition on the encrypted messages.</p>\n<p><img src=\"/galleries/bgv_scheme2023/fhe_add_tiny.png\" alt=\"fhe_add\"></p>\n<p>We define <code>add</code>:\n<code>add(c, c') -> c*</code></p>\n<ul>\n<li><span><span><span>c0∗=c0+c0′c^*_0 = c_0 + c'_0</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n<li><span><span><span>c1∗=c1+c1′c^*_1 = c_1 + c'_1</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n<li>return <span><span><span>c∗=(c0∗,c1∗)c^* = (c^*_0, c^*_1)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></li>\n</ul>\n<div><span><span><span>c0∗=c0+c0′=pk0⋅u+te0+m+pk0⋅u′+te0′+m′=pk0⋅(u+u′)+t(e0+e0′)+m+m′=(a⋅s+te)⋅(u+u′)+t(e0+e0′)+m+m′=(a⋅s)⋅(u+u′)+te⋅(u+u′)+t(e0+e0′)+m+m′c1∗=c1+c1′=pk1⋅u+te1+pk1⋅u′+te1′=pk1(u+u′)+t(e1+e1′)=−a(u+u′)+t(e1+e1′)\\begin{aligned}\nc^*_0 &#x26;= c_0 + c'_0 \\\\\n&#x26;= pk_0 \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_0} + m + pk_0 \\cdot \\textcolor{red}{u'} + t\\textcolor{darkgreen}{e'_0} + m' \\\\\n&#x26;= pk_0 \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e'_0}) + m + m' \\\\\n&#x26;= (a \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e}) \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e'_0}) + m + m' \\\\\n&#x26;= (a \\cdot \\textcolor{red}{s} ) \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + t\\textcolor{darkgreen}{e} \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e'_0}) + m + m'\n\\\\\n\\\\\nc^*_1 &#x26;= c_1 + c'_1 \\\\\n&#x26;= pk_1 \\cdot \\textcolor{red}{u} + t\\textcolor{darkgreen}{e_1} + pk_1 \\cdot \\textcolor{red}{u'} + t\\textcolor{darkgreen}{e'_1} \\\\ \n&#x26;= pk_1(\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_1} + \\textcolor{darkgreen}{e'_1}) \\\\\n&#x26;= -a(\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_1} + \\textcolor{darkgreen}{e'_1})\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>−</span><span>a</span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>And by using <code>Decrypt(c*, sk, params)</code> we have</p>\n<div><span><span><span>c0∗+c1∗⋅s=(a⋅s)⋅(u+u′)+te⋅(u+u′)+t(e0+e0′)+m+m′⏞c0∗++(−a(u+u′)+t(e1+e1′))⏞c1∗⋅s=(a⋅s)⋅(u+u′)+te⋅(u+u′)+t(e0+e0′)+m+m′−−(a⋅s)⋅(u+u′)+t(e1+e1′)⋅s=te⋅(u+u′)+t(e0+e0′)+t(e1+e1′)⋅s+m+m′=t(e⋅(u+u′)+e0+e0′+(e1+e1′)⋅s)⏟error+m+m′\\begin{aligned}\nc^*_0 + c^*_1 \\cdot \\textcolor{red}{s} &#x26;= \\overbrace{(a \\cdot \\textcolor{red}{s} ) \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + \\textcolor{darkgreen}{te} \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e'_0}) + m + m'}^{c^*_0} + \\\\\n&#x26;+ \\overbrace{(-a(\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_1} + \\textcolor{darkgreen}{e'_1}))}^{c^*_1} \\cdot \\textcolor{red}{s} \\\\\n&#x26;= \\cancel{(a \\cdot \\textcolor{red}{s} ) \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'})} + t\\textcolor{darkgreen}{e} \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e'_0}) + m + m' - \\\\\n&#x26; \\cancel{-(a \\cdot \\textcolor{red}{s}) \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'})} +  t(\\textcolor{darkgreen}{e_1} + \\textcolor{darkgreen}{e'_1}) \\cdot \\textcolor{red}{s} \\\\\n&#x26;= t\\textcolor{darkgreen}{e} \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + t(\\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e'_0}) + t(\\textcolor{darkgreen}{e_1} + \\textcolor{darkgreen}{e'_1}) \\cdot \\textcolor{red}{s}  + m + m' \\\\\n&#x26;=  \\underbrace{t(\\textcolor{darkgreen}{e} \\cdot (\\textcolor{red}{u} + \\textcolor{red}{u'}) + \\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e'_0} + (\\textcolor{darkgreen}{e_1} + \\textcolor{darkgreen}{e'_1}) \\cdot \\textcolor{red}{s} )}_{\\text{error}} + m + m'\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span><span><span><span></span><span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span>+</span></span></span><span><span></span><span><span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span><span><span><span></span><span><span>(</span><span>−</span><span>a</span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>−</span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>−</span><span>(</span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>t</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>t</span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span><span>error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>(</span><span>u</span><span></span><span>+</span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>(</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Again, by reducing everything <span><span><span> mod t\\bmod t</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> we have</p>\n<div><span><span><span>c0∗+c1∗⋅s=m∗=m+m′ mod tc^*_0 + c^*_1 \\cdot \\red{s} = m^* = m + m' \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span></div>\n<p>with the same remark that for the decryption to be correct the error that we add to <span><span><span>m∗m^*</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> must not wrap <span><span><span>m∗m^*</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> around <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>.</p>\n<p>The resulting ciphertext <span><span><span>c∗c^*</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> is not fresh anymore (just encrypted), and has a bigger noise than any of the previous ciphertexts that were inputs in the addition operation. In general, using non-fresh ciphertexts <span><span><span>c∗c^*</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> to perform future operations will carry over the noise from all the previous operations.</p>\n<p>We'll analyse how the noise grows in a dedicated section at the end.</p>\n<h3>FHE Multiplication</h3>\n<p>As in the addition case, we want the multiplication to be done on the encrypted messages.</p>\n<p><img src=\"/galleries/bgv_scheme2023/fhe_mul_tiny.png\" alt=\"fhe_mul\"></p>\n<p>Before describing how we multiply two ciphertexts we need to reinterpret the decryption equation:\n<span><span><span>c0+c1⋅s≡m mod tc_0 + c_1 \\cdot \\red{s}  \\equiv m \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>≡</span><span></span></span><span><span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span>\nas a linear equation:\n<span><span><span>y=ax+by = ax + b</span><span aria-hidden=\"true\"><span><span></span><span>y</span><span></span><span>=</span><span></span></span><span><span></span><span>a</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span></span></span></span></span>\nin <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>.</p>\n<p>If we look at adding two such linear equations in <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> we obtain another linear  equation in <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>:\n<span><span><span>c0+c1⋅s+c0′+c1′⋅s=(c0+c0′)⏟c0∗+(c1+c1′)⏟c1∗⋅sc_0 + c_1 \\cdot \\red{s} + c'_0  + c'_1 \\cdot \\red{s} = \\underbrace{(c_0 + c_0')}_{c^*_0}  + \\underbrace{(c_1 + c'_1)}_{c^*_1} \\cdot \\red{s}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span></p>\n<p>However, when multiplying two linear equations in <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> we get a quadratic equation (<span><span><span>ax2+bx+cax^2 + bx + c</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span></span></span></span></span>) in <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>:</p>\n<div><span><span><span>(c0+c1⋅s)⏟=m mod t⋅(c0′+c1′⋅s)⏟=m′ mod t=c1⋅c1′⋅s2+(c0⋅c1′+c1⋅c0′)⋅s+c0⋅c0′\\begin{aligned}\n\\underbrace{(c_0 + c_1 \\cdot \\textcolor{red}{s} )}_{= m \\bmod t} \\cdot \\underbrace{(c'_0 + c'_1 \\cdot \\textcolor{red}{s} )}_{= m' \\bmod t} &#x26;= c_1 \\cdot c'_1 \\cdot \\textcolor{red}{s}^2 + (c_0 \\cdot c'_1 + c_1 \\cdot c'_0) \\cdot \\textcolor{red}{s} +c_0 \\cdot c'_0\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span></span><span><span><span>=</span><span>m</span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span><span><span></span><span><span><span>=</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>We can define <code>mul</code> in the following way:\n<code>mul(c, c') -> c*</code></p>\n<ul>\n<li><span><span><span>c0∗=c0⋅c0′c^*_0 = c_0 \\cdot c'_0</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n<li><span><span><span>c1∗=c0⋅c1′+c1⋅c0′c^*_1 = c_0 \\cdot c'_1 + c_1 \\cdot c'_0</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n<li><span><span><span>c2∗=c1⋅c1′c^*_2 = c_1 \\cdot c'_1</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></li>\n<li>return <span><span><span>c∗=(c0∗,c1∗,c2∗)c^* = (c^*_0, c^*_1, c^*_2)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></li>\n</ul>\n<p><strong>Remarks</strong></p>\n<ul>\n<li>Similarly, as in addition, the noise of the resulting ciphertext <span><span><span>c∗c^*</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span></span></span></span></span> increases.</li>\n<li>We increase the number of ciphertext components by 1. This is not sustainable.</li>\n<li>Our decryption equation is linear, however after <code>mul</code> we have a quadratic decryption equation with 3 ciphertexts that doesn't play well with our idea of linear decryption equation.</li>\n</ul>\n<p>To solve the remarks the concept of <strong>relinearization</strong> is introduced.</p>\n<h2>Relinearization</h2>\n<p>The concept was explained in the <a href=\"https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/\">BFV blogpost</a> as well.</p>\n<p><em>Intuition</em>: We want to transform the quadratic equation <span><span><span>c0∗+c1∗⋅s+c2∗⋅s2c^*_0 + c^*_1 \\cdot \\red{s} + c^*_2 \\cdot \\red{s}^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> in <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> into some other linear equation <span><span><span>c^0+c^1⋅s^\\hat c_0 + \\hat c_1 \\cdot \\red{\\hat s}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span>s</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span> in some other secret key <span><span><span>s^\\red{\\hat s}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span></span><span>s</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>In order to do this we need to give some extra information (a \"hint\") about the key <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> that will help us get <span><span><span>s^\\red{\\hat s}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span></span><span>s</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>Consider the hint to be the pair:</p>\n<div><span><span><span>(ek0,ek1)=((a⋅s+te)+s2,−a)(ek_0, ek_1) = ((a \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e}) + \\textcolor{red}{s}^2, -a)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>(</span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>e</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span><span></span><span>−</span><span>a</span><span>)</span></span></span></span></span></div>\n<p>This is very similar to how the public key is generated and we can use the <code>PubKeyGen -> (pk0, pk1)</code> to generate it:\n<span><span><span>(pk0+s2,pk1)(pk_0 + \\red{s}^2, pk_1)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>\nIntuitively, we use a RLWE sample to hide <span><span><span>s2\\red{s}^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>Notice that:</p>\n<div><span><span><span>ek0+ek1⋅s=a⋅s+e+s2−a⋅s=s2+eek_0 + ek_1 \\cdot \\textcolor{red}{s} = \\cancel{\\textcolor{red}{a} \\cdot \\textcolor{red}{s}} + \\textcolor{darkgreen}{e} + \\textcolor{red}{s}^2 - \\cancel{\\textcolor{red}{a} \\cdot \\textcolor{red}{s}} = \\textcolor{red}{s}^2 + \\textcolor{darkgreen}{e}</span><span aria-hidden=\"true\"><span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>a</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>a</span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span></span></span></span></span></div>\n<p>The easiest way to get the term <span><span><span>c2∗s2c^*_2 \\red{s}^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> from the above equation is to multiply it by <span><span><span>c2∗c^*_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. However, <span><span><span>c2∗c^*_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a random element in <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and it will yield some large noise <span><span><span>c2∗ec^*_2\\textcolor{darkgreen}{e}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>e</span></span></span></span></span>. So we have to do something smarter.</p>\n<h3>Key switching v1</h3>\n<p>Key switching is a variant of relinearization. We start with a ciphertext <span><span><span>cc</span><span aria-hidden=\"true\"><span><span></span><span>c</span></span></span></span></span>.</p>\n<p><strong>Idea</strong>:<br>\nSplit the ciphertext into multiple \"small\" ciphertexts (for now think of small as the ciphertext polynomials having small coefficents). We can do this by decomposing the ciphertext coefficients into a small base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span>.</p>\n<p><em>Intuition</em>:<br>\nTo build an intuition, we can take the most common bases used in representing numbers:</p>\n<ul>\n<li>Base 10: <span><span><span>12310=3⋅100+2⋅101+1⋅102123_{10} = 3 \\cdot 10^0 + 2 \\cdot 10 ^1 + 1 \\cdot 10^2</span><span aria-hidden=\"true\"><span><span></span><span>1</span><span>2</span><span><span>3</span><span><span><span><span><span><span></span><span><span><span>1</span><span>0</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>3</span><span></span><span>⋅</span><span></span></span><span><span></span><span>1</span><span><span>0</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span></span><span>⋅</span><span></span></span><span><span></span><span>1</span><span><span>0</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span>⋅</span><span></span></span><span><span></span><span>1</span><span><span>0</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span></li>\n<li>Base 2: <span><span><span>1210=11002=1⋅23+1⋅22+0⋅21+0⋅2012_{10} = 1100_2 = 1 \\cdot 2^3 + 1 \\cdot 2^2 + 0 \\cdot 2^1 + 0 \\cdot 2^0</span><span aria-hidden=\"true\"><span><span></span><span>1</span><span><span>2</span><span><span><span><span><span><span></span><span><span><span>1</span><span>0</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span>1</span><span>0</span><span><span>0</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>0</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>0</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>2</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span></span></span></span></span></span></span></span></span></li>\n</ul>\n<p>Programmatically, this can be done by dividing the integer by the base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> <em>repeatedly</em> and collecting the remainders.</p>\n<p>In Python code:</p>\n<div><pre><code><span>def</span><span> </span><span>int2base</span><span>(</span>x<span>:</span><span> </span><span>int</span><span>,</span><span> </span>base<span>:</span><span> </span><span>int</span><span>)</span><span> </span><span>-</span><span>></span><span> </span>List<span>[</span><span>int</span><span>]</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>digits<span> </span><span>=</span><span> </span><span>[</span><span>]</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>while</span><span> </span>x<span> </span><span>></span><span> </span><span>0</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q<span>,</span><span> </span>r<span> </span><span>=</span><span> </span><span>divmod</span><span>(</span>x<span>,</span><span> </span>base<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>digits<span>.</span>append<span>(</span>r<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>x<span> </span><span>=</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>digits<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span></span>\n<span></span><span>print</span><span>(</span>int2base<span>(</span><span>123</span><span>,</span><span> </span><span>10</span><span>)</span><span>)</span><span></span>\n<span></span><span>#<span> </span>[3,<span> </span>2,<span> </span>1]</span><span></span>\n<span></span><span>print</span><span>(</span>int2base<span>(</span><span>12</span><span>,</span><span> </span><span>2</span><span>)</span><span>)</span><span></span>\n<span></span><span>#<span> </span>[0,<span> </span>0,<span> </span>1,<span> </span>1]</span>\n</code></pre></div>\n<p>A ciphertext component <span><span><span>c∈Rqc \\in R_q</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span></span><span>∈</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a polynomial of degree less than <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span>, with coefficients in <span><span><span>{0,1,..,q−1}\\{0,1,..,q-1\\}</span><span aria-hidden=\"true\"><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>,</span><span></span><span>.</span><span>.</span><span>,</span><span></span><span>q</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>, which we denote as follows:\n<span><span><span>c(x)=c[0]+c[1]x+...+c[n−1]xn−1c(x) = c[0] + c[1]x + ... + c[n-1]x^{n-1}</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span>[</span><span>0</span><span>]</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>1</span><span>]</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>.</span><span>.</span><span>.</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>n</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>]</span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>We want to write the coefficients <span><span><span>(c[0],...,c[n−1])(c[0], ..., c[n-1])</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>c</span><span>[</span><span>0</span><span>]</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span>c</span><span>[</span><span>n</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span>]</span><span>)</span></span></span></span></span> in base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span>. Since any coefficient is less than <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>, this decomposition has at most <span><span><span>⌊log⁡Tq⌋+1\\lfloor \\log_T q \\rfloor + 1</span><span aria-hidden=\"true\"><span><span></span><span>⌊</span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> terms. For example <span><span><span>c[0]=∑i=0⌊log⁡Tq⌋Tic[0](i)c[0] = \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} T^i c[0]^{(i)}</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>[</span><span>0</span><span>]</span><span></span><span>=</span><span></span></span><span><span></span><span><span>∑</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>c</span><span>[</span><span>0</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> where <span><span><span>c[0](i)c[0]^{(i)}</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>[</span><span>0</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> is the corresponding digit <span><span><span>&#x3C;T&#x3C; T</span><span aria-hidden=\"true\"><span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>T</span></span></span></span></span> in the decomposition. Using these digits we can construct the polynomials <span><span><span>c(i)c^{(i)}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span>:</p>\n<div><span><span><span>c(i)(x)=c[0](i)+c[1](i)x+...+c[n−1](i)xn−1c^{(i)}(x) = c[0]^{(i)} + c[1]^{(i)}x + ... + c[n-1]^{(i)}x^{n-1}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span>[</span><span>0</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>1</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>.</span><span>.</span><span>.</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span>[</span><span>n</span><span></span><span>−</span><span></span></span><span><span></span><span>1</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Then using these polynomials we can decompose the original polynomial <span><span><span>cc</span><span aria-hidden=\"true\"><span><span></span><span>c</span></span></span></span></span>:</p>\n<div><span><span><span>c=∑i=0⌊log⁡Tq⌋Ti⋅c(i) mod qc = \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} T^i  \\cdot c^{(i)} \\bmod q</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>\n<p>The polynomials <span><span><span>c(i)c^{(i)}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> are elements of <span><span><span>RTR_T</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and for a reasonable small <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> they have small coefficients (<span><span><span>&#x3C;T&#x3C; T</span><span aria-hidden=\"true\"><span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>T</span></span></span></span></span>). For each one of them we generate the hints:</p>\n<div><span><span><span>(ek0(i),ek1(i))=(ai⋅s+tei+Tis2,−ai)(ek_0^{(i)}, ek_1^{(i)}) = (a_i \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e_i} + T^i\\textcolor{red}{s}^2, -a_i)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span><span></span><span>−</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></div>\n<p>with <span><span><span>ai←RRqa_i \\xleftarrow{R} R_q</span><span aria-hidden=\"true\"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span><span><span><span><span></span><span><span><span>R</span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>ei←χ\\textcolor{darkgreen}{e_i} \\leftarrow \\chi</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>←</span><span></span></span><span><span></span><span>χ</span></span></span></span></span>.</p>\n<p>Now we go back to our ciphertext <span><span><span>c∗=(c0∗,c1∗,c2∗)c^* = (c_0^*, c_1^*, c_2^*)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, the result of <code>EvalMul</code>. We decompose <span><span><span>c2∗c^*_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> in the base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> and we get:</p>\n<div><span><span><span>c2∗=∑i=0⌊log⁡Tq⌋Ti⋅c2∗(i) mod qc^*_2 = \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} T^i  \\cdot {c^*_2}^{(i)} \\bmod q</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>\n<p>Then we construct the new ciphertext <span><span><span>c^\\hat c</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span> with the <strong>two</strong> components:</p>\n<div><span><span><span>c^0=c0∗+∑i=0⌊log⁡Tq⌋ek0(i)⋅c2∗(i)=c0∗+∑i=0⌊log⁡Tq⌋((ai⋅s+tei)+Tis2)⋅c2∗(i)c^1=c1∗+∑i=0⌊log⁡Tq⌋ek1(i)⋅c2∗(i)=c1∗+∑i=0⌊log⁡Tq⌋−ai⋅c2∗(i)\\begin{aligned}\n\\hat c_0 &#x26;= c^*_0 + \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} ek_0^{(i)} \\cdot {c^*_2}^{(i)} = c^*_0 + \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} ((a_i \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e_i}) + T^i\\textcolor{red}{s}^2 )\\cdot {c^*_2}^{(i)}\\\\\n\\hat c_1 &#x26;= c^*_1 + \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} ek_1^{(i)} \\cdot {c^*_2}^{(i)} = c^*_1 + \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} -a_i \\cdot {c^*_2}^{(i)} \n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span>(</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>−</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Using the above relations, we obtain the following linear equation:</p>\n<div><span><span><span>c^0+c^1⋅s=c0∗+c1∗⋅s+c2∗⋅s2⏟m⋅m′+∑i=0⌊log⁡Tq⌋tei⋅c2∗(i)⏟relinearization error\\hat c_0 + \\hat c_1 \\cdot \\textcolor{red}{s} = \\underbrace{c^*_0 + c^*_1 \\cdot \\textcolor{red}{s} + c^*_2 \\cdot \\textcolor{red}{s}^2}_{m \\cdot m'} + \\underbrace{ \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} t\\textcolor{darkgreen}{e_i} \\cdot {c^*_2}^{(i)}}_{\\text{relinearization error}}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>m</span><span>⋅</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>relinearization error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></div>\n<p>(the terms containing <span><span><span>ai⋅sa_i \\cdot \\red{s}</span><span aria-hidden=\"true\"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span> from <span><span><span>c^0\\hat c_0</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>−ai⋅s-a_i \\cdot \\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>−</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span> from <span><span><span>c^1⋅s\\hat c_1 \\cdot \\red{s}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span></span></span></span></span>  cancel out, <span><span><span>c2∗c^*_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is reconstructed and we are left with an error term).</p>\n<p>Because the relinearization error is a multiple of <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span>, it goes away when we decrypt and reduce <span><span><span> mod t\\bmod t</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> as long as the relinearization error does not wrap <span><span><span>m∗=m⋅m′m^* = m\\cdot m'</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> around <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>.</p>\n<p><strong>Remarks</strong></p>\n<ul>\n<li>We need to relinearize after a multiplication.</li>\n<li>A smaller <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> means we have a smaller noise, but more relinearization keys are needed.</li>\n<li><span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> is chosen based on what we want to optimize. We usually want to choose <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> to introduce a noise around the size of the noise in the ciphertexts. Once the noise grows we can use <span><span><span>T2T^2</span><span aria-hidden=\"true\"><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> or something else. We can also choose a big <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> at the start (which introduces lots of starting noise) and we don't need to change it later.</li>\n</ul>\n<h3>Modulus switching</h3>\n<p><strong>Task</strong>:\nYou want to reduce the noise that accumulates in the ciphertext, after performing homomorphic operations. The modulus switching technique allows us to decrease the noise, to ensure the decryption is still correct after performing homomorphic operations. More analysis is provided in a dedicated section below.</p>\n<p><strong>Idea</strong>: The technique uses two moduli <span><span><span>Q,qQ, q</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>,</span><span></span><span>q</span></span></span></span></span> with <span><span><span>q&#x3C;Qq &#x3C; Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>Q</span></span></span></span></span> and <span><span><span>q∣Qq | Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>∣</span><span>Q</span></span></span></span></span>. This  involves changing the ring where the ciphertexts live, <span><span><span>RQR_Q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, with a ring <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, that is parametrized by the smaller modulus. When you perform this change, the coefficient ring  <span><span><span>ZQ\\mathbb Z_Q</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is \"approximated\" by some ring <span><span><span>Zq\\mathbb Z_q</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, in the intuitive sense that the numbers become smaller (the numbers are scaled down by some factor). As we will see this means that the noise will be smaller in absolute value. Although, the noise will relatively  stay the same, since <span><span><span>q&#x3C;Qq &#x3C; Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>Q</span></span></span></span></span>, we mostly care about the magnitude of the noise, especially in multiplications.</p>\n<p>You can perform this repeatedly with many moduli <span><span><span>{q0,q1,...,qL}\\{q_0, q_1, ..., q_L\\}</span><span aria-hidden=\"true\"><span><span></span><span>{</span><span><span>q</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>,</span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>L</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>}</span></span></span></span></span> with decreasing values to lower the noise after each multiplication.</p>\n<p>The easiest way to do this is to scale down the ciphertext's components by <span><span><span>q/Qq / Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>/</span><span>Q</span></span></span></span></span> and <strong>smartly round</strong> in a way to keep the decryption equation correct. To ensure this, we want the scaling to keep the following propriety: <span><span><span>c~i=ci mod t\\tilde c_i = c_i \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span> , where <span><span><span>c~i≈(q/Q)ci\\tilde c_i \\approx (q / Q) c_i</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≈</span><span></span></span><span><span></span><span>(</span><span>q</span><span>/</span><span>Q</span><span>)</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> where <span><span><span>i∈{0,1}i \\in \\{0, 1\\}</span><span aria-hidden=\"true\"><span><span></span><span>i</span><span></span><span>∈</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>}</span></span></span></span></span>.</p>\n<p>The two requirements that we want to have are</p>\n<ol>\n<li>The decryption should be correct (decryption mod <span><span><span>QQ</span><span aria-hidden=\"true\"><span><span></span><span>Q</span></span></span></span></span> should be the same as decryption mod <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>): <span><span><span>[c0+c1⋅s]Q=[c~0+c~1⋅s]q mod t[c_0 + c_1 \\cdot \\red{s}]_Q = [\\tilde c_0 + \\tilde c_1 \\cdot \\red{s}]_q \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span>.</li>\n<li>The noise scales down.</li>\n</ol>\n<p><strong>Rounding</strong><br>\nIn order for the decryption to be correct we must adjust <span><span><span>cic_i</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> before scaling by  <span><span><span>q/Qq / Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>/</span><span>Q</span></span></span></span></span>. To do this we add a <strong>small correction term</strong> <span><span><span>δi\\delta_i</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> per component. We require <span><span><span>δi\\delta_i</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to:</p>\n<ol>\n<li>Only influence the error, hence <span><span><span>δi≡0 mod t\\delta_i \\equiv 0 \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≡</span><span></span></span><span><span></span><span>0</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span> (it will disappear when decrypting)</li>\n<li>Make the ciphertext to be divisible by <span><span><span>Q/q Q / q</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>:\n<div><span><span><span>ci+δi≡0 mod Qq⇒δi≡−ci mod Qqc_i + \\delta_i \\equiv 0 \\bmod \\dfrac Q q  \\Rightarrow \\delta_i \\equiv -c_i \\bmod \\dfrac Q q</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≡</span><span></span></span><span><span></span><span>0</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>⇒</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≡</span><span></span></span><span><span></span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span></div>\n</li>\n</ol>\n<p>One easy choice to set the correction terms such that both properties hold is <span><span><span>δi=t[−cit−1]Q/q\\delta_i = t [-c_i t^{-1}]_{Q/q}</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> where <span><span><span>t−1t^{-1}</span><span aria-hidden=\"true\"><span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span> is the inverse of <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> modulo <span><span><span>Q/qQ / q</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>.</p>\n<p>In the end, we define the components <span><span><span>c~i\\tilde c_i</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> of the  modulus switched ciphertext:\n<span><span><span>c~i=qQ(ci+δi)\\tilde c_i = \\dfrac q Q(c_i + \\delta_i)</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></p>\n<p>Now, let's check the decryption equation is actually correct. For a <span><span><span>k∈Rk \\in R</span><span aria-hidden=\"true\"><span><span></span><span>k</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span>:</p>\n<div><span><span><span>[c~0+c~1⋅s]q=c~0+c~1⋅s−kq=qQ(c0+δ0)+qQ(c1+δ1)⋅s−kq=qQ(c0+c1⋅s+δ0+δ1⋅s)−kq=qQ([c0+c1⋅s]Q+kQ+δ0+δ1⋅s)−kq=qQ[c0+c1⋅s]Q⏟≡m mod t+qQ(δ0+δ1⋅s)⏟≡0 mod t+kq−kq≡qQm mod t\\begin{aligned}\n[\\tilde c_0 + \\tilde c_1 \\cdot \\textcolor{red}{s}]_q \n&#x26;= \\tilde c_0 + \\tilde c_1 \\cdot \\textcolor{red}{s} - kq \\\\\n&#x26;= \\dfrac q Q(c_0 + \\delta_0) + \\dfrac q Q (c_1 + \\delta_1) \\cdot \\textcolor{red}{s} - kq \\\\\n&#x26;= \\dfrac q Q(c_0 + c_1 \\cdot \\textcolor{red}{s} + \\delta_0 + \\delta_1 \\cdot \\textcolor{red}{s}) - kq \\\\\n&#x26;= \\dfrac q Q([{c_0 + c_1 \\cdot \\textcolor{red}{s}}]_Q + kQ + \\delta_0 + \\delta_1 \\cdot \\textcolor{red}{s}) - kq \\\\ \n&#x26;= \\dfrac q Q \\underbrace{[{c_0 + c_1 \\cdot \\textcolor{red}{s}}]_Q}_{\\equiv m \\bmod t}  + \\underbrace{\\dfrac q Q (\\delta_0 + \\delta_1 \\cdot \\textcolor{red}{s})}_{\\equiv 0 \\bmod t} + kq - kq \\\\\n&#x26;\\equiv \\dfrac q Q m \\bmod t\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>[</span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>k</span><span>Q</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span><span><span><span><span></span><span><span><span>≡</span><span>m</span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>[</span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>≡</span><span>0</span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span><span>k</span><span>q</span><span></span><span>−</span><span></span><span>k</span><span>q</span></span></span><span><span></span><span><span></span><span></span><span>≡</span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>When doing <span><span><span>c0+c1⋅s=[c0+c1⋅s]Q+kQc_0 + c_1 \\cdot \\red{s} = [c_0 + c_1 \\cdot \\red{s}]_Q + kQ</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>k</span><span>Q</span></span></span></span></span>\nwe mention that <span><span><span>kk</span><span aria-hidden=\"true\"><span><span></span><span>k</span></span></span></span></span> is the same as in <span><span><span>[c~0+c~1⋅s]q=c~0+c~1⋅s−kq[\\tilde c_0 + \\tilde c_1 \\cdot \\red{s}]_q = \\tilde c_0 + \\tilde c_1 \\cdot \\red{s} - kq</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>−</span><span></span></span><span><span></span><span>k</span><span>q</span></span></span></span></span> under some conditions (see lemma 1 from <a href=\"https://eprint.iacr.org/2011/277.pdf\">here</a>).</p>\n<p>In the end we decrypt <span><span><span>qQm\\dfrac q Q m</span><span aria-hidden=\"true\"><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>m</span></span></span></span></span> instead of <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span>. In practice this can be solved by multiplying by <span><span><span>Q/qQ/q</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span> before encryption or after decryption, or to take <span><span><span>Q/q≡1 mod tQ/q \\equiv 1 \\bmod t</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>/</span><span>q</span><span></span><span>≡</span><span></span></span><span><span></span><span>1</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>t</span></span></span></span></span> (however such a <span><span><span>Q/qQ/q</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span> can be harder to find).</p>\n<h3>Key switching v2</h3>\n<p>Now that we know about modulus switching we introduce a second version to do key switching in BGV. Recall that the key switching technique is used in relinearization, for decreasing the size of the ciphertext obtained in multiplication.</p>\n<p><strong>Idea</strong>: Given two moduli <span><span><span>q,Qq, Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>,</span><span></span><span>Q</span></span></span></span></span>  with <span><span><span>q&#x3C;Qq &#x3C; Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>Q</span></span></span></span></span> and <span><span><span>q∣Qq | Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>∣</span><span>Q</span></span></span></span></span>, we start with elements in <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and we make a detour in a ring <span><span><span>RQR_Q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> with a bigger modulus <span><span><span>QQ</span><span aria-hidden=\"true\"><span><span></span><span>Q</span></span></span></span></span> where we perform our relinearization. Then we perform modulus switching to go back to our small ring <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>We generate the <em>hint</em>:</p>\n<div><span><span><span>(ek0,ek1)=((a⋅s+te+Qqs2),−a) mod Q(ek_0, ek_1) = ((a \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e} + \\frac{Q}{q} \\textcolor{red}{s}^2), -a) \\bmod Q</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>(</span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>−</span><span>a</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>Q</span></span></span></span></span></div>\n<p>Recall that <span><span><span>c∗=(c0∗,c1∗,c2∗)c^* = (c^*_0, c^*_1, c^*_2)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> is the result of the <code>mul</code>. Then we compute the components of the new ciphertext <span><span><span>c^\\hat c</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span></span></span></span></span>:</p>\n<div><span><span><span>c^0=Qqc0∗+c2∗⋅ek0 mod Qc^1=Qqc1∗+c2∗⋅ek1 mod Q\\begin{aligned}\n\\hat c_0 &#x26;= \\frac Q q c_0^* + c_2^* \\cdot ek_0 \\bmod Q\\\\\n\\hat c_1 &#x26;= \\frac Q q c_1^* + c_2^* \\cdot ek_1 \\bmod Q\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>Q</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span>q</span></span><span><span></span><span></span></span><span><span></span><span>Q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Lastly, we scale them both using modulus switching: <span><span><span>c^i=qQ(c^i+δi)\\hat c_i = \\dfrac q Q (\\hat c_i + \\delta_i)</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> with <span><span><span>δi=t[−cit−1]Q/q\\delta_i = t[-c_i t^{-1}]_{Q/q}</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, like before.</p>\n<p>The relinearization equation looks like this:</p>\n<div><span><span><span>c^0+c^1⋅s=c0∗+c1∗⋅s+c2∗⋅s2⏟m⋅m′+qQ(tc2∗⋅e+δ0+δ1⋅s)⏟relinearization error\\hat c_0 + \\hat c_1 \\cdot \\textcolor{red}{s} = \\underbrace{c_0^* + c_1^* \\cdot \\textcolor{red}{s} + c_2^* \\cdot \\textcolor{red}{s}^2}_{m\\cdot m'} + \\underbrace{\\dfrac q Q (t c_2^* \\cdot \\textcolor{darkgreen}{e} + \\delta_0 + \\delta_1 \\cdot \\textcolor{red}{s})}_{\\text{relinearization error}}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>m</span><span>⋅</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>relinearization error</span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></div>\n<p>Because the relinearization error is a multiple of <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> (remember that we chose <span><span><span>δi\\delta_i</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to be multiples of <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> too, to not influence the error), it will go away when we decrypt and reduce <span><span><span> mod t\\bmod t</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>t</span></span></span></span></span> as long as the relinearization error does not wrap <span><span><span>m∗=m⋅m′m^* = m\\cdot m'</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>∗</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>m</span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> around <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>.</p>\n<div><span><span><span>c^0+c^1⋅s=qQ(Qqc0∗+c2∗⋅ek0+δ0)+(qQ(Qqc1∗+c2∗⋅ek1)+δ1)⋅s=qQ(Qqc0∗+c2∗⋅(a⋅s+te+Qqs2)+δ0)++(qQ(Qqc1∗+c2∗⋅(−a))+δ1)⋅s=c0∗+c1∗⋅s+c2∗⋅s2+qQ(tc2∗⋅e+δ0+δ1⋅s)=mm′ mod t\\begin{aligned}\n\\hat c_0 + \\hat c_1 \\cdot \\textcolor{red}{s} \n&#x26;= \\frac{q}{Q} \\left( \\frac{Q}{q} c_0^* + c_2^* \\cdot ek_0 + \\delta_0 \\right) + \\left(\\frac{q}{Q} \\left ( \\frac{Q}{q} c_1^*  + c_2^* \\cdot ek_1 \\right) + \\delta_1 \\right) \\cdot \\textcolor{red}{s} \\\\\n&#x26;= \\frac{q}{Q} \\left( \\frac{Q}{q} c_0^* + c_2^* \\cdot \\left( a \\cdot \\textcolor{red}{s} + t\\textcolor{darkgreen}{e} + \\frac{Q}{q} \\textcolor{red}{s}^2 \\right) + \\delta_0 \\right) + \\\\\n&#x26;+ \\left(\\frac{q}{Q} \\left ( \\frac{Q}{q} c_1^*  + c_2^* \\cdot (-a)\\right)  + \\delta_1 \\right) \\cdot \\textcolor{red}{s} \\\\\n&#x26;= c_0^* + c_1^* \\cdot \\textcolor{red}{s} + c_2^* \\cdot s^2 + \\frac{q}{Q} (tc_2^* \\cdot \\textcolor{darkgreen}{e} + \\delta_0 + \\delta_1 \\cdot \\textcolor{red}{s}) \\\\\n&#x26;= mm' \\bmod t\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>^</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span><span>(</span></span><span>a</span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span>t</span><span>e</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span></span></span><span><span></span><span><span></span><span></span><span>+</span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>(</span><span>−</span><span>a</span><span>)</span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>⋅</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>e</span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<h2>Noise analysis</h2>\n<p>The main motivation of analysing the noise growth is because we want to set the parameters of the scheme based on it.</p>\n<p>Relevant papers:</p>\n<ul>\n<li><a href=\"https://www.esat.kuleuven.be/cosic/publications/thesis-316.pdf\">Ilia Iliashenko thesis</a></li>\n<li><a href=\"https://eprint.iacr.org/2015/889.pdf\">CS15</a></li>\n<li><a href=\"https://eprint.iacr.org/2019/493.pdf\">Evaluating the effectiveness of heuristic worst-case noise analysis in FHE</a></li>\n<li><a href=\"https://eprint.iacr.org/2012/099.pdf\">GHS</a></li>\n<li><a href=\"https://eprint.iacr.org/2022/706.pdf\">Finding and Evaluating Parameters for BGV</a></li>\n</ul>\n<h3>Measuring Noise</h3>\n<p>When doing operations (such as addition, multiplication) with noisy ciphertexts, the total noise accumulates. In the end we want our decryption to be correct. However, this can only happen if the accumulated noise does not exceed some <strong>bound</strong>.</p>\n<p><img src=\"/galleries/bgv_scheme2023/fhe_noise_tiny.png\" alt=\"fhe_noise\"></p>\n<p><em>Intuition</em>: We want to \"measure\" this accumulated noise by looking at \"how much\" a polynomial can impact an operation it's involved in. For example, we can analyze the impact of the polynomials <span><span><span>eie_i</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> which represent the RLWE noise or of the secret <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>. We can represent the polynomial's impact with a number.</p>\n<p>We can \"measure\" the impact of the polynomials using the:</p>\n<ol>\n<li><strong>Infinity norm</strong>: <span><span><span>∥a∥∞=max⁡∣ai∣\\|a\\|_\\infty = \\max{|a_i|}</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>max</span><span></span><span><span>∣</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>∣</span></span></span></span></span></span>, which is the value of the biggest coefficient in absolute value.</li>\n<li><strong>Canonical norm</strong>: <span><span><span>∥a∥can\\can a</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span>. In order to define it we use the so called <strong>canonical embedding</strong> of the polynomial.</li>\n</ol>\n<p>While the infinity norm is easy to understand, the canonical embedding is a bit more mathematically involved. Instead of searching for a way to measure the impact of a polynomial <span><span><span>a∈Ra \\in R</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span>, we transfer the polynomial in another space, such as <span><span><span>Cn\\mathbb C^n</span><span aria-hidden=\"true\"><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>, and we search for a better measure there.</p>\n<p>Recall that we work with polynomials from the ring <span><span><span>Rq=Zq[X]/(Xn+1)R_q = \\mathbb Z_q[X]/(X^n + 1)</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>X</span><span>]</span><span>/</span><span>(</span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span> with <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> a power of <span><span><span>22</span><span aria-hidden=\"true\"><span><span></span><span>2</span></span></span></span></span>.</p>\n<p><strong>Canonical embedding</strong><br>\nWe have the quotient polynomial <span><span><span>Xn+1X^n + 1</span><span aria-hidden=\"true\"><span><span></span><span><span>X</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> of <span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span> which has the complex roots <span><span><span>{ζ0,…,ζn−1}\\{\\zeta_0, \\dots, \\zeta_{n-1}\\}</span><span aria-hidden=\"true\"><span><span></span><span>{</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>…</span><span></span><span>,</span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>}</span></span></span></span></span> with <span><span><span>ζin=−1⇒ζi2n=1\\zeta_i^n = -1 \\Rightarrow \\zeta_i^{2n} = 1</span><span aria-hidden=\"true\"><span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>i</span></span></span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>−</span><span>1</span><span></span><span>⇒</span><span></span></span><span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>i</span></span></span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span></span>.<br>\nThen we take a polynomial <span><span><span>a∈Ra \\in R</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span>:<br>\n<span><span><span>a(X)=a0+a1X+...an−1Xn−1a(X) = a_0 + a_1X + ... a_{n-1}X^{n-1}</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>(</span><span>X</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>X</span><span></span><span>+</span><span></span></span><span><span></span><span>.</span><span>.</span><span>.</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>X</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span>\nand we evaluate <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> in every root <span><span><span>ζi\\zeta_i</span><span aria-hidden=\"true\"><span><span></span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. This leads to a vector <span><span><span>(a(ζ0),...a(ζn−1))∈Cn\\left(a(\\zeta_0), ... a(\\zeta_{n-1})\\right) \\in \\mathbb C^n</span><span aria-hidden=\"true\"><span><span></span><span><span>(</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span><span></span><span>∈</span><span></span></span><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>. We call this vector the <strong>canonical embedding</strong> of <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span>.<br>\nThe <a href=\"https://eprint.iacr.org/2012/230.pdf\">canonical embedding</a> is defined as</p>\n<div><span><span><span>σ:R→Cn,σ(a)=(a(ζ0),...a(ζn−1))\\sigma: R \\to \\mathbb C^n,\n\\quad \\sigma(a) = \\left(a(\\zeta_0), ... a(\\zeta_{n-1})\\right)</span><span aria-hidden=\"true\"><span><span></span><span>σ</span><span></span><span>:</span><span></span></span><span><span></span><span>R</span><span></span><span>→</span><span></span></span><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span>,</span><span></span><span></span><span>σ</span><span>(</span><span>a</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>(</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span>a</span><span>(</span><span><span>ζ</span><span><span><span><span><span><span></span><span><span><span>n</span><span>−</span><span>1</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span></span></span></span></span></span></div>\n<p><strong>Canonical norm</strong><br>\nSince now we have obtained a new vector in <span><span><span>Cn\\mathbb C^n</span><span aria-hidden=\"true\"><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span> we can look at its infinity norm and define the <strong>canonical norm</strong> <span><span><span>∥a∥can=∥σ(a)∥∞\\can a = \\|\\sigma(a)\\|_\\infty</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>∥</span><span>σ</span><span>(</span><span>a</span><span>)</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>In practice, the canonical norm is used to compute the noise bounds, because it provides a better decryption noise bound.</p>\n<ol>\n<li>There is a relationship between these norms: <span><span><span>∥a∥∞≤c2n⋅∥a∥can\\|a\\|_{\\infty} \\leq c_{2n}\\cdot \\can a</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span> for some constant <span><span><span>c2nc_{2n}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, which is <span><span><span>11</span><span aria-hidden=\"true\"><span><span></span><span>1</span></span></span></span></span> when <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> is a power of <span><span><span>22</span><span aria-hidden=\"true\"><span><span></span><span>2</span></span></span></span></span> (see <a href=\"https://eprint.iacr.org/2011/535.pdf\">this</a>). With this inequality in mind, it suffices to assure correct decryption by setting the canonical norm of the noise to be less than <span><span><span>q/2q/2</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>/</span><span>2</span></span></span></span></span>.</li>\n<li>When doing multiplications, the noise bound offered by the canonical norm increases slower than the bound offered by the infinity norm. We have these two inequalities:</li>\n</ol>\n<div><span><span><span>∥ab∥∞≤γ∥a∥∞∥b∥∞∥ab∥can≤∥a∥can∥b∥can\\begin{aligned}\n\\|ab\\|_\\infty &#x26;\\leq \\gamma\\|a\\|_\\infty \\|b\\|_\\infty  \\\\ \n\\can {ab} &#x26;\\leq \\can a \\can b\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>∥</span><span>a</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span>∥</span><span>a</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>γ</span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>∥</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span>∞</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span>∥</span><span>b</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>where <span><span><span>γ>1\\gamma > 1</span><span aria-hidden=\"true\"><span><span></span><span>γ</span><span></span><span>></span><span></span></span><span><span></span><span>1</span></span></span></span></span> is the so-called <em>expansion factor</em> of the ring <span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span>. For more details, see <a href=\"https://escholarship.org/content/qt0141w93p/qt0141w93p.pdf\">this</a>.</p>\n<p><strong>Noise bounds</strong><br>\nSuppose we choose <span><span><span>a∈Ra \\in R</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span> with coefficients sampled independently from one of the distributions (discrete Gaussian, random, ternary). Let <span><span><span>VaV_a</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> be the variance of each coefficient <span><span><span>(a0,...an)(a_0, ... a_n)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>.</span><span>.</span><span>.</span><span><span>a</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> in <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span>. In <a href=\"https://www.esat.kuleuven.be/cosic/publications/thesis-316.pdf\">Ilia Iliashenko's thesis</a> and in the <a href=\"https://eprint.iacr.org/2022/706.pdf\">Finding and Evaluating Parameters for BGV</a> paper it's shown that we can choose a number <span><span><span>DD</span><span aria-hidden=\"true\"><span><span></span><span>D</span></span></span></span></span> such that\n<span><span><span>∥a∥can≤DnVa \\can a \\leq D \\sqrt{n V_a}</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>a</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span>\nholds with overwhelming probability. In practice, we set <span><span><span>D=6D = 6</span><span aria-hidden=\"true\"><span><span></span><span>D</span><span></span><span>=</span><span></span></span><span><span></span><span>6</span></span></span></span></span>.</p>\n<p>When analysing the noise growth we'll make use of the following proprieties. For two polynomials <span><span><span>a,b∈Ra, b \\in R</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>,</span><span></span><span>b</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span> with variances <span><span><span>Va,VbV_a, V_b</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and some constant <span><span><span>kk</span><span aria-hidden=\"true\"><span><span></span><span>k</span></span></span></span></span> we have:</p>\n<ul>\n<li><span><span><span>Va+b=Va+VbV_{a+b} = V_a + V_b</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>a</span><span>+</span><span>b</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> ,</li>\n<li><span><span><span>Vka=k2VaV_{ka} = k^2V_a</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>k</span><span>a</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>k</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>,</li>\n<li><span><span><span>Va⋅b=nVaVbV_{a \\cdot b} = nV_aV_b</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>a</span><span>⋅</span><span>b</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</li>\n</ul>\n<p>For the distributions that we work with we have the <strong>coefficient</strong> variances:</p>\n<ul>\n<li>Discrete Gaussian distribution with standard deviation <span><span><span>σ: VDG=σ2\\sigma: \\ V_{\\mathcal {DG}} = \\sigma^2</span><span aria-hidden=\"true\"><span><span></span><span>σ</span><span></span><span>:</span><span> </span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>D</span><span>G</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>\n<li>Ternary distribution: <span><span><span>V3=2/3V_3 = 2/3</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>2</span><span>/</span><span>3</span></span></span></span></span>.</li>\n<li>Uniform distribution with integer coefficients in <span><span><span>(−q/2,q/2]: Vq≈q2/12(-q/2, q/2]: \\ V_q \\approx q^2 / 12</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>−</span><span>q</span><span>/</span><span>2</span><span>,</span><span></span><span>q</span><span>/</span><span>2</span><span>]</span><span></span><span>:</span><span> </span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≈</span><span></span></span><span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>\n</ul>\n<h3>Noise for operations</h3>\n<p>We now have the building blocks (starting values and operations) to analyse the noise for each operation. The goal of analysing the noise buildup is to choose the scheme parameters such that the scheme properties (fhe, decryption) hold and the scheme remains secure. Following the paper <a href=\"https://eprint.iacr.org/2022/706.pdf\">Finding and Evaluating Parameters for BGV</a> we have:</p>\n<p><strong>Fresh ciphertext noise</strong><br>\nIn order to make sure the decryption is correct we must make sure the error</p>\n<div><span><span><span>v=c0+c1⋅s=t(e⋅u+e0+e1⋅s)⏟r+m=r+m mod qv = c_0 + c_1 \\cdot \\textcolor{red}{s} = \\underbrace{t(\\textcolor{darkgreen}{e} \\cdot \\textcolor{red}{u} + \\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e_1} \\cdot \\textcolor{red}{s})}_{r} + m = r + m \\bmod q</span><span aria-hidden=\"true\"><span><span></span><span>v</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>r</span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span>t</span><span>(</span><span>e</span><span></span><span>⋅</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>m</span><span></span><span>=</span><span></span></span><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span>m</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>\n<p>does not wrap around the modulus (i.e <span><span><span>∥v∥∞≤c2n∥v∥can≤q/2\\|v\\|_{\\infty} \\leq c_{2n}\\can v \\leq q/2</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>n</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>q</span><span>/</span><span>2</span></span></span></span></span> ). The message <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span> is thought to come uniformly from <span><span><span>RtR_t</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>Recall that</p>\n<ul>\n<li>The errors <span><span><span>e,e0,e1\\textcolor{darkgreen}{e}, \\textcolor{darkgreen}{e_0}, \\textcolor{darkgreen}{e_1}</span><span aria-hidden=\"true\"><span><span></span><span>e</span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> come from a discrete Gaussian => <span><span><span>Ve=Ve0=Ve1=σ2V_{\\textcolor{darkgreen}{e}} = V_{\\textcolor{darkgreen}{e_0}} = V_{\\textcolor{darkgreen}{e_1}} = \\sigma^2</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>\n<li>The secret <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> and <span><span><span>u\\red{u}</span><span aria-hidden=\"true\"><span><span></span><span>u</span></span></span></span></span> come from a ternary distribution => <span><span><span>Vs=Vu=2/3V_{\\red{s}} = V_{\\red{u}} = 2/3</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>u</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>2</span><span>/</span><span>3</span></span></span></span></span>.</li>\n<li>The message <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span> comes from <span><span><span>RtR_t</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and we assume that the coefficients are uniformly distributed in <span><span><span>Zt\\mathbb Z_t</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> => <span><span><span>Vm=t2/12V_m = t^2 / 12</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>\n</ul>\n<div><span><span><span>Vv=Vm+t(e⋅u+e0+e1⋅s)=Vm+t2Ve⋅u+e0+e1⋅s=t212+t2(nσ223+σ2+nσ223)=t2(112+σ2(43n+1))\\begin{aligned}\nV_v &#x26;= V_{m + t(\\textcolor{darkgreen}{e}\\cdot \\textcolor{red}{u} + \\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e_1} \\cdot \\textcolor{red}{s})} \\\\\n&#x26;= V_m + t^2V_{\\textcolor{darkgreen}{e} \\cdot \\textcolor{red}{u} + \\textcolor{darkgreen}{e_0} + \\textcolor{darkgreen}{e_1} \\cdot \\textcolor{red}{s}}  \\\\\n&#x26;= \\frac{t^2}{12} + t^2 \\left(n\\sigma^2 \\frac{2}{3} + \\sigma^2 + n\\sigma^2 \\frac{2}{3}\\right)  \\\\\n&#x26;= t^2 \\left(\\frac{1}{12} + \\sigma^2 \\left(\\frac{4}{3}n + 1\\right)\\right)\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>V</span><span><span><span><span><span><span></span><span><span>v</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>m</span><span>+</span><span>t</span><span>(</span><span>e</span><span>⋅</span><span>u</span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>s</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span><span>⋅</span><span>u</span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span>n</span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>3</span></span></span><span><span></span><span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>n</span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span>3</span></span></span><span><span></span><span></span></span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span><span>3</span></span></span><span><span></span><span></span></span><span><span></span><span><span>4</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span></span><span>+</span><span></span><span>1</span><span><span>)</span></span></span><span><span>)</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Hence:\n<span><span><span>∥v∥can≤DnVv\\can v \\leq D\\sqrt {nV_v}</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span>v</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></p>\n<p>The parameters for the scheme and distributions, <span><span><span>q,t,σ,nq, t, \\sigma, n</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>,</span><span></span><span>t</span><span>,</span><span></span><span>σ</span><span>,</span><span></span><span>n</span></span></span></span></span>,  are chosen such that the decryption is correct.</p>\n<p><strong>Addition</strong><br>\nFor two ciphertexts <span><span><span>(c,c′)(c, c')</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>c</span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> encrypting <span><span><span>(m,m′)(m, m')</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>m</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span> we have the corresponding errors <span><span><span>(v,v′)(v, v')</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>v</span><span>,</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span>. The error after ciphertext addition is <span><span><span>vaddv_{\\text{add}}</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>add</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>If we use the decryption equation we have</p>\n<div><span><span><span>vadd=v+v′=(c0+c1⋅s)+(c0′+c1′⋅s)=r+m+r′+m′ mod qv_{\\text{add}} = v + v' = (c_0 + c_1 \\cdot \\red{s}) + (c_0' + c_1' \\cdot \\red{s}) = r + m + r' + m' \\bmod q</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>add</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></div>\n<p>We have <span><span><span>m+m′=[m+m′]t+gtm + m' = [m + m']_t + gt</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>g</span><span>t</span></span></span></span></span> with <span><span><span>g∈Rg \\in R</span><span aria-hidden=\"true\"><span><span></span><span>g</span><span></span><span>∈</span><span></span></span><span><span></span><span>R</span></span></span></span></span> and <span><span><span>∥g∥∞=1\\|g\\|_{\\infty} = 1</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>g</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>1</span></span></span></span></span> (because both <span><span><span>∥m∥∞,∥m′∥∞&#x3C;t/2\\|m\\|_{\\infty}, \\|m'\\|_{\\infty} &#x3C; t / 2</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span>m</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>∥</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span>∞</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>t</span><span>/</span><span>2</span></span></span></span></span>). By replacing in the equation above we obtain:\n<span><span><span>v+v′=[m+m′]t+r+r′+gt mod qv + v' = [m + m']_t + r + r' + gt \\bmod q</span><span aria-hidden=\"true\"><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>g</span><span>t</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>q</span></span></span></span></span></p>\n<p>We see that the noise <span><span><span>r+r′+gtr + r' + gt</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>g</span><span>t</span></span></span></span></span> grows linearly.</p>\n<p>Finally, using the canonical norm we have the following:</p>\n<div><span><span><span>∥vadd∥can≤∥v∥can+∥v′∥can\\can {v_{\\text{add}}} \\leq \\can v + \\can {v'}</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>add</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p><strong>Multiplication</strong><br>\nSimilarly for multiplication, if we use the decryption equation we have:</p>\n<div><span><span><span>vmul=v⋅v′=(c0+c1⋅s)⋅(c0′+c1′⋅s)=(r+m)+(r′+m′)=mm′+mr′+m′r+rr′ mod q\\begin{aligned}\nv_{\\text{mul}} \n&#x26;= v \\cdot v' = (c_0 + c_1 \\cdot \\red{s}) \\cdot (c_0' + c_1' \\cdot \\red{s}) \\\\\n&#x26;= (r + m) + (r' + m') = mm' + mr' + m'r + rr' \\bmod q\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>v</span><span></span><span>⋅</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span><span></span><span>⋅</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>′</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span>r</span><span></span><span>+</span><span></span><span>m</span><span>)</span><span></span><span>+</span><span></span><span>(</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>m</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>r</span><span></span><span>+</span><span></span><span>r</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>If we look at the error term <span><span><span>mr′+m′r+rr′mr' + m'r + rr'</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span>r</span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we see that in the leading term <span><span><span>rr′rr'</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span><span>r</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span></span></span></span></span> we multiply the noises, therefore the noise grows quadratically.</p>\n<p>Using the canonical norm, we have:</p>\n<div><span><span><span>∥vmul∥can≤∥v∥can∥v′∥can\\can {v_{\\text{mul}}} \\leq \\can v\\can {v'}</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>′</span></span></span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p><strong>Modulus switching</strong><br>\nFor modulus switch we scale the noise down and then we add the small error that comes with the correction terms <span><span><span>δ0,δ1\\delta_0, \\delta_1</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.\nRecall that</p>\n<ul>\n<li>We set <span><span><span>δi=t[−cit−1]Q/q\\delta_i = t[-c_it^{-1}]_{Q/q}</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. We assume the terms <span><span><span>[−cit−1]Q/q[-c_it^{-1}]_{Q/q}</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> are uniformly distributed mod <span><span><span>Q/qQ / q</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>, then multiplied by <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> => <span><span><span>Vδ0=Vδ1=t2Q212q2V_{\\delta_0} = V_{\\delta_1} = \\dfrac {t^2Q^2} {12q^2}</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span>.</li>\n</ul>\n<div><span><span><span>vswitch=[c~0+c~1⋅s]q=qQ[c0+c1⋅s]Q+qQ(δ0+δ1⋅s)=qQv+qQ(δ0+δ1⋅s)v_{\\text{switch}} = [\\tilde c_0 + \\tilde c_1 \\cdot \\red{s}]_q = \\dfrac q Q [c_0 + c_1 \\cdot \\red{s}]_Q  + \\dfrac q Q (\\delta_0 + \\delta_1 \\cdot \\red{s}) = \\dfrac q Q v  + \\dfrac q Q (\\delta_0 + \\delta_1 \\cdot \\red{s})</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>switch</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span><span></span><span>c</span></span><span><span></span><span><span>~</span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>Q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span></span></span></span></span></div>\n<p>Using the canonical norm we get:</p>\n<div><span><span><span>∥vswitch∥can≤qQ∥v∥can+qQ∥δ0+δ1⋅s∥can≤qQ∥v∥can+Dtn12(1+23n)\\can {v_{\\text{switch}}} \\leq \\dfrac q Q \\can v + \\dfrac q Q \\can {\\delta_0 + \\delta_1 \\cdot \\red{s}} \\leq \\dfrac q Q \\can v + Dt\\sqrt{\\dfrac n {12} \\left (1 + \\dfrac 2 3 n \\right)}</span><span aria-hidden=\"true\"><span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>switch</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>∥</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>≤</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>∥</span><span>v</span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>D</span><span>t</span><span><span><span><span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span>n</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></div>\n<p>We can see that the noise is scaled down by almost <span><span><span>q/Qq / Q</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span>/</span><span>Q</span></span></span></span></span>.</p>\n<p><strong>Key switching - Base decomposition</strong><br>\nIn relinearization we deal with <span><span><span>c0+c1⋅s+c2⋅s2c_0 + c_1 \\cdot \\red{s} + c_2 \\cdot \\red{s}^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. Here we decompose <span><span><span>c2⋅s2c_2 \\cdot \\red{s}^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> in base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> and hide the <em>hints</em> about <span><span><span>s2\\red{s}^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> using  RingLWE-like samples involving errors  <span><span><span>ei\\textcolor{darkgreen}{e_i}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. Remember from  key switching technique using base decomposition that we have a relinearization error: <span><span><span>∑i=0⌊log⁡Tq⌋tei⋅c2∗(i)\\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} t\\textcolor{darkgreen}{e_i} \\cdot {c^*_2}^{(i)}</span><span aria-hidden=\"true\"><span><span></span><span><span>∑</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span>. The variance of any term <span><span><span>tei⋅c2∗(i)t\\textcolor{darkgreen}{e_i} \\cdot {c^*_2}^{(i)}</span><span aria-hidden=\"true\"><span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span> from the sum is <span><span><span>Vtei⋅c2∗(i)V_{t \\textcolor{darkgreen}{e_i} \\cdot {c^*_2}^{(i)}}</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>Recall that</p>\n<ul>\n<li>The errors <span><span><span>ei\\textcolor{darkgreen}{e_i}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> come from a discrete Gaussian distribution => <span><span><span>Vei=σ2V_{\\textcolor{darkgreen}{e_i}}= \\sigma^2</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>\n<li>We can assume that the polynomials in base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> behave like random polynomials extracted from <span><span><span>RTR_T</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> => <span><span><span>Vc2∗=T2/12V_{{c^*_2}} = T^2 / 12</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>\n</ul>\n<div><span><span><span>vks=c0∗+c1∗⋅s+c2∗⋅s2⏟vmul+∑i=0⌊log⁡Tq⌋tei⋅c2∗(i)v_{\\text{ks}} = \\underbrace{c^*_0 + c^*_1 \\cdot \\red{s} + c^*_2 \\cdot \\red{s}^2}_{v_{\\text{mul}}} +  \\sum_{i=0}^{\\lfloor \\log_T q \\rfloor} t\\textcolor{darkgreen}{e_i} \\cdot {c^*_2}^{(i)}</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>∑</span></span></span><span><span></span><span><span><span>⌊</span><span><span><span>l</span><span>o</span><span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>q</span><span>⌋</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>t</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>If we use the canonical norm:</p>\n<div><span><span><span>∥vks∥can≤∥vmul∥can+Dnlog⁡T(q)Vt⋅ei⋅c2∗(i)=∥vmul∥can+Dtn2log⁡T(q)VeiVc2∗(i)=∥vmul∥can+DtnTlog⁡T(q)σ212\\begin{aligned}\n\\can {v_{\\text{ks}}} &#x26; \\leq \\can {v_{\\text{mul}}} + D\\sqrt{n \\log_T (q)V_{t \\cdot \\textcolor{darkgreen}{e_i} \\cdot {c^*_2}^{(i)}}} \\\\\n&#x26;= \\can {v_{\\text{mul}}} + Dt\\sqrt{n^2 \\log_T (q)V_{\\textcolor{darkgreen}{e_i}} V_{{c^*_2}^{(i)}}}  \\\\ \n&#x26;= \\can {v_{\\text{mul}}} + DtnT\\sqrt{ \\log_T (q)\\dfrac {\\sigma^2} {12}}\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span></span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>t</span><span>⋅</span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span>t</span><span><span><span><span><span><span></span><span><span><span>n</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span><span>(</span><span>i</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span>t</span><span>n</span><span>T</span><span><span><span><span><span><span></span><span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p><strong>Key switching - Modulus switch</strong><br>\nIn the relinearisation version that employs modulus switching, we have the following error term: <span><span><span>qQ(tc2∗⋅e+δ0+δ1⋅s)\\dfrac q Q (tc_2^* \\cdot \\textcolor{darkgreen}{e} + \\delta_0 + \\delta_1 \\cdot \\red{s})</span><span aria-hidden=\"true\"><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span></span></span></span></span>.\nRecall that:</p>\n<ul>\n<li>The ciphertext component <span><span><span>c2∗c_2^*</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> comes from <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> => <span><span><span>Vc2∗=q2/12V_{c_2^*} = q^2 / 12</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>/</span><span>1</span><span>2</span></span></span></span></span>.</li>\n<li>The errors <span><span><span>e\\textcolor{darkgreen}{e}</span><span aria-hidden=\"true\"><span><span></span><span>e</span></span></span></span></span> comes from a discrete Gaussian => <span><span><span>Ve=σ2V_{\\textcolor{darkgreen}{e}}= \\sigma^2</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</li>\n<li>The secret <span><span><span>s\\red{s}</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> comes from a ternary distribution => <span><span><span>Vs=2/3V_{\\red{s}}= 2/3</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>2</span><span>/</span><span>3</span></span></span></span></span>.</li>\n<li>We set <span><span><span>δi=t[−cit−1]Q/q\\delta_i = t[-c_it^{-1}]_{Q/q}</span><span aria-hidden=\"true\"><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. We assume the terms <span><span><span>[−cit−1]Q/q[-c_it^{-1}]_{Q/q}</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>−</span><span><span>c</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>−</span><span>1</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>Q</span><span>/</span><span>q</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> are uniformly distributed mod <span><span><span>Q/qQ / q</span><span aria-hidden=\"true\"><span><span></span><span>Q</span><span>/</span><span>q</span></span></span></span></span>, then multiplied by <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> => <span><span><span>Vδ0=Vδ1=t2Q212q2V_{\\delta_0} = V_{\\delta_1} = \\dfrac {t^2Q^2} {12q^2}</span><span aria-hidden=\"true\"><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span>.</li>\n</ul>\n<div><span><span><span>vks=c0∗+c1∗⋅s+c2∗⋅s2⏟vmul+qQ(tc2∗⋅e+δ0+δ1⋅s)v_{\\text{ks}} = \\underbrace{c_0^* + c_1^* \\cdot \\red{s} + c_2^* \\cdot \\red{s}^2}_{v_{\\text{mul}}} + \\dfrac q Q (tc_2^* \\cdot \\textcolor{darkgreen}{e} + \\delta_0 + \\delta_1 \\cdot \\red{s})</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span><span></span><span><span><span><span><span><span></span><span><span></span><span></span><span></span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>e</span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span>)</span></span></span></span></span></div>\n<p>The variance of this error term is:</p>\n<div><span><span><span>VqQ(tc2∗i⋅e+δ0+δ1⋅s)=(qQ)2(t2nVc2∗Ve+Vδ0+nVδ1Vs)=(qQ)2(t2nq212σ2+t2Q212q2+nt2Q212q223)=(qQ)2(t2nq212σ2)+t212+nt21223=(qQ)2(t2nq212σ2)+t212(1+23n)\\begin{aligned}\nV_{\\frac q Q (t{c_2^*}_i \\cdot \\textcolor{darkgreen}{e} + \\delta_0 + \\delta_1 \\cdot \\textcolor{red}{s})} \n&#x26;= \\left(\\frac q Q \\right)^2 (t^2 nV_{c_2^*}V_{\\textcolor{darkgreen}{e}} + V_{\\delta_0} + nV_{\\delta_1}V_{\\textcolor{red}{s}}) \\\\\n&#x26;= \\left(\\frac q Q \\right)^2 \\left(t^2  n \\frac {q^2} {12} \\sigma^2 +  \\dfrac {t^2Q^2} {12q^2} + n  \\dfrac {t^2Q^2} {12q^2} \\dfrac 2 3\\right) \\\\\n&#x26;= \\left(\\frac q Q \\right)^2 \\left(t^2  n \\frac {q^2} {12} \\sigma^2 \\right)  +\\dfrac {t^2} {12} + n  \\dfrac {t^2} {12} \\dfrac 2 3 \\\\\n&#x26;= \\left(\\frac q Q \\right)^2 \\left(t^2  n \\frac {q^2} {12} \\sigma^2 \\right)  +\\dfrac {t^2} {12} \\left(1+ \\dfrac 2 3 n \\right)\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span></span><span><span><span><span><span><span></span><span><span>Q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>q</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>(</span><span>t</span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>e</span><span>+</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>⋅</span><span>s</span><span>)</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>(</span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>∗</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>n</span><span><span>V</span><span><span><span><span><span><span></span><span><span><span><span>δ</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>V</span><span><span><span><span><span><span></span><span><span><span>s</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>Q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>)</span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Now we can bound:</p>\n<div><span><span><span>∥vks∥can≤∥vmul∥can+Dn(qQ)2(t2nq212σ2+t212(1+23n))≤∥vmul∥can+DqQtn(nq212σ2+112(1+23n))\\begin{aligned}\n\\can {v_{\\text{ks}}} \n&#x26; \\leq \\can {v_{\\text{mul}}} + D\\sqrt{n \\left(\\frac q Q \\right)^2 \\left(t^2  n \\frac {q^2} {12} \\sigma^2 + \\frac {t^2} {12} \\left(1+ \\dfrac 2 3 n\\right) \\right)} \\\\\n&#x26; \\leq \\can {v_{\\text{mul}}} + D \\frac q Q t\\sqrt{n \\left(n \\frac{q^2} {12} \\sigma^2 + \\frac {1} {12} \\left(1+ \\dfrac 2 3 n\\right) \\right)}\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>ks</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span><span><span><span><span><span></span><span><span>n</span><span></span><span><span><span><span>(</span></span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>)</span></span></span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span><span><span>(</span></span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span><span><span>)</span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>≤</span><span></span><span>∥</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span><span>mul</span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span><span>∥</span><span><span><span><span><span><span></span><span><span><span><span>can</span></span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>D</span><span><span></span><span><span><span><span><span><span></span><span>Q</span></span><span><span></span><span></span></span><span><span></span><span>q</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>t</span><span><span><span><span><span><span></span><span><span>n</span><span></span><span><span><span>(</span></span><span>n</span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>σ</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>1</span><span>2</span></span></span><span><span></span><span></span></span><span><span></span><span><span>1</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span><span><span>(</span></span><span>1</span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span>3</span></span><span><span></span><span></span></span><span><span></span><span>2</span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span></span><span>n</span><span><span>)</span></span></span><span><span>)</span></span></span></span></span><span><span></span><span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<h1>Code</h1>\n<p>And now that we have discussed all the ingredients and spices of the BGV encryption scheme, it's time to bake it, sorry, implement it.</p>\n<p>We provide a <a href=\"https://github.com/zademn/EverythingCrypto/blob/master/E3-Homomorphic-Encryption/BGV.ipynb\">proof of concept implementation</a>, in Python. The aim of the code is to mirror the equations easily. This means that if we see <span><span><span>a⋅s+ea \\cdot s + e</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span></span><span>⋅</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>e</span></span></span></span></span> in the theory part we prefer to see <code>a * s + e</code> in code instead of <code>polyadd(polymul(a, s), e)</code>.</p>\n<p>DISCLAIMER: The code should be used for educational purposes only, and never in production.</p>\n<p>We represent polynomials using a class: <code>QuotientRingPoly</code>. Every polynomial is defined by three attributes:</p>\n<ul>\n<li><code>coef: np.ndarray</code> - Vector of the polynomial's coefficients. <code>coef[-1]</code> is the free coefficient, <code>coef[0]</code> is the leading coefficient. It's always padded to have <code>n</code> elements.</li>\n<li><code>coef_modulus: int</code> - Modulus of the ring where its coefficients live in.</li>\n<li><code>poly_modulus: int | np.ndarray</code> - Modulus of the polynomial ring where it belongs: <code>X^n + 1</code></li>\n</ul>\n<p><code>QuotientRingPoly</code> has the <code>._reduce(self)</code> method which reduces any polynomial to an element in the ring.</p>\n<p>We overloaded the operators <code>+, -, *, //, %</code>:</p>\n<ul>\n<li>Operators work between two <code>QuotientRingPoly</code> using the default polynomial operation rules.</li>\n<li>Operators work between a <code>QuotientRingPoly</code> and an <code>int | float</code> coefficient-wise.</li>\n</ul>\n<p>The attributes <code>coef</code> and <code>coef_modulus</code> can be assigned too. After assigning, the <code>_reduce()</code> method will be called. This is helpful to easily change the ring of the polynomial.</p>\n<p><strong>Remarks</strong></p>\n<ul>\n<li>To work with big integers, we use the python built in <code>int</code> class. To use this with numpy we set <code>dtype = object</code> for every array creation.</li>\n<li>We have helper functions <code>roundv</code> and <code>intv</code> (round vector, int vector) that vectorize the <code>round</code> and <code>int</code> operations, allowing us to help with rounding and converting vector elements to python's builtin <code>int</code> class.</li>\n</ul>\n<h1>Resources</h1>\n<ul>\n<li><a href=\"https://eprint.iacr.org/2011/277.pdf\">BGV paper</a> - Original paper</li>\n<li><a href=\"https://eprint.iacr.org/2011/344.pdf\">BV paper</a></li>\n<li><a href=\"https://homomorphicencryption.org/standard/\">FHE standard</a></li>\n<li><a href=\"https://eprint.iacr.org/2015/889.pdf\">CS15</a> - for comparisons between FHE schemes</li>\n<li><a href=\"https://www.esat.kuleuven.be/cosic/publications/thesis-316.pdf\">Ilia Iliashenko thesis</a> - for noise analysis</li>\n<li><a href=\"https://eprint.iacr.org/2019/493.pdf\">Evaluating the effectiveness of heuristic worst-case noise analysis in FHE</a></li>\n<li><a href=\"https://eprint.iacr.org/2012/099.pdf\">GHS</a></li>\n<li><a href=\"https://eprint.iacr.org/2022/706.pdf\">Finding and Evaluating Parameters for BGV</a></li>\n<li><a href=\"https://bit-ml.github.io/blog/post/homomorphic-encryption-toy-implementation-in-python/\">Bitdefender BFV blogpost</a></li>\n<li><a href=\"https://www.inferati.com/blog/fhe-schemes-bgv\">Inferati blogpost</a></li>\n</ul>\n"},"galleries":{"asm_llm2024":[{"src":"/galleries/asm_llm2024/asmllm_code_repair.png","width":2570,"height":370},{"src":"/galleries/asm_llm2024/asmllm_downstream.png","width":1255,"height":769},{"src":"/galleries/asm_llm2024/markus-spiske-uPXs5Vx5bIg-unsplash-min.jpeg","width":5760,"height":3840}],"atari_agents_2022":[{"src":"/galleries/atari_agents_2022/collage.png","width":960,"height":1300},{"src":"/galleries/atari_agents_2022/dqn_modern_pytorch_vs_dopamine.png","width":1022,"height":367},{"src":"/galleries/atari_agents_2022/octocat.svg","width":16,"height":16},{"src":"/galleries/atari_agents_2022/rliable_comparison.png","width":875,"height":763},{"src":"/galleries/atari_agents_2022/sampling.png","width":1348,"height":164}],"bgv_scheme2023":[{"src":"/galleries/bgv_scheme2023/fhe_add.drawio.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_add_tiny.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_mul.drawio.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_mul_tiny.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_noise.png","width":390,"height":412},{"src":"/galleries/bgv_scheme2023/fhe_noise_tiny.png","width":390,"height":412},{"src":"/galleries/bgv_scheme2023/fhe_simple.drawio.png","width":538,"height":161},{"src":"/galleries/bgv_scheme2023/fhe_simple_tiny.png","width":538,"height":161},{"src":"/galleries/bgv_scheme2023/lock.jpg","width":1200,"height":630},{"src":"/galleries/bgv_scheme2023/poly.drawio.png","width":342,"height":346},{"src":"/galleries/bgv_scheme2023/poly_tiny.png","width":342,"height":346},{"src":"/galleries/bgv_scheme2023/sec_game.drawio.png","width":350,"height":244},{"src":"/galleries/bgv_scheme2023/sec_game_tiny.png","width":350,"height":244}],"courses":[{"src":"/galleries/courses/atari_collage.png","width":960,"height":1300},{"src":"/galleries/courses/campus.jpg","width":725,"height":1080},{"src":"/galleries/courses/overview_bitdefender.jpg","width":1959,"height":2813},{"src":"/galleries/courses/overview_crypto.jpg","width":1920,"height":960},{"src":"/galleries/courses/overview_fmi.jpg","width":768,"height":600},{"src":"/galleries/courses/overview_pm.png","width":1194,"height":1190},{"src":"/galleries/courses/thumb_bitdefender.png","width":128,"height":128},{"src":"/galleries/courses/thumb_precis.jpg","width":128,"height":128},{"src":"/galleries/courses/thumb_rosedu.png","width":360,"height":360},{"src":"/galleries/courses/thumb_unibuc.png","width":512,"height":512}],"deep_bit_2019_pictures":[{"src":"/galleries/deep_bit_2019_pictures/20190731_150323.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_150331.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_153111.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_153118.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_164741.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_164747.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142509.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142514.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142521.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142523_1.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142925.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_144034.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145138.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145146.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145644.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145647.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145650.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145654.jpg","width":4160,"height":3120}],"deep_bit_2019_posters":[{"src":"/galleries/deep_bit_2019_posters/poster_alin_passwords.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_bogdan_train_with_private_data.png","width":7200,"height":5400},{"src":"/galleries/deep_bit_2019_posters/poster_cristi_stegano.png","width":2480,"height":3507},{"src":"/galleries/deep_bit_2019_posters/poster_elena+adi_adversarial.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_horia+alin_homoglyph.png","width":6300,"height":4875},{"src":"/galleries/deep_bit_2019_posters/poster_mada_crypto_nets.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_mircescu_MRI.png","width":2480,"height":3507},{"src":"/galleries/deep_bit_2019_posters/poster_novac_logs_anomalies.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_tudor_fake_news.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_vlad_mouse_auth.png","width":4965,"height":7021}],"deep_fmi_2019_posters":[{"src":"/galleries/deep_fmi_2019_posters/10. EmoContext_Poster.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/10. Image_Segmentation.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/10. Landmark Recognition _ Visualization.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/10. Political Orientation Classification.png","width":7200,"height":5400},{"src":"/galleries/deep_fmi_2019_posters/10. Poster_VDSR.png","width":3507,"height":4957},{"src":"/galleries/deep_fmi_2019_posters/2048_RL.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/A LEARNED REPRESENTATION FOR ARTISTIC STYLE.png","width":1275,"height":1650},{"src":"/galleries/deep_fmi_2019_posters/Emotion_Detection.png","width":4500,"height":6300},{"src":"/galleries/deep_fmi_2019_posters/Emotion_Detection_CNN.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/Google Landmark Recognition Challenge.png","width":1755,"height":2480},{"src":"/galleries/deep_fmi_2019_posters/Image Classification.png","width":1275,"height":1650},{"src":"/galleries/deep_fmi_2019_posters/Image Semantic Segmentation.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/Image_Colorization.png","width":2478,"height":3507},{"src":"/galleries/deep_fmi_2019_posters/PosterRL.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/Revising Bi-Axial LSTM for Music Generation.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/Semantic Segmantation.png","width":8400,"height":8400},{"src":"/galleries/deep_fmi_2019_posters/Style Transfer.png","width":2480,"height":3300},{"src":"/galleries/deep_fmi_2019_posters/poster.png","width":1275,"height":1650}],"eeml2019_pictures":[{"src":"/galleries/eeml2019_pictures/andrei.jpg","width":1590,"height":1060},{"src":"/galleries/eeml2019_pictures/bitdefender_booth.jpg","width":1710,"height":1140},{"src":"/galleries/eeml2019_pictures/ema.jpg","width":1394,"height":930},{"src":"/galleries/eeml2019_pictures/florin.jpg","width":1152,"height":2048},{"src":"/galleries/eeml2019_pictures/florin_brad.jpg","width":928,"height":1392},{"src":"/galleries/eeml2019_pictures/full_house.jpg","width":1392,"height":928},{"src":"/galleries/eeml2019_pictures/group.jpg","width":1939,"height":1293},{"src":"/galleries/eeml2019_pictures/volunteers.jpg","width":1392,"height":928},{"src":"/galleries/eeml2019_pictures/z_ema_poster.png","width":1449,"height":2048},{"src":"/galleries/eeml2019_pictures/z_florin_poster.png","width":1698,"height":2400},{"src":"/galleries/eeml2019_pictures/z_iulia_andrei_poster.png","width":1772,"height":2496}],"eeml2019_posters":[{"src":"/galleries/eeml2019_posters/z_ema_poster.png","width":1449,"height":2048},{"src":"/galleries/eeml2019_posters/z_florin_poster.png","width":1698,"height":2400},{"src":"/galleries/eeml2019_posters/z_iulia_andrei_poster.png","width":1772,"height":2496}],"homomorphic2020":[{"src":"/galleries/homomorphic2020/alice.png","width":1000,"height":339},{"src":"/galleries/homomorphic2020/arithmetic_circuit.png","width":408,"height":382},{"src":"/galleries/homomorphic2020/dec_details.png","width":676,"height":312},{"src":"/galleries/homomorphic2020/enigma_dec.jpg","width":800,"height":1200},{"src":"/galleries/homomorphic2020/eval_mul.png","width":569,"height":460},{"src":"/galleries/homomorphic2020/eval_sum.png","width":567,"height":441},{"src":"/galleries/homomorphic2020/he_scheme5.png","width":1354,"height":390},{"src":"/galleries/homomorphic2020/noisy_cyphertext.png","width":658,"height":449}],"private_set2021":[{"src":"/galleries/private_set2021/monolith.jpg","width":800,"height":1200}],"rstg_pictures":[{"src":"/galleries/rstg_pictures/RSTG_model.png","width":2347,"height":1031},{"src":"/galleries/rstg_pictures/chart.svg","width":600,"height":371},{"src":"/galleries/rstg_pictures/digits.gif","width":692,"height":337},{"src":"/galleries/rstg_pictures/featured_graph_nets.jpg","width":1455,"height":1200},{"src":"/galleries/rstg_pictures/featured_graph_nets_bk.jpg","width":2784,"height":1856},{"src":"/galleries/rstg_pictures/interaction_videos.gif","width":1079,"height":258},{"src":"/galleries/rstg_pictures/rstg.gif","width":1353,"height":517},{"src":"/galleries/rstg_pictures/rstg_stages.gif","width":600,"height":565},{"src":"/galleries/rstg_pictures/smt-smt2.gif","width":725,"height":251}],"tmlss2018_pictures":[{"src":"/galleries/tmlss2018_pictures/dana.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/elena.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/florin.jpg","width":810,"height":1080},{"src":"/galleries/tmlss2018_pictures/iulia.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/lecture_hall.jpg","width":1920,"height":992},{"src":"/galleries/tmlss2018_pictures/salina.jpg","width":1920,"height":1280},{"src":"/galleries/tmlss2018_pictures/salina_1.jpg","width":1920,"height":1280},{"src":"/galleries/tmlss2018_pictures/stefan.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/stefan_1.jpg","width":1599,"height":899}],"tmlss2018_posters":[{"src":"/galleries/tmlss2018_posters/Bitdefender+NLP2SQL_1440.jpg","width":1440,"height":3558},{"src":"/galleries/tmlss2018_posters/ElenaBurceanu_Tracking_1440.jpg","width":1440,"height":2036},{"src":"/galleries/tmlss2018_posters/EmanuelaHaller_Segmentation_1440.jpg","width":1440,"height":2036},{"src":"/galleries/tmlss2018_posters/IuliaDuta_AndreiNicolicioiu_Video2NLP_1440.jpg","width":1440,"height":2036},{"src":"/galleries/tmlss2018_posters/StefanPostavaru_RMSProp_1440.jpg","width":1440,"height":2036}]}},"siteData":{"title":"Bitdefender Machine Learning & Crypto Research Unit","description":"Bitdefender Machine Learning & Crypto Research Unit goals are to further the fields of machine learning and criptography while engaging with the international research community and to develop the local AI&ML scene by supporting and participating in local conferences, lecture and research groups.","tagline":"Engaging with the broader Machine Learning Community.","tags":["machine-learning","research","bitdefender"]}};</script><script defer="" type="text/javascript" src="https://bit-ml.github.io/bootstrap.627376fc.js"></script><script defer="" type="text/javascript" src="https://bit-ml.github.io/templates/src/pages/Post.6f8f419e.js"></script><script defer="" type="text/javascript" src="https://bit-ml.github.io/main.6dead43a.js"></script></body></html>