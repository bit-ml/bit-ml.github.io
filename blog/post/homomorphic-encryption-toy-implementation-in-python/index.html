<!DOCTYPE html><html lang="en"><head><title data-react-helmet="true">Homomorphic Encryption: a Toy Implementation in Python | Bitdefender Research</title><meta data-react-helmet="true" name="description" content="Homomorphic Encryption: a Toy Implementation in PythonMotivation:We made this blog post as self-contained as possible, even though it wasinitially thought as a follow-up of this tutorial given byOpenMined.The starting point of our Python implementation is this githubgist,which follows the Homomorphic Encryption scheme from[FV12]. The motiva..."/><meta data-react-helmet="true" name="keywords" content="blog"/><meta data-react-helmet="true" property="og:title" content="Homomorphic Encryption: a Toy Implementation in Python | Bitdefender Research"/><meta data-react-helmet="true" property="og:description" content="Homomorphic Encryption: a Toy Implementation in PythonMotivation:We made this blog post as self-contained as possible, even though it wasinitially thought as a follow-up of this tutorial given byOpenMined.The starting point of our Python implementation is this githubgist,which follows the Homomorphic Encryption scheme from[FV12]. The motiva..."/><meta data-react-helmet="true" property="og:site_name" content="https://bit-ml.github.io"/><meta data-react-helmet="true" property="article:tag" content="blog"/><meta data-react-helmet="true" property="og:image" content="https://bit-ml.github.io/galleries/homomorphic2020/enigma_dec.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:site" content="@Bitdefender"/><meta data-react-helmet="true" name="twitter:title" content="Homomorphic Encryption: a Toy Implementation in Python | Bitdefender Research"/><meta data-react-helmet="true" name="twitter:description" content="Homomorphic Encryption: a Toy Implementation in PythonMotivation:We made this blog post as self-contained as possible, even though it wasinitially thought as a follow-up of this tutorial given byOpenMined.The starting point of our Python implementation is this githubgist,which follows the Homomorphic Encryption scheme from[FV12]. The motiva..."/><meta data-react-helmet="true" name="twitter:image" content="https://bit-ml.github.io/galleries/homomorphic2020/enigma_dec.jpg"/><meta data-react-helmet="true" itemProp="description" content="Homomorphic Encryption: a Toy Implementation in PythonMotivation:We made this blog post as self-contained as possible, even though it wasinitially thought as a follow-up of this tutorial given byOpenMined.The starting point of our Python implementation is this githubgist,which follows the Homomorphic Encryption scheme from[FV12]. The motiva..."/><meta data-react-helmet="true" itemProp="keywords" content="blog"/><meta data-react-helmet="true" itemProp="image" content="https://bit-ml.github.io/galleries/homomorphic2020/enigma_dec.jpg"/><link rel="preload" as="script" href="https://bit-ml.github.io/bootstrap.627376fc.js"/><link rel="preload" as="script" href="https://bit-ml.github.io/templates/src/pages/Post.6f8f419e.js"/><link rel="preload" as="script" href="https://bit-ml.github.io/main.6dead43a.js"/><link rel="preload" as="style" href="https://bit-ml.github.io/styles.c960d3bf.css"/><link rel="stylesheet" href="https://bit-ml.github.io/styles.c960d3bf.css"/><meta charSet="UTF-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="apple-touch-icon" href="icon.png"/><style data-styled-components="iHRNpA XnyzJ dsJdO hGTvzL kihGxn gDEKjd hnfUJl hWAXyU kuoEPx hKelgb gLoNrh bStMIm dYMJEb">
/* sc-component-id: sc-global-552716834 */
html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;-webkit-text-decoration:none;text-decoration:none;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} figure{margin:0;} img{border-style:none;max-width:100%;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} html{font-size:19px;box-sizing:border-box;} *,*::before,*::after{box-sizing:inherit;} body{font-family:"Roboto",Helvetica,Arial,sans-serif;line-height:1.78rem;padding:0;background:#FFF;} h1{display:block;margin:0.67em 0;} .math-display{overflow-x:auto;} @media (min-width:74.6875em){.math-display{overflow-x:initial;}} .remark-highlight{font-size:14px;} @media (min-width:74.6875em){.remark-highlight{font-size:16px;}} p.hint.tip,p.hint.error,p.hint.warn{-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;box-sizing:border-box;font-size:inherit;line-height:1.6rem;word-spacing:0.05rem;background-color:rgba(238,238,238,0.5);border-bottom-right-radius:2px;border-top-right-radius:2px;padding:8px 12px 8px 24px;margin-bottom:16px;position:relative;} p.hint.tip:before,p.hint.error:before,p.hint.warn:before{border-radius:100%;color:#fff;content:'!';font-size:14px;font-weight:700;left:-12px;line-height:20px;position:absolute;height:20px;width:20px;text-align:center;top:12px;} p.hint.tip{border-left:4px solid #27ab83;} p.hint.tip:before{display:none;} p.hint.warn{border-left:4px solid #f0b429;} p.hint.warn:before{background-color:#f0b429;} p.hint.error{border-left:4px solid #ef4e4e;} p.hint.error:before{background-color:#ef4e4e;content:'√ó';} .content table{border-collapse:collapse;border-spacing:0;empty-cells:show;border:1px solid #cbcbcb;font-size:12px;line-height:1.0rem;} @media (min-width:74.6875em){.content table{font-size:19px;line-height:1.78rem;}} .content caption{color:#000;font:italic 85%/1 arial,sans-serif;padding:1em 0;text-align:center;} .content td,.content th{border-left:1px solid #cbcbcb;border-width:0 0 0 1px;font-size:inherit;margin:0;overflow:visible;padding:0.5em 1em;} .content thead{background-color:#e0e0e0;color:#000;text-align:left;vertical-align:bottom;} .content td{background-color:#f2f2f2;} .content tr:nth-child(2n-1) td{background-color:transparent;} .content td{border-bottom:1px solid #cbcbcb;} .content tbody > tr:last-child > td{border-bottom-width:0;} .content td,.content th{border-width:0 0 1px 0;border-bottom:1px solid #cbcbcb;} .content tbody > tr:last-child > td{border-bottom-width:0;}
/* sc-component-id: Navigation__Nav-sc-qabwmo-0 */
.gDEKjd{width:100%;background:transparent;padding:0 1rem;font-family:"Roboto",Helvetica,Arial,sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;} .gDEKjd a{padding:0.5rem 0 0.25rem 0;font-style:normal;font-weight:500;line-height:23px;font-size:14px;text-align:right;text-transform:uppercase;color:#333;} .gDEKjd a:last-child{padding:0.5rem;padding-right:0;} @media (min-width:74.6875em){.gDEKjd{padding:0 5rem;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}.gDEKjd a{padding:0.5rem 1rem 0.25rem 1rem;}}
/* sc-component-id: Featured__StyledButtonBack-sc-xm4c49-5 */
.iHRNpA{position:absolute;top:50%;left:-5px;margin-left:10px;margin-top:-20px;width:40px;height:40px;padding:10px;background:none;border:none;outline:none;border-radius:40px;} @media (min-width:46.0625em){.iHRNpA{left:10px;width:70px;height:70px;padding:15px;}} @media (min-width:64.0625em){.iHRNpA{left:10px;width:70px;height:70px;padding:15px;}}
/* sc-component-id: Featured__StyledButtonNext-sc-xm4c49-6 */
.XnyzJ{position:absolute;top:50%;right:-5px;margin-right:10px;margin-top:-20px;width:40px;height:40px;padding:10px;background:none;border:none;outline:none;border-radius:40px;} @media (min-width:46.0625em){.XnyzJ{right:10px;width:70px;height:70px;padding:15px;}} @media (min-width:64.0625em){.XnyzJ{right:10px;width:70px;height:70px;padding:15px;}}
/* sc-component-id: Post__PageWithCoverImg-sc-oyq0rs-0 */
@media (min-width:74.6875em){.dsJdO{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}.dsJdO nav{padding:0;}} @media (min-width:46.0625em){.dsJdO{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}}
/* sc-component-id: Post-sc-oyq0rs-1 */
.kihGxn{margin:0 auto;padding:0 1rem;} @media (min-width:46.0625em){.kihGxn{max-width:62%;padding:0 2rem;}} @media (min-width:74.6875em){.kihGxn{max-width:62%;padding:0 5rem;}}
/* sc-component-id: Post__PostContent-sc-oyq0rs-2 */
.hnfUJl{margin:0 auto;max-width:720px;} .hnfUJl > h1{font-family:"Exo 2",sans-serif;font-size:2.074rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:2.074rem;} .hnfUJl > h1 > span{display:block;font-size:1.20rem;line-height:2.074rem;} @media (min-width:74.6875em){.hnfUJl > h1{font-size:2.488rem;line-height:3.57895rem;}.hnfUJl > h1 > span{font-size:1.44rem;}} .hnfUJl > h2{font-family:"Exo 2",sans-serif;font-size:1.728rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:2.074rem;} @media (min-width:74.6875em){.hnfUJl > h2{font-size:2.074rem;line-height:3.57895rem;}} .hnfUJl > h3{font-family:"Exo 2",sans-serif;font-size:1.44rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:1.78947rem;} @media (min-width:74.6875em){.hnfUJl > h3{font-size:1.728rem;}} .hnfUJl > h4{font-family:"Exo 2",sans-serif;font-size:1.20rem;font-weight:600;margin-top:1.78947rem;margin-bottom:1.78947rem;padding:0;line-height:1.78947rem;} @media (min-width:74.6875em){.hnfUJl > h4{font-size:1.44rem;}} .hnfUJl > h5{font-family:"Exo 2",sans-serif;font-size:1.20rem;font-weight:600;margin-top:1.78947rem;margin-bottom:0;padding:0;line-height:1.78947rem;} .hnfUJl p{font-family:"Roboto",Helvetica,Arial,sans-serif;font-size:1.00rem;font-weight:300;margin-top:0;margin-bottom:1.78947rem;padding:0;font-style:normal;-webkit-letter-spacing:0.03em;-moz-letter-spacing:0.03em;-ms-letter-spacing:0.03em;letter-spacing:0.03em;color:#333;} .hnfUJl p > strong{font-weight:500;} .hnfUJl >table{font-family:"Roboto",Helvetica,Arial,sans-serif;font-size:0.694rem;font-weight:300;margin-bottom:1.78947rem;} .hnfUJl >table > strong{font-weight:500;} @media (min-width:74.6875em){.hnfUJl div.wide-content+table{width:920px;margin-left:-100px;}} .hnfUJl a{-webkit-text-decoration:underline;text-decoration:underline;color:#333;} .hnfUJl a:hover{color:#e6212b;} .hnfUJl ul,.hnfUJl ol{margin-top:0;margin-bottom:1.78947rem;font-weight:300;line-height:1.78947rem;} .hnfUJl ul > li ul,.hnfUJl ol > li ul{margin-bottom:0;} .hnfUJl > img,.hnfUJl > p img{margin:0 auto;display:block;} .hnfUJl > blockquote{font-size:1.1rem;font-family:"Roboto",Helvetica,Arial,sans-serif;font-style:italic;font-weight:300;line-height:1.8rem;-webkit-letter-spacing:0.03em;-moz-letter-spacing:0.03em;-ms-letter-spacing:0.03em;letter-spacing:0.03em;text-align:right;margin-right:0;padding:24px;quotes:"\201E""\201C";} .hnfUJl > blockquote:before{display:inline-block;-webkit-transform:translate(-15px,-15px);-ms-transform:translate(-15px,-15px);transform:translate(-15px,-15px);content:open-quote;color:#edebeb;font-size:5rem;font-weight:400;} .hnfUJl > blockquote > footer{margin-top:10px;font-style:normal;font-weight:400;} .hnfUJl > details summary{cursor:pointer;}
/* sc-component-id: Post__PostHeader-sc-oyq0rs-5 */
.hWAXyU{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-family:"Roboto",Helvetica,Arial,sans-serif;font-style:normal;font-weight:400;line-height:1.8rem;-webkit-letter-spacing:0.03em;-moz-letter-spacing:0.03em;-ms-letter-spacing:0.03em;letter-spacing:0.03em;}
/* sc-component-id: Post__BackLink-sc-oyq0rs-6 */
.kuoEPx{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;color:#828282;} .kuoEPx:hover{color:#e6212b;}
/* sc-component-id: Post__Date-sc-oyq0rs-7 */
.hKelgb{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;font-size:1rem;text-align:right;color:#828282;}
/* sc-component-id: Post__PostFooter-sc-oyq0rs-8 */
.gLoNrh{display:inline-block;background:#edebeb;width:100%;}
/* sc-component-id: Post__PostFooterWraper-sc-oyq0rs-9 */
.bStMIm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:720px;padding:0 1rem;margin:0 auto;} .bStMIm > p{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;color:#828282;} @media (min-width:74.6875em){.bStMIm{padding-left:0 0 0 100px;}}
/* sc-component-id: Post__CoverImg-sc-oyq0rs-10 */
@media (min-width:46.0625em){.hGTvzL{background:#fff url(/galleries/homomorphic2020/enigma_dec.jpg) no-repeat bottom;background-size:cover;position:-webkit-sticky;position:sticky;top:0;left:0;height:100vh;width:38%;}} @media (min-width:74.6875em){.hGTvzL{background:#fff url(/galleries/homomorphic2020/enigma_dec.jpg) no-repeat bottom;background-size:cover;position:-webkit-sticky;position:sticky;top:0;left:0;height:100vh;width:38%;}}</style></head><body><div id="root"><div class="content" data-reactroot=""><div><div class="Post__PageWithCoverImg-sc-oyq0rs-0 dsJdO"><div class="Post__CoverImg-sc-oyq0rs-10 hGTvzL"></div><div class="Post-sc-oyq0rs-1 kihGxn"><header><nav class="Navigation__Nav-sc-qabwmo-0 gDEKjd"><a href="https://bit-ml.github.io/">Home</a><a href="https://bit-ml.github.io/#research">Research</a><a href="https://bit-ml.github.io/#teams">Team</a><a href="https://bit-ml.github.io/teaching/lectures-and-courses">Teaching</a></nav></header><section class="Post__PostContent-sc-oyq0rs-2 hnfUJl"><div class="Post__PostHeader-sc-oyq0rs-5 hWAXyU"><a class="Post__BackLink-sc-oyq0rs-6 kuoEPx active" aria-current="page" href="https://bit-ml.github.io/">&lt;<!-- --> Back Home</a><small class="Post__Date-sc-oyq0rs-7 hKelgb">published on <!-- -->November 16, 2020</small></div><h1>Homomorphic Encryption: a Toy Implementation in Python</h1>
<p><strong>Motivation:</strong>
We made this blog post as self-contained as possible, even though it was
initially thought as a follow-up of <a href="https://blog.openmined.org/build-an-homomorphic-encryption-scheme-from-scratch-with-python/#buildanhomomorphicencryptionscheme">this tutorial given by
OpenMined</a>.
The starting point of our Python implementation is <a href="https://gist.github.com/youben11/f00bc95c5dde5e11218f14f7110ad289">this github
gist</a>,
which follows the Homomorphic Encryption scheme from
<a href="https://eprint.iacr.org/2012/144.pdf">[FV12]</a>. The motivation behind <a href="https://github.com/bit-ml/he-scheme">our
implementation</a> was for us to understand
in detail the two techniques of
<a href="https://eprint.iacr.org/2012/144.pdf">[FV12]</a> used for ciphertext
multiplication, namely <em>relinearization</em> and <em>modulus-switching</em>. This
essential operation of ciphertext multiplication was missing in the previous
implementation. We thought we might share this understanding through a blog
post as well since it may be of interest to anyone using the [FV12] scheme in
<a href="https://github.com/OpenMined/TenSEAL">TenSeal</a> or
<a href="https://github.com/Microsoft/SEAL">Seal</a> libraries.</p>
<p><strong>Disclaimer:</strong> Our toy implementation is not meant to be secure or
optimized for efficiency. We did it to better understand the inner workings
of the [FV12] scheme, so you can use it as a learning tool. Our full
implementation can be found <a href="https://github.com/bit-ml/he-scheme">here</a>.</p>
<p><strong>Curious about how to work with data you can&#x27;t see?</strong> In the first part of
this blog post we are going to broadly explain what Homomorphic Encryption is
and some closely related concepts. In the second part we will follow an
example of such a scheme, namely the
<a href="https://eprint.iacr.org/2012/144.pdf">[FV12]</a> scheme, and discuss some of
the details of our implementation.</p>
<h2>1. What is Homomorphic Encryption?</h2>
<p>Homomorphic Encryption (HE) enables a user to perform meaningful computations
on sensitive data <strong>while ensuring the privacy of the data</strong>. This may sound
paradoxical to anyone who has ever worked with encrypted data before: if you
want to perform useful computations on the encrypted data (e.g. encrypted
under classical algorithms like AES), you need to decrypt it first. But once
decryption takes place, the privacy of the data is compromised. So how is it
possible for HE to overcome this seeming contradiction? üîÆ Well,
the solution is highly non-trivial, as it took the cryptographic community
more than 30 years to come up with a construction. The first
<a href="https://www.cs.cmu.edu/~odonnell/hits09/gentry-homomorphic-encryption.pdf">solution</a>
was proposed by Craig Gentry in 2009 and was of theoretical interest only.
Since then, a lot of research has been done (e.g.
<a href="https://eprint.iacr.org/2011/277">[BGV11]</a>,
<a href="https://eprint.iacr.org/2012/144">[FV12]</a>,
<a href="https://eprint.iacr.org/2016/421">[CKKS16]</a>,
<a href="https://github.com/lducas/FHEW">[FHEW]</a>,
<a href="https://tfhe.github.io/tfhe/">[TFHE]</a>,
<a href="https://eprint.iacr.org/2013/340">[GSW13]</a>) to make these ideas more
practical. By the end of this post you should have a basic understanding of
how such a construction may work.</p>
<p>Besides the traditional encryption (<span><span><span>Enc\mathsf{Enc}</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>n</span><span>c</span></span></span></span></span></span>), decryption
(<span><span><span>Dec\mathsf{Dec}</span><span aria-hidden="true"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span>) and key generation (<span><span><span>Keygen\mathsf{Keygen}</span><span aria-hidden="true"><span><span></span><span><span>K</span><span>e</span><span>y</span><span>g</span><span>e</span><span>n</span></span></span></span></span></span>) algorithms, an HE
scheme also uses <em>an evaluation algorithm</em> (<span><span><span>Eval\mathsf{Eval}</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span>). <strong>This is the
distinguishing feature that makes computations on encrypted data possible.</strong>
üí• Let&#x27;s consider the following example: Alice holds some personal
information <span><span><span>xx</span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span></span> (e.g. her medical records and her family&#x27;s medical history).
There is also a company that makes very good predictions based on this kind
of information, using a refined model, expressed as the functionality <span><span><span>FF</span><span aria-hidden="true"><span><span></span><span>F</span></span></span></span></span>
(e.g. a well chosen machine learning model). On one hand, Alice is very interested in these
predictions but is also reluctant to trust the company with her sensitive
information. On the other hand, the company can&#x27;t just give their model to
Alice to make the predictions herself. A solution using Homomorphic
Encryption is given in the picture below. Some important things to notice are:</p>
<ul>
<li>Alice sends her data <strong>encrypted</strong>, so the company never learns anything about <span><span><span>xx</span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span></span>.</li>
<li>Computing on the encrypted data <span><span><span>CC</span><span aria-hidden="true"><span><span></span><span>C</span></span></span></span></span> does <strong>not involve</strong> Alice&#x27;s secret key <span><span><span>sksk</span><span aria-hidden="true"><span><span></span><span>s</span><span>k</span></span></span></span></span>. Only her public key <span><span><span>pkpk</span><span aria-hidden="true"><span><span></span><span>p</span><span>k</span></span></span></span></span> is used.</li>
<li>To obtain <span><span><span>C‚Ä≤C&#x27;</span><span aria-hidden="true"><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> as the encryption of <span><span><span>F(x)F(x)</span><span aria-hidden="true"><span><span></span><span>F</span><span>(</span><span>x</span><span>)</span></span></span></span></span>, the evaluation algorithm uses the description of <span><span><span>FF</span><span aria-hidden="true"><span><span></span><span>F</span></span></span></span></span> to do computations on <span><span><span>CC</span><span aria-hidden="true"><span><span></span><span>C</span></span></span></span></span> (which encrypts <span><span><span>xx</span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span></span>).</li>
<li>By using her secret key, <span><span><span>sksk</span><span aria-hidden="true"><span><span></span><span>s</span><span>k</span></span></span></span></span>, Alice manages to recover the information that interests her, namely <span><span><span>F(x)F(x)</span><span aria-hidden="true"><span><span></span><span>F</span><span>(</span><span>x</span><span>)</span></span></span></span></span>.</li>
</ul>
<p><img src="https://bit-ml.github.io/galleries/homomorphic2020/alice.png" alt="alice_overview"/></p>
<h3>A closer look at the Eval algorithm üîé</h3>
<p>All the existing HE constructions are <em>homomorphic</em> with respect to two basic
operations: some kind of <em>addition</em> and some kind of <em>multiplication</em> (e.g.
<span><span><span>++</span><span aria-hidden="true"><span><span></span><span>+</span></span></span></span></span> and <span><span><span>√ó\times</span><span aria-hidden="true"><span><span></span><span>√ó</span></span></span></span></span> over the integers or the binary operations <span><span><span>XOR\mathsf{XOR}</span><span aria-hidden="true"><span><span></span><span><span>X</span><span>O</span><span>R</span></span></span></span></span></span>
and <span><span><span>AND\mathsf{AND}</span><span aria-hidden="true"><span><span></span><span><span>A</span><span>N</span><span>D</span></span></span></span></span></span>, etc.). What we mean is that the scheme allows the
efficient computation of <span><span><span>caddc_{add}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> from the individual ciphertexts
<span><span><span>c1=Enc(pk,m1)c_1=\mathsf{Enc}(pk,m_1)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>c2=Enc(pk,m2)c_2=\mathsf{Enc}(pk,m_2)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> such that the
decryption of <span><span><span>caddc_{add}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> yields <span><span><span>m1+m2m_1+m_2</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p><img src="https://bit-ml.github.io/galleries/homomorphic2020/eval_sum.png" alt="summation"/></p>
<p>Analogously, the ciphertext <span><span><span>cmulc_{mul}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> corresponding to multiplication, that
decrypts to <span><span><span>m1√óm2m_1\times m_2</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, is efficiently computable from the individual
ciphertexts <span><span><span>c1=Enc(pk,m1)c_1=\mathsf{Enc}(pk,m_1)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>c2=Enc(pk,m2)c_2=\mathsf{Enc}(pk,m_2)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>,
respectively.</p>
<p><img src="https://bit-ml.github.io/galleries/homomorphic2020/eval_mul.png" alt="multiplication"/></p>
<p>For instance:</p>
<ul>
<li>the <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)"><strong>RSA</strong></a> encryption: <span><span><span>Ence,NRSA(m):=me‚Äämod‚ÄäN\mathsf{Enc}^{\mathsf{RSA}}_{e,N}(m):=m^e \bmod N</span><span aria-hidden="true"><span><span></span><span><span><span>E</span><span>n</span><span>c</span></span><span><span><span><span><span><span></span><span><span><span>e</span><span>,</span><span>N</span></span></span></span><span><span></span><span><span><span><span>R</span><span>S</span><span>A</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>m</span><span>)</span><span></span><span>:</span></span><span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>e</span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>N</span></span></span></span></span>  is multiplicatively homomorphic as <span><span><span>m1e‚ãÖm2e‚Äämod‚ÄäN=(m1‚ãÖm2)e‚Äämod‚ÄäNm_1^e \cdot m_2^e \bmod N = (m_1 \cdot m_2)^{e} \bmod N</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>e</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>e</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>N</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>N</span></span></span></span></span></li>
<li>the <a href="https://en.wikipedia.org/wiki/ElGamal_encryption"><strong>El-Gamal</strong></a> encryption: <span><span><span>Encg,hEG(m)=(gr,hr‚ãÖm)\mathsf{Enc}^{\mathsf{EG}}_{g,h}(m)=(g^r,h^r\cdot m)</span><span aria-hidden="true"><span><span></span><span><span><span>E</span><span>n</span><span>c</span></span><span><span><span><span><span><span></span><span><span><span>g</span><span>,</span><span>h</span></span></span></span><span><span></span><span><span><span><span>E</span><span>G</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>m</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span>r</span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>r</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span>)</span></span></span></span></span>. It is easy to verify that the multiplicative property holds:</li>
</ul>
<p><span><span><span>(gr1,hr1‚ãÖm1)‚ãÖ(gr2,hr2‚ãÖm2)=(gr1+r2,hr1+r2‚ãÖ(m1‚ãÖm2)). (g^{r_1},h^{r_1}\cdot m_1)\cdot (g^{r_2},h^{r_2}\cdot m_2) =(g^{r_1+r_2},h^{r_1+r_2}\cdot (m_1\cdot m_2)).</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span><span>.</span></span></span></span></span></p>
<p>All the existing HE schemes support only two types of computations on the encrypted data: some forms of addition and multiplication. This means that the <span><span><span>Eval\mathsf{Eval}</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span> algorithm works only for functionalities <span><span><span>FF</span><span aria-hidden="true"><span><span></span><span>F</span></span></span></span></span> that can be expressed using additions (<span><span><span>++</span><span aria-hidden="true"><span><span></span><span>+</span></span></span></span></span>) and multiplications (<span><span><span>√ó\times</span><span aria-hidden="true"><span><span></span><span>√ó</span></span></span></span></span>). Another way of saying this is that HE schemes support only arithmetic circuits with addition/multiplication gates. Below we can view as an arithmetic circuit the functionality <span><span><span>F(m1,m2,m3,m4)=m1√óm2√óm4+m3√óm4F(m_1,m_2,m_3,m_4)= m_1\times m_2\times m_4 + m_3\times m_4</span><span aria-hidden="true"><span><span></span><span>F</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p><img src="https://bit-ml.github.io/galleries/homomorphic2020/arithmetic_circuit.png" alt="arithmetic_circuit"/></p>
<h3>Why focus on homomorphisms with respect to <em>two</em> operations?</h3>
<p>In principle, any functionality can be expressed using only two basic operations. For example, any binary circuit can be obtained using <a href="https://en.wikipedia.org/wiki/NAND_gate">NAND</a> gates exclusively. In turn, a NAND operation consists of one addition and one multiplication: <span><span><span>NAND(a,b)=a√ób+1‚Äämod‚Ää2\mathsf{NAND}(a,b)=a\times b + 1\bmod 2</span><span aria-hidden="true"><span><span></span><span><span>N</span><span>A</span><span>N</span><span>D</span></span><span>(</span><span>a</span><span>,</span><span></span><span>b</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>a</span><span></span><span>√ó</span><span></span></span><span><span></span><span>b</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span></span></span></span>, for any bits <span><span><span>a,b‚àà{0,1}a,b \in \{0,1\}</span><span aria-hidden="true"><span><span></span><span>a</span><span>,</span><span></span><span>b</span><span></span><span>‚àà</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>}</span></span></span></span></span>.</p>
<p>üí° Therefore it is enough to have an HE scheme that supports an
unlimited number of additions and multiplications to be able to make any
efficient computation we can think of on encrypted data.</p>
<h3>Homomorphic Encryption and &quot;noisy&quot; ciphertexts</h3>
<p>The most practical HE constructions rely on the hardness of the <a href="https://en.wikipedia.org/wiki/Ring_learning_with_errors">Ring
Learning With Errors
(RLWE)</a> problem for
their security, as is the case with many <a href="https://en.wikipedia.org/wiki/Lattice-based_cryptography">lattice-based
cryptographic</a>
constructions. The inherent <strong>&quot;noise&quot;</strong> of the RLWE problem is inherited by
all the schemes that are based on it. In particular, this &quot;noise&quot; element is
present in every HE ciphertext and has a great impact on the parameters of
the scheme.</p>
<p><img src="https://bit-ml.github.io/galleries/homomorphic2020/noisy_cyphertext.png" alt="noisy_cyphertext"/></p>
<p>The noise grows with every addition or multiplication we do on the
ciphertexts. This is very relevant as decryption stops working correctly once
the noise exceeds a certain threshold.</p>
<p>Because of this phenomenon, the number of multiplications and additions that
can be carried out correctly on the ciphertext is limited. üí• The
parameters of such a scheme can be generated such that it can handle a
minimum number of operations. But this minimum number must be decided in
advance to set the parameters accordingly. We usually call such a scheme
<em>Somewhat Homomorphic Encryption</em> (SHE) scheme. When the construction allows
an unbounded number of operations, we call such a scheme <em>Fully Homomorphic
Encryption</em> (FHE). Even though we are not going to discuss it any further, we
have to mention that it&#x27;s possible to obtain FHE from SHE. In fact, Gentry
<a href="https://www.cs.cmu.edu/~odonnell/hits09/gentry-homomorphic-encryption.pdf">showed</a>
how to transform any SHE (that can homomorphically evaluate its own
decryption circuit) to FHE, through a computationally expensive process
called <em>bootstrapping</em>. For applications that don&#x27;t require many homomorphic
evaluations SHE is preferred, as we want to avoid the computational overhead
of the boostrapping.</p>
<h2>2. A SHE scheme example</h2>
<p>For the remaining of this blog post we will try to make the concepts that we
have already presented more concrete, by discussing a <em>toy implementation</em> of
the SHE scheme construction of <a href="https://eprint.iacr.org/2012/144">[FV12]</a>.
Our main goal is to understand how <em>relinearization</em> and <em>modulus-switching</em>
are used to obtain ciphertext multiplication.</p>
<p><strong>Notations:</strong> For an integer <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>, by <span><span><span>Zq\mathbb{Z}_q</span><span aria-hidden="true"><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> we mean the set
<span><span><span>{0,1,‚Ä¶,q‚àí1}\{0,1,\ldots,q-1\}</span><span aria-hidden="true"><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>,</span><span></span><span>‚Ä¶</span><span></span><span>,</span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>. We denote by <span><span><span>[a]q[a]_q</span><span aria-hidden="true"><span><span></span><span>[</span><span>a</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> the remainder of <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> <em>modulo</em> <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>.
For example <span><span><span>[18]7=4[18]_7 = 4</span><span aria-hidden="true"><span><span></span><span>[</span><span>1</span><span>8</span><span><span>]</span><span><span><span><span><span><span></span><span><span>7</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>4</span></span></span></span></span>. When rounding to the nearest integer, we use
<span><span><span>‚åä‚ãÖ‚åâ\lfloor \cdot \rceil</span><span aria-hidden="true"><span><span></span><span>‚åä</span><span>‚ãÖ</span><span>‚åâ</span></span></span></span></span>. The basic elements we work with will not be integers,
but merely <em>polynomials with integer coefficients</em>. We also work with <em>noisy
polynomials</em>, whose coefficients are sampled according to some error
distribution <span><span><span>œá\chi</span><span aria-hidden="true"><span><span></span><span>œá</span></span></span></span></span>. We bound such errors by their largest absolute value of
their coefficients, denoted as <span><span><span>‚à•‚ãÖ‚à•\|\cdot\|</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>‚à•</span></span></span></span></span>.</p>
<h3>Quick recap on working with polynomials</h3>
<p>The HE scheme we are going to describe deals with <em>adding and multiplying
polynomials</em>. Here we present a quick example of how to work with
polynomials, so that we all have the same starting point. If you already know
how to do this, you can skip it.</p>
<p>First thing, let&#x27;s add and multiply polynomials <em>modulo some polynomial <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span></em>.
This &quot;modulo <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span>&quot; thing simply means that we add and multiply the polynomials
in the usual way, but we take the remainders of the results when divided by
<span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span>. When we do these additions and multiplications <span><span><span>‚Äämod‚Ääf\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, we sometimes
say in a fancy way that we are working in the <em>ring</em> <span><span><span>Z[x]/(f)\mathbb{Z}[x]/(f)</span><span aria-hidden="true"><span><span></span><span><span>Z</span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span> of
reduced polynomials.üíç</p>
<p>Let&#x27;s take <span><span><span>f=x4+1f = x^4 +1</span><span aria-hidden="true"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. If we look at <span><span><span>p(x)=x5p(x) =x^5</span><span aria-hidden="true"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span>,
then <span><span><span>p(x)=x‚ãÖ(x4+1)‚àíxp(x) = x \cdot (x^4 + 1) - x</span><span aria-hidden="true"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>x</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Therefore, when taking the reminder we get
<span><span><span>p(x)=‚àíx‚Äämod‚Ääfp(x) = -x \bmod f</span><span aria-hidden="true"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>‚àí</span><span>x</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span></span></span></span></span>. For faster computations <span><span><span>‚Äämod‚Ääf\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span> you can use this trick:
when making <span><span><span>‚Äämod‚Ääf\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, simply replace <span><span><span>x4x^4</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>‚àí1-1</span><span aria-hidden="true"><span><span></span><span>‚àí</span><span>1</span></span></span></span></span>, <span><span><span>x5x^5</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>‚àíx-x</span><span aria-hidden="true"><span><span></span><span>‚àí</span><span>x</span></span></span></span></span> and so on.</p>
<p>Let&#x27;s consider two polynomials <span><span><span>a(x)=x3+x2+7a(x) = x^3 + x^2 + 7</span><span aria-hidden="true"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span> and <span><span><span>b(x)=x2+11xb(x) = x^2 + 11x</span><span aria-hidden="true"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span>.
Then:</p>
<div><span><span><span>a(x)+b(x)‚Äämod‚Ääf=x3+2x2+11x+7¬†mod¬†f.a(x)+b(x) \bmod f = x^3 + 2x^2 + 11x + 7 \text { mod }f.</span><span aria-hidden="true"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>7</span><span><span>¬†mod¬†</span></span><span>f</span><span>.</span></span></span></span></span></div>
<p>Here nothing special happened. Let&#x27;s multiply them:</p>
<div><span><span><span>a(x)‚ãÖb(x)‚Äämod‚Ääf=(x3+x2+7)‚ãÖ(x2+11x)¬†mod¬†f=x5+11x4+x4+11x3+7x2+77x¬†mod¬†f=‚àíx‚àí11‚àí1+11x3+7x2+77x¬†mod¬†f=11x3+7x2+76x‚àí12¬†mod¬†f.\begin{aligned}
a(x) \cdot b(x) \bmod f
    &amp;= (x^3 + x^2 + 7)\cdot (x^2 +11x) \text { mod }f \\
    &amp;= x^5 + 11x^4 + x^4 + 11x^3 + 7x^2 + 77x \text { mod }f\\
    &amp;= -x - 11 - 1 + 11x^3 + 7x^2 + 77x \text { mod }f \\
    &amp;= 11x^3 + 7x^2 + 76x - 12 \text { mod }f.
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>f</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span>x</span><span>)</span><span><span>¬†mod¬†</span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span>¬†mod¬†</span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>‚àí</span><span>x</span><span></span><span>‚àí</span><span></span><span>1</span><span>1</span><span></span><span>‚àí</span><span></span><span>1</span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span>¬†mod¬†</span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>6</span><span>x</span><span></span><span>‚àí</span><span></span><span>1</span><span>2</span><span><span>¬†mod¬†</span></span><span>f</span><span>.</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>These operations are implemented
<a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L7">here</a>
and make use of the cool
<a href="https://numpy.org/doc/stable/reference/routines.polynomials.html">Numpy</a>
library:</p>
<div><pre><code><span>import</span><span> </span>numpy<span> </span><span>as</span><span> </span>np<span></span>
<span></span><span>from</span><span> </span>numpy<span>.</span>polynomial<span> </span><span>import</span><span> </span>polynomial<span> </span><span>as</span><span> </span>poly<span></span>
<span></span><span></span>
<span></span><span>#------Functions<span> </span>for<span> </span>polynomial<span> </span>evaluations<span> </span>mod<span> </span>poly_mod<span> </span>only------</span><span></span>
<span></span><span>def</span><span> </span><span>polymul_wm</span><span>(</span>x<span>,</span><span> </span>y<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Multiply<span> </span>two<span> </span>polynomials<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>x,<span> </span>y:<span> </span>two<span> </span>polynomials<span> </span>to<span> </span>be<span> </span>multiplied.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>A<span> </span>polynomial<span> </span>in<span> </span>Z[X]/(poly_mod).<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>poly<span>.</span>polydiv<span>(</span>poly<span>.</span>polymul<span>(</span>x<span>,</span><span> </span>y<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span>[</span><span>1</span><span>]</span><span> </span><span></span>
<span></span><span>def</span><span> </span><span>polyadd_wm</span><span>(</span>x<span>,</span><span> </span>y<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Add<span> </span>two<span> </span>polynomials<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>x,<span> </span>y:<span> </span>two<span> </span>polynomials<span> </span>to<span> </span>be<span> </span>added.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>A<span> </span>polynomial<span> </span>in<span> </span>Z[X]/(poly_mod).<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>poly<span>.</span>polydiv<span>(</span>poly<span>.</span>polyadd<span>(</span>x<span>,</span><span> </span>y<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span>[</span><span>1</span><span>]</span><span> </span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>Now let&#x27;s go one step further and see how we perform these operations of
polynomials not just modulo <span><span><span>ff</span><span aria-hidden="true"><span><span></span><span>f</span></span></span></span></span>, <em>but also modulo some integer <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span></em>. As you
might expect, the coefficients of these polynomials are also reduced modulo
<span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>, so they always take integer values from <span><span><span>00</span><span aria-hidden="true"><span><span></span><span>0</span></span></span></span></span> to <span><span><span>q‚àí1.q-1.</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>.</span></span></span></span></span> This time, we say
that we are working the ring of reduced polynomials <span><span><span>Zq[x]/(f)\mathbb{Z}_q[x]/(f)</span><span aria-hidden="true"><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span>.
üíç</p>
<p>Let&#x27;s take the previous example, <span><span><span>f=x4+1f = x^4+1</span><span aria-hidden="true"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, <span><span><span>a(x)=x3+x2+7a(x)=x^3+x^2+7</span><span aria-hidden="true"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span>,
<span><span><span>b(x)=x2+11xb(x)=x^2+11x</span><span aria-hidden="true"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span> and consider <span><span><span>q=5q =5</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>5</span></span></span></span></span>. We can think of <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> and <span><span><span>bb</span><span aria-hidden="true"><span><span></span><span>b</span></span></span></span></span> as already
taken <span><span><span>‚Äämod‚Ääf\bmod f</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>. If we take them further modulo <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>, then <span><span><span>[a(x)]q=x3+x2+2[a(x)]_q = x^3 +
x^2 +2</span><span aria-hidden="true"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span> and <span><span><span>[b(x)]q=x2+x[b(x)]_q = x^2+x</span><span aria-hidden="true"><span><span></span><span>[</span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Moreover,</p>
<div><span><span><span>[a(x)+b(x)]q=x3+x2+2+x2+x=x3+2x2+x+2[a(x) + b(x)]_q = x^3 + x^2 +2+ x^2 + x = x^3 + 2x^2 + x+2</span><span aria-hidden="true"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span></div>
<p>and</p>
<div><span><span><span>[a(x)‚ãÖb(x)]q=(x3+x2+2)‚ãÖ(x2+x)=x5+x4+x4+x3+2x2+2x=‚àíx‚àí1‚àí1+x3+2x2+2x=x3+2x2+x+3\begin{aligned}
[a(x) \cdot b(x)]_q
    &amp;= (x^3 + x^2+2) \cdot (x^2 + x)\\
    &amp;= x^5 + x^4 + x^4 +x^3+2x^2 + 2x\\
    &amp;= -x -1 -1 + x^3 +2x^2+2x\\
    &amp;= x^3+2x^2+x+3
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>‚àí</span><span>x</span><span></span><span>‚àí</span><span></span><span>1</span><span></span><span>‚àí</span><span></span><span>1</span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span></span><span>+</span><span></span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>where at the last but one equality we performed modulo <span><span><span>f=x4+1f = x^4+1</span><span aria-hidden="true"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> and at the last one, modulo <span><span><span>q=5q=5</span><span aria-hidden="true"><span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>5</span></span></span></span></span>.</p>
<p>These operations already mentioned are <span><span><span>polyadd\texttt{polyadd}</span><span aria-hidden="true"><span><span></span><span><span>polyadd</span></span></span></span></span></span> and
<span><span><span>polymul\texttt{polymul}</span><span aria-hidden="true"><span><span></span><span><span>polymul</span></span></span></span></span></span> implemented
<a href="https://github.com/Bitdefender-Crypto-Team/he-scheme/blob/main/rlwe_he_scheme_updated.py">here</a>.</p>
<h3>The Fan-Vercauteren ([FV12]) scheme</h3>
<p>Next, we recall the basic (<span><span><span>Keygen\mathsf{Keygen}</span><span aria-hidden="true"><span><span></span><span><span>K</span><span>e</span><span>y</span><span>g</span><span>e</span><span>n</span></span></span></span></span></span>, <span><span><span>Enc\mathsf{Enc}</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>n</span><span>c</span></span></span></span></span></span>, <span><span><span>Dec\mathsf{Dec}</span><span aria-hidden="true"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span>)
algorithms of <a href="https://eprint.iacr.org/2012/144.pdf"><strong>the [FV12] scheme</strong></a>.
These (almost identical) algorithms have already been described
<a href="https://blog.openmined.org/build-an-homomorphic-encryption-scheme-from-scratch-with-python/#buildanhomomorphicencryptionscheme">here</a>,
but for the sake of completeness, we present them as well. Then we will
explain in detail the core of the <span><span><span>Eval\mathsf{Eval}</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span> algorithm: the addition and
multiplication of the ciphertexts. <em>Spoiler alert</em>: We will primarily focus
on the two <em>Relinearization</em> techniques that enable ciphertext
multiplication.</p>
<p>Let <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> be power of 2. We call a positive integer <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> the <em>plaintext
modulus</em> and a positive integer <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span> as the <em>ciphertext modulus</em>. We set
<span><span><span>Œî=‚åäq/t‚åã\Delta = \lfloor q/t \rfloor</span><span aria-hidden="true"><span><span></span><span>Œî</span><span></span><span>=</span><span></span></span><span><span></span><span>‚åä</span><span>q</span><span>/</span><span>t</span><span>‚åã</span></span></span></span></span>. The scheme involves adding and multiplying
polynomials in <span><span><span>Rt=Zt[x]/(xn+1)R_t = \mathbb{Z}_t[x]/(x^n+1)</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>, on the plaintext side, and
adding and multiplying polynomials in <span><span><span>Rq=Zq[x]/(xn+1)R_q = \mathbb{Z}_q[x]/(x^n+1)</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>, on the
ciphertext side. We also denote by <span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span> the ring <span><span><span>Z[x]/(xn+1).\mathbb{Z}[x]/(x^n+1).</span><span aria-hidden="true"><span><span></span><span><span>Z</span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span>.</span></span></span></span></span></p>
<p><strong>Disclaimer</strong>: From now on all polynomial operations are
assumed to be mod <span><span><span>xn+1x^n+1</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, even if we don&#x27;t mention it every time.</p>
<p>Here is the <strong>high level of the scheme</strong>:</p>
<p><img src="https://bit-ml.github.io/galleries/homomorphic2020/he_scheme5.png" alt="he_scheme5"/></p>
<p>‚û°Ô∏è <span><span><span>Keygen\mathsf{Keygen}</span><span aria-hidden="true"><span><span></span><span><span>K</span><span>e</span><span>y</span><span>g</span><span>e</span><span>n</span></span></span></span></span></span>: The <em>secret key</em> <span><span><span>sksk</span><span aria-hidden="true"><span><span></span><span>s</span><span>k</span></span></span></span></span> is a secret binary polynomial <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> in <span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span>, i.e. its coefficients are either 0 or 1. The <em>public key</em> <span><span><span>pkpk</span><span aria-hidden="true"><span><span></span><span>p</span><span>k</span></span></span></span></span> is created as follows: we sample <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> uniformly over <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and an error <span><span><span>ee</span><span aria-hidden="true"><span><span></span><span>e</span></span></span></span></span> according to some error distribution <span><span><span>œá\chi</span><span aria-hidden="true"><span><span></span><span>œá</span></span></span></span></span> over <span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span> and output <span><span><span>pk=([‚àí(a‚ãÖs+e)]q,a)‚ààRq√óRqpk = ([-(a\cdot s+e)]_q,a) \in R_q \times R_q</span><span aria-hidden="true"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span>a</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>a</span><span>)</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Notice that hardness of the
<a href="https://en.wikipedia.org/wiki/Ring_learning_with_errors#The_RLWE_Problem">RLWE</a>
problem prevents the computation of the secret <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span> from the public key.</p>
<p>The way we generate the uniform polynomials and the binary polynomials is
implemented as <span><span><span>gen_uniform_poly\texttt{gen\_uniform\_poly}</span><span aria-hidden="true"><span><span></span><span><span>gen_uniform_poly</span></span></span></span></span></span> and as
<span><span><span>gen_binary_poly\texttt{gen\_binary\_poly}</span><span aria-hidden="true"><span><span></span><span><span>gen_binary_poly</span></span></span></span></span></span> respectively. The error distribution <span><span><span>œá\chi</span><span aria-hidden="true"><span><span></span><span>œá</span></span></span></span></span> is
usually taken as a discretized variant of the
<a href="https://en.wikipedia.org/wiki/Normal_distribution"><em>Normal distribution</em></a>, over
<span><span><span>Zn\mathbb{Z}^n</span><span aria-hidden="true"><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>, and is implemented as <span><span><span>gen_normal_poly\texttt{gen\_normal\_poly}</span><span aria-hidden="true"><span><span></span><span><span>gen_normal_poly</span></span></span></span></span></span>.
They can be found
<a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L118">here</a>.</p>
<div><pre><code><span>def</span><span> </span><span>keygen</span><span>(</span>size<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std1<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Generate<span> </span>a<span> </span>public<span> </span>and<span> </span>secret<span> </span>keys.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>the<span> </span>polynoms<span> </span>for<span> </span>the<span> </span>public<span> </span>and<span> </span>secret<span> </span>keys.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>modulus:<span> </span>coefficient<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>std1:<span> </span>standard<span> </span>deviation<span> </span>of<span> </span>the<span> </span>error.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Public<span> </span>and<span> </span>secret<span> </span>key.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>s<span> </span><span>=</span><span> </span>gen_binary_poly<span>(</span>size<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>gen_uniform_poly<span>(</span>size<span>,</span><span> </span>modulus<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>e<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std1<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>polyadd<span>(</span>polymul<span>(</span><span>-</span>a<span>,</span><span> </span>s<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span><span>-</span>e<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>b<span>,</span><span> </span>a<span>)</span><span>,</span><span> </span>s<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>‚û°Ô∏è <span><span><span>Enc\mathsf{Enc}</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>n</span><span>c</span></span></span></span></span></span>: To encrypt a <em>plaintext</em> <span><span><span>m‚ààRtm \in R_t</span><span aria-hidden="true"><span><span></span><span>m</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, we let <span><span><span>pk=(pk0,pk1)pk = (pk_0, pk_1)</span><span aria-hidden="true"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, sample <span><span><span>u,e1,e2u, e_1, e_2</span><span aria-hidden="true"><span><span></span><span>u</span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> according to <span><span><span>œá\chi</span><span aria-hidden="true"><span><span></span><span>œá</span></span></span></span></span> over <span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span> and output the <em>ciphertext</em></p>
<div><span><span><span>Enc(pk,m)=([pk0‚ãÖu+e1+Œî‚ãÖm]q,[pk1‚ãÖu+e2]q)‚ààRq√óRq\mathsf{Enc}(pk,m) = ([pk_0 \cdot u +e_1 + \Delta \cdot m]_q,[pk_1 \cdot u + e_2]_q) \in R_q \times R_q</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>m</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>[</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>
<p>Due to the <a href="https://en.wikipedia.org/wiki/Ring_learning_with_errors#The_RLWE_Problem">RLWE</a> assumption, the ciphertexts &quot;look&quot; uniformly random to a possible attacker, so they don&#x27;t reveal any information about the plaintext.</p>
<p>In the piece of <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L188">code</a> below, the message we want to encrypt, <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span>, is an integer vector of length at most <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span>, with entries in the set <span><span><span>{0,1,‚Ä¶,t‚àí1}\{0, 1,\ldots, t-1\}</span><span aria-hidden="true"><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>,</span><span></span><span>‚Ä¶</span><span></span><span>,</span><span></span><span>t</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>. Before we encode it as a polynomial in <span><span><span>m‚ààRtm \in R_t</span><span aria-hidden="true"><span><span></span><span>m</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, we pad it with enough zeros to make it a length <span><span><span>nn</span><span aria-hidden="true"><span><span></span><span>n</span></span></span></span></span> vector.</p>
<div><pre><code><span>def</span><span> </span><span>encrypt</span><span>(</span>pk<span>,</span><span> </span>size<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>m<span>,</span><span> </span>std1<span>)</span><span>:</span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Encrypt<span> </span>an<span> </span>integer<span> </span>vector<span> </span>pt.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>pk:<span> </span>public-key.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>polynomials.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>m:<span> </span>plaintext<span> </span>message,<span> </span>as<span> </span>an<span> </span>integer<span> </span>vector<span> </span>(of<span> </span>length<span> </span>&lt;=<span> </span>size)<span> </span>with<span> </span>entries<span> </span>mod<span> </span>t.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>m<span> </span><span>=</span><span> </span>np<span>.</span>array<span>(</span>m<span> </span><span>+</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>size<span> </span><span>-</span><span> </span><span>len</span><span>(</span>m<span>)</span><span>)</span><span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span> </span><span>%</span><span> </span>t<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>delta<span> </span><span>=</span><span> </span>q<span> </span><span>//</span><span> </span>t<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>scaled_m<span> </span><span>=</span><span> </span>delta<span> </span><span>*</span><span> </span>m<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>e1<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std1<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>e2<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std1<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>u<span> </span><span>=</span><span> </span>gen_binary_poly<span>(</span>size<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct0<span> </span><span>=</span><span> </span>polyadd<span>(</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polyadd<span>(</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul<span>(</span>pk<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>u<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>e1<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>scaled_m<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct1<span> </span><span>=</span><span> </span>polyadd<span>(</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul<span>(</span>pk<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>u<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>e2<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>ct0<span>,</span><span> </span>ct1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>‚û°Ô∏è <span><span><span>Dec\mathsf{Dec}</span><span aria-hidden="true"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span>: Given a ciphertext <span><span><span>ct=Enc(pk,m)=(ct0,ct1)ct = \mathsf{Enc}(pk,m)=(ct_0, ct_1)</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>m</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, we decrypt it using the secret key <span><span><span>sk=ssk=s</span><span aria-hidden="true"><span><span></span><span>s</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>s</span></span></span></span></span> as follows:</p>
<div><span><span><span>Dec(sk,ct)=[‚åät‚ãÖ[ct0+ct1‚ãÖs]qq‚åâ]t‚ààRt\mathsf{Dec}(sk,ct) = \Bigg[ \Bigg\lfloor \frac{t\cdot [ct_0+ct_1\cdot s]_q}{q} \Bigg\rceil \Bigg]_t \in R_t</span><span aria-hidden="true"><span><span></span><span><span>D</span><span>e</span><span>c</span></span><span>(</span><span>s</span><span>k</span><span>,</span><span></span><span>c</span><span>t</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>[</span></span><span><span>‚åä</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>t</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>‚åâ</span></span><span><span><span>]</span></span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>
<p>‚õî Let&#x27;s stop for a bit and check together how the <span><span><span>Dec\mathsf{Dec}</span><span aria-hidden="true"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span> algorithm works. The intuition behind it is that <span><span><span>pk0+pk1‚ãÖskpk_0 + pk_1\cdot sk</span><span aria-hidden="true"><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span>k</span></span></span></span></span> is &quot;small&quot;. This implies that <span><span><span>ct0+ct1‚ãÖskct_0 + ct_1\cdot sk</span><span aria-hidden="true"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span>k</span></span></span></span></span> is &quot;close&quot; to the scaled message <span><span><span>Œî‚ãÖm\Delta \cdot m</span><span aria-hidden="true"><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span></span></span></span></span>. To recover the message <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span>, we get rid of <span><span><span>Œî\Delta</span><span aria-hidden="true"><span><span></span><span>Œî</span></span></span></span></span> <span><span><span>(‚âàq/t)(\approx q/t)</span><span aria-hidden="true"><span><span></span><span>(</span><span>‚âà</span><span></span></span><span><span></span><span>q</span><span>/</span><span>t</span><span>)</span></span></span></span></span> and then apply rounding to shave off the &quot;small&quot; noise. Let&#x27;s check that this intuition actually works.</p>
<p>First, we set the notation <span><span><span>ct(s):=ct0+ct1‚ãÖsct(s) := ct_0 + ct_1 \cdot s</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>:</span></span><span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span></span></span></span></span>, which we&#x27;ll frequently use for the rest of the post. If we perform this computation, we will end up getting <em>a noisy scaled variant of the plaintext</em>, namely <span><span><span>Œî‚ãÖm+v\Delta \cdot m+v</span><span aria-hidden="true"><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span></span></span></span></span>!</p>
<p>If we go back to see how <span><span><span>ctct</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span></span></span></span></span> and <span><span><span>pkpk</span><span aria-hidden="true"><span><span></span><span>p</span><span>k</span></span></span></span></span> were defined, we get:</p>
<div><span><span><span>[ct(s)]q=[(pk0‚ãÖu+e1+Œî‚ãÖm)+(pk1‚ãÖu+e2)‚ãÖs]q=[‚àí(a‚ãÖs+e)‚ãÖu+e1+Œî‚ãÖm+a‚ãÖu‚ãÖs+e2‚ãÖs]q=Œî‚ãÖm‚àíe‚ãÖu+e1+e2‚ãÖs=Œî‚ãÖm+v,\begin{aligned}
[ct(s)]_q &amp;= [(pk_0 \cdot u + e_1 + \Delta \cdot m) + (pk_1 \cdot u + e_2) \cdot s]_q\\
    &amp;= [-(a\cdot s + e)\cdot u+e_1 + \Delta \cdot m + a \cdot u \cdot s + e_2 \cdot s]_q\\
    &amp;= \Delta \cdot m - e \cdot u + e_1 + e_2 \cdot s\\
    &amp;= \Delta \cdot m + v,
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>[</span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span>)</span><span></span><span>+</span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>[</span><span>‚àí</span><span>(</span><span>a</span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span>e</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span></span><span>+</span><span></span><span>a</span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span></span><span>‚àí</span><span></span><span>e</span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span></span><span>+</span><span></span><span>v</span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>which is nothing but the scaled plaintext <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span> with some <em>&quot;small&quot; noise</em> <span><span><span>vv</span><span aria-hidden="true"><span><span></span><span>v</span></span></span></span></span>.</p>
<p>Because we always have <span><span><span>‚à•Œî‚ãÖm+v‚à•&lt;q\|\Delta\cdot m + v\| &lt; q</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span>‚à•</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>q</span></span></span></span></span>, reducing it <span><span><span>‚Äämod‚Ääq\bmod q</span><span aria-hidden="true"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> has no effect (e.g. <span><span><span>[4]7=4[4]_{7} = 4</span><span aria-hidden="true"><span><span></span><span>[</span><span>4</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>7</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>4</span></span></span></span></span>). As long as the noise <span><span><span>‚à•v‚à•&lt;Œî/2\|v\|&lt;\Delta/2</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span>v</span><span>‚à•</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>, we can always recover the correct <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span>.</p>
<p><img src="https://bit-ml.github.io/galleries/homomorphic2020/dec_details.png" alt="decoder_details"/></p>
<p>For example, in the picture above, any green point will decrypt to <span><span><span>22</span><span aria-hidden="true"><span><span></span><span>2</span></span></span></span></span> when we scale it by <span><span><span>t/qt/q</span><span aria-hidden="true"><span><span></span><span>t</span><span>/</span><span>q</span></span></span></span></span> <span><span><span>(‚âà1/Œî)(\approx 1/\Delta)</span><span aria-hidden="true"><span><span></span><span>(</span><span>‚âà</span><span></span></span><span><span></span><span>1</span><span>/</span><span>Œî</span><span>)</span></span></span></span></span> and round it. Analogously, any dark-brown point will decrypt to <span><span><span>33</span><span aria-hidden="true"><span><span></span><span>3</span></span></span></span></span>.</p>
<p>We can implement this evaluation, as <span><span><span>scaled_pt\texttt{scaled\_pt}</span><span aria-hidden="true"><span><span></span><span><span>scaled_pt</span></span></span></span></span></span> below, by performing polynomial operations in <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. You will see that this equation,</p>
<div><span><span><span>[ct(s)]q=[ct0+ct1‚ãÖs]q=Œî‚ãÖm+v,[ct(s)]_q = [ct_0 + ct_1 \cdot s]_q = \Delta \cdot m + v,</span><span aria-hidden="true"><span><span></span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span>,</span></span></span></span></span></div>
<p>which we will call <em>the decryption equation</em>, becomes really useful in deriving ways of computing on ciphertexts. Here we provide the <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L219">code</a> for the <span><span><span>Dec\mathsf{Dec}</span><span aria-hidden="true"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span> algorithm:</p>
<div><pre><code><span>def</span><span> </span><span>decrypt</span><span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Decrypt<span> </span>a<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>sk:<span> </span>secret-key.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>polynomials.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct:<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Integer<span> </span>vector<span> </span>representing<span> </span>the<span> </span>plaintext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>scaled_pt<span> </span><span>=</span><span> </span>polyadd<span>(</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul<span>(</span>ct<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>sk<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_poly<span> </span><span>=</span><span> </span>np<span>.</span><span>round</span><span>(</span>t<span> </span><span>*</span><span> </span>scaled_pt<span> </span><span>/</span><span> </span>q<span>)</span><span> </span><span>%</span><span> </span>t<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>np<span>.</span>int64<span>(</span>decrypted_poly<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<h3>Homomorphic operations of [FV12]</h3>
<p>As explained in the first part, the <span><span><span>Eval\mathsf{Eval}</span><span aria-hidden="true"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span> algorithm works only for functionalities that can be expressed using addition <span><span><span>(+)(+)</span><span aria-hidden="true"><span><span></span><span>(</span><span>+</span><span>)</span></span></span></span></span> or multiplication <span><span><span>(√ó)(\times)</span><span aria-hidden="true"><span><span></span><span>(</span><span>√ó</span><span>)</span></span></span></span></span>.</p>
<p>Let&#x27;s take two ciphertexts <span><span><span>ct=Enc(pk,m)ct = \mathsf{Enc}(pk,m)</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>m</span><span>)</span></span></span></span></span> and <span><span><span>ct‚Ä≤=Enc(pk,m‚Ä≤)ct&#x27; = \mathsf{Enc}(pk,m&#x27;)</span><span aria-hidden="true"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span>. We want to see how to construct ciphertexts that decrypt both the addition, <span><span><span>m+m‚Ä≤m+m&#x27;</span><span aria-hidden="true"><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>, and the multiplication, <span><span><span>m‚ãÖm‚Ä≤m\cdot m&#x27;</span><span aria-hidden="true"><span><span></span><span>m</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>. Also, keep in mind that when performing operations on <span><span><span>mm</span><span aria-hidden="true"><span><span></span><span>m</span></span></span></span></span> and <span><span><span>m‚Ä≤m&#x27;</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>, we are actually doing them <em>modulo <span><span><span>xn+1x^n+1</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span></em> and <em>modulo <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span></em>, since these are the plaintext operations from <span><span><span>Rt=Zt[x]/(xn+1)R_t = \mathbb{Z}_t[x]/(x^n+1)</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>.</p>
<p>Let&#x27;s write the decryption equations of <span><span><span>ctct</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span></span></span></span></span> and <span><span><span>ct‚Ä≤ct&#x27;</span><span aria-hidden="true"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>:</p>
<div><span><span><span>[ct(s)]q=Œî‚ãÖm+v¬†and¬†[ct‚Ä≤(s)]q=Œî‚ãÖm‚Ä≤+v‚Ä≤.[ct(s)]_q = \Delta \cdot m + v \text{ and } [ct&#x27;(s)]_q = \Delta \cdot m&#x27; + v&#x27;.</span><span aria-hidden="true"><span><span></span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span><span>¬†and¬†</span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>
<p>‚û°Ô∏è <strong>Addition:</strong> If we simply add the decryption equations, we get</p>
<div><span><span><span>[ct(s)]q+[ct‚Ä≤(s)]q=Œî‚ãÖ(m+m‚Ä≤)+v+v‚Ä≤.[ct(s)]_q + [ct&#x27;(s)]_q = \Delta \cdot (m+m&#x27;) + v  + v&#x27;.</span><span aria-hidden="true"><span><span></span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>
<p>But wait a sec, we need to decrypt to <span><span><span>m1+m2m_1+m_2</span><span aria-hidden="true"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> modulo <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span>! Notice that <span><span><span>m+m‚Ä≤=t‚ãÖœµ+[m+m‚Ä≤]tm + m&#x27; = t \cdot \epsilon + [m+m&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>œµ</span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, for some binary polynomial <span><span><span>œµ\epsilon</span><span aria-hidden="true"><span><span></span><span>œµ</span></span></span></span></span>. Using the notation <span><span><span>rt(q):=q‚àíŒî‚ãÖtr_t(q):= q- \Delta \cdot t</span><span aria-hidden="true"><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span></span><span>:</span></span><span><span></span><span>=</span><span></span></span><span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>t</span></span></span></span></span> (this is just the remainder of <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span> divided by <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span>) we get:</p>
<div><span><span><span>[ct(s)+ct‚Ä≤(s)]q=Œî‚ãÖ[m+m‚Ä≤]t+vadd¬†mod¬†q,\begin{aligned}
[ct(s) + ct&#x27;(s)]_q = \Delta \cdot [m+m&#x27;]_t + v_{add} \text{ mod }q,
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>+</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>¬†mod¬†</span></span><span>q</span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>where <span><span><span>vadd=v+v‚Ä≤‚àírt(q)‚ãÖœµv_{add} = v+v&#x27;-r_t(q) \cdot \epsilon</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚àí</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>œµ</span></span></span></span></span>.Click here if you want to see why this follows.</p>
<div><span><span><span>[ct(s)+ct‚Ä≤(s)]q=Œî‚ãÖ[m+m‚Ä≤]t+Œî‚ãÖt‚ãÖœµ+v+v‚Ä≤=Œî‚ãÖ[m+m‚Ä≤]t+(q‚àírt(q))‚ãÖœµ+v+v‚Ä≤‚â°Œî‚ãÖ[m+m‚Ä≤]t+vadd¬†mod¬†q.\begin{aligned}
[ct(s) + ct&#x27;(s)]_q 
    =&amp; \Delta \cdot [m+m&#x27;]_t + \Delta \cdot t \cdot \epsilon + v  + v&#x27; \\
    =&amp; \Delta \cdot [m+m&#x27;]_t + (q-r_t(q)) \cdot \epsilon + v+v&#x27; \\
    \equiv&amp; \Delta \cdot [m+m&#x27;]_t + v_{add} \text{ mod }q.
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>+</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span></span></span><span><span></span><span><span>=</span></span></span><span><span></span><span><span>‚â°</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>t</span><span></span><span>‚ãÖ</span><span></span><span>œµ</span><span></span><span>+</span><span></span><span>v</span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>(</span><span>q</span><span></span><span>‚àí</span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>œµ</span><span></span><span>+</span><span></span><span>v</span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>¬†mod¬†</span></span><span>q</span><span>.</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>This suggests to set the new ciphertext as <span><span><span>cadd=(ct0+ct0‚Ä≤,¬†ct1+ct1‚Ä≤)c_{add}=(ct_0+ct&#x27;_0, \text{ }ct_1+ct&#x27;_1)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>¬†</span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, which can be computed without the knowledge of the secret key <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>. Therefore, <span><span><span>cadd=ct+ct‚Ä≤c_{add} = ct + ct&#x27;</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span>t</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> decrypts to the sum, <span><span><span>[m+m‚Ä≤]t[m+m&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, as long as the new &quot;noise&quot;, <span><span><span>vaddv_{add}</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, is smaller than <span><span><span>Œî/2\Delta/2</span><span aria-hidden="true"><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>.</p>
<p>üí° The <strong>noise growth</strong> for <strong>addition</strong> is quite slow as <span><span><span>‚à•vadd‚à•&lt;‚à•v‚à•+‚à•v‚Ä≤‚à•+t&lt;2B+t\|v_{add}\|&lt;\|v\|+\|v&#x27;\| + t &lt; 2B+t</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>‚à•</span><span>v</span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>‚à•</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>2</span><span>B</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span></span></span></span></span>, where <span><span><span>BB</span><span aria-hidden="true"><span><span></span><span>B</span></span></span></span></span> is an upper bound on the &quot;noise&quot; of the ciphertexts that were added. This means we can probably do many additions before decryption stops working.</p>
<p>To <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L261">add ciphertexts</a>, it seems like we only need to add polynomials in <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. So, ciphertext addition is a piece of cake üç∞.</p>
<div><pre><code><span>def</span><span> </span><span>add_cipher</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Add<span> </span>a<span> </span>ciphertext<span> </span>and<span> </span>a<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1,<span> </span>ct2:<span> </span>ciphertexts.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>new_ct0<span> </span><span>=</span><span> </span>polyadd<span>(</span>ct1<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>new_ct1<span> </span><span>=</span><span> </span>polyadd<span>(</span>ct1<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>new_ct0<span>,</span><span> </span>new_ct1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>‚û°Ô∏è <strong>Multiplication:</strong> Producing a new ciphertext that decrypts the product of the two messages is not that easy. But we should still try ü§û. The first idea that comes to mind is to simply multiply the decryption equations. It worked for addition, so maybe it works here as well.</p>
<div><span><span><span>ct(s)‚ãÖct‚Ä≤(s)=Œî2‚ãÖmm‚Ä≤+Œî‚ãÖ(mv‚Ä≤+m‚Ä≤v)+vv‚Ä≤.¬†¬†(1)ct(s) \cdot ct&#x27;(s) = \Delta^2 \cdot mm&#x27; + \Delta\cdot (mv&#x27;+m&#x27;v) + vv&#x27;. \text{ } \ (1)</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>Œî</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>m</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>v</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>.</span><span><span>¬†</span></span><span>¬†</span><span>(</span><span>1</span><span>)</span></span></span></span></span></div>
<p>If we scale by <span><span><span>t/qt/q</span><span aria-hidden="true"><span><span></span><span>t</span><span>/</span><span>q</span></span></span></span></span> to get rid of one <span><span><span>Œî\Delta</span><span aria-hidden="true"><span><span></span><span>Œî</span></span></span></span></span>, we get something that looks like what we want.</p>
<div><span><span><span>tq‚ãÖct(s)‚ãÖct‚Ä≤(s)‚âàŒî‚ãÖmm‚Ä≤+(mv‚Ä≤+m‚Ä≤v)\frac{t}{q}\cdot ct(s) \cdot ct&#x27;(s) \approx \Delta \cdot mm&#x27; + (mv&#x27;+m&#x27;v)</span><span aria-hidden="true"><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>‚âà</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span>m</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>v</span><span>)</span></span></span></span></span></div>
<p>It seems we are on the right track. Let&#x27;s examine these expressions further. Recall the notations <span><span><span>ct(s)=ct0+ct1‚ãÖsct(s) = ct_0 + ct_1\cdot s</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span></span></span></span></span> and  <span><span><span>ct‚Ä≤(s)=ct0‚Ä≤+ct1‚Ä≤‚ãÖs.ct&#x27;(s) = ct&#x27;_0 + ct&#x27;_1\cdot s.</span><span aria-hidden="true"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span>.</span></span></span></span></span> Both of them are <em>linear</em> in <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>, but their multiplication is <em>quadratic</em> in <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>:</p>
<div><span><span><span>ct‚ãÖct‚Ä≤(s)=ct0‚ãÖct0‚Ä≤+(ct0‚ãÖct1‚Ä≤+ct1‚ãÖct0‚Ä≤)s+ct1‚ãÖct1‚Ä≤s2,ct\cdot ct&#x27;(s) = ct_0\cdot ct&#x27;_0 + (ct_0\cdot ct&#x27;_1 + ct_1\cdot ct&#x27;_0)s +ct_1\cdot ct&#x27;_1s^2, </span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span></span></span></span></span></div>
<p>which we will write, in short, as <span><span><span>ct‚ãÖct‚Ä≤(s)=c0√ó+c1√ó‚ãÖs+c2√ó‚ãÖs2.ct \cdot ct&#x27; (s) = c_0^\times + c_1^{\times}\cdot s + c_2^{\times} \cdot s^2.</span><span aria-hidden="true"><span><span></span><span>c</span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>√ó</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></p>
<p>But what about the right hand side?  Keep in mind that we work with plaintexts <span><span><span>m,m‚Ä≤‚ààRtm, m&#x27; \in R_t</span><span aria-hidden="true"><span><span></span><span>m</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, so we should take <span><span><span>mm‚Ä≤mm&#x27;</span><span aria-hidden="true"><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> with <em>coefficients modulo <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span></em>. Therefore, we can apply the same trick as we did for addition: we divide by <span><span><span>tt</span><span aria-hidden="true"><span><span></span><span>t</span></span></span></span></span> and write <span><span><span>mm‚Ä≤=trm+[mm‚Ä≤]tmm&#x27; = tr_m + [mm&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span><span>r</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, where <span><span><span>rmr_m</span><span aria-hidden="true"><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is an integer polynomial. Skipping a lot of details, we end up with:</p>
<div><span><span><span>t/q‚ãÖct‚ãÖct‚Ä≤(s)=Œî‚ãÖ[mm‚Ä≤]t+u2t/q \cdot ct \cdot ct&#x27;(s) = \Delta \cdot [mm&#x27;]_t + u_2</span><span aria-hidden="true"><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>
<p>for <span><span><span>u2u_2</span><span aria-hidden="true"><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> a polynomial with <em>rational</em> coefficients. Looks like we&#x27;re getting closer to obtaining the decryption equation. We can now write the original expression <span><span><span>(1)(1)</span><span aria-hidden="true"><span><span></span><span>(</span><span>1</span><span>)</span></span></span></span></span> as:</p>
<div><span><span><span>t/q‚ãÖc0√ó+t/q‚ãÖc1√ó‚ãÖs+t/q‚ãÖc2√ó‚ãÖs2=Œî‚ãÖ[mm‚Ä≤]t+u2t/q \cdot c_0^\times + t/q \cdot c_1^{\times} \cdot s + t/q \cdot c_2^{\times} \cdot s^2 = \Delta \cdot [mm&#x27;]_t + u_2</span><span aria-hidden="true"><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>√ó</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>
<p>Hm.. these coefficients look like <em>rational polynomials</em>.  Recall that the ciphertext has <em>integer polynomials</em> as elements. So we round each coefficient appearing in the left hand side to their nearest integers and then reduce the whole equation modulo <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>:</p>
<div><span><span><span>[‚åät/q‚ãÖc0√ó‚åâ]q+[‚åät/q‚ãÖc1√ó‚åâ]q‚ãÖs+[‚åät/q‚ãÖc2√ó‚åâ]q‚ãÖs2=Œî‚ãÖ[mm‚Ä≤]t+u3¬†¬†(2)[\lfloor t/q \cdot c_0^{\times} \rceil]_q + [\lfloor t/q \cdot c_1^{\times}\rceil]_q \cdot s + [\lfloor t/q \cdot c_2^{\times}\rceil]_q \cdot s^2 = \Delta \cdot [mm&#x27;]_t + u_3 \text{ } \ (2)</span><span aria-hidden="true"><span><span></span><span>[</span><span>‚åä</span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚åâ</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>‚åä</span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚åâ</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>‚åä</span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚åâ</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>¬†</span></span><span>¬†</span><span>(</span><span>2</span><span>)</span></span></span></span></span></div>
<p>where <span><span><span>u3u_3</span><span aria-hidden="true"><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a &quot;small&quot; integer polynomial, that represents the &quot;noise&quot; after one multiplication.</p>
<p>üí° The <strong>noise growth</strong> for <strong>multiplication</strong> grows a lot faster:
<span><span><span>‚à•u3‚à•‚â§2‚ãÖn‚ãÖt‚ãÖB‚ãÖ(2n+1)‚ãÖ(n+1)+8t2‚ãÖn2,\|u_3\| \leq 2 \cdot n \cdot t \cdot B \cdot (2n+1)\cdot (n+1) + 8t^2 \cdot n^2,</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>2</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>B</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>2</span><span>n</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>n</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>8</span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>n</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span></span></span></span></span>
where <span><span><span>BB</span><span aria-hidden="true"><span><span></span><span>B</span></span></span></span></span> is an upper bound for the &quot;noise&quot; of the ciphertexts that were multiplied. We refer the enthusiastic reader for more details to <a href="https://eprint.iacr.org/2012/144.pdf">[[FV12] Lem. 2]</a>.</p>
<p>Phew, seems like we are done: we can consider as a ciphertext decrypting to <span><span><span>[mm‚Ä≤]t[mm&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> the tuple of scaled and rounded coefficients mod <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span> from left hand side of <span><span><span>(2)(2)</span><span aria-hidden="true"><span><span></span><span>(</span><span>2</span><span>)</span></span></span></span></span>, denoted by <span><span><span>(c0,c1,c2)(c_0, c_1, c_2)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>. Of course, for a correct decryption, <span><span><span>u3u_3</span><span aria-hidden="true"><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> should have small enough coefficients. You can see below how these coefficients are <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L293">computed</a> in Python:</p>
<div><pre><code><span>def</span><span> </span><span>multiplication_coeffs</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Multiply<span> </span>two<span> </span>ciphertexts.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1:<span> </span>first<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct2:<span> </span>second<span> </span>ciphertext<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Triplet<span> </span>(c0,c1,c2)<span> </span>encoding<span> </span>the<span> </span>multiplied<span> </span>ciphertexts.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_0<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>ct1<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>*</span><span> </span>t<span> </span><span>/</span><span> </span>q<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_1<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polyadd_wm<span>(</span>polymul_wm<span>(</span>ct1<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>polymul_wm<span>(</span>ct1<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>*</span><span> </span>t<span> </span><span>/</span><span> </span>q<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_2<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>ct1<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>*</span><span> </span>t<span> </span><span>/</span><span> </span>q<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>c_0<span>,</span><span> </span>c_1<span>,</span><span> </span>c_2<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>But, as a popular movie character would say, <strong>&quot;Houston, we have a problem&quot;</strong>. This tuple of coefficients has size 3, <strong>not 2 as the usual ciphertext</strong>. Moreover, the size of such tuple will grow linearly in the number of further multiplications performed on the ciphertexts. In order to restore the size of the ciphertext as 2, we will make use of the so called <em>relinearization technique</em>. üí•</p>
<h3>Relinearization</h3>
<p>üí° The idea of <strong>Relinearization</strong> is to reduce the triplet
<span><span><span>(c0,c1,c2)(c_0,c_1,c_2)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> to a ciphertext pair <span><span><span>(c0‚Ä≤,c1‚Ä≤)‚ààRq√óRq(c_0&#x27;,c_1&#x27;) \in R_q \times R_q</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> that
recovers <span><span><span>[mm‚Ä≤]t[mm&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> when decrypted with the usual decryption
algorithm. We would like to produce a pair <span><span><span>(c0‚Ä≤,c1‚Ä≤)(c_0&#x27;,c_1&#x27;)</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, without using the
secret <span><span><span>ss</span><span aria-hidden="true"><span><span></span><span>s</span></span></span></span></span>, such that:
<span><span><span>[c0‚Ä≤+s‚ãÖc1‚Ä≤]q=[c0+c1‚ãÖs+c2‚ãÖs2+r]q[c_0&#x27; + s\cdot c_1&#x27;]_q = [c_0 + c_1\cdot s + c_2 \cdot s^2 + r ]_q</span><span aria-hidden="true"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>,
where <span><span><span>rr</span><span aria-hidden="true"><span><span></span><span>r</span></span></span></span></span> is a &quot;small&quot; error. The correct decryption will be possible, as the
&quot;small&quot; error <span><span><span>rr</span><span aria-hidden="true"><span><span></span><span>r</span></span></span></span></span> will vanish because of the rounding in decryption.</p>
<p>As the name suggests it, we transform the degree 2 polynomial, <span><span><span>c0+c1‚ãÖs+c2‚ãÖs2c_0+c_1\cdot s+c_2 \cdot s^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> into a linear polynomial, i.e. of degree 1. This involves giving extra info about  <span><span><span>s2s^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. Using a special public key, called <em>relinearization key</em>, we can <em>linearize</em> <span><span><span>c2‚ãÖs2c_2 \cdot s^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> (up to some small error) as</p>
<div><span><span><span>[c20+c21‚ãÖs]q=[c2‚ãÖs2+erelin]q.[c_{20}+c_{21} \cdot s]_q = [c_2\cdot s^2 + e_{relin}]_q.</span><span aria-hidden="true"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>r</span><span>e</span><span>l</span><span>i</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>
<p>Therefore, by Equation <span><span><span>(2)(2)</span><span aria-hidden="true"><span><span></span><span>(</span><span>2</span><span>)</span></span></span></span></span>, we can get a standard ciphertext pair as</p>
<div><span><span><span>cmul=(c0+c20,c1+c21),c_{mul} =(c_0+c_{20}, c_1+c_{21}), </span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span></span></span></span></span></div>
<p>that correctly decrypts to <span><span><span>[mm‚Ä≤]t[mm&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, as you can see below:</p>
<div><span><span><span>[c0+c20+s‚ãÖ(c1+c21)]q=[c0+c1‚ãÖs+c2‚ãÖs2+erelin]q=Œî‚ãÖ[mm‚Ä≤]t+vmult,\begin{aligned}
[c_0 + c_{20} + s\cdot (c_1 + c_{21})]_q = [c_0 + c_1 \cdot s + c_2 \cdot s^2 + e_{relin}]_q = \Delta \cdot [mm&#x27;]_t + v_{mult},
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>r</span><span>e</span><span>l</span><span>i</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>where <span><span><span>vmult=u3+erelin.v_{mult} = u_3 + e_{relin}.</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>r</span><span>e</span><span>l</span><span>i</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>.</span></span></span></span></span> Therefore, <span><span><span>cmulc_{mul}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> decrypts correctly
to <span><span><span>[mm‚Ä≤]t[mm&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> if <span><span><span>‚à•vmult‚à•\|v_{mult}\|</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span></span></span></span></span> is less than <span><span><span>Œî/2\Delta/2</span><span aria-hidden="true"><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>. So yay! we finally
know how to get a ciphertext encoding multiplication!</p>
<h3>Different versions of relinearization</h3>
<p>To complete this discussion, we need to see how to construct the linear
approximation of <span><span><span>c2‚ãÖs2c_2 \cdot s^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> and find out what the relinearization key is
about. For this, we will go a bit deeper into (technical) details. Don&#x27;t
panic, we&#x27;ll take you step by step. üòÑ</p>
<p>We are going to present two versions of linearizing <span><span><span>c2‚ãÖs2c_2\cdot s^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. First,
keep in mind that <span><span><span>s2s^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> should not be known, so we give the relinearization
key as a <em>masked version</em> of <span><span><span>s2s^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>Let&#x27;s think of the following situation: say we include in the public key the
following <em>relinearization</em> key:</p>
<div><span><span><span>rlk=(rlk0,rlk1)=([‚àí(a‚ãÖs+e)+s2]q,a),rlk = (rlk_0, rlk_1) = ([-(a\cdot s+e)+s^2]_q,a),</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span>a</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>a</span><span>)</span><span>,</span></span></span></span></span></div>
<p>for some uniform <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> in <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and a small error <span><span><span>ee</span><span aria-hidden="true"><span><span></span><span>e</span></span></span></span></span>.</p>
<p>‚ùó Intuitively, the secret <span><span><span>s2s^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> is hidden by something that looks
like an
<a href="https://en.wikipedia.org/wiki/Ring_learning_with_errors#The_RLWE_Problem">RLWE</a>
sample. Notice that,</p>
<div><span><span><span>rlk0+rlk1‚ãÖs=s2+e.rlk_0 + rlk_1 \cdot s = s^2 + e.</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span>.</span></span></span></span></span></div>
<p>To obtain the approximation of <span><span><span>c2‚ãÖs2c_2\cdot s^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> we should multiply the above
expression by <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. By doing so, we end up with the rather large-norm term
<span><span><span>c2‚ãÖec_2\cdot e</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>e</span></span></span></span></span>, due to the size of the coefficients of <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. We cannot allow
such a large &quot;noise&quot; as it will interfere with decryption. To avoid this
&quot;noise&quot; blow-up we will employ two techniques described below.</p>
<h3>üí• Relinearization: Version 1</h3>
<p>One strategy is to use base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> decomposition of the coefficients of <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to
slice <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> into components of small norm. To do this, we pick a base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> and
write each coefficient of <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> in this base. Recall that <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a integer
polynomial, modulo <span><span><span>xn+1x^n+1</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, so of degree at most <span><span><span>n‚àí1n-1</span><span aria-hidden="true"><span><span></span><span>n</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. If we write <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> as
a polynomial:</p>
<div><span><span><span>c2(x)=c2[0]+c2[1]‚ãÖx+‚Ä¶+c2[n‚àí1]‚ãÖxn‚àí1c_2(x) = c_2[0] + c_2[1]\cdot x+\ldots+c_2[n-1]\cdot x^{n-1}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>0</span><span>]</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>n</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>then we can decompose each coefficient <span><span><span>c2[i]c_2[i]</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span></span></span></span></span> in base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span>. Notice that
since <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> has coefficients in <span><span><span>[0,q‚àí1][0,q-1]</span><span aria-hidden="true"><span><span></span><span>[</span><span>0</span><span>,</span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>]</span></span></span></span></span>, the maximum power appearing in
these representations is <span><span><span>T‚ÑìT^{\ell}</span><span aria-hidden="true"><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span></span></span></span></span>, where <span><span><span>‚Ñì=‚åälog‚Å°T(q)‚åã\ell = \lfloor \log_T(q)\rfloor</span><span aria-hidden="true"><span><span></span><span>‚Ñì</span><span></span><span>=</span><span></span></span><span><span></span><span>‚åä</span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span>‚åã</span></span></span></span></span>.
For base decomposition we <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L102">use</a> the function <span><span><span>int2base\texttt{int2base}</span><span aria-hidden="true"><span><span></span><span><span>int2base</span></span></span></span></span></span>:</p>
<div><pre><code><span>def</span><span> </span><span>int2base</span><span>(</span>n<span>,</span><span> </span>b<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Generates<span> </span>the<span> </span>base<span> </span>decomposition<span> </span>of<span> </span>an<span> </span>integer<span> </span>n.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>n:<span> </span>integer<span> </span>to<span> </span>be<span> </span>decomposed.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>b:<span> </span>base.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>array<span> </span>of<span> </span>coefficients<span> </span>from<span> </span>the<span> </span>base<span> </span>decomposition<span> </span>of<span> </span>n<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>with<span> </span>the<span> </span>coeff[i]<span> </span>being<span> </span>the<span> </span>coeff<span> </span>of<span> </span>b<span> </span>^<span> </span>i.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>if</span><span> </span>n<span> </span><span>&lt;</span><span> </span>b<span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>[</span>n<span>]</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>else</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>[</span>n<span> </span><span>%</span><span> </span>b<span>]</span><span> </span><span>+</span><span> </span>int2base<span>(</span>n<span> </span><span>//</span><span> </span>b<span>,</span><span> </span>b<span>)</span><span> </span><span> </span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>The relinearization key, <span><span><span>rlkrlk</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span> in this version, consists of masked variants
of <span><span><span>Ti‚ãÖs2,T^i \cdot s^2,</span><span aria-hidden="true"><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span></span></span></span></span> instead of <span><span><span>s2s^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. More precisely, for <span><span><span>0‚â§i‚â§‚Ñì0 \leq i \leq
\ell</span><span aria-hidden="true"><span><span></span><span>0</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>i</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>‚Ñì</span></span></span></span></span>, this is defined as follows:</p>
<div><span><span><span>(rlk0[i],rlk1[i])=([‚àí(ai‚ãÖs+ei)+Ti‚ãÖs2]q,ai)(rlk_0[i], rlk_1[i]) = ([-(a_i \cdot s + e_i) + T^i\cdot s^2]_{q}, a_i)</span><span aria-hidden="true"><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></div>
<p>for <span><span><span>aia_i</span><span aria-hidden="true"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> chosen uniformly in <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>eie_i</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> chosen according to the
distribution <span><span><span>œá\chi</span><span aria-hidden="true"><span><span></span><span>œá</span></span></span></span></span> over <span><span><span>RR</span><span aria-hidden="true"><span><span></span><span>R</span></span></span></span></span> (yep, same error distribution as in the
description of the scheme). Below you can find the <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L135">implementation</a> of the
function that generates the evaluation (relinearization) key
<span><span><span>(rlk0[i],rlk1[i])0‚â§i‚â§‚Ñì(rlk_0[i],rlk_1[i])_{0\leq i\leq\ell}</span><span aria-hidden="true"><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span><span>)</span><span><span><span><span><span><span></span><span><span><span>0</span><span>‚â§</span><span>i</span><span>‚â§</span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<div><pre><code><span>def</span><span> </span><span>evaluate_keygen_v1</span><span>(</span>sk<span>,</span><span> </span>size<span>,</span><span> </span>modulus<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std2<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Generate<span> </span>a<span> </span>relinearization<span> </span>key<span> </span>using<span> </span>version<span> </span>1.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>sk:<span> </span>secret<span> </span>key.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>the<span> </span>polynomials.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>modulus:<span> </span>coefficient<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>T:<span> </span>base.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>std2:<span> </span>standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>distribution.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk:<span> </span>relinearization<span> </span>key.<span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>n<span> </span><span>=</span><span> </span><span>len</span><span>(</span>poly_mod<span>)</span><span> </span><span>-</span><span> </span><span>1</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>l<span> </span><span>=</span><span> </span>np<span>.</span><span>int</span><span>(</span>np<span>.</span>log<span>(</span>modulus<span>)</span><span> </span><span>/</span><span> </span>np<span>.</span>log<span>(</span>T<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>rlk0<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>,</span><span> </span>n<span>)</span><span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>rlk1<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>,</span><span> </span>n<span>)</span><span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>for</span><span> </span>i<span> </span><span>in</span><span> </span><span>range</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>gen_uniform_poly<span>(</span>size<span>,</span><span> </span>modulus<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>e<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std2<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>secret_part<span> </span><span>=</span><span> </span>T<span> </span><span>**</span><span> </span>i<span> </span><span>*</span><span> </span>poly<span>.</span>polymul<span>(</span>sk<span>,</span><span> </span>sk<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd<span>(</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul_wm<span>(</span><span>-</span>a<span>,</span><span> </span>sk<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polyadd_wm<span>(</span><span>-</span>e<span>,</span><span> </span>secret_part<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>concatenate<span>(</span><span> </span><span>(</span>b<span>,</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>len</span><span>(</span>b<span>)</span><span>)</span><span> </span><span>)</span><span> </span><span>)</span><span>)</span><span> </span><span>#<span> </span>pad<span> </span>b<span> </span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>concatenate<span>(</span><span> </span><span>(</span>a<span>,</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>len</span><span>(</span>a<span>)</span><span>)</span><span> </span><span>)</span><span> </span><span>)</span><span>)</span><span> </span><span>#<span> </span>pad<span> </span>a<span> </span><span> </span><span> </span><span> </span></span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0<span>[</span>i<span>]</span><span> </span><span>=</span><span> </span>b<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk1<span>[</span>i<span>]</span><span> </span><span>=</span><span> </span>a<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>rlk0<span>,</span><span> </span>rlk1<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>Now, given <span><span><span>rlkrlk</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>, let&#x27;s look at how we compute the linear approximation of
<span><span><span>c2‚ãÖs2c_2 \cdot s^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. Let the polynomials <span><span><span>c2(i)c_2(i)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span></span></span></span></span> be the base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> decomposition
of <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, such that:</p>
<div><span><span><span>c2=‚àëi=0‚Ñìc2(i)‚ãÖTi.c_2 = \displaystyle \sum_{i=0}^{\ell} c_2(i)\cdot T^i.</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>
<p>We can get the linear approximation given by <span><span><span>(c20,c21)(c_{20}, c_{21})</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, where:</p>
<div><span><span><span>c20=‚àëi=0‚Ñìrlk0[i]‚ãÖc2(i)¬†and¬†c21=‚àëi=0‚Ñìrlk1[i]‚ãÖc2(i).c_{20} = \sum_{i=0}^{\ell} rlk_0[i]\cdot c_2(i) \text{ and } c_{21} = \sum_{i=0}^{\ell} rlk_1[i]\cdot c_2(i).</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span><span>¬†and¬†</span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span>.</span></span></span></span></span></div>
<p>Therefore, <span><span><span>c20+c21‚ãÖs=c2‚ãÖs2+erelin_v1c_{20} + c_{21} \cdot s = c_2 \cdot s^2 + e_{\text{relin\_v1}}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>
where <span><span><span>erelin_v1e_{\text{relin\_v1}}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is an error term from <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<div><span><span><span>c20+c21‚ãÖs=‚àëi=0‚Ñì[‚àí(ai‚ãÖs+ei)+Ti‚ãÖs2]c2(i)+‚àëi=0‚Ñìai‚ãÖs‚ãÖc2(i)=‚àí‚àëi=0‚Ñìei‚ãÖc2(i)+c2‚ãÖs2.\begin{aligned}
c_{20} + c_{21} \cdot s
    &amp;= \sum_{i=0}^{\ell} [-(a_i\cdot s+e_i)+T^i\cdot s^2] c_2(i) + \sum_{i=0}^{\ell} a_i \cdot s \cdot c_2(i)\\
    &amp;= -\sum_{i=0}^{\ell} e_i \cdot c_2(i) + c_2 \cdot s^2.
 \end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>]</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>‚àí</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>.</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>üí° By doing base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> decomposition we get a &quot;small&quot; <strong>relinearization noise</strong>:
<span><span><span>‚à•erelin_v1‚à•‚â§(‚Ñì+1)‚ãÖB‚ãÖT‚ãÖn/2\|e_{\text{relin\_v1}}\| \leq (\ell+1)\cdot B \cdot T \cdot n/2</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>(</span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>B</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span>/</span><span>2</span></span></span></span></span>
where <span><span><span>BB</span><span aria-hidden="true"><span><span></span><span>B</span></span></span></span></span> is an upper bound on the errors <span><span><span>eie_i</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>‚ùì Now the question is how to compute the polynomials <span><span><span>c2(i)c_2(i)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span></span></span></span></span>. The coefficients of these polynomials prove to be nothing but the columns of the matrix <span><span><span>Reps\texttt{Reps}</span><span aria-hidden="true"><span><span></span><span><span>Reps</span></span></span></span></span></span>.</p>
<p><span><span><span>c2[i]=Reps[i][0]+Reps[i][1]‚ãÖT+‚Ä¶+Reps[i][‚Ñì]‚ãÖT‚Ñì.c_2[i] = \mathtt{Reps}[i][0] + \mathtt{Reps}[i][1] \cdot T+ \ldots + \mathtt{Reps}[i][\ell] \cdot T^{\ell}.</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>=</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>0</span><span>]</span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>‚Ñì</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></p>
<p>If we multiply this by <span><span><span>xix^i</span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span></span></span></span></span>, we get:</p>
<div><span><span><span>c2[i]‚ãÖxi=Reps[i][0]‚ãÖxi+Reps[i][1]‚ãÖxi‚ãÖT+‚Ä¶+Reps[i][‚Ñì]‚ãÖxi‚ãÖT‚Ñì.c_2[i] \cdot x^i =
    \mathtt{Reps}[i][0] \cdot x^i +
    \mathtt{Reps}[i][1] \cdot x^i \cdot T+ \ldots +
    \mathtt{Reps}[i][\ell] \cdot x^i \cdot T^{\ell}.</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>0</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>‚Ñì</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>
<p>Summing up all these for each <span><span><span>0‚â§i‚â§n‚àí10\leq i \leq n-1</span><span aria-hidden="true"><span><span></span><span>0</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>i</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>n</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, on the left hand side we
actually get <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>:</p>
<div><span><span><span>c2=‚àëi=0n‚àí1Reps[i][0]‚ãÖxi+(‚àëi=0n‚àí1Reps[i][1]‚ãÖxi)‚ãÖT+‚Ä¶+(‚àëi=0n‚àí1Reps[i][‚Ñì]‚ãÖxi)‚ãÖT‚Ñì.c_2 = \displaystyle \sum_{i=0}^{n-1} \mathtt{Reps}[i][0] \cdot x^i
    + (\sum_{i=0}^{n-1}\mathtt{Reps}[i][1] \cdot x^i) \cdot  T+ \ldots
    + (\sum_{i=0}^{n-1} \mathtt{Reps}[i][\ell] \cdot x^i) \cdot T^{\ell}.</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>0</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>‚Ñì</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>
<p>So, if we denote the above sums by polynomials <span><span><span>c2(j)c_2(j)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>j</span><span>)</span></span></span></span></span>, we simply get</p>
<div><span><span><span>c2=‚àëj=0‚Ñìc2(j)‚ãÖTj.c_2 = \displaystyle \sum_{j=0}^{\ell} c_2(j)\cdot T^j.</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>j</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>j</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>
<p>Phew, what a relief! Notice that the coefficients for each polynomial
<span><span><span>c2(j)c_2(j)</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>j</span><span>)</span></span></span></span></span> are given by the <span><span><span>jj</span><span aria-hidden="true"><span><span></span><span>j</span></span></span></span></span>-th column of <span><span><span>Reps\mathtt{Reps}</span><span aria-hidden="true"><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span></span></span></span></span>.</p>
<p>So after all this math, we finally got the linear approximation of <span><span><span>c2‚ãÖs2c_2 \cdot
s^2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> and thus, we can derive the standard ciphertext encoding the
multiplication of the plaintexts. Here comes the <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L311">code</a>:</p>
<div><pre><code><span>def</span><span> </span><span>mul_cipher_v1</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0<span>,</span><span> </span>rlk1<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Multiply<span> </span>two<span> </span>ciphertexts.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1:<span> </span>first<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct2:<span> </span>second<span> </span>ciphertext<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>T:<span> </span>base<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0,<span> </span>rlk1:<span> </span>output<span> </span>of<span> </span>the<span> </span>EvaluateKeygen_v1<span> </span>function.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>n<span> </span><span>=</span><span> </span><span>len</span><span>(</span>poly_mod<span>)</span><span> </span><span>-</span><span> </span><span>1</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>l<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>log<span>(</span>q<span>)</span><span> </span><span>/</span><span> </span>np<span>.</span>log<span>(</span>T<span>)</span><span>)</span><span> </span><span> </span><span>#l<span> </span>=<span> </span>log_T(q)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_0<span>,</span><span> </span>c_1<span>,</span><span> </span>c_2<span> </span><span>=</span><span> </span>multiplication_coeffs<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_2<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>concatenate<span>(</span><span> </span><span>(</span>c_2<span>,</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>len</span><span>(</span>c_2<span>)</span><span>)</span><span>)</span><span> </span><span>)</span><span>)</span><span> </span><span>#pad</span><span></span>
<span></span><span> </span><span> </span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#Next,<span> </span>we<span> </span>decompose<span> </span>c_2<span> </span>in<span> </span>base<span> </span>T:<span> </span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#more<span> </span>precisely,<span> </span>each<span> </span>coefficient<span> </span>of<span> </span>c_2<span> </span>is<span> </span>decomposed<span> </span>in<span> </span>base<span> </span>T<span> </span>such<span> </span>that<span> </span>c_2<span> </span>=<span> </span>sum<span> </span>T**i<span> </span>*<span> </span>c_2(i)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Reps<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span><span>(</span>n<span>,</span><span> </span>l<span> </span><span>+</span><span> </span><span>1</span><span>)</span><span>,</span><span> </span>dtype<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>for</span><span> </span>i<span> </span><span>in</span><span> </span><span>range</span><span>(</span>n<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rep<span> </span><span>=</span><span> </span>int2base<span>(</span>c_2<span>[</span>i<span>]</span><span>,</span><span> </span>T<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rep2<span> </span><span>=</span><span> </span>rep<span> </span><span>+</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span> </span><span>-</span><span> </span><span>len</span><span>(</span>rep<span>)</span><span>)</span><span> </span><span>#pad<span> </span>with<span> </span>0</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Reps<span>[</span>i<span>]</span><span> </span><span>=</span><span> </span>np<span>.</span>array<span>(</span>rep2<span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Each<span> </span>row<span> </span>Reps[i]<span> </span>is<span> </span>the<span> </span>base<span> </span>T<span> </span>representation<span> </span>of<span> </span>the<span> </span>i-th<span> </span>coefficient<span> </span>c_2[i].</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>The<span> </span>polynomials<span> </span>c_2(j)<span> </span>are<span> </span>given<span> </span>by<span> </span>the<span> </span>columns<span> </span>Reps[:,j].</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span>shape<span>=</span>n<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span>shape<span>=</span>n<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Here<span> </span>we<span> </span>compute<span> </span>the<span> </span>sums:<span> </span>rlk[j][0]<span> </span>*<span> </span>c_2(j)<span> </span>and<span> </span>rlk[j][1]<span> </span>*<span> </span>c_2(j)<span> </span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>for</span><span> </span>j<span> </span><span>in</span><span> </span><span>range</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>polyadd_wm<span>(</span>c_20<span>,</span><span> </span>polymul_wm<span>(</span>rlk0<span>[</span>j<span>]</span><span>,</span><span> </span>Reps<span>[</span><span>:</span><span>,</span>j<span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>polyadd_wm<span>(</span>c_21<span>,</span><span> </span>polymul_wm<span>(</span>rlk1<span>[</span>j<span>]</span><span>,</span><span> </span>Reps<span>[</span><span>:</span><span>,</span>j<span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>c_20<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>c_21<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>new_c0<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_0<span>,</span><span> </span>c_20<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>new_c1<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_1<span>,</span><span> </span>c_21<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>new_c0<span>,</span><span> </span>new_c1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<h3>üí• Relinearization: Version 2</h3>
<p>This version is much simpler and cleaner than the previous one (yay!) and uses the so-called <em>modulus switching</em> technique. Recall that if we try to naively mask <span><span><span>s2s^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> in the reliniarization key, then there is a large blow-up in the noise because of the <span><span><span>c2c_2</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> multiplication. We want to avoid this to get a correct decryption.</p>
<p>In this version we mask <span><span><span>s2s^2</span><span aria-hidden="true"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> modulo a a different modulus, <span><span><span>p‚ãÖqp\cdot q</span><span aria-hidden="true"><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>q</span></span></span></span></span>, with a much larger <span><span><span>p‚â´qp\gg q</span><span aria-hidden="true"><span><span></span><span>p</span><span></span><span>‚â´</span><span></span></span><span><span></span><span>q</span></span></span></span></span>, as shown below.</p>
<div><span><span><span>rlk=(rlk0,rlk1)=([‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2]p‚ãÖq,a‚Ä≤),rlk = (rlk_0, rlk_1) = ([-(a&#x27; \cdot s + e&#x27;) + p\cdot s^2]_{p\cdot q}, a&#x27;),</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>p</span><span>‚ãÖ</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span>,</span></span></span></span></span></div>
<p>for a uniform <span><span><span>a‚Ä≤a&#x27;</span><span aria-hidden="true"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> in <span><span><span>Rp‚ãÖqR_{p\cdot q}</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span><span>p</span><span>‚ãÖ</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>e‚Ä≤e&#x27;</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> drawn according to an error distribution <span><span><span>œá‚Ä≤\chi&#x27;</span><span aria-hidden="true"><span><span></span><span><span>œá</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> over <span><span><span>R.R.</span><span aria-hidden="true"><span><span></span><span>R</span><span>.</span></span></span></span></span>
Remember that our goal is to produce an approximation of <span><span><span>[c2‚ãÖs2]q[c_2\cdot s^2]_q</span><span aria-hidden="true"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. The idea is that when we scale from <span><span><span>p‚ãÖqp\cdot q</span><span aria-hidden="true"><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>q</span></span></span></span></span> back to <span><span><span>qq</span><span aria-hidden="true"><span><span></span><span>q</span></span></span></span></span>, the noise gets divided by the large integer <span><span><span>pp</span><span aria-hidden="true"><span><span></span><span>p</span></span></span></span></span>, significantly reducing its size.</p>
<p>In a safe implementation the distribution <span><span><span>œá‚Ä≤\chi&#x27;</span><span aria-hidden="true"><span><span></span><span><span>œá</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> should be distinct from
<span><span><span>œá\chi</span><span aria-hidden="true"><span><span></span><span>œá</span></span></span></span></span> and its parameters should be carefully chosen for security reasons.
Since security is not our main goal in this blog post, you can check the
paper for further details.</p>
<div><pre><code><span>def</span><span> </span><span>evaluate_keygen_v2</span><span>(</span>sk<span>,</span><span> </span>size<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>,</span><span> </span>extra_modulus<span>,</span><span> </span>std2<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Generate<span> </span>a<span> </span>relinearization<span> </span>key<span> </span>using<span> </span>version<span> </span>2.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>sk:<span> </span>secret<span> </span>key<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>the<span> </span>polynomials.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>modulus:<span> </span>coefficient<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>extra_modulus:<span> </span>the<span> </span>&quot;p&quot;<span> </span>modulus<span> </span>for<span> </span>modulus<span> </span>switching.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>st2:<span> </span>standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>distribution.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0,<span> </span>rlk1:<span> </span>relinearization<span> </span>key.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>new_modulus<span> </span><span>=</span><span> </span>modulus<span> </span><span>*</span><span> </span>extra_modulus<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>gen_uniform_poly<span>(</span>size<span>,</span><span> </span>new_modulus<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>e<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std2<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>secret_part<span> </span><span>=</span><span> </span>extra_modulus<span> </span><span>*</span><span> </span>poly<span>.</span>polymul<span>(</span>sk<span>,</span><span> </span>sk<span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul_wm<span>(</span><span>-</span>a<span>,</span><span> </span>sk<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polyadd_wm<span>(</span><span>-</span>e<span>,</span><span> </span>secret_part<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>new_modulus<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>b<span>,</span><span> </span>a<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<p>The linear approximation of <span><span><span>[c2‚ãÖs2]q[c_2 \cdot s^2]_q</span><span aria-hidden="true"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> can be computed from the pair:</p>
<div><span><span><span>(c20,c21)=([‚åäc2‚ãÖrlk0p‚åâ]q,[‚åäc2‚ãÖrlk1p‚åâ]q).(c_{20}, c_{21}) = \Big(\Big[\Big\lfloor\frac{c_2 \cdot rlk_0}{p}\Big\rceil\Big]_q, \Big[\Big\lfloor\frac{c_2 \cdot rlk_1}{p}\Big\rceil\Big]_q\Big).</span><span aria-hidden="true"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>(</span></span><span><span>[</span></span><span><span>‚åä</span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>‚åâ</span></span><span><span><span>]</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>[</span></span><span><span>‚åä</span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>‚åâ</span></span><span><span><span>]</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span><span>.</span></span></span></span></span></div>
<p>Indeed, <span><span><span>[c20+c21‚ãÖs]q=[c2‚ãÖs2]q+erelin_v2,[c_{20} + c_{21} \cdot s]_q = [c_2 \cdot s^2]_q + e_{\text{relin\_v2}},</span><span aria-hidden="true"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span></span> for a &quot;small&quot; error <span><span><span>erelin_v2e_{\text{relin\_v2}}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> in <span><span><span>RqR_q</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>
<div><span><span><span>c2‚ãÖrlk0p+c2‚ãÖrlk1p‚ãÖs=c2‚ãÖ[‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2]p‚ãÖq+c2‚ãÖa‚Ä≤‚ãÖsp=c2‚ãÖs2+‚àíc2‚ãÖe‚Ä≤p+q‚ãÖK,\begin{aligned}
\frac{c_2 \cdot rlk_0}{p} + \frac{c_2 \cdot rlk_1}{p} \cdot s 
    &amp;= \frac{c_2\cdot [-(a&#x27;\cdot s+e&#x27;) + p\cdot s^2]_{p\cdot q}+c_2 \cdot a&#x27; \cdot s}{p}\\
    &amp;= c_2\cdot s^2 +\frac{-c_2\cdot e&#x27;}{p} + q \cdot K,
\end{aligned}</span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>p</span><span>‚ãÖ</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span>‚àí</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span>q</span><span></span><span>‚ãÖ</span><span></span><span>K</span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>where <span><span><span>K‚ààRK \in R</span><span aria-hidden="true"><span><span></span><span>K</span><span></span><span>‚àà</span><span></span></span><span><span></span><span>R</span></span></span></span></span> such that <span><span><span>[‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2]pq=‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2+pq‚ãÖK[-(a&#x27;\cdot s+e&#x27;) + p\cdot s^2]_{pq} = -(a&#x27;\cdot s+e&#x27;) + p\cdot s^2 + pq\cdot K</span><span aria-hidden="true"><span><span></span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>p</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>K</span></span></span></span></span>.</p>
<p>We&#x27;re cheating a bit here, since the pair involves the <em>roundings of the terms to their nearest integers</em>. Still, we&#x27;re not far from the truth, since for any real number <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span>, <span><span><span>‚åäa‚åâ\lfloor a \rceil</span><span aria-hidden="true"><span><span></span><span>‚åä</span><span>a</span><span>‚åâ</span></span></span></span></span> differs from <span><span><span>aa</span><span aria-hidden="true"><span><span></span><span>a</span></span></span></span></span> by a small quantity
<span><span><span>Œµ‚àà[‚àí12,12]\varepsilon \in [-\frac{1}{2},\frac{1}{2}]</span><span aria-hidden="true"><span><span></span><span>Œµ</span><span></span><span>‚àà</span><span></span></span><span><span></span><span>[</span><span>‚àí</span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span>,</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span>]</span></span></span></span></span>. (we can also extend this coefficient-wise to polynomials).</p>
<p>üí° We get a &quot;small&quot; <strong>relinearization noise</strong>,
<span><span><span>erelin_v2‚âà(c2‚ãÖe‚Ä≤)/pe_{\text{relin\_v2}} \approx (c_2\cdot e&#x27;)/p</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚âà</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span>/</span><span>p</span></span></span></span></span>, for large <span><span><span>p:p:</span><span aria-hidden="true"><span><span></span><span>p</span><span></span><span>:</span></span></span></span></span>
<span><span><span>‚à•erelin_v2‚à•‚â§q‚ãÖB‚Ä≤‚ãÖnp+n+12.\|e_{\text{relin\_v2}}\| \leq \frac{q \cdot B&#x27; \cdot n}{p}+\frac{n+1}{2}.</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>p</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span>‚ãÖ</span><span><span>B</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>‚ãÖ</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>n</span><span>+</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span>.</span></span></span></span></span></p>
<p>Next, we provide the easy <a href="https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L355">code</a> implementation for multiplying ciphertexts using this version.</p>
<div><pre><code><span>def</span><span> </span><span>mul_cipher_v2</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>p<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0<span>,</span><span> </span>rlk1<span>)</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>&quot;&quot;&quot;Multiply<span> </span>two<span> </span>ciphertexts.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1:<span> </span>first<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct2:<span> </span>second<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>p:<span> </span>modulus-swithcing<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0,<span> </span>rlk1:<span> </span>output<span> </span>of<span> </span>the<span> </span>EvaluateKeygen_v2<span> </span>function.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>&quot;&quot;&quot;</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_0<span>,</span><span> </span>c_1<span>,</span><span> </span>c_2<span> </span><span>=</span><span> </span>multiplication_coeffs<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>c_2<span>,</span><span> </span>rlk0<span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>/</span><span> </span>p<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>c_2<span>,</span><span> </span>rlk1<span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>/</span><span> </span>p<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>new_c0<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_0<span>,</span><span> </span>c_20<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>new_c1<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_1<span>,</span><span> </span>c_21<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>new_c0<span>,</span><span> </span>new_c1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div>
<h3>Version 1 vs. Version 2 ü•ä</h3>
<p>Recall that we can derive a fresh standard ciphertext that decrypts to
<span><span><span>[mm‚Ä≤]t[mm&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> as <span><span><span>cmul=(c0+c20,c1+c21)c_{mul} =(c_0+c_{20}, c_1+c_{21})</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, since</p>
<div><span><span><span>c0+c20+s‚ãÖ(c1+c21)=Œî‚ãÖ[mm‚Ä≤]t+vmult,c_0 + c_{20} + s\cdot (c_1 + c_{21}) = \Delta \cdot [mm&#x27;]_t + v_{mult},</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span></span></div>
<p>where <span><span><span>vmult=u3+erelinv_{mult} = u_3 + e_{\text{relin}}</span><span aria-hidden="true"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>erelin‚àà{erelin_v1,erelin_v2}e_{\text{relin}} \in \{e_{\text{relin\_v1}}, e_{\text{relin\_v2}}\}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚àà</span><span></span></span><span><span></span><span>{</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>}</span></span></span></span></span>.</p>
<p>We need to make sure that <span><span><span>cmulc_{mul}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> decrypts <em>correctly</em> to <span><span><span>[mm‚Ä≤]t[mm&#x27;]_t</span><span aria-hidden="true"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. For
this, it suffices to choose the parameters such that
<span><span><span>‚à•u3‚à•+‚à•erelin‚à•‚â§Œî/2.\|u_3\| + \|e_{\text{relin}}\| \leq \Delta/2.</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>Œî</span><span>/</span><span>2</span><span>.</span></span></span></span></span></p>
<p>Now that we have <strong>two</strong> versions of relinearization, which help us in
deriving <span><span><span>cmulc_{mul}</span><span aria-hidden="true"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, we may wonder which one we can use:</p>
<table><thead><tr><th>Relinearization</th><th align="left">Size of <span><span><span>rlkrlk</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span> (in bits)</th><th>Bound of <span><span><span>ereline_{\text{relin}}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></th></tr></thead><tbody><tr><td><strong>Version 1</strong></td><td align="left"><span><span><span>2(‚Ñì+1)‚ãÖn‚ãÖlog‚Å°q2(\ell+1)\cdot n \cdot \log q</span><span aria-hidden="true"><span><span></span><span>2</span><span>(</span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>lo<span>g</span></span><span></span><span>q</span></span></span></span></span></td><td><span><span><span>(‚Ñì+1)‚ãÖB‚ãÖT‚ãÖn/2(\ell+1)\cdot B \cdot T \cdot n/2</span><span aria-hidden="true"><span><span></span><span>(</span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>B</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span>/</span><span>2</span></span></span></span></span></td></tr><tr><td><strong>Version 2</strong></td><td align="left"><span><span><span>2n‚ãÖlog‚Å°pq2n \cdot \log pq</span><span aria-hidden="true"><span><span></span><span>2</span><span>n</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>lo<span>g</span></span><span></span><span>p</span><span>q</span></span></span></span></span></td><td><span><span><span>q‚ãÖB‚Ä≤‚ãÖnp+n+12\frac{q \cdot B&#x27; \cdot n}{p}+\frac{n+1}{2}</span><span aria-hidden="true"><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>p</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span>‚ãÖ</span><span><span>B</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>‚ãÖ</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>n</span><span>+</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span></td></tr></tbody></table>
<p>‚û°Ô∏è <strong>size of <span><span><span>rlkrlk</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>:</strong> <strong>Version 1</strong> gives a relinearization key as <span><span><span>‚Ñì+1\ell+1</span><span aria-hidden="true"><span><span></span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> pairs of polynomials in <span><span><span>Rq,R_q,</span><span aria-hidden="true"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span></span> whereas <strong>Version 2</strong> gives just one such pair. Recall that <span><span><span>‚Ñì=‚åälog‚Å°Tq‚åã\ell=\lfloor \log_T{q}\rfloor</span><span aria-hidden="true"><span><span></span><span>‚Ñì</span><span></span><span>=</span><span></span></span><span><span></span><span>‚åä</span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span>q</span></span><span>‚åã</span></span></span></span></span> and see that this decreases as long as the base <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> increases.</p>
<p>‚û°Ô∏è <strong>bound of <span><span><span>ereline_{\text{relin}}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>:</strong> The upper bounds of <span><span><span>ereline_{\text{relin}}</span><span aria-hidden="true"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> for both versions are according to <a href="https://eprint.iacr.org/2012/144.pdf">[FV12], Lem.3</a>. We consider <span><span><span>BB</span><span aria-hidden="true"><span><span></span><span>B</span></span></span></span></span> as a bound taken so that the error distribution <span><span><span>œá\chi</span><span aria-hidden="true"><span><span></span><span>œá</span></span></span></span></span> takes values in <span><span><span>[‚àíB,B][-B,B]</span><span aria-hidden="true"><span><span></span><span>[</span><span>‚àí</span><span>B</span><span>,</span><span></span><span>B</span><span>]</span></span></span></span></span> with high probability. We similarly define <span><span><span>B‚Ä≤B&#x27;</span><span aria-hidden="true"><span><span></span><span><span>B</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> for the case of the error distribution <span><span><span>œá‚Ä≤\chi&#x27;</span><span aria-hidden="true"><span><span></span><span><span>œá</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>, used in <strong>Version 2</strong>. Notice that for <strong>Version 1</strong>, a larger <span><span><span>TT</span><span aria-hidden="true"><span><span></span><span>T</span></span></span></span></span> leads to more noise (but smaller <span><span><span>rlkrlk</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>), whereas in <strong>Version 2</strong>, a larger <span><span><span>pp</span><span aria-hidden="true"><span><span></span><span>p</span></span></span></span></span> leads to smaller noise (but larger <span><span><span>rlkrlk</span><span aria-hidden="true"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>). For choosing the parameters in safe implementation, we refer the reader to <a href="https://eprint.iacr.org/2012/144.pdf">[FV12] Sec. Realinearisation Version 2.</a></p>
<h3>Setting the parameters</h3>
<p>We set the parameters for our toy implementation just to make sure it always
correctly decrypts at least one ciphertext multiplication. For that, we made
sure that <span><span><span>‚à•u3‚à•+‚à•erelin‚à•&lt;Œî/2\|u_3\| + \|e_{\text{relin}}\|&lt; \Delta /2</span><span aria-hidden="true"><span><span></span><span>‚à•</span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>&lt;</span><span></span></span><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>. In practice, for the
current choice it seems that decryption always works for <span><span><span>33</span><span aria-hidden="true"><span><span></span><span>3</span></span></span></span></span> ciphertext
multiplications when using V2 relinearization, for example. This is due to
the fact that the theoretical bounds are worst-case bounds. For the same
parameters we can make hundreds of addition (in practice it seems that
decryption works even for <span><span><span>10001000</span><span aria-hidden="true"><span><span></span><span>1</span><span>0</span><span>0</span><span>0</span></span></span></span></span> additions üòÆ). Ciphertext addition
is almost for free in terms of noise growth! üí• We invite you to play
around with the parameters and the bounds and try to see how many
multiplications you can get (as they are the costly operations).</p>
<h3>Let&#x27;s play! üéâ</h3>
<p>Now we can multiply ciphertexts, as we have implemented two versions of this:
<span><span><span>mul_cipher_v1\texttt{mul\_cipher\_v1}</span><span aria-hidden="true"><span><span></span><span><span>mul_cipher_v1</span></span></span></span></span></span> and <span><span><span>mul_cipher_v2\texttt{mul\_cipher\_v2}</span><span aria-hidden="true"><span><span></span><span><span>mul_cipher_v2</span></span></span></span></span></span>, using
relinearization. We can further add ciphertexts by using
<span><span><span>add_cipher\texttt{add\_cipher}</span><span aria-hidden="true"><span><span></span><span><span>add_cipher</span></span></span></span></span></span>. So yay! we can finally perform computations on
encrypted data.</p>
<p><strong>Bonus:</strong> if you&#x27;re curious, you can try computing more complex (polynomial)
operations on encrypted data, such as <em>multiplying three ciphertexts</em>. Here
we only wanted to show how to perform one multiplication. For more levels of
multiplications, you should set the parameters as in
<a href="https://eprint.iacr.org/2012/144.pdf">[FV12, Thm1]</a> so that you decrypt
correctly üòâ.</p>
<p><strong>Bonus2:</strong> you can also perform <em>plain operations</em>, such as adding or
multiplying plaintexts to ciphertexts, by using <span><span><span>add_plain\texttt{add\_plain}</span><span aria-hidden="true"><span><span></span><span><span>add_plain</span></span></span></span></span></span> and
<span><span><span>mul_plain,\texttt{mul\_plain},</span><span aria-hidden="true"><span><span></span><span><span>mul_plain</span></span><span>,</span></span></span></span></span> (with a <em>reduced noise growth</em>) both from
<a href="https://github.com/Bitdefender-Crypto-Team/he-scheme/blob/main/rlwe_he_scheme_updated.py">here</a>.
For further details on how these work, you should check
<a href="https://blog.openmined.org/build-an-homomorphic-encryption-scheme-from-scratch-with-python/#buildanhomomorphicencryptionscheme">this</a>. ü§ì</p>
<p>So what are you waiting for? Go check it out!</p>
<div><pre><code><span>import</span><span> </span>rlwe_he_scheme_updated<span> </span><span>as</span><span> </span>rlwe_updated<span></span>
<span></span><span>import</span><span> </span>numpy<span> </span><span>as</span><span> </span>np<span></span>
<span></span><span></span>
<span></span><span>if</span><span> </span>__name__<span> </span><span>==</span><span> </span><span>&#x27;__main__&#x27;</span><span>:</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Scheme&#x27;s<span> </span>parameters</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>polynomial<span> </span>modulus<span> </span>degree</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>n<span> </span><span>=</span><span> </span><span>2</span><span> </span><span>**</span><span> </span><span>2</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>ciphertext<span> </span>modulus</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>q<span> </span><span>=</span><span> </span><span>2</span><span> </span><span>**</span><span> </span><span>14</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>plaintext<span> </span>modulus</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>t<span> </span><span>=</span><span> </span><span>2</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>base<span> </span>for<span> </span>relin_v1</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>T<span> </span><span>=</span><span> </span><span>int</span><span>(</span>np<span>.</span>sqrt<span>(</span>q<span>)</span><span>)</span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#modulusswitching<span> </span>modulus</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>p<span> </span><span>=</span><span> </span>q<span> </span><span>**</span><span> </span><span>3</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>polynomial<span> </span>modulus</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>poly_mod<span> </span><span>=</span><span> </span>np<span>.</span>array<span>(</span><span>[</span><span>1</span><span>]</span><span> </span><span>+</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>1</span><span>)</span><span> </span><span>+</span><span> </span><span>[</span><span>1</span><span>]</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>in<span> </span>the<span> </span>encryption</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>std1<span> </span><span>=</span><span> </span><span>1</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>in<span> </span>the<span> </span>evaluateKeyGen_v2</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>std2<span> </span><span>=</span><span> </span><span>1</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Keygen</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>pk<span>,</span><span> </span>sk<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>keygen<span>(</span>n<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std1<span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#EvaluateKeygen_version1</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>rlk0_v1<span>,</span><span> </span>rlk1_v1<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>evaluate_keygen_v1<span>(</span>sk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std1<span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#EvaluateKeygen_version2</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>rlk0_v2<span>,</span><span> </span>rlk1_v2<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>evaluate_keygen_v2<span>(</span>sk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>,</span><span> </span>p<span>,</span><span> </span>std2<span>)</span><span></span>
<span></span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Encryption</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>pt1<span>,</span><span> </span>pt2<span> </span><span>=</span><span> </span><span>[</span><span>1</span><span>,</span><span> </span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>1</span><span>]</span><span>,</span><span> </span><span>[</span><span>1</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>0</span><span>,</span><span> </span><span>1</span><span>]</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>cst1<span>,</span><span> </span>cst2<span> </span><span>=</span><span> </span><span>[</span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>0</span><span>]</span><span>,</span><span> </span><span>[</span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>0</span><span>,</span><span> </span><span>0</span><span>]</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct1<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>encrypt<span>(</span>pk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>pt1<span>,</span><span> </span>std1<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct2<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>encrypt<span>(</span>pk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>pt2<span>,</span><span> </span>std1<span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>Ciphertext<span> </span>ct1({}):&quot;</span><span>.</span><span>format</span><span>(</span>pt1<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;&quot;</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;\t<span> </span>ct1_0:&quot;</span><span>,</span><span> </span>ct1<span>[</span><span>0</span><span>]</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;\t<span> </span>ct1_1:&quot;</span><span>,</span><span> </span>ct1<span>[</span><span>1</span><span>]</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;&quot;</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>Ciphertext<span> </span>ct2({}):&quot;</span><span>.</span><span>format</span><span>(</span>pt2<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;&quot;</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;\t<span> </span>ct1_0:&quot;</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;\t<span> </span>ct1_1:&quot;</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;&quot;</span><span>)</span><span></span>
<span></span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Evaluation</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct3<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>add_plain<span>(</span>ct1<span>,</span><span> </span>cst1<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct4<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>mul_plain<span>(</span>ct2<span>,</span><span> </span>cst2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#ct5<span> </span>=<span> </span>(ct1<span> </span>+<span> </span>cst1)<span> </span>+<span> </span>(cst2<span> </span>*<span> </span>ct2)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct5<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>add_cipher<span>(</span>ct3<span>,</span><span> </span>ct4<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>ct6<span> </span>=<span> </span>ct1<span> </span>*<span> </span>ct2</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct6<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>mul_cipher_v1<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0_v1<span>,</span><span> </span>rlk1_v1<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>ct7<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>mul_cipher_v2<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>p<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0_v2<span>,</span><span> </span>rlk1_v2<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Decryption</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct3<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct3<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct4<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct4<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct5<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct5<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct6<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct6<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct7<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct7<span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>Decrypted<span> </span>ct3=(ct1<span> </span>+<span> </span>{}):<span> </span>{}&quot;</span><span>.</span><span>format</span><span>(</span>cst1<span>,</span><span> </span>decrypted_ct3<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>Decrypted<span> </span>ct4=(ct2<span> </span>*<span> </span>{}):<span> </span>{}&quot;</span><span>.</span><span>format</span><span>(</span>cst2<span>,</span><span> </span>decrypted_ct4<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>Decrypted<span> </span>ct5=(ct1<span> </span>+<span> </span>{}<span> </span>+<span> </span>{}<span> </span>*<span> </span>ct2):<span> </span>{}&quot;</span><span>.</span><span>format</span><span>(</span>cst1<span>,</span><span> </span>cst2<span>,</span><span> </span>decrypted_ct5<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>pt1<span> </span>+<span> </span>{}<span> </span>+<span> </span>{}<span> </span>*<span> </span>pt2):<span> </span>{}&quot;</span><span>.</span><span>format</span><span>(</span>cst1<span>,</span><span> </span>cst2<span>,</span><span> </span>rlwe_updated<span>.</span>polyadd<span>(</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlwe_updated<span>.</span>polyadd<span>(</span>pt1<span>,</span><span> </span>cst1<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlwe_updated<span>.</span>polymul<span>(</span>cst2<span>,</span><span> </span>pt2<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>Decrypted<span> </span>ct6=(ct1<span> </span>*<span> </span>ct2):<span> </span>{}&quot;</span><span>.</span><span>format</span><span>(</span>decrypted_ct6<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>Decrypted<span> </span>ct7=(ct1<span> </span>*<span> </span>ct2):<span> </span>{}&quot;</span><span>.</span><span>format</span><span>(</span>decrypted_ct7<span>)</span><span>)</span><span></span>
<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>&quot;[+]<span> </span>pt1<span> </span>*<span> </span>pt2:<span> </span>{}&quot;</span><span>.</span><span>format</span><span>(</span>rlwe_updated<span>.</span>polymul<span>(</span>pt1<span>,</span><span> </span>pt2<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>
</code></pre></div></section><div class="Post__PostFooter-sc-oyq0rs-8 gLoNrh"><div class="Post__PostFooterWraper-sc-oyq0rs-9 bStMIm"><p class="Post__Author-sc-oyq0rs-4 dYMJEb">written by <!-- -->MƒÉdƒÉlina Bolboceanu, Miruna Ro»ôca, Radu »öi»õiu</p></div></div></div></div></div></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"https://bit-ml.github.io/styles.c960d3bf.css"}</script><script type="text/javascript">
    window.__routeInfo = {"path":"blog/post/homomorphic-encryption-toy-implementation-in-python","templateID":2,"sharedPropsHashes":{"galleries":"ZHT1Kz"},"localProps":null,"allProps":{"post":{"data":{"slug":"homomorphic-encryption-toy-implementation-in-python","authors":"MƒÉdƒÉlina Bolboceanu, Miruna Ro»ôca, Radu »öi»õiu","categories":"blog","featured_img":"/galleries/homomorphic2020/enigma_dec.jpg","date":"November-16-2020","title":"Homomorphic Encryption: a Toy Implementation in Python","id":4},"messages":[],"history":["./content/collections/posts/homomorphic2020.md","content/collections/posts/homomorphic2020.html"],"cwd":"/Users/fbrad/bit/bit-ml","contents":"<h1>Homomorphic Encryption: a Toy Implementation in Python</h1>\n<p><strong>Motivation:</strong>\nWe made this blog post as self-contained as possible, even though it was\ninitially thought as a follow-up of <a href=\"https://blog.openmined.org/build-an-homomorphic-encryption-scheme-from-scratch-with-python/#buildanhomomorphicencryptionscheme\">this tutorial given by\nOpenMined</a>.\nThe starting point of our Python implementation is <a href=\"https://gist.github.com/youben11/f00bc95c5dde5e11218f14f7110ad289\">this github\ngist</a>,\nwhich follows the Homomorphic Encryption scheme from\n<a href=\"https://eprint.iacr.org/2012/144.pdf\">[FV12]</a>. The motivation behind <a href=\"https://github.com/bit-ml/he-scheme\">our\nimplementation</a> was for us to understand\nin detail the two techniques of\n<a href=\"https://eprint.iacr.org/2012/144.pdf\">[FV12]</a> used for ciphertext\nmultiplication, namely <em>relinearization</em> and <em>modulus-switching</em>. This\nessential operation of ciphertext multiplication was missing in the previous\nimplementation. We thought we might share this understanding through a blog\npost as well since it may be of interest to anyone using the [FV12] scheme in\n<a href=\"https://github.com/OpenMined/TenSEAL\">TenSeal</a> or\n<a href=\"https://github.com/Microsoft/SEAL\">Seal</a> libraries.</p>\n<p><strong>Disclaimer:</strong> Our toy implementation is not meant to be secure or\noptimized for efficiency. We did it to better understand the inner workings\nof the [FV12] scheme, so you can use it as a learning tool. Our full\nimplementation can be found <a href=\"https://github.com/bit-ml/he-scheme\">here</a>.</p>\n<p><strong>Curious about how to work with data you can't see?</strong> In the first part of\nthis blog post we are going to broadly explain what Homomorphic Encryption is\nand some closely related concepts. In the second part we will follow an\nexample of such a scheme, namely the\n<a href=\"https://eprint.iacr.org/2012/144.pdf\">[FV12]</a> scheme, and discuss some of\nthe details of our implementation.</p>\n<h2>1. What is Homomorphic Encryption?</h2>\n<p>Homomorphic Encryption (HE) enables a user to perform meaningful computations\non sensitive data <strong>while ensuring the privacy of the data</strong>. This may sound\nparadoxical to anyone who has ever worked with encrypted data before: if you\nwant to perform useful computations on the encrypted data (e.g. encrypted\nunder classical algorithms like AES), you need to decrypt it first. But once\ndecryption takes place, the privacy of the data is compromised. So how is it\npossible for HE to overcome this seeming contradiction? üîÆ Well,\nthe solution is highly non-trivial, as it took the cryptographic community\nmore than 30 years to come up with a construction. The first\n<a href=\"https://www.cs.cmu.edu/~odonnell/hits09/gentry-homomorphic-encryption.pdf\">solution</a>\nwas proposed by Craig Gentry in 2009 and was of theoretical interest only.\nSince then, a lot of research has been done (e.g.\n<a href=\"https://eprint.iacr.org/2011/277\">[BGV11]</a>,\n<a href=\"https://eprint.iacr.org/2012/144\">[FV12]</a>,\n<a href=\"https://eprint.iacr.org/2016/421\">[CKKS16]</a>,\n<a href=\"https://github.com/lducas/FHEW\">[FHEW]</a>,\n<a href=\"https://tfhe.github.io/tfhe/\">[TFHE]</a>,\n<a href=\"https://eprint.iacr.org/2013/340\">[GSW13]</a>) to make these ideas more\npractical. By the end of this post you should have a basic understanding of\nhow such a construction may work.</p>\n<p>Besides the traditional encryption (<span><span><span>Enc\\mathsf{Enc}</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>n</span><span>c</span></span></span></span></span></span>), decryption\n(<span><span><span>Dec\\mathsf{Dec}</span><span aria-hidden=\"true\"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span>) and key generation (<span><span><span>Keygen\\mathsf{Keygen}</span><span aria-hidden=\"true\"><span><span></span><span><span>K</span><span>e</span><span>y</span><span>g</span><span>e</span><span>n</span></span></span></span></span></span>) algorithms, an HE\nscheme also uses <em>an evaluation algorithm</em> (<span><span><span>Eval\\mathsf{Eval}</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span>). <strong>This is the\ndistinguishing feature that makes computations on encrypted data possible.</strong>\nüí• Let's consider the following example: Alice holds some personal\ninformation <span><span><span>xx</span><span aria-hidden=\"true\"><span><span></span><span>x</span></span></span></span></span> (e.g. her medical records and her family's medical history).\nThere is also a company that makes very good predictions based on this kind\nof information, using a refined model, expressed as the functionality <span><span><span>FF</span><span aria-hidden=\"true\"><span><span></span><span>F</span></span></span></span></span>\n(e.g. a well chosen machine learning model). On one hand, Alice is very interested in these\npredictions but is also reluctant to trust the company with her sensitive\ninformation. On the other hand, the company can't just give their model to\nAlice to make the predictions herself. A solution using Homomorphic\nEncryption is given in the picture below. Some important things to notice are:</p>\n<ul>\n<li>Alice sends her data <strong>encrypted</strong>, so the company never learns anything about <span><span><span>xx</span><span aria-hidden=\"true\"><span><span></span><span>x</span></span></span></span></span>.</li>\n<li>Computing on the encrypted data <span><span><span>CC</span><span aria-hidden=\"true\"><span><span></span><span>C</span></span></span></span></span> does <strong>not involve</strong> Alice's secret key <span><span><span>sksk</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span>k</span></span></span></span></span>. Only her public key <span><span><span>pkpk</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>k</span></span></span></span></span> is used.</li>\n<li>To obtain <span><span><span>C‚Ä≤C'</span><span aria-hidden=\"true\"><span><span></span><span><span>C</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> as the encryption of <span><span><span>F(x)F(x)</span><span aria-hidden=\"true\"><span><span></span><span>F</span><span>(</span><span>x</span><span>)</span></span></span></span></span>, the evaluation algorithm uses the description of <span><span><span>FF</span><span aria-hidden=\"true\"><span><span></span><span>F</span></span></span></span></span> to do computations on <span><span><span>CC</span><span aria-hidden=\"true\"><span><span></span><span>C</span></span></span></span></span> (which encrypts <span><span><span>xx</span><span aria-hidden=\"true\"><span><span></span><span>x</span></span></span></span></span>).</li>\n<li>By using her secret key, <span><span><span>sksk</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span>k</span></span></span></span></span>, Alice manages to recover the information that interests her, namely <span><span><span>F(x)F(x)</span><span aria-hidden=\"true\"><span><span></span><span>F</span><span>(</span><span>x</span><span>)</span></span></span></span></span>.</li>\n</ul>\n<p><img src=\"/galleries/homomorphic2020/alice.png\" alt=\"alice_overview\"></p>\n<h3>A closer look at the Eval algorithm üîé</h3>\n<p>All the existing HE constructions are <em>homomorphic</em> with respect to two basic\noperations: some kind of <em>addition</em> and some kind of <em>multiplication</em> (e.g.\n<span><span><span>++</span><span aria-hidden=\"true\"><span><span></span><span>+</span></span></span></span></span> and <span><span><span>√ó\\times</span><span aria-hidden=\"true\"><span><span></span><span>√ó</span></span></span></span></span> over the integers or the binary operations <span><span><span>XOR\\mathsf{XOR}</span><span aria-hidden=\"true\"><span><span></span><span><span>X</span><span>O</span><span>R</span></span></span></span></span></span>\nand <span><span><span>AND\\mathsf{AND}</span><span aria-hidden=\"true\"><span><span></span><span><span>A</span><span>N</span><span>D</span></span></span></span></span></span>, etc.). What we mean is that the scheme allows the\nefficient computation of <span><span><span>caddc_{add}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> from the individual ciphertexts\n<span><span><span>c1=Enc(pk,m1)c_1=\\mathsf{Enc}(pk,m_1)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>c2=Enc(pk,m2)c_2=\\mathsf{Enc}(pk,m_2)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> such that the\ndecryption of <span><span><span>caddc_{add}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> yields <span><span><span>m1+m2m_1+m_2</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p><img src=\"/galleries/homomorphic2020/eval_sum.png\" alt=\"summation\"></p>\n<p>Analogously, the ciphertext <span><span><span>cmulc_{mul}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> corresponding to multiplication, that\ndecrypts to <span><span><span>m1√óm2m_1\\times m_2</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, is efficiently computable from the individual\nciphertexts <span><span><span>c1=Enc(pk,m1)c_1=\\mathsf{Enc}(pk,m_1)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> and <span><span><span>c2=Enc(pk,m2)c_2=\\mathsf{Enc}(pk,m_2)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>,\nrespectively.</p>\n<p><img src=\"/galleries/homomorphic2020/eval_mul.png\" alt=\"multiplication\"></p>\n<p>For instance:</p>\n<ul>\n<li>the <a href=\"https://en.wikipedia.org/wiki/RSA_(cryptosystem)\"><strong>RSA</strong></a> encryption: <span><span><span>Ence,NRSA(m):=me‚Äämod‚ÄäN\\mathsf{Enc}^{\\mathsf{RSA}}_{e,N}(m):=m^e \\bmod N</span><span aria-hidden=\"true\"><span><span></span><span><span><span>E</span><span>n</span><span>c</span></span><span><span><span><span><span><span></span><span><span><span>e</span><span>,</span><span>N</span></span></span></span><span><span></span><span><span><span><span>R</span><span>S</span><span>A</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>m</span><span>)</span><span></span><span>:</span></span><span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>e</span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>N</span></span></span></span></span>  is multiplicatively homomorphic as <span><span><span>m1e‚ãÖm2e‚Äämod‚ÄäN=(m1‚ãÖm2)e‚Äämod‚ÄäNm_1^e \\cdot m_2^e \\bmod N = (m_1 \\cdot m_2)^{e} \\bmod N</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span>e</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span>e</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>N</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span><span><span><span><span><span><span></span><span><span><span>e</span></span></span></span></span></span></span></span></span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>N</span></span></span></span></span></li>\n<li>the <a href=\"https://en.wikipedia.org/wiki/ElGamal_encryption\"><strong>El-Gamal</strong></a> encryption: <span><span><span>Encg,hEG(m)=(gr,hr‚ãÖm)\\mathsf{Enc}^{\\mathsf{EG}}_{g,h}(m)=(g^r,h^r\\cdot m)</span><span aria-hidden=\"true\"><span><span></span><span><span><span>E</span><span>n</span><span>c</span></span><span><span><span><span><span><span></span><span><span><span>g</span><span>,</span><span>h</span></span></span></span><span><span></span><span><span><span><span>E</span><span>G</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>m</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span>r</span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span>r</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span>)</span></span></span></span></span>. It is easy to verify that the multiplicative property holds:</li>\n</ul>\n<p><span><span><span>(gr1,hr1‚ãÖm1)‚ãÖ(gr2,hr2‚ãÖm2)=(gr1+r2,hr1+r2‚ãÖ(m1‚ãÖm2)). (g^{r_1},h^{r_1}\\cdot m_1)\\cdot (g^{r_2},h^{r_2}\\cdot m_2) =(g^{r_1+r_2},h^{r_1+r_2}\\cdot (m_1\\cdot m_2)).</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>g</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>,</span><span></span><span><span>h</span><span><span><span><span><span><span></span><span><span><span><span>r</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>+</span><span><span>r</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>)</span><span>.</span></span></span></span></span></p>\n<p>All the existing HE schemes support only two types of computations on the encrypted data: some forms of addition and multiplication. This means that the <span><span><span>Eval\\mathsf{Eval}</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span> algorithm works only for functionalities <span><span><span>FF</span><span aria-hidden=\"true\"><span><span></span><span>F</span></span></span></span></span> that can be expressed using additions (<span><span><span>++</span><span aria-hidden=\"true\"><span><span></span><span>+</span></span></span></span></span>) and multiplications (<span><span><span>√ó\\times</span><span aria-hidden=\"true\"><span><span></span><span>√ó</span></span></span></span></span>). Another way of saying this is that HE schemes support only arithmetic circuits with addition/multiplication gates. Below we can view as an arithmetic circuit the functionality <span><span><span>F(m1,m2,m3,m4)=m1√óm2√óm4+m3√óm4F(m_1,m_2,m_3,m_4)= m_1\\times m_2\\times m_4 + m_3\\times m_4</span><span aria-hidden=\"true\"><span><span></span><span>F</span><span>(</span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p><img src=\"/galleries/homomorphic2020/arithmetic_circuit.png\" alt=\"arithmetic_circuit\"></p>\n<h3>Why focus on homomorphisms with respect to <em>two</em> operations?</h3>\n<p>In principle, any functionality can be expressed using only two basic operations. For example, any binary circuit can be obtained using <a href=\"https://en.wikipedia.org/wiki/NAND_gate\">NAND</a> gates exclusively. In turn, a NAND operation consists of one addition and one multiplication: <span><span><span>NAND(a,b)=a√ób+1‚Äämod‚Ää2\\mathsf{NAND}(a,b)=a\\times b + 1\\bmod 2</span><span aria-hidden=\"true\"><span><span></span><span><span>N</span><span>A</span><span>N</span><span>D</span></span><span>(</span><span>a</span><span>,</span><span></span><span>b</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>a</span><span></span><span>√ó</span><span></span></span><span><span></span><span>b</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>2</span></span></span></span></span>, for any bits <span><span><span>a,b‚àà{0,1}a,b \\in \\{0,1\\}</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>,</span><span></span><span>b</span><span></span><span>‚àà</span><span></span></span><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>}</span></span></span></span></span>.</p>\n<p>üí° Therefore it is enough to have an HE scheme that supports an\nunlimited number of additions and multiplications to be able to make any\nefficient computation we can think of on encrypted data.</p>\n<h3>Homomorphic Encryption and \"noisy\" ciphertexts</h3>\n<p>The most practical HE constructions rely on the hardness of the <a href=\"https://en.wikipedia.org/wiki/Ring_learning_with_errors\">Ring\nLearning With Errors\n(RLWE)</a> problem for\ntheir security, as is the case with many <a href=\"https://en.wikipedia.org/wiki/Lattice-based_cryptography\">lattice-based\ncryptographic</a>\nconstructions. The inherent <strong>\"noise\"</strong> of the RLWE problem is inherited by\nall the schemes that are based on it. In particular, this \"noise\" element is\npresent in every HE ciphertext and has a great impact on the parameters of\nthe scheme.</p>\n<p><img src=\"/galleries/homomorphic2020/noisy_cyphertext.png\" alt=\"noisy_cyphertext\"></p>\n<p>The noise grows with every addition or multiplication we do on the\nciphertexts. This is very relevant as decryption stops working correctly once\nthe noise exceeds a certain threshold.</p>\n<p>Because of this phenomenon, the number of multiplications and additions that\ncan be carried out correctly on the ciphertext is limited. üí• The\nparameters of such a scheme can be generated such that it can handle a\nminimum number of operations. But this minimum number must be decided in\nadvance to set the parameters accordingly. We usually call such a scheme\n<em>Somewhat Homomorphic Encryption</em> (SHE) scheme. When the construction allows\nan unbounded number of operations, we call such a scheme <em>Fully Homomorphic\nEncryption</em> (FHE). Even though we are not going to discuss it any further, we\nhave to mention that it's possible to obtain FHE from SHE. In fact, Gentry\n<a href=\"https://www.cs.cmu.edu/~odonnell/hits09/gentry-homomorphic-encryption.pdf\">showed</a>\nhow to transform any SHE (that can homomorphically evaluate its own\ndecryption circuit) to FHE, through a computationally expensive process\ncalled <em>bootstrapping</em>. For applications that don't require many homomorphic\nevaluations SHE is preferred, as we want to avoid the computational overhead\nof the boostrapping.</p>\n<h2>2. A SHE scheme example</h2>\n<p>For the remaining of this blog post we will try to make the concepts that we\nhave already presented more concrete, by discussing a <em>toy implementation</em> of\nthe SHE scheme construction of <a href=\"https://eprint.iacr.org/2012/144\">[FV12]</a>.\nOur main goal is to understand how <em>relinearization</em> and <em>modulus-switching</em>\nare used to obtain ciphertext multiplication.</p>\n<p><strong>Notations:</strong> For an integer <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>, by <span><span><span>Zq\\mathbb{Z}_q</span><span aria-hidden=\"true\"><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> we mean the set\n<span><span><span>{0,1,‚Ä¶,q‚àí1}\\{0,1,\\ldots,q-1\\}</span><span aria-hidden=\"true\"><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>,</span><span></span><span>‚Ä¶</span><span></span><span>,</span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>. We denote by <span><span><span>[a]q[a]_q</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>a</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> the remainder of <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> <em>modulo</em> <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>.\nFor example <span><span><span>[18]7=4[18]_7 = 4</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>1</span><span>8</span><span><span>]</span><span><span><span><span><span><span></span><span><span>7</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>4</span></span></span></span></span>. When rounding to the nearest integer, we use\n<span><span><span>‚åä‚ãÖ‚åâ\\lfloor \\cdot \\rceil</span><span aria-hidden=\"true\"><span><span></span><span>‚åä</span><span>‚ãÖ</span><span>‚åâ</span></span></span></span></span>. The basic elements we work with will not be integers,\nbut merely <em>polynomials with integer coefficients</em>. We also work with <em>noisy\npolynomials</em>, whose coefficients are sampled according to some error\ndistribution <span><span><span>œá\\chi</span><span aria-hidden=\"true\"><span><span></span><span>œá</span></span></span></span></span>. We bound such errors by their largest absolute value of\ntheir coefficients, denoted as <span><span><span>‚à•‚ãÖ‚à•\\|\\cdot\\|</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>‚à•</span></span></span></span></span>.</p>\n<h3>Quick recap on working with polynomials</h3>\n<p>The HE scheme we are going to describe deals with <em>adding and multiplying\npolynomials</em>. Here we present a quick example of how to work with\npolynomials, so that we all have the same starting point. If you already know\nhow to do this, you can skip it.</p>\n<p>First thing, let's add and multiply polynomials <em>modulo some polynomial <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span></em>.\nThis \"modulo <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span>\" thing simply means that we add and multiply the polynomials\nin the usual way, but we take the remainders of the results when divided by\n<span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span>. When we do these additions and multiplications <span><span><span>‚Äämod‚Ääf\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, we sometimes\nsay in a fancy way that we are working in the <em>ring</em> <span><span><span>Z[x]/(f)\\mathbb{Z}[x]/(f)</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span> of\nreduced polynomials.üíç</p>\n<p>Let's take <span><span><span>f=x4+1f = x^4 +1</span><span aria-hidden=\"true\"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. If we look at <span><span><span>p(x)=x5p(x) =x^5</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span>,\nthen <span><span><span>p(x)=x‚ãÖ(x4+1)‚àíxp(x) = x \\cdot (x^4 + 1) - x</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>x</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Therefore, when taking the reminder we get\n<span><span><span>p(x)=‚àíx‚Äämod‚Ääfp(x) = -x \\bmod f</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>‚àí</span><span>x</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span></span></span></span></span>. For faster computations <span><span><span>‚Äämod‚Ääf\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span> you can use this trick:\nwhen making <span><span><span>‚Äämod‚Ääf\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>, simply replace <span><span><span>x4x^4</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>‚àí1-1</span><span aria-hidden=\"true\"><span><span></span><span>‚àí</span><span>1</span></span></span></span></span>, <span><span><span>x5x^5</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span></span></span></span></span> by <span><span><span>‚àíx-x</span><span aria-hidden=\"true\"><span><span></span><span>‚àí</span><span>x</span></span></span></span></span> and so on.</p>\n<p>Let's consider two polynomials <span><span><span>a(x)=x3+x2+7a(x) = x^3 + x^2 + 7</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span> and <span><span><span>b(x)=x2+11xb(x) = x^2 + 11x</span><span aria-hidden=\"true\"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span>.\nThen:</p>\n<div><span><span><span>a(x)+b(x)‚Äämod‚Ääf=x3+2x2+11x+7¬†mod¬†f.a(x)+b(x) \\bmod f = x^3 + 2x^2 + 11x + 7 \\text { mod }f.</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span></span><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>7</span><span><span>¬†mod¬†</span></span><span>f</span><span>.</span></span></span></span></span></div>\n<p>Here nothing special happened. Let's multiply them:</p>\n<div><span><span><span>a(x)‚ãÖb(x)‚Äämod‚Ääf=(x3+x2+7)‚ãÖ(x2+11x)¬†mod¬†f=x5+11x4+x4+11x3+7x2+77x¬†mod¬†f=‚àíx‚àí11‚àí1+11x3+7x2+77x¬†mod¬†f=11x3+7x2+76x‚àí12¬†mod¬†f.\\begin{aligned}\na(x) \\cdot b(x) \\bmod f\n    &#x26;= (x^3 + x^2 + 7)\\cdot (x^2 +11x) \\text { mod }f \\\\\n    &#x26;= x^5 + 11x^4 + x^4 + 11x^3 + 7x^2 + 77x \\text { mod }f\\\\\n    &#x26;= -x - 11 - 1 + 11x^3 + 7x^2 + 77x \\text { mod }f \\\\\n    &#x26;= 11x^3 + 7x^2 + 76x - 12 \\text { mod }f.\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span></span><span>f</span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span>x</span><span>)</span><span><span>¬†mod¬†</span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span>¬†mod¬†</span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>‚àí</span><span>x</span><span></span><span>‚àí</span><span></span><span>1</span><span>1</span><span></span><span>‚àí</span><span></span><span>1</span><span></span><span>+</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>7</span><span>x</span><span><span>¬†mod¬†</span></span><span>f</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>1</span><span>1</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>7</span><span>6</span><span>x</span><span></span><span>‚àí</span><span></span><span>1</span><span>2</span><span><span>¬†mod¬†</span></span><span>f</span><span>.</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>These operations are implemented\n<a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L7\">here</a>\nand make use of the cool\n<a href=\"https://numpy.org/doc/stable/reference/routines.polynomials.html\">Numpy</a>\nlibrary:</p>\n<div><pre><code><span>import</span><span> </span>numpy<span> </span><span>as</span><span> </span>np<span></span>\n<span></span><span>from</span><span> </span>numpy<span>.</span>polynomial<span> </span><span>import</span><span> </span>polynomial<span> </span><span>as</span><span> </span>poly<span></span>\n<span></span><span></span>\n<span></span><span>#------Functions<span> </span>for<span> </span>polynomial<span> </span>evaluations<span> </span>mod<span> </span>poly_mod<span> </span>only------</span><span></span>\n<span></span><span>def</span><span> </span><span>polymul_wm</span><span>(</span>x<span>,</span><span> </span>y<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Multiply<span> </span>two<span> </span>polynomials<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>x,<span> </span>y:<span> </span>two<span> </span>polynomials<span> </span>to<span> </span>be<span> </span>multiplied.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>A<span> </span>polynomial<span> </span>in<span> </span>Z[X]/(poly_mod).<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>poly<span>.</span>polydiv<span>(</span>poly<span>.</span>polymul<span>(</span>x<span>,</span><span> </span>y<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span>[</span><span>1</span><span>]</span><span> </span><span></span>\n<span></span><span>def</span><span> </span><span>polyadd_wm</span><span>(</span>x<span>,</span><span> </span>y<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Add<span> </span>two<span> </span>polynomials<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>x,<span> </span>y:<span> </span>two<span> </span>polynomials<span> </span>to<span> </span>be<span> </span>added.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>A<span> </span>polynomial<span> </span>in<span> </span>Z[X]/(poly_mod).<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>poly<span>.</span>polydiv<span>(</span>poly<span>.</span>polyadd<span>(</span>x<span>,</span><span> </span>y<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span>[</span><span>1</span><span>]</span><span> </span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>Now let's go one step further and see how we perform these operations of\npolynomials not just modulo <span><span><span>ff</span><span aria-hidden=\"true\"><span><span></span><span>f</span></span></span></span></span>, <em>but also modulo some integer <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span></em>. As you\nmight expect, the coefficients of these polynomials are also reduced modulo\n<span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>, so they always take integer values from <span><span><span>00</span><span aria-hidden=\"true\"><span><span></span><span>0</span></span></span></span></span> to <span><span><span>q‚àí1.q-1.</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>.</span></span></span></span></span> This time, we say\nthat we are working the ring of reduced polynomials <span><span><span>Zq[x]/(f)\\mathbb{Z}_q[x]/(f)</span><span aria-hidden=\"true\"><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span>f</span><span>)</span></span></span></span></span>.\nüíç</p>\n<p>Let's take the previous example, <span><span><span>f=x4+1f = x^4+1</span><span aria-hidden=\"true\"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, <span><span><span>a(x)=x3+x2+7a(x)=x^3+x^2+7</span><span aria-hidden=\"true\"><span><span></span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>7</span></span></span></span></span>,\n<span><span><span>b(x)=x2+11xb(x)=x^2+11x</span><span aria-hidden=\"true\"><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>1</span><span>x</span></span></span></span></span> and consider <span><span><span>q=5q =5</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>5</span></span></span></span></span>. We can think of <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> and <span><span><span>bb</span><span aria-hidden=\"true\"><span><span></span><span>b</span></span></span></span></span> as already\ntaken <span><span><span>‚Äämod‚Ääf\\bmod f</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>f</span></span></span></span></span>. If we take them further modulo <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>, then <span><span><span>[a(x)]q=x3+x2+2[a(x)]_q = x^3 +\nx^2 +2</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span> and <span><span><span>[b(x)]q=x2+x[b(x)]_q = x^2+x</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span></span></span></span></span>. Moreover,</p>\n<div><span><span><span>[a(x)+b(x)]q=x3+x2+2+x2+x=x3+2x2+x+2[a(x) + b(x)]_q = x^3 + x^2 +2+ x^2 + x = x^3 + 2x^2 + x+2</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span></span><span>+</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>2</span></span></span></span></span></div>\n<p>and</p>\n<div><span><span><span>[a(x)‚ãÖb(x)]q=(x3+x2+2)‚ãÖ(x2+x)=x5+x4+x4+x3+2x2+2x=‚àíx‚àí1‚àí1+x3+2x2+2x=x3+2x2+x+3\\begin{aligned}\n[a(x) \\cdot b(x)]_q\n    &#x26;= (x^3 + x^2+2) \\cdot (x^2 + x)\\\\\n    &#x26;= x^5 + x^4 + x^4 +x^3+2x^2 + 2x\\\\\n    &#x26;= -x -1 -1 + x^3 +2x^2+2x\\\\\n    &#x26;= x^3+2x^2+x+3\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>a</span><span>(</span><span>x</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>b</span><span>(</span><span>x</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>5</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>‚àí</span><span>x</span><span></span><span>‚àí</span><span></span><span>1</span><span></span><span>‚àí</span><span></span><span>1</span><span></span><span>+</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span>x</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>2</span><span><span>x</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>x</span><span></span><span>+</span><span></span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>where at the last but one equality we performed modulo <span><span><span>f=x4+1f = x^4+1</span><span aria-hidden=\"true\"><span><span></span><span>f</span><span></span><span>=</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>4</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> and at the last one, modulo <span><span><span>q=5q=5</span><span aria-hidden=\"true\"><span><span></span><span>q</span><span></span><span>=</span><span></span></span><span><span></span><span>5</span></span></span></span></span>.</p>\n<p>These operations already mentioned are <span><span><span>polyadd\\texttt{polyadd}</span><span aria-hidden=\"true\"><span><span></span><span><span>polyadd</span></span></span></span></span></span> and\n<span><span><span>polymul\\texttt{polymul}</span><span aria-hidden=\"true\"><span><span></span><span><span>polymul</span></span></span></span></span></span> implemented\n<a href=\"https://github.com/Bitdefender-Crypto-Team/he-scheme/blob/main/rlwe_he_scheme_updated.py\">here</a>.</p>\n<h3>The Fan-Vercauteren ([FV12]) scheme</h3>\n<p>Next, we recall the basic (<span><span><span>Keygen\\mathsf{Keygen}</span><span aria-hidden=\"true\"><span><span></span><span><span>K</span><span>e</span><span>y</span><span>g</span><span>e</span><span>n</span></span></span></span></span></span>, <span><span><span>Enc\\mathsf{Enc}</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>n</span><span>c</span></span></span></span></span></span>, <span><span><span>Dec\\mathsf{Dec}</span><span aria-hidden=\"true\"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span>)\nalgorithms of <a href=\"https://eprint.iacr.org/2012/144.pdf\"><strong>the [FV12] scheme</strong></a>.\nThese (almost identical) algorithms have already been described\n<a href=\"https://blog.openmined.org/build-an-homomorphic-encryption-scheme-from-scratch-with-python/#buildanhomomorphicencryptionscheme\">here</a>,\nbut for the sake of completeness, we present them as well. Then we will\nexplain in detail the core of the <span><span><span>Eval\\mathsf{Eval}</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span> algorithm: the addition and\nmultiplication of the ciphertexts. <em>Spoiler alert</em>: We will primarily focus\non the two <em>Relinearization</em> techniques that enable ciphertext\nmultiplication.</p>\n<p>Let <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> be power of 2. We call a positive integer <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> the <em>plaintext\nmodulus</em> and a positive integer <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span> as the <em>ciphertext modulus</em>. We set\n<span><span><span>Œî=‚åäq/t‚åã\\Delta = \\lfloor q/t \\rfloor</span><span aria-hidden=\"true\"><span><span></span><span>Œî</span><span></span><span>=</span><span></span></span><span><span></span><span>‚åä</span><span>q</span><span>/</span><span>t</span><span>‚åã</span></span></span></span></span>. The scheme involves adding and multiplying\npolynomials in <span><span><span>Rt=Zt[x]/(xn+1)R_t = \\mathbb{Z}_t[x]/(x^n+1)</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>, on the plaintext side, and\nadding and multiplying polynomials in <span><span><span>Rq=Zq[x]/(xn+1)R_q = \\mathbb{Z}_q[x]/(x^n+1)</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>, on the\nciphertext side. We also denote by <span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span> the ring <span><span><span>Z[x]/(xn+1).\\mathbb{Z}[x]/(x^n+1).</span><span aria-hidden=\"true\"><span><span></span><span><span>Z</span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span>.</span></span></span></span></span></p>\n<p><strong>Disclaimer</strong>: From now on all polynomial operations are\nassumed to be mod <span><span><span>xn+1x^n+1</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, even if we don't mention it every time.</p>\n<p>Here is the <strong>high level of the scheme</strong>:</p>\n<p><img src=\"/galleries/homomorphic2020/he_scheme5.png\" alt=\"he_scheme5\"></p>\n<p>‚û°Ô∏è <span><span><span>Keygen\\mathsf{Keygen}</span><span aria-hidden=\"true\"><span><span></span><span><span>K</span><span>e</span><span>y</span><span>g</span><span>e</span><span>n</span></span></span></span></span></span>: The <em>secret key</em> <span><span><span>sksk</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span>k</span></span></span></span></span> is a secret binary polynomial <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> in <span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span>, i.e. its coefficients are either 0 or 1. The <em>public key</em> <span><span><span>pkpk</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>k</span></span></span></span></span> is created as follows: we sample <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> uniformly over <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and an error <span><span><span>ee</span><span aria-hidden=\"true\"><span><span></span><span>e</span></span></span></span></span> according to some error distribution <span><span><span>œá\\chi</span><span aria-hidden=\"true\"><span><span></span><span>œá</span></span></span></span></span> over <span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span> and output <span><span><span>pk=([‚àí(a‚ãÖs+e)]q,a)‚ààRq√óRqpk = ([-(a\\cdot s+e)]_q,a) \\in R_q \\times R_q</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span>a</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>a</span><span>)</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>Notice that hardness of the\n<a href=\"https://en.wikipedia.org/wiki/Ring_learning_with_errors#The_RLWE_Problem\">RLWE</a>\nproblem prevents the computation of the secret <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span> from the public key.</p>\n<p>The way we generate the uniform polynomials and the binary polynomials is\nimplemented as <span><span><span>gen_uniform_poly\\texttt{gen\\_uniform\\_poly}</span><span aria-hidden=\"true\"><span><span></span><span><span>gen_uniform_poly</span></span></span></span></span></span> and as\n<span><span><span>gen_binary_poly\\texttt{gen\\_binary\\_poly}</span><span aria-hidden=\"true\"><span><span></span><span><span>gen_binary_poly</span></span></span></span></span></span> respectively. The error distribution <span><span><span>œá\\chi</span><span aria-hidden=\"true\"><span><span></span><span>œá</span></span></span></span></span> is\nusually taken as a discretized variant of the\n<a href=\"https://en.wikipedia.org/wiki/Normal_distribution\"><em>Normal distribution</em></a>, over\n<span><span><span>Zn\\mathbb{Z}^n</span><span aria-hidden=\"true\"><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span></span></span></span></span>, and is implemented as <span><span><span>gen_normal_poly\\texttt{gen\\_normal\\_poly}</span><span aria-hidden=\"true\"><span><span></span><span><span>gen_normal_poly</span></span></span></span></span></span>.\nThey can be found\n<a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L118\">here</a>.</p>\n<div><pre><code><span>def</span><span> </span><span>keygen</span><span>(</span>size<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std1<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Generate<span> </span>a<span> </span>public<span> </span>and<span> </span>secret<span> </span>keys.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>the<span> </span>polynoms<span> </span>for<span> </span>the<span> </span>public<span> </span>and<span> </span>secret<span> </span>keys.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>modulus:<span> </span>coefficient<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>std1:<span> </span>standard<span> </span>deviation<span> </span>of<span> </span>the<span> </span>error.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Public<span> </span>and<span> </span>secret<span> </span>key.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>s<span> </span><span>=</span><span> </span>gen_binary_poly<span>(</span>size<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>gen_uniform_poly<span>(</span>size<span>,</span><span> </span>modulus<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>e<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std1<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>polyadd<span>(</span>polymul<span>(</span><span>-</span>a<span>,</span><span> </span>s<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span><span>-</span>e<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>b<span>,</span><span> </span>a<span>)</span><span>,</span><span> </span>s<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>‚û°Ô∏è <span><span><span>Enc\\mathsf{Enc}</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>n</span><span>c</span></span></span></span></span></span>: To encrypt a <em>plaintext</em> <span><span><span>m‚ààRtm \\in R_t</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, we let <span><span><span>pk=(pk0,pk1)pk = (pk_0, pk_1)</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, sample <span><span><span>u,e1,e2u, e_1, e_2</span><span aria-hidden=\"true\"><span><span></span><span>u</span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> according to <span><span><span>œá\\chi</span><span aria-hidden=\"true\"><span><span></span><span>œá</span></span></span></span></span> over <span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span> and output the <em>ciphertext</em></p>\n<div><span><span><span>Enc(pk,m)=([pk0‚ãÖu+e1+Œî‚ãÖm]q,[pk1‚ãÖu+e2]q)‚ààRq√óRq\\mathsf{Enc}(pk,m) = ([pk_0 \\cdot u +e_1 + \\Delta \\cdot m]_q,[pk_1 \\cdot u + e_2]_q) \\in R_q \\times R_q</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>m</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>[</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>u</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Due to the <a href=\"https://en.wikipedia.org/wiki/Ring_learning_with_errors#The_RLWE_Problem\">RLWE</a> assumption, the ciphertexts \"look\" uniformly random to a possible attacker, so they don't reveal any information about the plaintext.</p>\n<p>In the piece of <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L188\">code</a> below, the message we want to encrypt, <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span>, is an integer vector of length at most <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span>, with entries in the set <span><span><span>{0,1,‚Ä¶,t‚àí1}\\{0, 1,\\ldots, t-1\\}</span><span aria-hidden=\"true\"><span><span></span><span>{</span><span>0</span><span>,</span><span></span><span>1</span><span>,</span><span></span><span>‚Ä¶</span><span></span><span>,</span><span></span><span>t</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>}</span></span></span></span></span>. Before we encode it as a polynomial in <span><span><span>m‚ààRtm \\in R_t</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, we pad it with enough zeros to make it a length <span><span><span>nn</span><span aria-hidden=\"true\"><span><span></span><span>n</span></span></span></span></span> vector.</p>\n<div><pre><code><span>def</span><span> </span><span>encrypt</span><span>(</span>pk<span>,</span><span> </span>size<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>m<span>,</span><span> </span>std1<span>)</span><span>:</span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Encrypt<span> </span>an<span> </span>integer<span> </span>vector<span> </span>pt.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>pk:<span> </span>public-key.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>polynomials.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>m:<span> </span>plaintext<span> </span>message,<span> </span>as<span> </span>an<span> </span>integer<span> </span>vector<span> </span>(of<span> </span>length<span> </span>&#x3C;=<span> </span>size)<span> </span>with<span> </span>entries<span> </span>mod<span> </span>t.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>m<span> </span><span>=</span><span> </span>np<span>.</span>array<span>(</span>m<span> </span><span>+</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>size<span> </span><span>-</span><span> </span><span>len</span><span>(</span>m<span>)</span><span>)</span><span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span> </span><span>%</span><span> </span>t<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>delta<span> </span><span>=</span><span> </span>q<span> </span><span>//</span><span> </span>t<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>scaled_m<span> </span><span>=</span><span> </span>delta<span> </span><span>*</span><span> </span>m<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>e1<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std1<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>e2<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std1<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>u<span> </span><span>=</span><span> </span>gen_binary_poly<span>(</span>size<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct0<span> </span><span>=</span><span> </span>polyadd<span>(</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polyadd<span>(</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul<span>(</span>pk<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>u<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>e1<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>scaled_m<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct1<span> </span><span>=</span><span> </span>polyadd<span>(</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul<span>(</span>pk<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>u<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>e2<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>ct0<span>,</span><span> </span>ct1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>‚û°Ô∏è <span><span><span>Dec\\mathsf{Dec}</span><span aria-hidden=\"true\"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span>: Given a ciphertext <span><span><span>ct=Enc(pk,m)=(ct0,ct1)ct = \\mathsf{Enc}(pk,m)=(ct_0, ct_1)</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>m</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, we decrypt it using the secret key <span><span><span>sk=ssk=s</span><span aria-hidden=\"true\"><span><span></span><span>s</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>s</span></span></span></span></span> as follows:</p>\n<div><span><span><span>Dec(sk,ct)=[‚åät‚ãÖ[ct0+ct1‚ãÖs]qq‚åâ]t‚ààRt\\mathsf{Dec}(sk,ct) = \\Bigg[ \\Bigg\\lfloor \\frac{t\\cdot [ct_0+ct_1\\cdot s]_q}{q} \\Bigg\\rceil \\Bigg]_t \\in R_t</span><span aria-hidden=\"true\"><span><span></span><span><span>D</span><span>e</span><span>c</span></span><span>(</span><span>s</span><span>k</span><span>,</span><span></span><span>c</span><span>t</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>[</span></span><span><span>‚åä</span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>t</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>‚åâ</span></span><span><span><span>]</span></span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>\n<p>‚õî Let's stop for a bit and check together how the <span><span><span>Dec\\mathsf{Dec}</span><span aria-hidden=\"true\"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span> algorithm works. The intuition behind it is that <span><span><span>pk0+pk1‚ãÖskpk_0 + pk_1\\cdot sk</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span>k</span></span></span></span></span> is \"small\". This implies that <span><span><span>ct0+ct1‚ãÖskct_0 + ct_1\\cdot sk</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span>k</span></span></span></span></span> is \"close\" to the scaled message <span><span><span>Œî‚ãÖm\\Delta \\cdot m</span><span aria-hidden=\"true\"><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span></span></span></span></span>. To recover the message <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span>, we get rid of <span><span><span>Œî\\Delta</span><span aria-hidden=\"true\"><span><span></span><span>Œî</span></span></span></span></span> <span><span><span>(‚âàq/t)(\\approx q/t)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>‚âà</span><span></span></span><span><span></span><span>q</span><span>/</span><span>t</span><span>)</span></span></span></span></span> and then apply rounding to shave off the \"small\" noise. Let's check that this intuition actually works.</p>\n<p>First, we set the notation <span><span><span>ct(s):=ct0+ct1‚ãÖsct(s) := ct_0 + ct_1 \\cdot s</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>:</span></span><span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span></span></span></span></span>, which we'll frequently use for the rest of the post. If we perform this computation, we will end up getting <em>a noisy scaled variant of the plaintext</em>, namely <span><span><span>Œî‚ãÖm+v\\Delta \\cdot m+v</span><span aria-hidden=\"true\"><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span></span></span></span></span>!</p>\n<p>If we go back to see how <span><span><span>ctct</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span></span></span></span></span> and <span><span><span>pkpk</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span>k</span></span></span></span></span> were defined, we get:</p>\n<div><span><span><span>[ct(s)]q=[(pk0‚ãÖu+e1+Œî‚ãÖm)+(pk1‚ãÖu+e2)‚ãÖs]q=[‚àí(a‚ãÖs+e)‚ãÖu+e1+Œî‚ãÖm+a‚ãÖu‚ãÖs+e2‚ãÖs]q=Œî‚ãÖm‚àíe‚ãÖu+e1+e2‚ãÖs=Œî‚ãÖm+v,\\begin{aligned}\n[ct(s)]_q &#x26;= [(pk_0 \\cdot u + e_1 + \\Delta \\cdot m) + (pk_1 \\cdot u + e_2) \\cdot s]_q\\\\\n    &#x26;= [-(a\\cdot s + e)\\cdot u+e_1 + \\Delta \\cdot m + a \\cdot u \\cdot s + e_2 \\cdot s]_q\\\\\n    &#x26;= \\Delta \\cdot m - e \\cdot u + e_1 + e_2 \\cdot s\\\\\n    &#x26;= \\Delta \\cdot m + v,\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span></span></span><span><span></span><span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>[</span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span>)</span><span></span><span>+</span><span></span><span>(</span><span>p</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>[</span><span>‚àí</span><span>(</span><span>a</span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span>e</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span></span><span>+</span><span></span><span>a</span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span></span><span>‚àí</span><span></span><span>e</span><span></span><span>‚ãÖ</span><span></span><span>u</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>m</span><span></span><span>+</span><span></span><span>v</span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>which is nothing but the scaled plaintext <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span> with some <em>\"small\" noise</em> <span><span><span>vv</span><span aria-hidden=\"true\"><span><span></span><span>v</span></span></span></span></span>.</p>\n<p>Because we always have <span><span><span>‚à•Œî‚ãÖm+v‚à•&#x3C;q\\|\\Delta\\cdot m + v\\| &#x3C; q</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span>‚à•</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>q</span></span></span></span></span>, reducing it <span><span><span>‚Äämod‚Ääq\\bmod q</span><span aria-hidden=\"true\"><span><span></span><span></span><span><span><span>m</span><span>o</span><span>d</span></span></span><span></span><span>q</span></span></span></span></span> has no effect (e.g. <span><span><span>[4]7=4[4]_{7} = 4</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>4</span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>7</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>4</span></span></span></span></span>). As long as the noise <span><span><span>‚à•v‚à•&#x3C;Œî/2\\|v\\|&#x3C;\\Delta/2</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span>v</span><span>‚à•</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>, we can always recover the correct <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span>.</p>\n<p><img src=\"/galleries/homomorphic2020/dec_details.png\" alt=\"decoder_details\"></p>\n<p>For example, in the picture above, any green point will decrypt to <span><span><span>22</span><span aria-hidden=\"true\"><span><span></span><span>2</span></span></span></span></span> when we scale it by <span><span><span>t/qt/q</span><span aria-hidden=\"true\"><span><span></span><span>t</span><span>/</span><span>q</span></span></span></span></span> <span><span><span>(‚âà1/Œî)(\\approx 1/\\Delta)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>‚âà</span><span></span></span><span><span></span><span>1</span><span>/</span><span>Œî</span><span>)</span></span></span></span></span> and round it. Analogously, any dark-brown point will decrypt to <span><span><span>33</span><span aria-hidden=\"true\"><span><span></span><span>3</span></span></span></span></span>.</p>\n<p>We can implement this evaluation, as <span><span><span>scaled_pt\\texttt{scaled\\_pt}</span><span aria-hidden=\"true\"><span><span></span><span><span>scaled_pt</span></span></span></span></span></span> below, by performing polynomial operations in <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. You will see that this equation,</p>\n<div><span><span><span>[ct(s)]q=[ct0+ct1‚ãÖs]q=Œî‚ãÖm+v,[ct(s)]_q = [ct_0 + ct_1 \\cdot s]_q = \\Delta \\cdot m + v,</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span>,</span></span></span></span></span></div>\n<p>which we will call <em>the decryption equation</em>, becomes really useful in deriving ways of computing on ciphertexts. Here we provide the <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L219\">code</a> for the <span><span><span>Dec\\mathsf{Dec}</span><span aria-hidden=\"true\"><span><span></span><span><span>D</span><span>e</span><span>c</span></span></span></span></span></span> algorithm:</p>\n<div><pre><code><span>def</span><span> </span><span>decrypt</span><span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Decrypt<span> </span>a<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>sk:<span> </span>secret-key.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>polynomials.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct:<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Integer<span> </span>vector<span> </span>representing<span> </span>the<span> </span>plaintext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>scaled_pt<span> </span><span>=</span><span> </span>polyadd<span>(</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul<span>(</span>ct<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>sk<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_poly<span> </span><span>=</span><span> </span>np<span>.</span><span>round</span><span>(</span>t<span> </span><span>*</span><span> </span>scaled_pt<span> </span><span>/</span><span> </span>q<span>)</span><span> </span><span>%</span><span> </span>t<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>np<span>.</span>int64<span>(</span>decrypted_poly<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<h3>Homomorphic operations of [FV12]</h3>\n<p>As explained in the first part, the <span><span><span>Eval\\mathsf{Eval}</span><span aria-hidden=\"true\"><span><span></span><span><span>E</span><span>v</span><span>a</span><span>l</span></span></span></span></span></span> algorithm works only for functionalities that can be expressed using addition <span><span><span>(+)(+)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>+</span><span>)</span></span></span></span></span> or multiplication <span><span><span>(√ó)(\\times)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>√ó</span><span>)</span></span></span></span></span>.</p>\n<p>Let's take two ciphertexts <span><span><span>ct=Enc(pk,m)ct = \\mathsf{Enc}(pk,m)</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span>m</span><span>)</span></span></span></span></span> and <span><span><span>ct‚Ä≤=Enc(pk,m‚Ä≤)ct' = \\mathsf{Enc}(pk,m')</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>E</span><span>n</span><span>c</span></span><span>(</span><span>p</span><span>k</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span></span></span></span></span>. We want to see how to construct ciphertexts that decrypt both the addition, <span><span><span>m+m‚Ä≤m+m'</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>, and the multiplication, <span><span><span>m‚ãÖm‚Ä≤m\\cdot m'</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>. Also, keep in mind that when performing operations on <span><span><span>mm</span><span aria-hidden=\"true\"><span><span></span><span>m</span></span></span></span></span> and <span><span><span>m‚Ä≤m'</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>, we are actually doing them <em>modulo <span><span><span>xn+1x^n+1</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span></em> and <em>modulo <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span></em>, since these are the plaintext operations from <span><span><span>Rt=Zt[x]/(xn+1)R_t = \\mathbb{Z}_t[x]/(x^n+1)</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span>Z</span></span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>x</span><span>]</span><span>/</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span></span></span></span></span>.</p>\n<p>Let's write the decryption equations of <span><span><span>ctct</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span></span></span></span></span> and <span><span><span>ct‚Ä≤ct'</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>:</p>\n<div><span><span><span>[ct(s)]q=Œî‚ãÖm+v¬†and¬†[ct‚Ä≤(s)]q=Œî‚ãÖm‚Ä≤+v‚Ä≤.[ct(s)]_q = \\Delta \\cdot m + v \\text{ and } [ct'(s)]_q = \\Delta \\cdot m' + v'.</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span><span>¬†and¬†</span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>\n<p>‚û°Ô∏è <strong>Addition:</strong> If we simply add the decryption equations, we get</p>\n<div><span><span><span>[ct(s)]q+[ct‚Ä≤(s)]q=Œî‚ãÖ(m+m‚Ä≤)+v+v‚Ä≤.[ct(s)]_q + [ct'(s)]_q = \\Delta \\cdot (m+m') + v  + v'.</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>\n<p>But wait a sec, we need to decrypt to <span><span><span>m1+m2m_1+m_2</span><span aria-hidden=\"true\"><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> modulo <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span>! Notice that <span><span><span>m+m‚Ä≤=t‚ãÖœµ+[m+m‚Ä≤]tm + m' = t \\cdot \\epsilon + [m+m']_t</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>œµ</span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, for some binary polynomial <span><span><span>œµ\\epsilon</span><span aria-hidden=\"true\"><span><span></span><span>œµ</span></span></span></span></span>. Using the notation <span><span><span>rt(q):=q‚àíŒî‚ãÖtr_t(q):= q- \\Delta \\cdot t</span><span aria-hidden=\"true\"><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span></span><span>:</span></span><span><span></span><span>=</span><span></span></span><span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>t</span></span></span></span></span> (this is just the remainder of <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span> divided by <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span>) we get:</p>\n<div><span><span><span>[ct(s)+ct‚Ä≤(s)]q=Œî‚ãÖ[m+m‚Ä≤]t+vadd¬†mod¬†q,\\begin{aligned}\n[ct(s) + ct'(s)]_q = \\Delta \\cdot [m+m']_t + v_{add} \\text{ mod }q,\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>+</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>¬†mod¬†</span></span><span>q</span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>where <span><span><span>vadd=v+v‚Ä≤‚àírt(q)‚ãÖœµv_{add} = v+v'-r_t(q) \\cdot \\epsilon</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>v</span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚àí</span><span></span></span><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>œµ</span></span></span></span></span>.Click here if you want to see why this follows.</p>\n<div><span><span><span>[ct(s)+ct‚Ä≤(s)]q=Œî‚ãÖ[m+m‚Ä≤]t+Œî‚ãÖt‚ãÖœµ+v+v‚Ä≤=Œî‚ãÖ[m+m‚Ä≤]t+(q‚àírt(q))‚ãÖœµ+v+v‚Ä≤‚â°Œî‚ãÖ[m+m‚Ä≤]t+vadd¬†mod¬†q.\\begin{aligned}\n[ct(s) + ct'(s)]_q \n    =&#x26; \\Delta \\cdot [m+m']_t + \\Delta \\cdot t \\cdot \\epsilon + v  + v' \\\\\n    =&#x26; \\Delta \\cdot [m+m']_t + (q-r_t(q)) \\cdot \\epsilon + v+v' \\\\\n    \\equiv&#x26; \\Delta \\cdot [m+m']_t + v_{add} \\text{ mod }q.\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>+</span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span></span></span><span><span></span><span><span>=</span></span></span><span><span></span><span><span>‚â°</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>t</span><span></span><span>‚ãÖ</span><span></span><span>œµ</span><span></span><span>+</span><span></span><span>v</span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>(</span><span>q</span><span></span><span>‚àí</span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span>)</span><span></span><span>‚ãÖ</span><span></span><span>œµ</span><span></span><span>+</span><span></span><span>v</span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span><span><span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>¬†mod¬†</span></span><span>q</span><span>.</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>This suggests to set the new ciphertext as <span><span><span>cadd=(ct0+ct0‚Ä≤,¬†ct1+ct1‚Ä≤)c_{add}=(ct_0+ct'_0, \\text{ }ct_1+ct'_1)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>¬†</span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, which can be computed without the knowledge of the secret key <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>. Therefore, <span><span><span>cadd=ct+ct‚Ä≤c_{add} = ct + ct'</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span>t</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> decrypts to the sum, <span><span><span>[m+m‚Ä≤]t[m+m']_t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>m</span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, as long as the new \"noise\", <span><span><span>vaddv_{add}</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, is smaller than <span><span><span>Œî/2\\Delta/2</span><span aria-hidden=\"true\"><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>.</p>\n<p>üí° The <strong>noise growth</strong> for <strong>addition</strong> is quite slow as <span><span><span>‚à•vadd‚à•&#x3C;‚à•v‚à•+‚à•v‚Ä≤‚à•+t&#x3C;2B+t\\|v_{add}\\|&#x3C;\\|v\\|+\\|v'\\| + t &#x3C; 2B+t</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>a</span><span>d</span><span>d</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>‚à•</span><span>v</span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>‚à•</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>2</span><span>B</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span></span></span></span></span>, where <span><span><span>BB</span><span aria-hidden=\"true\"><span><span></span><span>B</span></span></span></span></span> is an upper bound on the \"noise\" of the ciphertexts that were added. This means we can probably do many additions before decryption stops working.</p>\n<p>To <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L261\">add ciphertexts</a>, it seems like we only need to add polynomials in <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. So, ciphertext addition is a piece of cake üç∞.</p>\n<div><pre><code><span>def</span><span> </span><span>add_cipher</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Add<span> </span>a<span> </span>ciphertext<span> </span>and<span> </span>a<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1,<span> </span>ct2:<span> </span>ciphertexts.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>new_ct0<span> </span><span>=</span><span> </span>polyadd<span>(</span>ct1<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>new_ct1<span> </span><span>=</span><span> </span>polyadd<span>(</span>ct1<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>new_ct0<span>,</span><span> </span>new_ct1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>‚û°Ô∏è <strong>Multiplication:</strong> Producing a new ciphertext that decrypts the product of the two messages is not that easy. But we should still try ü§û. The first idea that comes to mind is to simply multiply the decryption equations. It worked for addition, so maybe it works here as well.</p>\n<div><span><span><span>ct(s)‚ãÖct‚Ä≤(s)=Œî2‚ãÖmm‚Ä≤+Œî‚ãÖ(mv‚Ä≤+m‚Ä≤v)+vv‚Ä≤.¬†¬†(1)ct(s) \\cdot ct'(s) = \\Delta^2 \\cdot mm' + \\Delta\\cdot (mv'+m'v) + vv'. \\text{ } \\ (1)</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>Œî</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>m</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>v</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>v</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>.</span><span><span>¬†</span></span><span>¬†</span><span>(</span><span>1</span><span>)</span></span></span></span></span></div>\n<p>If we scale by <span><span><span>t/qt/q</span><span aria-hidden=\"true\"><span><span></span><span>t</span><span>/</span><span>q</span></span></span></span></span> to get rid of one <span><span><span>Œî\\Delta</span><span aria-hidden=\"true\"><span><span></span><span>Œî</span></span></span></span></span>, we get something that looks like what we want.</p>\n<div><span><span><span>tq‚ãÖct(s)‚ãÖct‚Ä≤(s)‚âàŒî‚ãÖmm‚Ä≤+(mv‚Ä≤+m‚Ä≤v)\\frac{t}{q}\\cdot ct(s) \\cdot ct'(s) \\approx \\Delta \\cdot mm' + (mv'+m'v)</span><span aria-hidden=\"true\"><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>q</span></span></span><span><span></span><span></span></span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>‚âà</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span>m</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>v</span><span>)</span></span></span></span></span></div>\n<p>It seems we are on the right track. Let's examine these expressions further. Recall the notations <span><span><span>ct(s)=ct0+ct1‚ãÖsct(s) = ct_0 + ct_1\\cdot s</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span></span></span></span></span> and  <span><span><span>ct‚Ä≤(s)=ct0‚Ä≤+ct1‚Ä≤‚ãÖs.ct'(s) = ct'_0 + ct'_1\\cdot s.</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span>.</span></span></span></span></span> Both of them are <em>linear</em> in <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>, but their multiplication is <em>quadratic</em> in <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>:</p>\n<div><span><span><span>ct‚ãÖct‚Ä≤(s)=ct0‚ãÖct0‚Ä≤+(ct0‚ãÖct1‚Ä≤+ct1‚ãÖct0‚Ä≤)s+ct1‚ãÖct1‚Ä≤s2,ct\\cdot ct'(s) = ct_0\\cdot ct'_0 + (ct_0\\cdot ct'_1 + ct_1\\cdot ct'_0)s +ct_1\\cdot ct'_1s^2, </span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span></span></span></span></span></div>\n<p>which we will write, in short, as <span><span><span>ct‚ãÖct‚Ä≤(s)=c0√ó+c1√ó‚ãÖs+c2√ó‚ãÖs2.ct \\cdot ct' (s) = c_0^\\times + c_1^{\\times}\\cdot s + c_2^{\\times} \\cdot s^2.</span><span aria-hidden=\"true\"><span><span></span><span>c</span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>√ó</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></p>\n<p>But what about the right hand side?  Keep in mind that we work with plaintexts <span><span><span>m,m‚Ä≤‚ààRtm, m' \\in R_t</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span>,</span><span></span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, so we should take <span><span><span>mm‚Ä≤mm'</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> with <em>coefficients modulo <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span></em>. Therefore, we can apply the same trick as we did for addition: we divide by <span><span><span>tt</span><span aria-hidden=\"true\"><span><span></span><span>t</span></span></span></span></span> and write <span><span><span>mm‚Ä≤=trm+[mm‚Ä≤]tmm' = tr_m + [mm']_t</span><span aria-hidden=\"true\"><span><span></span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>t</span><span><span>r</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, where <span><span><span>rmr_m</span><span aria-hidden=\"true\"><span><span></span><span><span>r</span><span><span><span><span><span><span></span><span><span>m</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is an integer polynomial. Skipping a lot of details, we end up with:</p>\n<div><span><span><span>t/q‚ãÖct‚ãÖct‚Ä≤(s)=Œî‚ãÖ[mm‚Ä≤]t+u2t/q \\cdot ct \\cdot ct'(s) = \\Delta \\cdot [mm']_t + u_2</span><span aria-hidden=\"true\"><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>c</span><span><span>t</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>(</span><span>s</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>\n<p>for <span><span><span>u2u_2</span><span aria-hidden=\"true\"><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> a polynomial with <em>rational</em> coefficients. Looks like we're getting closer to obtaining the decryption equation. We can now write the original expression <span><span><span>(1)(1)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>1</span><span>)</span></span></span></span></span> as:</p>\n<div><span><span><span>t/q‚ãÖc0√ó+t/q‚ãÖc1√ó‚ãÖs+t/q‚ãÖc2√ó‚ãÖs2=Œî‚ãÖ[mm‚Ä≤]t+u2t/q \\cdot c_0^\\times + t/q \\cdot c_1^{\\times} \\cdot s + t/q \\cdot c_2^{\\times} \\cdot s^2 = \\Delta \\cdot [mm']_t + u_2</span><span aria-hidden=\"true\"><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span>√ó</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></div>\n<p>Hm.. these coefficients look like <em>rational polynomials</em>.  Recall that the ciphertext has <em>integer polynomials</em> as elements. So we round each coefficient appearing in the left hand side to their nearest integers and then reduce the whole equation modulo <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>:</p>\n<div><span><span><span>[‚åät/q‚ãÖc0√ó‚åâ]q+[‚åät/q‚ãÖc1√ó‚åâ]q‚ãÖs+[‚åät/q‚ãÖc2√ó‚åâ]q‚ãÖs2=Œî‚ãÖ[mm‚Ä≤]t+u3¬†¬†(2)[\\lfloor t/q \\cdot c_0^{\\times} \\rceil]_q + [\\lfloor t/q \\cdot c_1^{\\times}\\rceil]_q \\cdot s + [\\lfloor t/q \\cdot c_2^{\\times}\\rceil]_q \\cdot s^2 = \\Delta \\cdot [mm']_t + u_3 \\text{ } \\ (2)</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>‚åä</span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚åâ</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>‚åä</span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚åâ</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>[</span><span>‚åä</span><span>t</span><span>/</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span><span><span></span><span><span><span>√ó</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚åâ</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>¬†</span></span><span>¬†</span><span>(</span><span>2</span><span>)</span></span></span></span></span></div>\n<p>where <span><span><span>u3u_3</span><span aria-hidden=\"true\"><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a \"small\" integer polynomial, that represents the \"noise\" after one multiplication.</p>\n<p>üí° The <strong>noise growth</strong> for <strong>multiplication</strong> grows a lot faster:\n<span><span><span>‚à•u3‚à•‚â§2‚ãÖn‚ãÖt‚ãÖB‚ãÖ(2n+1)‚ãÖ(n+1)+8t2‚ãÖn2,\\|u_3\\| \\leq 2 \\cdot n \\cdot t \\cdot B \\cdot (2n+1)\\cdot (n+1) + 8t^2 \\cdot n^2,</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>2</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>t</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>B</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>2</span><span>n</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span>n</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>8</span><span><span>t</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>n</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span></span></span></span></span>\nwhere <span><span><span>BB</span><span aria-hidden=\"true\"><span><span></span><span>B</span></span></span></span></span> is an upper bound for the \"noise\" of the ciphertexts that were multiplied. We refer the enthusiastic reader for more details to <a href=\"https://eprint.iacr.org/2012/144.pdf\">[[FV12] Lem. 2]</a>.</p>\n<p>Phew, seems like we are done: we can consider as a ciphertext decrypting to <span><span><span>[mm‚Ä≤]t[mm']_t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> the tuple of scaled and rounded coefficients mod <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span> from left hand side of <span><span><span>(2)(2)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>2</span><span>)</span></span></span></span></span>, denoted by <span><span><span>(c0,c1,c2)(c_0, c_1, c_2)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>. Of course, for a correct decryption, <span><span><span>u3u_3</span><span aria-hidden=\"true\"><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> should have small enough coefficients. You can see below how these coefficients are <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L293\">computed</a> in Python:</p>\n<div><pre><code><span>def</span><span> </span><span>multiplication_coeffs</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Multiply<span> </span>two<span> </span>ciphertexts.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1:<span> </span>first<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct2:<span> </span>second<span> </span>ciphertext<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Triplet<span> </span>(c0,c1,c2)<span> </span>encoding<span> </span>the<span> </span>multiplied<span> </span>ciphertexts.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_0<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>ct1<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>*</span><span> </span>t<span> </span><span>/</span><span> </span>q<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_1<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polyadd_wm<span>(</span>polymul_wm<span>(</span>ct1<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>polymul_wm<span>(</span>ct1<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>*</span><span> </span>t<span> </span><span>/</span><span> </span>q<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_2<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>ct1<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>*</span><span> </span>t<span> </span><span>/</span><span> </span>q<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>c_0<span>,</span><span> </span>c_1<span>,</span><span> </span>c_2<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>But, as a popular movie character would say, <strong>\"Houston, we have a problem\"</strong>. This tuple of coefficients has size 3, <strong>not 2 as the usual ciphertext</strong>. Moreover, the size of such tuple will grow linearly in the number of further multiplications performed on the ciphertexts. In order to restore the size of the ciphertext as 2, we will make use of the so called <em>relinearization technique</em>. üí•</p>\n<h3>Relinearization</h3>\n<p>üí° The idea of <strong>Relinearization</strong> is to reduce the triplet\n<span><span><span>(c0,c1,c2)(c_0,c_1,c_2)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span> to a ciphertext pair <span><span><span>(c0‚Ä≤,c1‚Ä≤)‚ààRq√óRq(c_0',c_1') \\in R_q \\times R_q</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>‚àà</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>√ó</span><span></span></span><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> that\nrecovers <span><span><span>[mm‚Ä≤]t[mm']_t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> when decrypted with the usual decryption\nalgorithm. We would like to produce a pair <span><span><span>(c0‚Ä≤,c1‚Ä≤)(c_0',c_1')</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, without using the\nsecret <span><span><span>ss</span><span aria-hidden=\"true\"><span><span></span><span>s</span></span></span></span></span>, such that:\n<span><span><span>[c0‚Ä≤+s‚ãÖc1‚Ä≤]q=[c0+c1‚ãÖs+c2‚ãÖs2+r]q[c_0' + s\\cdot c_1']_q = [c_0 + c_1\\cdot s + c_2 \\cdot s^2 + r ]_q</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>,\nwhere <span><span><span>rr</span><span aria-hidden=\"true\"><span><span></span><span>r</span></span></span></span></span> is a \"small\" error. The correct decryption will be possible, as the\n\"small\" error <span><span><span>rr</span><span aria-hidden=\"true\"><span><span></span><span>r</span></span></span></span></span> will vanish because of the rounding in decryption.</p>\n<p>As the name suggests it, we transform the degree 2 polynomial, <span><span><span>c0+c1‚ãÖs+c2‚ãÖs2c_0+c_1\\cdot s+c_2 \\cdot s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> into a linear polynomial, i.e. of degree 1. This involves giving extra info about  <span><span><span>s2s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. Using a special public key, called <em>relinearization key</em>, we can <em>linearize</em> <span><span><span>c2‚ãÖs2c_2 \\cdot s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> (up to some small error) as</p>\n<div><span><span><span>[c20+c21‚ãÖs]q=[c2‚ãÖs2+erelin]q.[c_{20}+c_{21} \\cdot s]_q = [c_2\\cdot s^2 + e_{relin}]_q.</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>r</span><span>e</span><span>l</span><span>i</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>\n<p>Therefore, by Equation <span><span><span>(2)(2)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>2</span><span>)</span></span></span></span></span>, we can get a standard ciphertext pair as</p>\n<div><span><span><span>cmul=(c0+c20,c1+c21),c_{mul} =(c_0+c_{20}, c_1+c_{21}), </span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span>,</span></span></span></span></span></div>\n<p>that correctly decrypts to <span><span><span>[mm‚Ä≤]t[mm']_t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, as you can see below:</p>\n<div><span><span><span>[c0+c20+s‚ãÖ(c1+c21)]q=[c0+c1‚ãÖs+c2‚ãÖs2+erelin]q=Œî‚ãÖ[mm‚Ä≤]t+vmult,\\begin{aligned}\n[c_0 + c_{20} + s\\cdot (c_1 + c_{21})]_q = [c_0 + c_1 \\cdot s + c_2 \\cdot s^2 + e_{relin}]_q = \\Delta \\cdot [mm']_t + v_{mult},\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>r</span><span>e</span><span>l</span><span>i</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>where <span><span><span>vmult=u3+erelin.v_{mult} = u_3 + e_{relin}.</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>r</span><span>e</span><span>l</span><span>i</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>.</span></span></span></span></span> Therefore, <span><span><span>cmulc_{mul}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> decrypts correctly\nto <span><span><span>[mm‚Ä≤]t[mm']_t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> if <span><span><span>‚à•vmult‚à•\\|v_{mult}\\|</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span></span></span></span></span> is less than <span><span><span>Œî/2\\Delta/2</span><span aria-hidden=\"true\"><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>. So yay! we finally\nknow how to get a ciphertext encoding multiplication!</p>\n<h3>Different versions of relinearization</h3>\n<p>To complete this discussion, we need to see how to construct the linear\napproximation of <span><span><span>c2‚ãÖs2c_2 \\cdot s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> and find out what the relinearization key is\nabout. For this, we will go a bit deeper into (technical) details. Don't\npanic, we'll take you step by step. üòÑ</p>\n<p>We are going to present two versions of linearizing <span><span><span>c2‚ãÖs2c_2\\cdot s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. First,\nkeep in mind that <span><span><span>s2s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> should not be known, so we give the relinearization\nkey as a <em>masked version</em> of <span><span><span>s2s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>Let's think of the following situation: say we include in the public key the\nfollowing <em>relinearization</em> key:</p>\n<div><span><span><span>rlk=(rlk0,rlk1)=([‚àí(a‚ãÖs+e)+s2]q,a),rlk = (rlk_0, rlk_1) = ([-(a\\cdot s+e)+s^2]_q,a),</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span>a</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>a</span><span>)</span><span>,</span></span></span></span></span></div>\n<p>for some uniform <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> in <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and a small error <span><span><span>ee</span><span aria-hidden=\"true\"><span><span></span><span>e</span></span></span></span></span>.</p>\n<p>‚ùó Intuitively, the secret <span><span><span>s2s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> is hidden by something that looks\nlike an\n<a href=\"https://en.wikipedia.org/wiki/Ring_learning_with_errors#The_RLWE_Problem\">RLWE</a>\nsample. Notice that,</p>\n<div><span><span><span>rlk0+rlk1‚ãÖs=s2+e.rlk_0 + rlk_1 \\cdot s = s^2 + e.</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>e</span><span>.</span></span></span></span></span></div>\n<p>To obtain the approximation of <span><span><span>c2‚ãÖs2c_2\\cdot s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> we should multiply the above\nexpression by <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. By doing so, we end up with the rather large-norm term\n<span><span><span>c2‚ãÖec_2\\cdot e</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>e</span></span></span></span></span>, due to the size of the coefficients of <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. We cannot allow\nsuch a large \"noise\" as it will interfere with decryption. To avoid this\n\"noise\" blow-up we will employ two techniques described below.</p>\n<h3>üí• Relinearization: Version 1</h3>\n<p>One strategy is to use base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> decomposition of the coefficients of <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> to\nslice <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> into components of small norm. To do this, we pick a base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> and\nwrite each coefficient of <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> in this base. Recall that <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is a integer\npolynomial, modulo <span><span><span>xn+1x^n+1</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>n</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, so of degree at most <span><span><span>n‚àí1n-1</span><span aria-hidden=\"true\"><span><span></span><span>n</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span></span></span></span></span>. If we write <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> as\na polynomial:</p>\n<div><span><span><span>c2(x)=c2[0]+c2[1]‚ãÖx+‚Ä¶+c2[n‚àí1]‚ãÖxn‚àí1c_2(x) = c_2[0] + c_2[1]\\cdot x+\\ldots+c_2[n-1]\\cdot x^{n-1}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>x</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>0</span><span>]</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>x</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>n</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>then we can decompose each coefficient <span><span><span>c2[i]c_2[i]</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span></span></span></span></span> in base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span>. Notice that\nsince <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> has coefficients in <span><span><span>[0,q‚àí1][0,q-1]</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>0</span><span>,</span><span></span><span>q</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span><span>]</span></span></span></span></span>, the maximum power appearing in\nthese representations is <span><span><span>T‚ÑìT^{\\ell}</span><span aria-hidden=\"true\"><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span></span></span></span></span>, where <span><span><span>‚Ñì=‚åälog‚Å°T(q)‚åã\\ell = \\lfloor \\log_T(q)\\rfloor</span><span aria-hidden=\"true\"><span><span></span><span>‚Ñì</span><span></span><span>=</span><span></span></span><span><span></span><span>‚åä</span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>q</span><span>)</span><span>‚åã</span></span></span></span></span>.\nFor base decomposition we <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L102\">use</a> the function <span><span><span>int2base\\texttt{int2base}</span><span aria-hidden=\"true\"><span><span></span><span><span>int2base</span></span></span></span></span></span>:</p>\n<div><pre><code><span>def</span><span> </span><span>int2base</span><span>(</span>n<span>,</span><span> </span>b<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Generates<span> </span>the<span> </span>base<span> </span>decomposition<span> </span>of<span> </span>an<span> </span>integer<span> </span>n.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>n:<span> </span>integer<span> </span>to<span> </span>be<span> </span>decomposed.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>b:<span> </span>base.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>array<span> </span>of<span> </span>coefficients<span> </span>from<span> </span>the<span> </span>base<span> </span>decomposition<span> </span>of<span> </span>n<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>with<span> </span>the<span> </span>coeff[i]<span> </span>being<span> </span>the<span> </span>coeff<span> </span>of<span> </span>b<span> </span>^<span> </span>i.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>if</span><span> </span>n<span> </span><span>&#x3C;</span><span> </span>b<span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>[</span>n<span>]</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>else</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>[</span>n<span> </span><span>%</span><span> </span>b<span>]</span><span> </span><span>+</span><span> </span>int2base<span>(</span>n<span> </span><span>//</span><span> </span>b<span>,</span><span> </span>b<span>)</span><span> </span><span> </span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>The relinearization key, <span><span><span>rlkrlk</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span> in this version, consists of masked variants\nof <span><span><span>Ti‚ãÖs2,T^i \\cdot s^2,</span><span aria-hidden=\"true\"><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>,</span></span></span></span></span> instead of <span><span><span>s2s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. More precisely, for <span><span><span>0‚â§i‚â§‚Ñì0 \\leq i \\leq\n\\ell</span><span aria-hidden=\"true\"><span><span></span><span>0</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>i</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>‚Ñì</span></span></span></span></span>, this is defined as follows:</p>\n<div><span><span><span>(rlk0[i],rlk1[i])=([‚àí(ai‚ãÖs+ei)+Ti‚ãÖs2]q,ai)(rlk_0[i], rlk_1[i]) = ([-(a_i \\cdot s + e_i) + T^i\\cdot s^2]_{q}, a_i)</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span></div>\n<p>for <span><span><span>aia_i</span><span aria-hidden=\"true\"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> chosen uniformly in <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>eie_i</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> chosen according to the\ndistribution <span><span><span>œá\\chi</span><span aria-hidden=\"true\"><span><span></span><span>œá</span></span></span></span></span> over <span><span><span>RR</span><span aria-hidden=\"true\"><span><span></span><span>R</span></span></span></span></span> (yep, same error distribution as in the\ndescription of the scheme). Below you can find the <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L135\">implementation</a> of the\nfunction that generates the evaluation (relinearization) key\n<span><span><span>(rlk0[i],rlk1[i])0‚â§i‚â§‚Ñì(rlk_0[i],rlk_1[i])_{0\\leq i\\leq\\ell}</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span><span>)</span><span><span><span><span><span><span></span><span><span><span>0</span><span>‚â§</span><span>i</span><span>‚â§</span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<div><pre><code><span>def</span><span> </span><span>evaluate_keygen_v1</span><span>(</span>sk<span>,</span><span> </span>size<span>,</span><span> </span>modulus<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std2<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Generate<span> </span>a<span> </span>relinearization<span> </span>key<span> </span>using<span> </span>version<span> </span>1.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>sk:<span> </span>secret<span> </span>key.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>the<span> </span>polynomials.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>modulus:<span> </span>coefficient<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>T:<span> </span>base.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>std2:<span> </span>standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>distribution.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk:<span> </span>relinearization<span> </span>key.<span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>n<span> </span><span>=</span><span> </span><span>len</span><span>(</span>poly_mod<span>)</span><span> </span><span>-</span><span> </span><span>1</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>l<span> </span><span>=</span><span> </span>np<span>.</span><span>int</span><span>(</span>np<span>.</span>log<span>(</span>modulus<span>)</span><span> </span><span>/</span><span> </span>np<span>.</span>log<span>(</span>T<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>rlk0<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>,</span><span> </span>n<span>)</span><span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>rlk1<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>,</span><span> </span>n<span>)</span><span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>for</span><span> </span>i<span> </span><span>in</span><span> </span><span>range</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>gen_uniform_poly<span>(</span>size<span>,</span><span> </span>modulus<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>e<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std2<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>secret_part<span> </span><span>=</span><span> </span>T<span> </span><span>**</span><span> </span>i<span> </span><span>*</span><span> </span>poly<span>.</span>polymul<span>(</span>sk<span>,</span><span> </span>sk<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd<span>(</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul_wm<span>(</span><span>-</span>a<span>,</span><span> </span>sk<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polyadd_wm<span>(</span><span>-</span>e<span>,</span><span> </span>secret_part<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>concatenate<span>(</span><span> </span><span>(</span>b<span>,</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>len</span><span>(</span>b<span>)</span><span>)</span><span> </span><span>)</span><span> </span><span>)</span><span>)</span><span> </span><span>#<span> </span>pad<span> </span>b<span> </span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>concatenate<span>(</span><span> </span><span>(</span>a<span>,</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>len</span><span>(</span>a<span>)</span><span>)</span><span> </span><span>)</span><span> </span><span>)</span><span>)</span><span> </span><span>#<span> </span>pad<span> </span>a<span> </span><span> </span><span> </span><span> </span></span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0<span>[</span>i<span>]</span><span> </span><span>=</span><span> </span>b<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk1<span>[</span>i<span>]</span><span> </span><span>=</span><span> </span>a<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>rlk0<span>,</span><span> </span>rlk1<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>Now, given <span><span><span>rlkrlk</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>, let's look at how we compute the linear approximation of\n<span><span><span>c2‚ãÖs2c_2 \\cdot s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span>. Let the polynomials <span><span><span>c2(i)c_2(i)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span></span></span></span></span> be the base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> decomposition\nof <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, such that:</p>\n<div><span><span><span>c2=‚àëi=0‚Ñìc2(i)‚ãÖTi.c_2 = \\displaystyle \\sum_{i=0}^{\\ell} c_2(i)\\cdot T^i.</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>\n<p>We can get the linear approximation given by <span><span><span>(c20,c21)(c_{20}, c_{21})</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, where:</p>\n<div><span><span><span>c20=‚àëi=0‚Ñìrlk0[i]‚ãÖc2(i)¬†and¬†c21=‚àëi=0‚Ñìrlk1[i]‚ãÖc2(i).c_{20} = \\sum_{i=0}^{\\ell} rlk_0[i]\\cdot c_2(i) \\text{ and } c_{21} = \\sum_{i=0}^{\\ell} rlk_1[i]\\cdot c_2(i).</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span><span>¬†and¬†</span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span>.</span></span></span></span></span></div>\n<p>Therefore, <span><span><span>c20+c21‚ãÖs=c2‚ãÖs2+erelin_v1c_{20} + c_{21} \\cdot s = c_2 \\cdot s^2 + e_{\\text{relin\\_v1}}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>=</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>\nwhere <span><span><span>erelin_v1e_{\\text{relin\\_v1}}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> is an error term from <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<div><span><span><span>c20+c21‚ãÖs=‚àëi=0‚Ñì[‚àí(ai‚ãÖs+ei)+Ti‚ãÖs2]c2(i)+‚àëi=0‚Ñìai‚ãÖs‚ãÖc2(i)=‚àí‚àëi=0‚Ñìei‚ãÖc2(i)+c2‚ãÖs2.\\begin{aligned}\nc_{20} + c_{21} \\cdot s\n    &#x26;= \\sum_{i=0}^{\\ell} [-(a_i\\cdot s+e_i)+T^i\\cdot s^2] c_2(i) + \\sum_{i=0}^{\\ell} a_i \\cdot s \\cdot c_2(i)\\\\\n    &#x26;= -\\sum_{i=0}^{\\ell} e_i \\cdot c_2(i) + c_2 \\cdot s^2.\n \\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>]</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span></span><span>+</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>‚àí</span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span>.</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>üí° By doing base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> decomposition we get a \"small\" <strong>relinearization noise</strong>:\n<span><span><span>‚à•erelin_v1‚à•‚â§(‚Ñì+1)‚ãÖB‚ãÖT‚ãÖn/2\\|e_{\\text{relin\\_v1}}\\| \\leq (\\ell+1)\\cdot B \\cdot T \\cdot n/2</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>(</span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>B</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span>/</span><span>2</span></span></span></span></span>\nwhere <span><span><span>BB</span><span aria-hidden=\"true\"><span><span></span><span>B</span></span></span></span></span> is an upper bound on the errors <span><span><span>eie_i</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<p>‚ùì Now the question is how to compute the polynomials <span><span><span>c2(i)c_2(i)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>i</span><span>)</span></span></span></span></span>. The coefficients of these polynomials prove to be nothing but the columns of the matrix <span><span><span>Reps\\texttt{Reps}</span><span aria-hidden=\"true\"><span><span></span><span><span>Reps</span></span></span></span></span></span>.</p>\n<p><span><span><span>c2[i]=Reps[i][0]+Reps[i][1]‚ãÖT+‚Ä¶+Reps[i][‚Ñì]‚ãÖT‚Ñì.c_2[i] = \\mathtt{Reps}[i][0] + \\mathtt{Reps}[i][1] \\cdot T+ \\ldots + \\mathtt{Reps}[i][\\ell] \\cdot T^{\\ell}.</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>=</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>0</span><span>]</span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>‚Ñì</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></p>\n<p>If we multiply this by <span><span><span>xix^i</span><span aria-hidden=\"true\"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span></span></span></span></span>, we get:</p>\n<div><span><span><span>c2[i]‚ãÖxi=Reps[i][0]‚ãÖxi+Reps[i][1]‚ãÖxi‚ãÖT+‚Ä¶+Reps[i][‚Ñì]‚ãÖxi‚ãÖT‚Ñì.c_2[i] \\cdot x^i =\n    \\mathtt{Reps}[i][0] \\cdot x^i +\n    \\mathtt{Reps}[i][1] \\cdot x^i \\cdot T+ \\ldots +\n    \\mathtt{Reps}[i][\\ell] \\cdot x^i \\cdot T^{\\ell}.</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>[</span><span>i</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>0</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>‚Ñì</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>\n<p>Summing up all these for each <span><span><span>0‚â§i‚â§n‚àí10\\leq i \\leq n-1</span><span aria-hidden=\"true\"><span><span></span><span>0</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>i</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>n</span><span></span><span>‚àí</span><span></span></span><span><span></span><span>1</span></span></span></span></span>, on the left hand side we\nactually get <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>:</p>\n<div><span><span><span>c2=‚àëi=0n‚àí1Reps[i][0]‚ãÖxi+(‚àëi=0n‚àí1Reps[i][1]‚ãÖxi)‚ãÖT+‚Ä¶+(‚àëi=0n‚àí1Reps[i][‚Ñì]‚ãÖxi)‚ãÖT‚Ñì.c_2 = \\displaystyle \\sum_{i=0}^{n-1} \\mathtt{Reps}[i][0] \\cdot x^i\n    + (\\sum_{i=0}^{n-1}\\mathtt{Reps}[i][1] \\cdot x^i) \\cdot  T+ \\ldots\n    + (\\sum_{i=0}^{n-1} \\mathtt{Reps}[i][\\ell] \\cdot x^i) \\cdot T^{\\ell}.</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>0</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>1</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>+</span><span></span></span><span><span></span><span>‚Ä¶</span><span></span><span>+</span><span></span></span><span><span></span><span>(</span><span><span><span><span><span><span></span><span><span><span>i</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>n</span><span>‚àí</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span><span>[</span><span>i</span><span>]</span><span>[</span><span>‚Ñì</span><span>]</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>i</span></span></span></span></span></span></span></span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>\n<p>So, if we denote the above sums by polynomials <span><span><span>c2(j)c_2(j)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>j</span><span>)</span></span></span></span></span>, we simply get</p>\n<div><span><span><span>c2=‚àëj=0‚Ñìc2(j)‚ãÖTj.c_2 = \\displaystyle \\sum_{j=0}^{\\ell} c_2(j)\\cdot T^j.</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>j</span><span>=</span><span>0</span></span></span></span><span><span></span><span><span>‚àë</span></span></span><span><span></span><span><span><span>‚Ñì</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>j</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>T</span><span><span><span><span><span><span></span><span><span>j</span></span></span></span></span></span></span></span><span>.</span></span></span></span></span></div>\n<p>Phew, what a relief! Notice that the coefficients for each polynomial\n<span><span><span>c2(j)c_2(j)</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>(</span><span>j</span><span>)</span></span></span></span></span> are given by the <span><span><span>jj</span><span aria-hidden=\"true\"><span><span></span><span>j</span></span></span></span></span>-th column of <span><span><span>Reps\\mathtt{Reps}</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span>e</span><span>p</span><span>s</span></span></span></span></span></span>.</p>\n<p>So after all this math, we finally got the linear approximation of <span><span><span>c2‚ãÖs2c_2 \\cdot\ns^2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> and thus, we can derive the standard ciphertext encoding the\nmultiplication of the plaintexts. Here comes the <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L311\">code</a>:</p>\n<div><pre><code><span>def</span><span> </span><span>mul_cipher_v1</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0<span>,</span><span> </span>rlk1<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Multiply<span> </span>two<span> </span>ciphertexts.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1:<span> </span>first<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct2:<span> </span>second<span> </span>ciphertext<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>T:<span> </span>base<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0,<span> </span>rlk1:<span> </span>output<span> </span>of<span> </span>the<span> </span>EvaluateKeygen_v1<span> </span>function.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>n<span> </span><span>=</span><span> </span><span>len</span><span>(</span>poly_mod<span>)</span><span> </span><span>-</span><span> </span><span>1</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>l<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>log<span>(</span>q<span>)</span><span> </span><span>/</span><span> </span>np<span>.</span>log<span>(</span>T<span>)</span><span>)</span><span> </span><span> </span><span>#l<span> </span>=<span> </span>log_T(q)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_0<span>,</span><span> </span>c_1<span>,</span><span> </span>c_2<span> </span><span>=</span><span> </span>multiplication_coeffs<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_2<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span>concatenate<span>(</span><span> </span><span>(</span>c_2<span>,</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>len</span><span>(</span>c_2<span>)</span><span>)</span><span>)</span><span> </span><span>)</span><span>)</span><span> </span><span>#pad</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#Next,<span> </span>we<span> </span>decompose<span> </span>c_2<span> </span>in<span> </span>base<span> </span>T:<span> </span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#more<span> </span>precisely,<span> </span>each<span> </span>coefficient<span> </span>of<span> </span>c_2<span> </span>is<span> </span>decomposed<span> </span>in<span> </span>base<span> </span>T<span> </span>such<span> </span>that<span> </span>c_2<span> </span>=<span> </span>sum<span> </span>T**i<span> </span>*<span> </span>c_2(i)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Reps<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span><span>(</span>n<span>,</span><span> </span>l<span> </span><span>+</span><span> </span><span>1</span><span>)</span><span>,</span><span> </span>dtype<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>for</span><span> </span>i<span> </span><span>in</span><span> </span><span>range</span><span>(</span>n<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rep<span> </span><span>=</span><span> </span>int2base<span>(</span>c_2<span>[</span>i<span>]</span><span>,</span><span> </span>T<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rep2<span> </span><span>=</span><span> </span>rep<span> </span><span>+</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span> </span><span>-</span><span> </span><span>len</span><span>(</span>rep<span>)</span><span>)</span><span> </span><span>#pad<span> </span>with<span> </span>0</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Reps<span>[</span>i<span>]</span><span> </span><span>=</span><span> </span>np<span>.</span>array<span>(</span>rep2<span>,</span><span> </span>dtype<span>=</span>np<span>.</span>int64<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Each<span> </span>row<span> </span>Reps[i]<span> </span>is<span> </span>the<span> </span>base<span> </span>T<span> </span>representation<span> </span>of<span> </span>the<span> </span>i-th<span> </span>coefficient<span> </span>c_2[i].</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>The<span> </span>polynomials<span> </span>c_2(j)<span> </span>are<span> </span>given<span> </span>by<span> </span>the<span> </span>columns<span> </span>Reps[:,j].</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span>shape<span>=</span>n<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>np<span>.</span>zeros<span>(</span>shape<span>=</span>n<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Here<span> </span>we<span> </span>compute<span> </span>the<span> </span>sums:<span> </span>rlk[j][0]<span> </span>*<span> </span>c_2(j)<span> </span>and<span> </span>rlk[j][1]<span> </span>*<span> </span>c_2(j)<span> </span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>for</span><span> </span>j<span> </span><span>in</span><span> </span><span>range</span><span>(</span>l<span> </span><span>+</span><span> </span><span>1</span><span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>polyadd_wm<span>(</span>c_20<span>,</span><span> </span>polymul_wm<span>(</span>rlk0<span>[</span>j<span>]</span><span>,</span><span> </span>Reps<span>[</span><span>:</span><span>,</span>j<span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>polyadd_wm<span>(</span>c_21<span>,</span><span> </span>polymul_wm<span>(</span>rlk1<span>[</span>j<span>]</span><span>,</span><span> </span>Reps<span>[</span><span>:</span><span>,</span>j<span>]</span><span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>c_20<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>c_21<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>new_c0<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_0<span>,</span><span> </span>c_20<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>new_c1<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_1<span>,</span><span> </span>c_21<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>new_c0<span>,</span><span> </span>new_c1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<h3>üí• Relinearization: Version 2</h3>\n<p>This version is much simpler and cleaner than the previous one (yay!) and uses the so-called <em>modulus switching</em> technique. Recall that if we try to naively mask <span><span><span>s2s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> in the reliniarization key, then there is a large blow-up in the noise because of the <span><span><span>c2c_2</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> multiplication. We want to avoid this to get a correct decryption.</p>\n<p>In this version we mask <span><span><span>s2s^2</span><span aria-hidden=\"true\"><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span></span></span></span></span> modulo a a different modulus, <span><span><span>p‚ãÖqp\\cdot q</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>q</span></span></span></span></span>, with a much larger <span><span><span>p‚â´qp\\gg q</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span></span><span>‚â´</span><span></span></span><span><span></span><span>q</span></span></span></span></span>, as shown below.</p>\n<div><span><span><span>rlk=(rlk0,rlk1)=([‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2]p‚ãÖq,a‚Ä≤),rlk = (rlk_0, rlk_1) = ([-(a' \\cdot s + e') + p\\cdot s^2]_{p\\cdot q}, a'),</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>p</span><span>‚ãÖ</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span>,</span></span></span></span></span></div>\n<p>for a uniform <span><span><span>a‚Ä≤a'</span><span aria-hidden=\"true\"><span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> in <span><span><span>Rp‚ãÖqR_{p\\cdot q}</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span><span>p</span><span>‚ãÖ</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>e‚Ä≤e'</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> drawn according to an error distribution <span><span><span>œá‚Ä≤\\chi'</span><span aria-hidden=\"true\"><span><span></span><span><span>œá</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> over <span><span><span>R.R.</span><span aria-hidden=\"true\"><span><span></span><span>R</span><span>.</span></span></span></span></span>\nRemember that our goal is to produce an approximation of <span><span><span>[c2‚ãÖs2]q[c_2\\cdot s^2]_q</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. The idea is that when we scale from <span><span><span>p‚ãÖqp\\cdot q</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>q</span></span></span></span></span> back to <span><span><span>qq</span><span aria-hidden=\"true\"><span><span></span><span>q</span></span></span></span></span>, the noise gets divided by the large integer <span><span><span>pp</span><span aria-hidden=\"true\"><span><span></span><span>p</span></span></span></span></span>, significantly reducing its size.</p>\n<p>In a safe implementation the distribution <span><span><span>œá‚Ä≤\\chi'</span><span aria-hidden=\"true\"><span><span></span><span><span>œá</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> should be distinct from\n<span><span><span>œá\\chi</span><span aria-hidden=\"true\"><span><span></span><span>œá</span></span></span></span></span> and its parameters should be carefully chosen for security reasons.\nSince security is not our main goal in this blog post, you can check the\npaper for further details.</p>\n<div><pre><code><span>def</span><span> </span><span>evaluate_keygen_v2</span><span>(</span>sk<span>,</span><span> </span>size<span>,</span><span> </span>modulus<span>,</span><span> </span>poly_mod<span>,</span><span> </span>extra_modulus<span>,</span><span> </span>std2<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Generate<span> </span>a<span> </span>relinearization<span> </span>key<span> </span>using<span> </span>version<span> </span>2.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>sk:<span> </span>secret<span> </span>key<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>size:<span> </span>size<span> </span>of<span> </span>the<span> </span>polynomials.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>modulus:<span> </span>coefficient<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>extra_modulus:<span> </span>the<span> </span>\"p\"<span> </span>modulus<span> </span>for<span> </span>modulus<span> </span>switching.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>st2:<span> </span>standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>distribution.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0,<span> </span>rlk1:<span> </span>relinearization<span> </span>key.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>new_modulus<span> </span><span>=</span><span> </span>modulus<span> </span><span>*</span><span> </span>extra_modulus<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>a<span> </span><span>=</span><span> </span>gen_uniform_poly<span>(</span>size<span>,</span><span> </span>new_modulus<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>e<span> </span><span>=</span><span> </span>gen_normal_poly<span>(</span>size<span>,</span><span> </span><span>0</span><span>,</span><span> </span>std2<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>secret_part<span> </span><span>=</span><span> </span>extra_modulus<span> </span><span>*</span><span> </span>poly<span>.</span>polymul<span>(</span>sk<span>,</span><span> </span>sk<span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>b<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polymul_wm<span>(</span><span>-</span>a<span>,</span><span> </span>sk<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>polyadd_wm<span>(</span><span>-</span>e<span>,</span><span> </span>secret_part<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>new_modulus<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span>b<span>,</span><span> </span>a<span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<p>The linear approximation of <span><span><span>[c2‚ãÖs2]q[c_2 \\cdot s^2]_q</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> can be computed from the pair:</p>\n<div><span><span><span>(c20,c21)=([‚åäc2‚ãÖrlk0p‚åâ]q,[‚åäc2‚ãÖrlk1p‚åâ]q).(c_{20}, c_{21}) = \\Big(\\Big[\\Big\\lfloor\\frac{c_2 \\cdot rlk_0}{p}\\Big\\rceil\\Big]_q, \\Big[\\Big\\lfloor\\frac{c_2 \\cdot rlk_1}{p}\\Big\\rceil\\Big]_q\\Big).</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span><span>(</span></span><span><span>[</span></span><span><span>‚åä</span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>‚åâ</span></span><span><span><span>]</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>[</span></span><span><span>‚åä</span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span><span>‚åâ</span></span><span><span><span>]</span></span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span><span>)</span></span><span>.</span></span></span></span></span></div>\n<p>Indeed, <span><span><span>[c20+c21‚ãÖs]q=[c2‚ãÖs2]q+erelin_v2,[c_{20} + c_{21} \\cdot s]_q = [c_2 \\cdot s^2]_q + e_{\\text{relin\\_v2}},</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>[</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span></span> for a \"small\" error <span><span><span>erelin_v2e_{\\text{relin\\_v2}}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> in <span><span><span>RqR_q</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>.</p>\n<div><span><span><span>c2‚ãÖrlk0p+c2‚ãÖrlk1p‚ãÖs=c2‚ãÖ[‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2]p‚ãÖq+c2‚ãÖa‚Ä≤‚ãÖsp=c2‚ãÖs2+‚àíc2‚ãÖe‚Ä≤p+q‚ãÖK,\\begin{aligned}\n\\frac{c_2 \\cdot rlk_0}{p} + \\frac{c_2 \\cdot rlk_1}{p} \\cdot s \n    &#x26;= \\frac{c_2\\cdot [-(a'\\cdot s+e') + p\\cdot s^2]_{p\\cdot q}+c_2 \\cdot a' \\cdot s}{p}\\\\\n    &#x26;= c_2\\cdot s^2 +\\frac{-c_2\\cdot e'}{p} + q \\cdot K,\n\\end{aligned}</span><span aria-hidden=\"true\"><span><span></span><span><span><span><span><span><span><span><span></span><span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>r</span><span>l</span><span><span>k</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span><span><span></span><span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span><span></span><span>+</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>p</span><span>‚ãÖ</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span>s</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>p</span></span></span><span><span></span><span></span></span><span><span></span><span><span>‚àí</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span><span>q</span><span></span><span>‚ãÖ</span><span></span><span>K</span><span>,</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></div>\n<p>where <span><span><span>K‚ààRK \\in R</span><span aria-hidden=\"true\"><span><span></span><span>K</span><span></span><span>‚àà</span><span></span></span><span><span></span><span>R</span></span></span></span></span> such that <span><span><span>[‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2]pq=‚àí(a‚Ä≤‚ãÖs+e‚Ä≤)+p‚ãÖs2+pq‚ãÖK[-(a'\\cdot s+e') + p\\cdot s^2]_{pq} = -(a'\\cdot s+e') + p\\cdot s^2 + pq\\cdot K</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span><span>p</span><span>q</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>‚àí</span><span>(</span><span><span>a</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>s</span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>s</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>p</span><span>q</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>K</span></span></span></span></span>.</p>\n<p>We're cheating a bit here, since the pair involves the <em>roundings of the terms to their nearest integers</em>. Still, we're not far from the truth, since for any real number <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span>, <span><span><span>‚åäa‚åâ\\lfloor a \\rceil</span><span aria-hidden=\"true\"><span><span></span><span>‚åä</span><span>a</span><span>‚åâ</span></span></span></span></span> differs from <span><span><span>aa</span><span aria-hidden=\"true\"><span><span></span><span>a</span></span></span></span></span> by a small quantity\n<span><span><span>Œµ‚àà[‚àí12,12]\\varepsilon \\in [-\\frac{1}{2},\\frac{1}{2}]</span><span aria-hidden=\"true\"><span><span></span><span>Œµ</span><span></span><span>‚àà</span><span></span></span><span><span></span><span>[</span><span>‚àí</span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span>,</span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span>]</span></span></span></span></span>. (we can also extend this coefficient-wise to polynomials).</p>\n<p>üí° We get a \"small\" <strong>relinearization noise</strong>,\n<span><span><span>erelin_v2‚âà(c2‚ãÖe‚Ä≤)/pe_{\\text{relin\\_v2}} \\approx (c_2\\cdot e')/p</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚âà</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>)</span><span>/</span><span>p</span></span></span></span></span>, for large <span><span><span>p:p:</span><span aria-hidden=\"true\"><span><span></span><span>p</span><span></span><span>:</span></span></span></span></span>\n<span><span><span>‚à•erelin_v2‚à•‚â§q‚ãÖB‚Ä≤‚ãÖnp+n+12.\\|e_{\\text{relin\\_v2}}\\| \\leq \\frac{q \\cdot B' \\cdot n}{p}+\\frac{n+1}{2}.</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>p</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span>‚ãÖ</span><span><span>B</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>‚ãÖ</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>n</span><span>+</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span>.</span></span></span></span></span></p>\n<p>Next, we provide the easy <a href=\"https://github.com/bit-ml/he-scheme/blob/main/rlwe_he_scheme_updated.py#L355\">code</a> implementation for multiplying ciphertexts using this version.</p>\n<div><pre><code><span>def</span><span> </span><span>mul_cipher_v2</span><span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>p<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0<span>,</span><span> </span>rlk1<span>)</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>\"\"\"Multiply<span> </span>two<span> </span>ciphertexts.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Args:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct1:<span> </span>first<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>ct2:<span> </span>second<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>q:<span> </span>ciphertext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t:<span> </span>plaintext<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>p:<span> </span>modulus-swithcing<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>poly_mod:<span> </span>polynomial<span> </span>modulus.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlk0,<span> </span>rlk1:<span> </span>output<span> </span>of<span> </span>the<span> </span>EvaluateKeygen_v2<span> </span>function.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>Returns:<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>Tuple<span> </span>representing<span> </span>a<span> </span>ciphertext.<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>\"\"\"</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_0<span>,</span><span> </span>c_1<span>,</span><span> </span>c_2<span> </span><span>=</span><span> </span>multiplication_coeffs<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_20<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>c_2<span>,</span><span> </span>rlk0<span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>/</span><span> </span>p<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>c_21<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>np<span>.</span><span>round</span><span>(</span>polymul_wm<span>(</span>c_2<span>,</span><span> </span>rlk1<span>,</span><span> </span>poly_mod<span>)</span><span> </span><span>/</span><span> </span>p<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>new_c0<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_0<span>,</span><span> </span>c_20<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>new_c1<span> </span><span>=</span><span> </span>np<span>.</span>int64<span>(</span>polyadd_wm<span>(</span>c_1<span>,</span><span> </span>c_21<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span> </span><span>%</span><span> </span>q<span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>return</span><span> </span><span>(</span>new_c0<span>,</span><span> </span>new_c1<span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n<h3>Version 1 vs. Version 2 ü•ä</h3>\n<p>Recall that we can derive a fresh standard ciphertext that decrypts to\n<span><span><span>[mm‚Ä≤]t[mm']_t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> as <span><span><span>cmul=(c0+c20,c1+c21)c_{mul} =(c_0+c_{20}, c_1+c_{21})</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span></span></span></span></span>, since</p>\n<div><span><span><span>c0+c20+s‚ãÖ(c1+c21)=Œî‚ãÖ[mm‚Ä≤]t+vmult,c_0 + c_{20} + s\\cdot (c_1 + c_{21}) = \\Delta \\cdot [mm']_t + v_{mult},</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span>0</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>0</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span>s</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>(</span><span><span>c</span><span><span><span><span><span><span></span><span><span>1</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>2</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>=</span><span></span></span><span><span></span><span>Œî</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span></span></div>\n<p>where <span><span><span>vmult=u3+erelinv_{mult} = u_3 + e_{\\text{relin}}</span><span aria-hidden=\"true\"><span><span></span><span><span>v</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span><span>t</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> and <span><span><span>erelin‚àà{erelin_v1,erelin_v2}e_{\\text{relin}} \\in \\{e_{\\text{relin\\_v1}}, e_{\\text{relin\\_v2}}\\}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span>‚àà</span><span></span></span><span><span></span><span>{</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v1</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin_v2</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>}</span></span></span></span></span>.</p>\n<p>We need to make sure that <span><span><span>cmulc_{mul}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> decrypts <em>correctly</em> to <span><span><span>[mm‚Ä≤]t[mm']_t</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>m</span><span><span>m</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span><span>]</span><span><span><span><span><span><span></span><span><span>t</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>. For\nthis, it suffices to choose the parameters such that\n<span><span><span>‚à•u3‚à•+‚à•erelin‚à•‚â§Œî/2.\\|u_3\\| + \\|e_{\\text{relin}}\\| \\leq \\Delta/2.</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>‚â§</span><span></span></span><span><span></span><span>Œî</span><span>/</span><span>2</span><span>.</span></span></span></span></span></p>\n<p>Now that we have <strong>two</strong> versions of relinearization, which help us in\nderiving <span><span><span>cmulc_{mul}</span><span aria-hidden=\"true\"><span><span></span><span><span>c</span><span><span><span><span><span><span></span><span><span><span>m</span><span>u</span><span>l</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>, we may wonder which one we can use:</p>\n<table>\n<thead>\n<tr>\n<th>Relinearization</th>\n<th align=\"left\">Size of <span><span><span>rlkrlk</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span> (in bits)</th>\n<th>Bound of <span><span><span>ereline_{\\text{relin}}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Version 1</strong></td>\n<td align=\"left\"><span><span><span>2(‚Ñì+1)‚ãÖn‚ãÖlog‚Å°q2(\\ell+1)\\cdot n \\cdot \\log q</span><span aria-hidden=\"true\"><span><span></span><span>2</span><span>(</span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>lo<span>g</span></span><span></span><span>q</span></span></span></span></span></td>\n<td><span><span><span>(‚Ñì+1)‚ãÖB‚ãÖT‚ãÖn/2(\\ell+1)\\cdot B \\cdot T \\cdot n/2</span><span aria-hidden=\"true\"><span><span></span><span>(</span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span><span>)</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>B</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>T</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>n</span><span>/</span><span>2</span></span></span></span></span></td>\n</tr>\n<tr>\n<td><strong>Version 2</strong></td>\n<td align=\"left\"><span><span><span>2n‚ãÖlog‚Å°pq2n \\cdot \\log pq</span><span aria-hidden=\"true\"><span><span></span><span>2</span><span>n</span><span></span><span>‚ãÖ</span><span></span></span><span><span></span><span>lo<span>g</span></span><span></span><span>p</span><span>q</span></span></span></span></span></td>\n<td><span><span><span>q‚ãÖB‚Ä≤‚ãÖnp+n+12\\frac{q \\cdot B' \\cdot n}{p}+\\frac{n+1}{2}</span><span aria-hidden=\"true\"><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>p</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>q</span><span>‚ãÖ</span><span><span>B</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span><span>‚ãÖ</span><span>n</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span><span>2</span></span></span></span><span><span></span><span></span></span><span><span></span><span><span><span>n</span><span>+</span><span>1</span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<p>‚û°Ô∏è <strong>size of <span><span><span>rlkrlk</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>:</strong> <strong>Version 1</strong> gives a relinearization key as <span><span><span>‚Ñì+1\\ell+1</span><span aria-hidden=\"true\"><span><span></span><span>‚Ñì</span><span></span><span>+</span><span></span></span><span><span></span><span>1</span></span></span></span></span> pairs of polynomials in <span><span><span>Rq,R_q,</span><span aria-hidden=\"true\"><span><span></span><span><span>R</span><span><span><span><span><span><span></span><span><span>q</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>,</span></span></span></span></span> whereas <strong>Version 2</strong> gives just one such pair. Recall that <span><span><span>‚Ñì=‚åälog‚Å°Tq‚åã\\ell=\\lfloor \\log_T{q}\\rfloor</span><span aria-hidden=\"true\"><span><span></span><span>‚Ñì</span><span></span><span>=</span><span></span></span><span><span></span><span>‚åä</span><span><span>lo<span>g</span></span><span><span><span><span><span><span></span><span><span>T</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span></span><span><span>q</span></span><span>‚åã</span></span></span></span></span> and see that this decreases as long as the base <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> increases.</p>\n<p>‚û°Ô∏è <strong>bound of <span><span><span>ereline_{\\text{relin}}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span>:</strong> The upper bounds of <span><span><span>ereline_{\\text{relin}}</span><span aria-hidden=\"true\"><span><span></span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span> for both versions are according to <a href=\"https://eprint.iacr.org/2012/144.pdf\">[FV12], Lem.3</a>. We consider <span><span><span>BB</span><span aria-hidden=\"true\"><span><span></span><span>B</span></span></span></span></span> as a bound taken so that the error distribution <span><span><span>œá\\chi</span><span aria-hidden=\"true\"><span><span></span><span>œá</span></span></span></span></span> takes values in <span><span><span>[‚àíB,B][-B,B]</span><span aria-hidden=\"true\"><span><span></span><span>[</span><span>‚àí</span><span>B</span><span>,</span><span></span><span>B</span><span>]</span></span></span></span></span> with high probability. We similarly define <span><span><span>B‚Ä≤B'</span><span aria-hidden=\"true\"><span><span></span><span><span>B</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span> for the case of the error distribution <span><span><span>œá‚Ä≤\\chi'</span><span aria-hidden=\"true\"><span><span></span><span><span>œá</span><span><span><span><span><span><span></span><span><span><span>‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span>, used in <strong>Version 2</strong>. Notice that for <strong>Version 1</strong>, a larger <span><span><span>TT</span><span aria-hidden=\"true\"><span><span></span><span>T</span></span></span></span></span> leads to more noise (but smaller <span><span><span>rlkrlk</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>), whereas in <strong>Version 2</strong>, a larger <span><span><span>pp</span><span aria-hidden=\"true\"><span><span></span><span>p</span></span></span></span></span> leads to smaller noise (but larger <span><span><span>rlkrlk</span><span aria-hidden=\"true\"><span><span></span><span>r</span><span>l</span><span>k</span></span></span></span></span>). For choosing the parameters in safe implementation, we refer the reader to <a href=\"https://eprint.iacr.org/2012/144.pdf\">[FV12] Sec. Realinearisation Version 2.</a></p>\n<h3>Setting the parameters</h3>\n<p>We set the parameters for our toy implementation just to make sure it always\ncorrectly decrypts at least one ciphertext multiplication. For that, we made\nsure that <span><span><span>‚à•u3‚à•+‚à•erelin‚à•&#x3C;Œî/2\\|u_3\\| + \\|e_{\\text{relin}}\\|&#x3C; \\Delta /2</span><span aria-hidden=\"true\"><span><span></span><span>‚à•</span><span><span>u</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>+</span><span></span></span><span><span></span><span>‚à•</span><span><span>e</span><span><span><span><span><span><span></span><span><span><span><span>relin</span></span></span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span></span><span>‚à•</span><span></span><span>&#x3C;</span><span></span></span><span><span></span><span>Œî</span><span>/</span><span>2</span></span></span></span></span>. In practice, for the\ncurrent choice it seems that decryption always works for <span><span><span>33</span><span aria-hidden=\"true\"><span><span></span><span>3</span></span></span></span></span> ciphertext\nmultiplications when using V2 relinearization, for example. This is due to\nthe fact that the theoretical bounds are worst-case bounds. For the same\nparameters we can make hundreds of addition (in practice it seems that\ndecryption works even for <span><span><span>10001000</span><span aria-hidden=\"true\"><span><span></span><span>1</span><span>0</span><span>0</span><span>0</span></span></span></span></span> additions üòÆ). Ciphertext addition\nis almost for free in terms of noise growth! üí• We invite you to play\naround with the parameters and the bounds and try to see how many\nmultiplications you can get (as they are the costly operations).</p>\n<h3>Let's play! üéâ</h3>\n<p>Now we can multiply ciphertexts, as we have implemented two versions of this:\n<span><span><span>mul_cipher_v1\\texttt{mul\\_cipher\\_v1}</span><span aria-hidden=\"true\"><span><span></span><span><span>mul_cipher_v1</span></span></span></span></span></span> and <span><span><span>mul_cipher_v2\\texttt{mul\\_cipher\\_v2}</span><span aria-hidden=\"true\"><span><span></span><span><span>mul_cipher_v2</span></span></span></span></span></span>, using\nrelinearization. We can further add ciphertexts by using\n<span><span><span>add_cipher\\texttt{add\\_cipher}</span><span aria-hidden=\"true\"><span><span></span><span><span>add_cipher</span></span></span></span></span></span>. So yay! we can finally perform computations on\nencrypted data.</p>\n<p><strong>Bonus:</strong> if you're curious, you can try computing more complex (polynomial)\noperations on encrypted data, such as <em>multiplying three ciphertexts</em>. Here\nwe only wanted to show how to perform one multiplication. For more levels of\nmultiplications, you should set the parameters as in\n<a href=\"https://eprint.iacr.org/2012/144.pdf\">[FV12, Thm1]</a> so that you decrypt\ncorrectly üòâ.</p>\n<p><strong>Bonus2:</strong> you can also perform <em>plain operations</em>, such as adding or\nmultiplying plaintexts to ciphertexts, by using <span><span><span>add_plain\\texttt{add\\_plain}</span><span aria-hidden=\"true\"><span><span></span><span><span>add_plain</span></span></span></span></span></span> and\n<span><span><span>mul_plain,\\texttt{mul\\_plain},</span><span aria-hidden=\"true\"><span><span></span><span><span>mul_plain</span></span><span>,</span></span></span></span></span> (with a <em>reduced noise growth</em>) both from\n<a href=\"https://github.com/Bitdefender-Crypto-Team/he-scheme/blob/main/rlwe_he_scheme_updated.py\">here</a>.\nFor further details on how these work, you should check\n<a href=\"https://blog.openmined.org/build-an-homomorphic-encryption-scheme-from-scratch-with-python/#buildanhomomorphicencryptionscheme\">this</a>. ü§ì</p>\n<p>So what are you waiting for? Go check it out!</p>\n<div><pre><code><span>import</span><span> </span>rlwe_he_scheme_updated<span> </span><span>as</span><span> </span>rlwe_updated<span></span>\n<span></span><span>import</span><span> </span>numpy<span> </span><span>as</span><span> </span>np<span></span>\n<span></span><span></span>\n<span></span><span>if</span><span> </span>__name__<span> </span><span>==</span><span> </span><span>'__main__'</span><span>:</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Scheme's<span> </span>parameters</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>polynomial<span> </span>modulus<span> </span>degree</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>n<span> </span><span>=</span><span> </span><span>2</span><span> </span><span>**</span><span> </span><span>2</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>ciphertext<span> </span>modulus</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>q<span> </span><span>=</span><span> </span><span>2</span><span> </span><span>**</span><span> </span><span>14</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>plaintext<span> </span>modulus</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>t<span> </span><span>=</span><span> </span><span>2</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>base<span> </span>for<span> </span>relin_v1</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>T<span> </span><span>=</span><span> </span><span>int</span><span>(</span>np<span>.</span>sqrt<span>(</span>q<span>)</span><span>)</span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#modulusswitching<span> </span>modulus</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>p<span> </span><span>=</span><span> </span>q<span> </span><span>**</span><span> </span><span>3</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>polynomial<span> </span>modulus</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>poly_mod<span> </span><span>=</span><span> </span>np<span>.</span>array<span>(</span><span>[</span><span>1</span><span>]</span><span> </span><span>+</span><span> </span><span>[</span><span>0</span><span>]</span><span> </span><span>*</span><span> </span><span>(</span>n<span> </span><span>-</span><span> </span><span>1</span><span>)</span><span> </span><span>+</span><span> </span><span>[</span><span>1</span><span>]</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>in<span> </span>the<span> </span>encryption</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>std1<span> </span><span>=</span><span> </span><span>1</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#standard<span> </span>deviation<span> </span>for<span> </span>the<span> </span>error<span> </span>in<span> </span>the<span> </span>evaluateKeyGen_v2</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>std2<span> </span><span>=</span><span> </span><span>1</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Keygen</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>pk<span>,</span><span> </span>sk<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>keygen<span>(</span>n<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std1<span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#EvaluateKeygen_version1</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>rlk0_v1<span>,</span><span> </span>rlk1_v1<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>evaluate_keygen_v1<span>(</span>sk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>std1<span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#EvaluateKeygen_version2</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>rlk0_v2<span>,</span><span> </span>rlk1_v2<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>evaluate_keygen_v2<span>(</span>sk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>,</span><span> </span>p<span>,</span><span> </span>std2<span>)</span><span></span>\n<span></span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Encryption</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>pt1<span>,</span><span> </span>pt2<span> </span><span>=</span><span> </span><span>[</span><span>1</span><span>,</span><span> </span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>1</span><span>]</span><span>,</span><span> </span><span>[</span><span>1</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>0</span><span>,</span><span> </span><span>1</span><span>]</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>cst1<span>,</span><span> </span>cst2<span> </span><span>=</span><span> </span><span>[</span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>0</span><span>]</span><span>,</span><span> </span><span>[</span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>0</span><span>,</span><span> </span><span>0</span><span>]</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct1<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>encrypt<span>(</span>pk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>pt1<span>,</span><span> </span>std1<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct2<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>encrypt<span>(</span>pk<span>,</span><span> </span>n<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>pt2<span>,</span><span> </span>std1<span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>Ciphertext<span> </span>ct1({}):\"</span><span>.</span><span>format</span><span>(</span>pt1<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\"</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\\t<span> </span>ct1_0:\"</span><span>,</span><span> </span>ct1<span>[</span><span>0</span><span>]</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\\t<span> </span>ct1_1:\"</span><span>,</span><span> </span>ct1<span>[</span><span>1</span><span>]</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\"</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>Ciphertext<span> </span>ct2({}):\"</span><span>.</span><span>format</span><span>(</span>pt2<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\"</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\\t<span> </span>ct1_0:\"</span><span>,</span><span> </span>ct2<span>[</span><span>0</span><span>]</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\\t<span> </span>ct1_1:\"</span><span>,</span><span> </span>ct2<span>[</span><span>1</span><span>]</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"\"</span><span>)</span><span></span>\n<span></span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Evaluation</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct3<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>add_plain<span>(</span>ct1<span>,</span><span> </span>cst1<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct4<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>mul_plain<span>(</span>ct2<span>,</span><span> </span>cst2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#ct5<span> </span>=<span> </span>(ct1<span> </span>+<span> </span>cst1)<span> </span>+<span> </span>(cst2<span> </span>*<span> </span>ct2)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct5<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>add_cipher<span>(</span>ct3<span>,</span><span> </span>ct4<span>,</span><span> </span>q<span>,</span><span> </span>poly_mod<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>ct6<span> </span>=<span> </span>ct1<span> </span>*<span> </span>ct2</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct6<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>mul_cipher_v1<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>T<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0_v1<span>,</span><span> </span>rlk1_v1<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>ct7<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>mul_cipher_v2<span>(</span>ct1<span>,</span><span> </span>ct2<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>p<span>,</span><span> </span>poly_mod<span>,</span><span> </span>rlk0_v2<span>,</span><span> </span>rlk1_v2<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>#<span> </span>Decryption</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct3<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct3<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct4<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct4<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct5<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct5<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct6<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct6<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span>decrypted_ct7<span> </span><span>=</span><span> </span>rlwe_updated<span>.</span>decrypt<span>(</span>sk<span>,</span><span> </span>q<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>,</span><span> </span>ct7<span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>Decrypted<span> </span>ct3=(ct1<span> </span>+<span> </span>{}):<span> </span>{}\"</span><span>.</span><span>format</span><span>(</span>cst1<span>,</span><span> </span>decrypted_ct3<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>Decrypted<span> </span>ct4=(ct2<span> </span>*<span> </span>{}):<span> </span>{}\"</span><span>.</span><span>format</span><span>(</span>cst2<span>,</span><span> </span>decrypted_ct4<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>Decrypted<span> </span>ct5=(ct1<span> </span>+<span> </span>{}<span> </span>+<span> </span>{}<span> </span>*<span> </span>ct2):<span> </span>{}\"</span><span>.</span><span>format</span><span>(</span>cst1<span>,</span><span> </span>cst2<span>,</span><span> </span>decrypted_ct5<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>pt1<span> </span>+<span> </span>{}<span> </span>+<span> </span>{}<span> </span>*<span> </span>pt2):<span> </span>{}\"</span><span>.</span><span>format</span><span>(</span>cst1<span>,</span><span> </span>cst2<span>,</span><span> </span>rlwe_updated<span>.</span>polyadd<span>(</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlwe_updated<span>.</span>polyadd<span>(</span>pt1<span>,</span><span> </span>cst1<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>rlwe_updated<span>.</span>polymul<span>(</span>cst2<span>,</span><span> </span>pt2<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>,</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>Decrypted<span> </span>ct6=(ct1<span> </span>*<span> </span>ct2):<span> </span>{}\"</span><span>.</span><span>format</span><span>(</span>decrypted_ct6<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>Decrypted<span> </span>ct7=(ct1<span> </span>*<span> </span>ct2):<span> </span>{}\"</span><span>.</span><span>format</span><span>(</span>decrypted_ct7<span>)</span><span>)</span><span></span>\n<span></span><span> </span><span> </span><span> </span><span> </span><span>print</span><span>(</span><span>\"[+]<span> </span>pt1<span> </span>*<span> </span>pt2:<span> </span>{}\"</span><span>.</span><span>format</span><span>(</span>rlwe_updated<span>.</span>polymul<span>(</span>pt1<span>,</span><span> </span>pt2<span>,</span><span> </span>t<span>,</span><span> </span>poly_mod<span>)</span><span>)</span><span>)</span><span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>\n</code></pre></div>\n"},"galleries":{"asm_llm2024":[{"src":"/galleries/asm_llm2024/asmllm_code_repair.png","width":2570,"height":370},{"src":"/galleries/asm_llm2024/asmllm_downstream.png","width":1255,"height":769},{"src":"/galleries/asm_llm2024/markus-spiske-uPXs5Vx5bIg-unsplash-min.jpeg","width":5760,"height":3840}],"atari_agents_2022":[{"src":"/galleries/atari_agents_2022/collage.png","width":960,"height":1300},{"src":"/galleries/atari_agents_2022/dqn_modern_pytorch_vs_dopamine.png","width":1022,"height":367},{"src":"/galleries/atari_agents_2022/octocat.svg","width":16,"height":16},{"src":"/galleries/atari_agents_2022/rliable_comparison.png","width":875,"height":763},{"src":"/galleries/atari_agents_2022/sampling.png","width":1348,"height":164}],"bgv_scheme2023":[{"src":"/galleries/bgv_scheme2023/fhe_add.drawio.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_add_tiny.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_mul.drawio.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_mul_tiny.png","width":392,"height":307},{"src":"/galleries/bgv_scheme2023/fhe_noise.png","width":390,"height":412},{"src":"/galleries/bgv_scheme2023/fhe_noise_tiny.png","width":390,"height":412},{"src":"/galleries/bgv_scheme2023/fhe_simple.drawio.png","width":538,"height":161},{"src":"/galleries/bgv_scheme2023/fhe_simple_tiny.png","width":538,"height":161},{"src":"/galleries/bgv_scheme2023/lock.jpg","width":1200,"height":630},{"src":"/galleries/bgv_scheme2023/poly.drawio.png","width":342,"height":346},{"src":"/galleries/bgv_scheme2023/poly_tiny.png","width":342,"height":346},{"src":"/galleries/bgv_scheme2023/sec_game.drawio.png","width":350,"height":244},{"src":"/galleries/bgv_scheme2023/sec_game_tiny.png","width":350,"height":244}],"courses":[{"src":"/galleries/courses/atari_collage.png","width":960,"height":1300},{"src":"/galleries/courses/campus.jpg","width":725,"height":1080},{"src":"/galleries/courses/overview_bitdefender.jpg","width":1959,"height":2813},{"src":"/galleries/courses/overview_crypto.jpg","width":1920,"height":960},{"src":"/galleries/courses/overview_fmi.jpg","width":768,"height":600},{"src":"/galleries/courses/overview_pm.png","width":1194,"height":1190},{"src":"/galleries/courses/thumb_bitdefender.png","width":128,"height":128},{"src":"/galleries/courses/thumb_precis.jpg","width":128,"height":128},{"src":"/galleries/courses/thumb_rosedu.png","width":360,"height":360},{"src":"/galleries/courses/thumb_unibuc.png","width":512,"height":512}],"deep_bit_2019_pictures":[{"src":"/galleries/deep_bit_2019_pictures/20190731_150323.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_150331.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_153111.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_153118.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_164741.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/20190731_164747.jpg","width":4032,"height":1960},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142509.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142514.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142521.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142523_1.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_142925.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_144034.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145138.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145146.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145644.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145647.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145650.jpg","width":4160,"height":3120},{"src":"/galleries/deep_bit_2019_pictures/IMG_20190731_145654.jpg","width":4160,"height":3120}],"deep_bit_2019_posters":[{"src":"/galleries/deep_bit_2019_posters/poster_alin_passwords.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_bogdan_train_with_private_data.png","width":7200,"height":5400},{"src":"/galleries/deep_bit_2019_posters/poster_cristi_stegano.png","width":2480,"height":3507},{"src":"/galleries/deep_bit_2019_posters/poster_elena+adi_adversarial.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_horia+alin_homoglyph.png","width":6300,"height":4875},{"src":"/galleries/deep_bit_2019_posters/poster_mada_crypto_nets.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_mircescu_MRI.png","width":2480,"height":3507},{"src":"/galleries/deep_bit_2019_posters/poster_novac_logs_anomalies.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_tudor_fake_news.png","width":4965,"height":7021},{"src":"/galleries/deep_bit_2019_posters/poster_vlad_mouse_auth.png","width":4965,"height":7021}],"deep_fmi_2019_posters":[{"src":"/galleries/deep_fmi_2019_posters/10. EmoContext_Poster.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/10. Image_Segmentation.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/10. Landmark Recognition _ Visualization.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/10. Political Orientation Classification.png","width":7200,"height":5400},{"src":"/galleries/deep_fmi_2019_posters/10. Poster_VDSR.png","width":3507,"height":4957},{"src":"/galleries/deep_fmi_2019_posters/2048_RL.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/A LEARNED REPRESENTATION FOR ARTISTIC STYLE.png","width":1275,"height":1650},{"src":"/galleries/deep_fmi_2019_posters/Emotion_Detection.png","width":4500,"height":6300},{"src":"/galleries/deep_fmi_2019_posters/Emotion_Detection_CNN.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/Google Landmark Recognition Challenge.png","width":1755,"height":2480},{"src":"/galleries/deep_fmi_2019_posters/Image Classification.png","width":1275,"height":1650},{"src":"/galleries/deep_fmi_2019_posters/Image Semantic Segmentation.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/Image_Colorization.png","width":2478,"height":3507},{"src":"/galleries/deep_fmi_2019_posters/PosterRL.png","width":4965,"height":7021},{"src":"/galleries/deep_fmi_2019_posters/Revising Bi-Axial LSTM for Music Generation.png","width":4957,"height":7017},{"src":"/galleries/deep_fmi_2019_posters/Semantic Segmantation.png","width":8400,"height":8400},{"src":"/galleries/deep_fmi_2019_posters/Style Transfer.png","width":2480,"height":3300},{"src":"/galleries/deep_fmi_2019_posters/poster.png","width":1275,"height":1650}],"eeml2019_pictures":[{"src":"/galleries/eeml2019_pictures/andrei.jpg","width":1590,"height":1060},{"src":"/galleries/eeml2019_pictures/bitdefender_booth.jpg","width":1710,"height":1140},{"src":"/galleries/eeml2019_pictures/ema.jpg","width":1394,"height":930},{"src":"/galleries/eeml2019_pictures/florin.jpg","width":1152,"height":2048},{"src":"/galleries/eeml2019_pictures/florin_brad.jpg","width":928,"height":1392},{"src":"/galleries/eeml2019_pictures/full_house.jpg","width":1392,"height":928},{"src":"/galleries/eeml2019_pictures/group.jpg","width":1939,"height":1293},{"src":"/galleries/eeml2019_pictures/volunteers.jpg","width":1392,"height":928},{"src":"/galleries/eeml2019_pictures/z_ema_poster.png","width":1449,"height":2048},{"src":"/galleries/eeml2019_pictures/z_florin_poster.png","width":1698,"height":2400},{"src":"/galleries/eeml2019_pictures/z_iulia_andrei_poster.png","width":1772,"height":2496}],"eeml2019_posters":[{"src":"/galleries/eeml2019_posters/z_ema_poster.png","width":1449,"height":2048},{"src":"/galleries/eeml2019_posters/z_florin_poster.png","width":1698,"height":2400},{"src":"/galleries/eeml2019_posters/z_iulia_andrei_poster.png","width":1772,"height":2496}],"homomorphic2020":[{"src":"/galleries/homomorphic2020/alice.png","width":1000,"height":339},{"src":"/galleries/homomorphic2020/arithmetic_circuit.png","width":408,"height":382},{"src":"/galleries/homomorphic2020/dec_details.png","width":676,"height":312},{"src":"/galleries/homomorphic2020/enigma_dec.jpg","width":800,"height":1200},{"src":"/galleries/homomorphic2020/eval_mul.png","width":569,"height":460},{"src":"/galleries/homomorphic2020/eval_sum.png","width":567,"height":441},{"src":"/galleries/homomorphic2020/he_scheme5.png","width":1354,"height":390},{"src":"/galleries/homomorphic2020/noisy_cyphertext.png","width":658,"height":449}],"private_set2021":[{"src":"/galleries/private_set2021/monolith.jpg","width":800,"height":1200}],"rstg_pictures":[{"src":"/galleries/rstg_pictures/RSTG_model.png","width":2347,"height":1031},{"src":"/galleries/rstg_pictures/chart.svg","width":600,"height":371},{"src":"/galleries/rstg_pictures/digits.gif","width":692,"height":337},{"src":"/galleries/rstg_pictures/featured_graph_nets.jpg","width":1455,"height":1200},{"src":"/galleries/rstg_pictures/featured_graph_nets_bk.jpg","width":2784,"height":1856},{"src":"/galleries/rstg_pictures/interaction_videos.gif","width":1079,"height":258},{"src":"/galleries/rstg_pictures/rstg.gif","width":1353,"height":517},{"src":"/galleries/rstg_pictures/rstg_stages.gif","width":600,"height":565},{"src":"/galleries/rstg_pictures/smt-smt2.gif","width":725,"height":251}],"tmlss2018_pictures":[{"src":"/galleries/tmlss2018_pictures/dana.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/elena.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/florin.jpg","width":810,"height":1080},{"src":"/galleries/tmlss2018_pictures/iulia.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/lecture_hall.jpg","width":1920,"height":992},{"src":"/galleries/tmlss2018_pictures/salina.jpg","width":1920,"height":1280},{"src":"/galleries/tmlss2018_pictures/salina_1.jpg","width":1920,"height":1280},{"src":"/galleries/tmlss2018_pictures/stefan.jpg","width":1920,"height":1282},{"src":"/galleries/tmlss2018_pictures/stefan_1.jpg","width":1599,"height":899}],"tmlss2018_posters":[{"src":"/galleries/tmlss2018_posters/Bitdefender+NLP2SQL_1440.jpg","width":1440,"height":3558},{"src":"/galleries/tmlss2018_posters/ElenaBurceanu_Tracking_1440.jpg","width":1440,"height":2036},{"src":"/galleries/tmlss2018_posters/EmanuelaHaller_Segmentation_1440.jpg","width":1440,"height":2036},{"src":"/galleries/tmlss2018_posters/IuliaDuta_AndreiNicolicioiu_Video2NLP_1440.jpg","width":1440,"height":2036},{"src":"/galleries/tmlss2018_posters/StefanPostavaru_RMSProp_1440.jpg","width":1440,"height":2036}]}},"siteData":{"title":"Bitdefender Machine Learning & Crypto Research Unit","description":"Bitdefender Machine Learning & Crypto Research Unit goals are to further the fields of machine learning and criptography while engaging with the international research community and to develop the local AI&ML scene by supporting and participating in local conferences, lecture and research groups.","tagline":"Engaging with the broader Machine Learning Community.","tags":["machine-learning","research","bitdefender"]}};</script><script defer="" type="text/javascript" src="https://bit-ml.github.io/bootstrap.627376fc.js"></script><script defer="" type="text/javascript" src="https://bit-ml.github.io/templates/src/pages/Post.6f8f419e.js"></script><script defer="" type="text/javascript" src="https://bit-ml.github.io/main.6dead43a.js"></script></body></html>